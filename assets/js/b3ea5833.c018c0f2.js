"use strict";(self.webpackChunkmapml_viewer_doc=self.webpackChunkmapml_viewer_doc||[]).push([[2229],{8072:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var n=s(4848),r=s(8453);const o={id:"creating-styles",title:"Creating custom mvt styles",slug:"/user-guide/creating-styles"},l=void 0,i={id:"user-guide/creating-styles",title:"Creating custom mvt styles",description:"What are mvt files",source:"@site/docs/user-guide/creating-styles.md",sourceDirName:"user-guide",slug:"/user-guide/creating-styles",permalink:"/web-map-doc/docs/user-guide/creating-styles",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"creating-styles",title:"Creating custom mvt styles",slug:"/user-guide/creating-styles"},sidebar:"sidebar",previous:{title:"MapML Quick Start Guide",permalink:"/web-map-doc/docs/user-guide/quick-start"},next:{title:"Using mvt styles",permalink:"/web-map-doc/docs/user-guide/using-styles"}},a={},d=[{value:"What are mvt files",id:"what-are-mvt-files",level:2},{value:"What are pmtiles files",id:"what-are-pmtiles-files",level:2},{value:"How to create a stylesheet module",id:"how-to-create-a-stylesheet-module",level:2},{value:"The required structure of the pmtiles &#39;stylesheet&#39;",id:"the-required-structure-of-the-pmtiles-stylesheet",level:2},{value:"Available imported symbols from protomaps-leaflet",id:"available-imported-symbols-from-protomaps-leaflet",level:2}];function c(e){const t={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"what-are-mvt-files",children:"What are mvt files"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://github.com/mapbox/vector-tile-spec",children:"Mapbox vector tiles (mvt)"})," files are a de facto standard encoding of map data optimized for rendering to HTML canvas element(s) via JavaScript and/or JSON-based encoded style information.  Cascading Style Sheet rules do not apply, because mvt content is not exposed via browser APIs, so\nstyle rules, while ",(0,n.jsx)(t.a,{href:"https://glazkov.com/2024/01/16/declarative-vs-imperative/",children:"sort-of declarative"}),", are implemented in script."]}),"\n",(0,n.jsx)(t.h2,{id:"what-are-pmtiles-files",children:"What are pmtiles files"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://docs.protomaps.com/pmtiles/",children:"pmtiles"})," is a map tile archive format that is intended to obviate (some of) the need for complex geospatial-specific servers and APIs for tile resources on the web, to enable people to create their own localized web map sites without having to host the whole world on their domain.  The pmtiles archive format contains metadata that can be requested via http byte range requests, and subsequent requests for individual tiles are also sent as byte range requests."]}),"\n",(0,n.jsxs)(t.p,{children:["The pmtiles map archive and mvt ",(0,n.jsx)(t.a,{href:"../elements/link#type",children:"formats"})," in the MapML polyfill are integrated via\n",(0,n.jsx)(t.a,{href:"https://docs.protomaps.com/pmtiles/leaflet",children:"the protomaps-leaflet library"}),".  Protomaps-leaflet is designed to support the (de facto standard) Web Mercator tile grid. This allows\nthe MapML polyfill to integrate support for pmtiles and mvt data sources for only the ",(0,n.jsx)(t.code,{children:"OSMTILE"})," projection.  ",(0,n.jsx)(t.code,{children:"<map-layer>"})," and ",(0,n.jsx)(t.code,{children:"<map-extent>"})," elements and the ",(0,n.jsx)(t.code,{children:"<mapml-viewer>"})," will\nnot work (and will be permanently ",(0,n.jsx)(t.code,{children:"disabled"}),") when used with ",(0,n.jsx)(t.code,{children:'<mapml-viewer projection="ANYTHING"...>'})," or ",(0,n.jsx)(t.code,{children:'<map-extent units="ANYTHING"...>'})," values apart from ",(0,n.jsx)(t.code,{children:"OSMTILE"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["Before proceeding below, you should read the ",(0,n.jsx)(t.a,{href:"https://docs.protomaps.com/pmtiles/leaflet#custom-vector-data",children:"protomaps-leaflet"})," documentation on custom styling.\nAnother useful source of information for styling includes ",(0,n.jsx)(t.a,{href:"https://github.com/protomaps/protomaps-leaflet/tree/main/examples",children:"the source code examples"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["Working examples of ",(0,n.jsx)(t.code,{children:"<mapml-viewer>"})," usage of themes and styles are ",(0,n.jsx)(t.a,{href:"https://maps4html.org/experiments/vector-tiles/pmtiles/",children:"available on-line"}),", with available ",(0,n.jsx)(t.a,{href:"https://github.com/Maps4HTML/experiments/tree/main/vector-tiles/pmtiles",children:"source code"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"how-to-create-a-stylesheet-module",children:"How to create a stylesheet module"}),"\n",(0,n.jsxs)(t.p,{children:["A pmtiles stylesheet used in the MapML polyfill is a JavaScript module source file which exports",(0,n.jsx)(t.br,{}),"\n","two symbols, a ",(0,n.jsx)(t.code,{children:"pmtilesRules"})," Map instance, and a Promise-valued ",(0,n.jsx)(t.code,{children:"pmtilesRulesReady"}),", which is resolved when\nthe required Sheet is loaded, per the following example:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:'const sheet = new protomapsL.Sheet(`\n<html>\n  <body>\n    <svg id="icon_0" width="99px" height="97px" xmlns="http://www.w3.org/2000/svg">\n      <image href="data:image/svg+xml;base64,PHN2ZyBpZD0iaWNvbl82NCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgICAgPGltYWdlIGhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQkFBQUFBUUNBWUFBQUFmOC85aEFBQUFDWEJJV1hNQUFBN0VBQUFPeEFHVkt3NGJBQUFBMlVsRVFWUjRuTldQTVdvQ1lSQ0Z2MElDZ2xZaFZnRUwzZmNyZGlsczBteVJUdkFLa2xaSXdKM2ZpTjE2aGhoeUFCRkVjZ2J2WUtFbmtCUkpiNWtFSlRheXNNdFd5WVBYRFBPOW1RZC9YcjVHSlRkc1Rhb21wdm12TzBZbVB1T1FRcjRQeE5yRXR3L29wQzdITFM1TVRFd3NEdmFPdHdOOERCRGIwenh5eklkMWJoSkQraTFLWHN4T1lJSjN2a0dZM2ozZ1BnRmVqUnRjWnVvK2ROeWVCM2l4Skt0TXZQeUNtMGc4bS9neXNYOXlsRlBoT0tUZ3hZYzVYZ2ZYRkkrVnhKMkpkeE85MUlDQmFFZU83dm44b2M2VkQzak1YT1AvNkFmS0Ywd3dXeU9Oc3dBQUFBQkpSVTVFcmtKZ2dnPT0iIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIvPgogICAgPC9zdmc+" width="99" height="97" />\n    </svg>\n  </body>\n</html>\n`);\nconst pmtilesRules = new Map();\nconst pmtilesRulesReady = sheet.load().then(() => {\n  ...\n  pmtilesRules.set(\n    \'https://maps4html.org/experiments/vector-tiles/pmtiles/spearfish.pmtiles?theme=light\',\n    { theme: { theme: \'light\' } }\n  );\n  ...\n  return pmtilesRules;\n});\nexport { pmtilesRules, pmtilesRulesReady };\n'})}),"\n",(0,n.jsx)(t.admonition,{type:"tip",children:(0,n.jsxs)(t.p,{children:["Pre-defined themes that you can use include: ",(0,n.jsx)(t.code,{children:"light"}),", ",(0,n.jsx)(t.code,{children:"dark"}),", ",(0,n.jsx)(t.code,{children:"white"}),", ",(0,n.jsx)(t.code,{children:"grayscale"})," and ",(0,n.jsx)(t.code,{children:"black"}),". You should include the theme name in the URL template as a parameter (even though it is not required by the pmtiles or mvt resource), so that the URL template can be made unique and distinct from other pmtilesRules keys' use of the same pmtiles or mvt resource."]})}),"\n",(0,n.jsx)(t.h2,{id:"the-required-structure-of-the-pmtiles-stylesheet",children:"The required structure of the pmtiles 'stylesheet'"}),"\n",(0,n.jsxs)(t.p,{children:["The stylesheet module must export two symbols: ",(0,n.jsx)(t.code,{children:"pmtilesRulesReady"})," and ",(0,n.jsx)(t.code,{children:"pmtilesRules"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"pmtilesRulesReady"})," export must be a Promise that signals to the MapML library that\nthe pmttilesRules export is fully defined and ready for rendering.  If your stylesheet\nuses IconSymbolizer, it may be convenient to perform resource loading and processing\nvia the asynchronous Sheet.load() function, which itself returns a Promise object that\nmay be returned by your stylesheet as the pmtilesRulesReady value, as\nshown in the example above. If your stylesheet does not require icons, it should\nbe possible to assign an already-resolved promise as the value of pmtilesRulesReady,\nvia Promise.resolve(), and return that."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"const pmtilesRules = new Map();\n// a Map requires a key, in this case the absolute URL of the data source (but,\n// can also be the absolute value of the URL _template_ for the data source),\n// and an object to be mapped by the key, in this case, an object with a `theme`\n// member, whose value is itself an object with a `theme` member.\npmtilesRules.set(\n    'https://maps4html.org/experiments/vector-tiles/pmtiles/spearfish.pmtiles?theme=light',\n    { theme: { theme: 'light' } }\n);\nconst pmtilesRulesReady = Promise.resolve();\nexport { pmtilesRules, pmtilesRulesReady };\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"pmtilesRules"})," export must be a ",(0,n.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map",children:"JavaScript Map-type object"}),", structured as follows:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"must have a unique URL template string key that will be used on the web to identify a set of rules"}),"\n",(0,n.jsxs)(t.li,{children:["has an object value that has a ",(0,n.jsx)(t.code,{children:"theme"})," or a ",(0,n.jsx)(t.code,{children:"rules"})," property"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"theme"})," property must be an object literal, itself with a ",(0,n.jsx)(t.code,{children:"theme"})," property with a string theme name value: ",(0,n.jsx)(t.code,{children:"{theme:{theme:'grayscale'}}"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"rules"})," property must be an object literal, with ",(0,n.jsx)(t.code,{children:"PAINT_RULES: [...]"})," and/or a ",(0,n.jsx)(t.code,{children:"LABEL_RULES: [...]"})," array-valued properties"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"PAINT_RULES"})," and ",(0,n.jsx)(t.code,{children:"LABEL_RULES"})," are arrays of objects that have required ",(0,n.jsx)(t.code,{children:"dataLayer"})," and ",(0,n.jsx)(t.code,{children:"symbolizer"})," properties"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"PAINT_RULES"})," and ",(0,n.jsx)(t.code,{children:"LABEL_RULES"})," can have optional properties e.g. ",(0,n.jsx)(t.code,{children:"filter"}),", ",(0,n.jsx)(t.code,{children:"minzoom"}),", ",(0,n.jsx)(t.code,{children:"maxzoom"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"dataLayer"})," is a string property that is the name of a layer encoded in the mvt data"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"symbolizer"})," is property of ",(0,n.jsx)(t.code,{children:"Symbolizer"}),"-type value"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"An example custom pmtiles stylesheet module for a localhost GeoServer 'spearfish' Layer Group (set up with a mvt tile cache) is as follows:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"class SpearfishSymbolizer {\n  constructor(options) {\n    this.color = options.color;\n    this.shape = options.shape;\n  }\n  draw(context, geom, z, feature) {\n    let pt = geom[0][0];\n    context.fillStyle = this.color;\n    context.strokeStyle = this.color;\n    context.beginPath();\n    if (this.shape === 'circle') {\n      context.arc(pt.x, pt.y, 3, 0, 2 * Math.PI);\n    } else {\n      context.rect(pt.x - 2, pt.y - 2, 4, 4);\n    }\n    context.stroke();\n    context.fill();\n  }\n}\n// the only other pmtilesRules keyed value besides `theme` that is supported is \n// an object with a `rules` member. The value of the `rules` member is an object \n// that has two optional array-valued members, `PAINT_RULES` and `LABEL_RULES`.\nconst pmtilesRules = new Map();\npmtilesRules.set(\n  'http://localhost:8080/geoserver/gwc/service/wmts/rest/spearfish/OSMTILE/{z}/{y}/{x}?format=application/vnd.mapbox-vector-tile',\n  {\n// PAINT_RULES and LABEL_RULES are each an array of dataLayer/symbolizer objects, with optional \n// function-valued `filter` member (filter is a member of the same object as\n// dataLayer and symbolizer, not a property of those objects).\n    rules: {\n      PAINT_RULES: [\n        {\n          dataLayer: 'streams',\n          symbolizer: new protomapsL.LineSymbolizer({ color: 'steelblue', width: 2 })\n        },\n        {\n          dataLayer: 'roads',\n          symbolizer: new protomapsL.LineSymbolizer({ color: 'maroon', width: 2 })\n        },\n        {\n          dataLayer: 'restricted',\n          symbolizer: new protomapsL.PolygonSymbolizer({\n            fill: 'red',\n            opacity: 0.5\n          })\n        },\n        {\n          dataLayer: 'restricted',\n          symbolizer: new protomapsL.LineSymbolizer({ color: 'red', width: 2 })\n        },\n        {\n          dataLayer: 'archsites',\n          symbolizer: new SpearfishSymbolizer({\n            color: 'red',\n            shape: 'square'\n          })\n        },\n        {\n          dataLayer: 'bugsites',\n          symbolizer: new SpearfishSymbolizer({\n            color: 'black',\n            shape: 'circle'\n          })\n        }\n      ],\n      LABEL_RULES: [\n        {\n          dataLayer: 'archsites',\n          symbolizer: new protomapsL.CenteredTextSymbolizer({\n            labelProps: ['str1'],\n            fill:'white',\n            width:2,\n            stroke:'black',\n            font:\"600 16px sans-serif\"\n          }),\n          // note that filter is a property of a rule, not an option to a symbolizer\n          filter: (z,f) => { return f.props['str1'].trim().toLowerCase() !== 'no name'; }\n        }\n      ]\n    }\n  }\n);\nexport { pmtilesRules };\n"})}),"\n",(0,n.jsx)(t.h2,{id:"available-imported-symbols-from-protomaps-leaflet",children:"Available imported symbols from protomaps-leaflet"}),"\n",(0,n.jsxs)(t.p,{children:["The following imports from protomaps-leaflet are available on the ",(0,n.jsx)(t.code,{children:"protomapsL"})," import, for use by your stylesheets:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"/* \n\n  CenteredSymbolizer,\n  CenteredTextSymbolizer,\n  CircleSymbolizer,\n  FlexSymbolizer,\n  Font,\n  GeomType,\n  GroupSymbolizer,\n  IconSymbolizer,\n  Index,\n  Justify,\n  Labeler,\n  Labelers,\n  LineLabelPlacement,\n  LineLabelSymbolizer,\n  LineSymbolizer,\n  OffsetSymbolizer,\n  OffsetTextSymbolizer,\n  Padding,\n  PmtilesSource,\n  PolygonSymbolizer,\n  Sheet,\n  ShieldSymbolizer,\n  Static,\n  TextPlacements,\n  TextSymbolizer,\n  TileCache,\n  View,\n  ZxySource,\n  arr,\n  covering,\n  createPattern,\n  exp,\n  getZoom,\n  isCcw,\n  isInRing,\n  labelRules,\n  leafletLayer,\n  linear,\n  paint,\n  paintRules,\n  pointInPolygon,\n  pointMinDistToLines,\n  pointMinDistToPoints,\n  sourcesToViews,\n  step,\n  toIndex,\n  transformGeom,\n  wrap\n*/\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>l,x:()=>i});var n=s(6540);const r={},o=n.createContext(r);function l(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);