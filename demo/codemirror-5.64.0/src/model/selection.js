import{cmp,copyPos,equalCursorPos,maxPos,minPos}from"../line/pos.js";import{indexOf}from"../util/misc.js";export class Selection{constructor(e,t){this.ranges=e,this.primIndex=t}primary(){return this.ranges[this.primIndex]}equals(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(let t=0;t<this.ranges.length;t++){let r=this.ranges[t],n=e.ranges[t];if(!equalCursorPos(r.anchor,n.anchor)||!equalCursorPos(r.head,n.head))return!1}return!0}deepCopy(){let e=[];for(let t=0;t<this.ranges.length;t++)e[t]=new Range(copyPos(this.ranges[t].anchor),copyPos(this.ranges[t].head));return new Selection(e,this.primIndex)}somethingSelected(){for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1}contains(e,t){t||(t=e);for(let r=0;r<this.ranges.length;r++){let n=this.ranges[r];if(cmp(t,n.from())>=0&&cmp(e,n.to())<=0)return r}return-1}}export class Range{constructor(e,t){this.anchor=e,this.head=t}from(){return minPos(this.anchor,this.head)}to(){return maxPos(this.anchor,this.head)}empty(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}}export function normalizeSelection(e,t,r){let n=e&&e.options.selectionsMayTouch,o=t[r];t.sort(((e,t)=>cmp(e.from(),t.from()))),r=indexOf(t,o);for(let s=1;s<t.length;s++){let e=t[s],o=t[s-1],i=cmp(o.to(),e.from());if(n&&!e.empty()?i>0:i>=0){let n=minPos(o.from(),e.from()),i=maxPos(o.to(),e.to()),h=o.empty()?e.from()==e.head:o.from()==o.head;s<=r&&--r,t.splice(--s,2,new Range(h?i:n,h?n:i))}}return new Selection(t,r)}export function simpleSelection(e,t){return new Selection([new Range(e,t||e)],0)}