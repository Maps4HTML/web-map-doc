import{getHandlers}from"./event.js";let operationGroup=null;export function pushOperation(l){operationGroup?operationGroup.ops.push(l):l.ownsGroup=operationGroup={ops:[l],delayedCallbacks:[]}}function fireCallbacksForOps(l){let e=l.delayedCallbacks,a=0;do{for(;a<e.length;a++)e[a].call(null);for(let e=0;e<l.ops.length;e++){let a=l.ops[e];if(a.cursorActivityHandlers)for(;a.cursorActivityCalled<a.cursorActivityHandlers.length;)a.cursorActivityHandlers[a.cursorActivityCalled++].call(null,a.cm)}}while(a<e.length)}export function finishOperation(l,e){let a=l.ownsGroup;if(a)try{fireCallbacksForOps(a)}finally{operationGroup=null,e(a)}}let orphanDelayedCallbacks=null;export function signalLater(l,e){let a=getHandlers(l,e);if(!a.length)return;let r,o=Array.prototype.slice.call(arguments,2);operationGroup?r=operationGroup.delayedCallbacks:orphanDelayedCallbacks?r=orphanDelayedCallbacks:(r=orphanDelayedCallbacks=[],setTimeout(fireOrphanDelayed,0));for(let t=0;t<a.length;++t)r.push((()=>a[t].apply(null,o)))}function fireOrphanDelayed(){let l=orphanDelayedCallbacks;orphanDelayedCallbacks=null;for(let e=0;e<l.length;++e)l[e]()}