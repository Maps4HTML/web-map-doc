var tests=[],filters=[],nameCounts={};function Failure(e){this.message=e}function indexOf(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;n<i;++n)if(e[n]==t)return n;return-1}function test(e,t,n){return null==nameCounts[e]?nameCounts[e]=2:e=e+"_"+nameCounts[e]++,tests.push({name:e,func:t,expectedFail:n}),e}Failure.prototype.toString=function(){return this.message};var namespace="";function testCM(e,t,n,i){return test(namespace+e,(function(){var e=document.getElementById("testground"),i=window.cm=CodeMirror(e,n),r=!1;try{t(i),r=!0}finally{!r||verbose?e.style.visibility="visible":e.removeChild(i.getWrapperElement())}}),i)}function runTests(e){var t=0;!function n(i){for(;;){if(i===tests.length)return running=!1,e("done");var r=tests[i],a=!1;if(filters.length){a=!0;for(var s=0;s<filters.length;s++)r.name.match(filters[s])&&(a=!1)}if(!a)break;e("skipped",r.name,f),i++}var l=r.expectedFail,o=+new Date,u=!1;try{var f=r.func()}catch(m){if(u=!0,l)e("expected",r.name);else if(m instanceof Failure)e("fail",r.name,m.message);else{var c=/(?:\bat |@).*?([^\/:]+):(\d+)/.exec(m.stack);c&&console.log(m.stack),e("error",r.name,m.toString()+(c?" ("+c[1]+":"+c[2]+")":""))}}if(u||(l?e("fail",r.name,f||"expected failure, but passed"):e("ok",r.name,f)),quit)return running=!1,null;var h=0;(t+=+new Date-o)>500&&(t=0,h=50),setTimeout((function(){n(i+1)}),h)}(0)}function label(e,t){return t?e+" ("+t+")":e}function eq(e,t,n){if(e!=t)throw new Failure(label(e+" != "+t,n))}function near(e,t,n,i){if(Math.abs(e-t)>n)throw new Failure(label(e+" is not close to "+t+" ("+n+")",i))}function eqCharPos(e,t,n){function i(e){return"{line:"+e.line+",ch:"+e.ch+",sticky:"+e.sticky+"}"}if(e!=t){if(null==e)throw new Failure(label("comparing null to "+i(t),n));if(null==t)throw new Failure(label("comparing "+i(e)+" to null",n));if(e.line!=t.line||e.ch!=t.ch)throw new Failure(label(i(e)+" != "+i(t),n))}}function eqCursorPos(e,t,n){eqCharPos(e,t,n),e&&eq(e.sticky,t.sticky,n?n+" (sticky)":"sticky")}function is(e,t){if(!e)throw new Failure(label("assertion failed",t))}function countTests(){if(!filters.length)return tests.length;for(var e=0,t=0;t<tests.length;++t)for(var n=tests[t].name,i=0;i<filters.length;i++)if(n.match(filters[i])){++e;break}return e}function parseTestFilter(e){return/_\*$/.test(e)?new RegExp("^"+e.slice(0,e.length-2),"i"):new RegExp(e,"i")}