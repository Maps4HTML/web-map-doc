<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo</title>
    <script type="module" src="../dist/mapml-viewer.js"></script>

    
    <link rel="stylesheet" href="codemirror-5.64.0/lib/codemirror.css">
    <script src="codemirror-5.64.0/lib/codemirror.js"></script>
    <script src="codemirror-5.64.0/mode/xml/xml.js"></script>
    <script src="codemirror-5.64.0/mode/css/css.js"></script>
    <script src="codemirror-5.64.0/mode/javascript/javascript.js"></script>
    <scrip src="codemirror-5.64.0/addon/edit/closetag.js"></scrip>

    <style>
        html, body {
            width: 100%;
            background-color: #faf8f5;
        }
        .tabcontent {
            width: 50%; 
            display: none;
            border-top: none;
            /*background-color: rgb(67, 196, 196);*/
        }
        #output {
            width:48%;
            display: inline-block;
            background-color: #ffffff;
        }
        mapml-viewer:defined {
            height: 300px;
            width: 100%;
            border-style: none;
        }
        button {
            width:auto;
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding: 4px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            font-size: 25px;
        }
        h2 {
            display:inline;
            color: #383838;
        }
        /* Style the tab */
        .tab {
            overflow: hidden;
        }
        /* Style the buttons that are used to open the tab content */
        .tab button {

            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 5px 10px;
            transition: 0.3s;
        }
        /* Change background color of buttons on hover */
        .tab button:hover {
            background-color: #ddd;
        }
        /* Create an active/current tablink class */
        .tab button.active {
            background-color: #ccc;
        }
    </style>
</head>
<body>
    <div style="text-align: center;">
        <h2>MapML Demo: &lt;layer-&gt;</h2>
        <button class="run" onclick="plot()">â–¶</button>
    </div>

    <div class="tab">
        <button id="default" class="tablinks" onclick="switchTab(event, 'HTML')">HTML</button>
        <button class="tablinks" onclick="switchTab(event, 'CSS')">CSS</button>
    </div>

    <div class="tabcontent" id="HTML">
        <textarea rows="10" style="width:100%" id="htmlEditor">
<mapml-viewer projection="OSMTILE" zoom="12" lat="45.42" lon="-75.70">
  <layer- label="OpenStreetMap" src="https://geogratis.gc.ca/mapml/en/osmtile/osm/" checked></layer->
  <layer- label="Ottawa" checked>
    <map-meta name="projection" content="OSMTILE"></map-meta>
    <map-meta name="cs" content="gcrs"></map-meta>
    <map-feature class="ottawa">
      <map-featurecaption>Ottawa</map-featurecaption>
      <map-geometry>
        <map-point>
          <map-coordinates>-75.697193 45.421530</map-coordinates>
        </map-point>
      </map-geometry>
      <map-properties>
        <table>
          <thead>
            <tr>
              <th role="columnheader" scope="col">Property name</th>
              <th role="columnheader" scope="col">Property value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th scope="row">Name</th>
              <td itemprop="amenity">Ottawa</td>
            </tr>
            <tr>
              <th scope="row">Type</th>
              <td itemprop="name">City</td>
            </tr>
            <tr>
              <th scope="row">Website</th>
              <td itemprop="website"><a href="https://ottawa.ca/" target="_blank">Ottawa</a></td>
            </tr>
          </tbody>
        </table>
      </map-properties>
    </map-feature>
  </layer->
</mapml-viewer></textarea>
    </div>
    <div class="tabcontent" id="CSS">
        <textarea rows="10" style="width:100%" id="cssEditor">
.ottawa {
  fill: #ea4335;
  stroke: #b21511;
}</textarea>
    </div>

    <div id="output"></div>

    <script>
        // Styling HTML Text Editor
        var htmlEditor = CodeMirror.fromTextArea(document.getElementById('htmlEditor'), {
            mode: "xml",
            //lineNumbers: true,
            screenReaderLabel: "MapML Demo Code",
            tabSize: 2,
            autoCloseTags: true
        });

        // Styling CSS Text Editor
        var cssEditor = CodeMirror.fromTextArea(document.getElementById('cssEditor'), {
            mode: "css",
            //lineNumbers: true,
            screenReaderLabel: "MapML Demo Code",
            tabSize: 2,
            autoCloseTags: true
        });

        // Plot the new mapml map when run button is clicked
        function plot() {
            let parser = new DOMParser();

            // HTML Parsing and implementing
            let rawText = htmlEditor.getValue();

            let mapml = parser.parseFromString(rawText, "text/html");
            mapml = mapml.querySelector('mapml-viewer');

            // CSS Parsing and implementing
            let rawTextCSS = cssEditor.getValue();

            let mapmlCSS = parser.parseFromString("<map-style>" + rawTextCSS + "</map-style>", "text/xml").querySelector('map-style');

            // Adding the CSS to each layer
            let layers = mapml.querySelectorAll('layer-');
            for (i=0; i<layers.length; ++i) {
                layers[i].appendChild(mapmlCSS);
            }

            // Adding code to output div
            let output = document.getElementById('output');
            output.replaceChild(mapml, output.querySelector('mapml-viewer'));
        }

        // Plot map when page is loaded using the deafult text
        window.onload = (event) => {
            let parser = new DOMParser();

            // HTML Parsing and implementing
            let rawText = htmlEditor.getValue();
            let mapml = parser.parseFromString(rawText, "text/html");
            mapml = mapml.querySelector('mapml-viewer');
            
            // CSS Parsing and implementing
            let rawTextCSS = cssEditor.getValue();
            let mapmlCSS = parser.parseFromString("<map-style>" + rawTextCSS + "</map-style>", "text/xml").querySelector('map-style');
            // Adding the CSS to each layer
            let layers = mapml.querySelectorAll('layer-');
            for (i=0; i<layers.length; ++i) {
                layers[i].appendChild(mapmlCSS);
            }
            // Adding code to output div
            let output = document.getElementById('output');
            output.appendChild(mapml);
        };

        // Function for switching between HTML and CSS
        function switchTab(evt, tab) {
            // Declare all variables
            let i, tabcontent, tablinks;

            // Get all elements with class="tabcontent" and hide them
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Get all elements with class="tablinks" and remove the class "active"
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            // Show the current tab, and add an "active" class to the button that opened the tab
            document.getElementById(tab).style.display = "inline-block";
            htmlEditor.refresh();
            cssEditor.refresh();
            evt.currentTarget.className += " active";
        }
        
        // Select The HTML Tab as the default
        document.getElementById('default').click();
    </script>
</body>
</html>
