{"version":3,"file":"mapml-viewer.js","sources":["../src/mapml-viewer.js"],"sourcesContent":["import './leaflet.js'; // bundled with proj4, proj4leaflet, modularized\nimport './mapml.js';\nimport DOMTokenList from './DOMTokenList.js';\nimport { MapLayer } from './layer.js';\nimport { MapCaption } from './map-caption.js';\nimport { MapFeature } from './map-feature.js';\nimport { MapExtent } from './map-extent.js';\n\nexport class MapViewer extends HTMLElement {\n  static get observedAttributes() {\n    return [\n      'lat',\n      'lon',\n      'zoom',\n      'projection',\n      'width',\n      'height',\n      'controls',\n      'static',\n      'controlslist'\n    ];\n  }\n  // see comments below regarding attributeChangedCallback vs. getter/setter\n  // usage.  Effectively, the user of the element must use the property, not\n  // the getAttribute/setAttribute/removeAttribute DOM API, because the latter\n  // calls don't result in the getter/setter being called (so you have to use\n  // the getter/setter directly)\n  get controls() {\n    return this.hasAttribute('controls');\n  }\n  set controls(value) {\n    const hasControls = Boolean(value);\n    if (hasControls) {\n      this.setAttribute('controls', '');\n    } else {\n      this.removeAttribute('controls');\n    }\n  }\n  get controlsList() {\n    return this._controlsList;\n  }\n  set controlsList(value) {\n    this._controlsList.value = value;\n    this.setAttribute('controlslist', value);\n  }\n  get width() {\n    return window.getComputedStyle(this).width.replace('px', '');\n  }\n  set width(val) {\n    //img.height or img.width setters change or add the corresponding attributes\n    this.setAttribute('width', val);\n  }\n  get height() {\n    return window.getComputedStyle(this).height.replace('px', '');\n  }\n  set height(val) {\n    //img.height or img.width setters change or add the corresponding attributes\n    this.setAttribute('height', val);\n  }\n  get lat() {\n    return this.hasAttribute('lat') ? this.getAttribute('lat') : '0';\n  }\n  set lat(val) {\n    if (val) {\n      this.setAttribute('lat', val);\n    }\n  }\n  get lon() {\n    return this.hasAttribute('lon') ? this.getAttribute('lon') : '0';\n  }\n  set lon(val) {\n    if (val) {\n      this.setAttribute('lon', val);\n    }\n  }\n  get projection() {\n    return this.hasAttribute('projection')\n      ? this.getAttribute('projection')\n      : '';\n  }\n  set projection(val) {\n    if (val && M[val]) {\n      this.setAttribute('projection', val);\n      if (this._map && this._map.options.projection !== val) {\n        this._map.options.crs = M[val];\n        this._map.options.projection = val;\n        for (let layer of this.querySelectorAll('layer-')) {\n          layer.removeAttribute('disabled');\n          let reAttach = this.removeChild(layer);\n          this.appendChild(reAttach);\n        }\n        if (this._debug) for (let i = 0; i < 2; i++) this.toggleDebug();\n      } else this.dispatchEvent(new CustomEvent('createmap'));\n    } else throw new Error('Undefined Projection');\n  }\n  get zoom() {\n    return this.hasAttribute('zoom') ? this.getAttribute('zoom') : 0;\n  }\n  set zoom(val) {\n    var parsedVal = parseInt(val, 10);\n    if (!isNaN(parsedVal) && parsedVal >= 0 && parsedVal <= 25) {\n      this.setAttribute('zoom', parsedVal);\n    }\n  }\n  get layers() {\n    return this.getElementsByTagName('layer-');\n  }\n\n  get extent() {\n    let map = this._map,\n      pcrsBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        map.getZoom(),\n        map.options.projection\n      );\n    let formattedExtent = M._convertAndFormatPCRS(pcrsBounds, map);\n    if (map.getMaxZoom() !== Infinity) {\n      formattedExtent.zoom = {\n        minZoom: map.getMinZoom(),\n        maxZoom: map.getMaxZoom()\n      };\n    }\n    return formattedExtent;\n  }\n  get static() {\n    return this.hasAttribute('static');\n  }\n  set static(value) {\n    const isStatic = Boolean(value);\n    if (isStatic) this.setAttribute('static', '');\n    else this.removeAttribute('static');\n  }\n\n  constructor() {\n    // Always call super first in constructor\n    super();\n    this._source = this.outerHTML;\n    // create an array to track the history of the map and the current index\n    this._history = [];\n    this._historyIndex = -1;\n    this._traversalCall = false;\n  }\n  connectedCallback() {\n    this._initShadowRoot();\n\n    this._controlsList = new DOMTokenList(\n      this.getAttribute('controlslist'),\n      this,\n      'controlslist',\n      [\n        'noreload',\n        'nofullscreen',\n        'nozoom',\n        'nolayer',\n        'noscale',\n        'geolocation'\n      ]\n    );\n\n    var s = window.getComputedStyle(this),\n      wpx = s.width,\n      hpx = s.height,\n      w = this.hasAttribute('width')\n        ? this.getAttribute('width')\n        : parseInt(wpx.replace('px', '')),\n      h = this.hasAttribute('height')\n        ? this.getAttribute('height')\n        : parseInt(hpx.replace('px', ''));\n    this._changeWidth(w);\n    this._changeHeight(h);\n\n    // wait for createmap event before creating leaflet map\n    // this allows a safeguard for the case where loading a custom TCRS takes\n    // longer than loading mapml-viewer.js/web-map.js\n    // the REASON we need a synchronous event listener (see comment below)\n    // is because the mapml-viewer element has / can have a size of 0 up until after\n    // something that happens between this point and the event handler executing\n    // perhaps a browser rendering cycle??\n    this.addEventListener('createmap', this._createMap);\n\n    let custom = !['CBMTILE', 'APSTILE', 'OSMTILE', 'WGS84'].includes(\n      this.projection\n    );\n    // this is worth a read, because dispatchEvent is synchronous\n    // https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent\n    // In particular:\n    //   \"All applicable event handlers are called and return before dispatchEvent() returns.\"\n    if (!custom) {\n      this.dispatchEvent(new CustomEvent('createmap'));\n    }\n    // https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/274\n    this.setAttribute('role', 'application');\n    this._toggleStatic();\n\n    /*\n    1. only deletes aria-label when the last (only remaining) map caption is removed\n    2. only deletes aria-label if the aria-label was defined by the map caption element itself\n    */\n\n    let mapcaption = this.querySelector('map-caption');\n\n    if (mapcaption !== null) {\n      setTimeout(() => {\n        let ariaupdate = this.getAttribute('aria-label');\n\n        if (ariaupdate === mapcaption.innerHTML) {\n          this.mapCaptionObserver = new MutationObserver((m) => {\n            let mapcaptionupdate = this.querySelector('map-caption');\n            if (mapcaptionupdate !== mapcaption) {\n              this.removeAttribute('aria-label');\n            }\n          });\n          this.mapCaptionObserver.observe(this, {\n            childList: true\n          });\n        }\n      }, 0);\n    }\n  }\n  _initShadowRoot() {\n    if (!this.shadowRoot) {\n      this.attachShadow({ mode: 'open' });\n    }\n    let tmpl = document.createElement('template');\n    /* jshint ignore:start */\n    tmpl.innerHTML = `<link rel=\"stylesheet\" href=\"${\n      new URL('mapml.css', import.meta.url).href\n    }\">`;\n    /* jshint ignore:end */\n\n    let shadowRoot = this.shadowRoot;\n    this._container = document.createElement('div');\n\n    let output =\n      \"<output role='status' aria-live='polite' aria-atomic='true' class='mapml-screen-reader-output'></output>\";\n    this._container.insertAdjacentHTML('beforeend', output);\n\n    // Set default styles for the map element.\n    let mapDefaultCSS = document.createElement('style');\n    mapDefaultCSS.innerHTML =\n      `:host {` +\n      `all: initial;` + // Reset properties inheritable from html/body, as some inherited styles may cause unexpected issues with the map element's components (https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/140).\n      `contain: layout size;` + // Contain layout and size calculations within the map element.\n      `display: inline-block;` + // This together with dimension properties is required so that Leaflet isn't working with a height=0 box by default.\n      `height: 150px;` + // Provide a \"default object size\" (https://github.com/Maps4HTML/HTML-Map-Element/issues/31).\n      `width: 300px;` +\n      `border-width: 2px;` + // Set a default border for contrast, similar to UA default for iframes.\n      `border-style: inset;` +\n      `}` +\n      `:host([frameborder=\"0\"]) {` +\n      `border-width: 0;` +\n      `}` +\n      `:host([hidden]) {` +\n      `display: none!important;` +\n      `}` +\n      `:host .leaflet-control-container {` +\n      `visibility: hidden!important;` + // Visibility hack to improve percieved performance (mitigate FOUC) â€“ visibility is unset in mapml.css! (https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/154).\n      `}`;\n\n    // Hide all (light DOM) children of the map element.\n    let hideElementsCSS = document.createElement('style');\n    hideElementsCSS.innerHTML =\n      `mapml-viewer > * {` + `display: none!important;` + `}`;\n    this.appendChild(hideElementsCSS);\n\n    // Make the Leaflet container element programmatically identifiable\n    // (https://github.com/Leaflet/Leaflet/issues/7193).\n    this._container.setAttribute('role', 'region');\n    this._container.setAttribute('aria-label', 'Interactive map');\n\n    shadowRoot.appendChild(mapDefaultCSS);\n    shadowRoot.appendChild(tmpl.content.cloneNode(true));\n    shadowRoot.appendChild(this._container);\n  }\n  _createMap() {\n    if (!this._map) {\n      this._map = L.map(this._container, {\n        center: new L.LatLng(this.lat, this.lon),\n        projection: this.projection,\n        query: true,\n        contextMenu: true,\n        announceMovement: M.options.announceMovement,\n        featureIndex: true,\n        mapEl: this,\n        crs: M[this.projection],\n        zoom: this.zoom,\n        zoomControl: false,\n        // because the M.MapMLLayer invokes _tileLayer._onMoveEnd when\n        // the mapml response is received the screen tends to flash.  I'm sure\n        // there is a better configuration than that, but at this moment\n        // I'm not sure how to approach that issue.\n        // See https://github.com/Maps4HTML/MapML-Leaflet-Client/issues/24\n        fadeAnimation: true\n      });\n      this._addToHistory();\n\n      this._createControls();\n      this._toggleControls();\n      this._crosshair = M.crosshair().addTo(this._map);\n\n      if (M.options.featureIndexOverlayOption)\n        this._featureIndexOverlay = M.featureIndexOverlay().addTo(this._map);\n\n      this._setUpEvents();\n    }\n  }\n  disconnectedCallback() {\n    while (this.shadowRoot.firstChild) {\n      this.shadowRoot.removeChild(this.shadowRoot.firstChild);\n    }\n    delete this._map;\n    this._deleteControls();\n  }\n  adoptedCallback() {\n    //    console.log('Custom map element moved to new page.');\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    //    console.log('Attribute: ' + name + ' changed from: '+ oldValue + ' to: '+newValue);\n    // \"Best practice\": handle side-effects in this callback\n    // https://developers.google.com/web/fundamentals/web-components/best-practices\n    // https://developers.google.com/web/fundamentals/web-components/best-practices#avoid-reentrancy\n    // note that the example is misleading, since the user can't use\n    // setAttribute or removeAttribute to set the property, they need to use\n    // the property directly in their API usage, which kinda sucks\n    /*\n  const hasValue = newValue !== null;\n  switch (name) {\n    case 'checked':\n      // Note the attributeChangedCallback is only handling the *side effects*\n      // of setting the attribute.\n      this.setAttribute('aria-checked', hasValue);\n      break;\n    ...\n  }     */\n    switch (name) {\n      case 'controlslist':\n        if (this._controlsList) {\n          if (this._controlsList.valueSet === false) {\n            this._controlsList.value = newValue;\n          }\n          this._toggleControls();\n        }\n        break;\n      case 'controls':\n        if (oldValue !== null && newValue === null) {\n          this._hideControls();\n        } else if (oldValue === null && newValue !== null) {\n          this._showControls();\n        }\n        break;\n      case 'height':\n        if (oldValue !== newValue) {\n          this._changeHeight(newValue);\n        }\n        break;\n      case 'width':\n        if (oldValue !== newValue) {\n          this._changeWidth(newValue);\n        }\n        break;\n      case 'static':\n        this._toggleStatic();\n        break;\n    }\n  }\n\n  // Creates All map controls and adds them to the map, when created.\n  _createControls() {\n    let mapSize = this._map.getSize().y,\n      totalSize = 0;\n\n    this._layerControl = M.layerControl(null, {\n      collapsed: true,\n      mapEl: this\n    }).addTo(this._map);\n\n    let scaleValue = M.options.announceScale;\n\n    if (scaleValue === 'metric') {\n      scaleValue = { metric: true, imperial: false };\n    }\n    if (scaleValue === 'imperial') {\n      scaleValue = { metric: false, imperial: true };\n    }\n\n    if (!this._scaleBar)\n      this._scaleBar = M.scaleBar(scaleValue).addTo(this._map);\n\n    // Only add controls if there is enough top left vertical space\n    if (!this._zoomControl && totalSize + 93 <= mapSize) {\n      totalSize += 93;\n      this._zoomControl = L.control.zoom().addTo(this._map);\n    }\n    if (!this._reloadButton && totalSize + 49 <= mapSize) {\n      totalSize += 49;\n      this._reloadButton = M.reloadButton().addTo(this._map);\n    }\n    if (!this._fullScreenControl && totalSize + 49 <= mapSize) {\n      totalSize += 49;\n      this._fullScreenControl = M.fullscreenButton().addTo(this._map);\n    }\n\n    if (!this._geolocationButton) {\n      this._geolocationButton = M.geolocationButton().addTo(this._map);\n    }\n  }\n\n  // Sets controls by hiding/unhiding them based on the map attribute\n  _toggleControls() {\n    if (this.controls === false) {\n      this._hideControls();\n      this._map.contextMenu.toggleContextMenuItem('Controls', 'disabled');\n    } else {\n      this._showControls();\n      this._map.contextMenu.toggleContextMenuItem('Controls', 'enabled');\n    }\n  }\n\n  _hideControls() {\n    this._setControlsVisibility('fullscreen', true);\n    this._setControlsVisibility('layercontrol', true);\n    this._setControlsVisibility('reload', true);\n    this._setControlsVisibility('zoom', true);\n    this._setControlsVisibility('geolocation', true);\n    this._setControlsVisibility('scale', true);\n  }\n  _showControls() {\n    this._setControlsVisibility('fullscreen', false);\n    this._setControlsVisibility('layercontrol', false);\n    this._setControlsVisibility('reload', false);\n    this._setControlsVisibility('zoom', false);\n    this._setControlsVisibility('geolocation', true);\n    this._setControlsVisibility('scale', false);\n\n    // prune the controls shown if necessary\n    // this logic could be embedded in _showControls\n    // but would require being able to iterate the domain of supported tokens\n    // for the controlslist\n    if (this._controlsList) {\n      this._controlsList.forEach((value) => {\n        switch (value.toLowerCase()) {\n          case 'nofullscreen':\n            this._setControlsVisibility('fullscreen', true);\n            break;\n          case 'nolayer':\n            this._setControlsVisibility('layercontrol', true);\n            break;\n          case 'noreload':\n            this._setControlsVisibility('reload', true);\n            break;\n          case 'nozoom':\n            this._setControlsVisibility('zoom', true);\n            break;\n          case 'geolocation':\n            this._setControlsVisibility('geolocation', false);\n            break;\n          case 'noscale':\n            this._setControlsVisibility('scale', true);\n            break;\n        }\n      });\n    }\n    if (this._layerControl && this._layerControl._layers.length === 0) {\n      this._layerControl._container.setAttribute('hidden', '');\n    }\n  }\n\n  // delete the map controls that are private properties of this custom element\n  _deleteControls() {\n    delete this._layerControl;\n    delete this._zoomControl;\n    delete this._reloadButton;\n    delete this._fullScreenControl;\n    delete this._geolocationButton;\n    delete this._scaleBar;\n  }\n  // Sets the control's visibility AND all its childrens visibility,\n  // for the control element based on the Boolean hide parameter\n  _setControlsVisibility(control, hide) {\n    let container;\n    switch (control) {\n      case 'zoom':\n        if (this._zoomControl) {\n          container = this._zoomControl._container;\n        }\n        break;\n      case 'reload':\n        if (this._reloadButton) {\n          container = this._reloadButton._container;\n        }\n        break;\n      case 'fullscreen':\n        if (this._fullScreenControl) {\n          container = this._fullScreenControl._container;\n        }\n        break;\n      case 'layercontrol':\n        if (this._layerControl) {\n          container = this._layerControl._container;\n        }\n        break;\n      case 'geolocation':\n        if (this._geolocationButton) {\n          container = this._geolocationButton._container;\n        }\n        break;\n      case 'scale':\n        if (this._scaleBar) {\n          container = this._scaleBar._container;\n        }\n        break;\n    }\n    if (container) {\n      if (hide) {\n        // setting the visibility for all the children of the element\n        [...container.children].forEach((childEl) => {\n          childEl.setAttribute('hidden', '');\n        });\n        container.setAttribute('hidden', '');\n      } else {\n        // setting the visibility for all the children of the element\n        [...container.children].forEach((childEl) => {\n          childEl.removeAttribute('hidden');\n        });\n        container.removeAttribute('hidden');\n      }\n    }\n  }\n  _toggleStatic() {\n    const isStatic = this.hasAttribute('static');\n    if (this._map) {\n      if (isStatic) {\n        this._map.dragging.disable();\n        this._map.touchZoom.disable();\n        this._map.doubleClickZoom.disable();\n        this._map.scrollWheelZoom.disable();\n        this._map.boxZoom.disable();\n        this._map.keyboard.disable();\n        this._zoomControl.disable();\n      } else {\n        this._map.dragging.enable();\n        this._map.touchZoom.enable();\n        this._map.doubleClickZoom.enable();\n        this._map.scrollWheelZoom.enable();\n        this._map.boxZoom.enable();\n        this._map.keyboard.enable();\n        this._zoomControl.enable();\n      }\n    }\n  }\n\n  _dropHandler(event) {\n    event.preventDefault();\n    let text = event.dataTransfer.getData('text');\n    M._pasteLayer(this, text);\n  }\n  _dragoverHandler(event) {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = 'copy';\n  }\n  _removeEvents() {\n    if (this._map) {\n      this._map.off();\n      this.removeEventListener('drop', this._dropHandler, false);\n      this.removeEventListener('dragover', this._dragoverHandler, false);\n    }\n  }\n  _setUpEvents() {\n    this.addEventListener('drop', this._dropHandler, false);\n    this.addEventListener('dragover', this._dragoverHandler, false);\n    this.addEventListener(\n      'change',\n      function (e) {\n        if (e.target.tagName === 'LAYER-') {\n          this.dispatchEvent(\n            new CustomEvent('layerchange', {\n              details: { target: this, originalEvent: e }\n            })\n          );\n        }\n      },\n      false\n    );\n\n    this.parentElement.addEventListener('keyup', function (e) {\n      if (\n        e.keyCode === 9 &&\n        document.activeElement.nodeName === 'MAPML-VIEWER'\n      ) {\n        document.activeElement.dispatchEvent(\n          new CustomEvent('mapfocused', { detail: { target: this } })\n        );\n      }\n    });\n    // pasting layer-, links and geojson using Ctrl+V\n    this.addEventListener('keydown', function (e) {\n      if (e.keyCode === 86 && e.ctrlKey) {\n        navigator.clipboard.readText().then((layer) => {\n          M._pasteLayer(this, layer);\n        });\n        // Prevents default spacebar event on all of mapml-viewer\n      } else if (\n        e.keyCode === 32 &&\n        this.shadowRoot.activeElement.nodeName !== 'INPUT'\n      ) {\n        e.preventDefault();\n        this._map.fire('keypress', { originalEvent: e });\n      }\n    });\n    this.parentElement.addEventListener('mousedown', function (e) {\n      if (document.activeElement.nodeName === 'MAPML-VIEWER') {\n        document.activeElement.dispatchEvent(\n          new CustomEvent('mapfocused', { detail: { target: this } })\n        );\n      }\n    });\n\n    this._map.on(\n      'locationfound',\n      function (e) {\n        this.dispatchEvent(\n          new CustomEvent('maplocationfound', {\n            detail: { latlng: e.latlng, accuracy: e.accuracy }\n          })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'locationerror',\n      function (e) {\n        this.dispatchEvent(\n          new CustomEvent('locationerror', { detail: { error: e.message } })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'load',\n      function () {\n        this.dispatchEvent(\n          new CustomEvent('load', { detail: { target: this } })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'preclick',\n      function (e) {\n        this.dispatchEvent(\n          new CustomEvent('preclick', {\n            detail: {\n              lat: e.latlng.lat,\n              lon: e.latlng.lng,\n              x: e.containerPoint.x,\n              y: e.containerPoint.y\n            }\n          })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'click',\n      function (e) {\n        this.dispatchEvent(\n          new CustomEvent('click', {\n            detail: {\n              lat: e.latlng.lat,\n              lon: e.latlng.lng,\n              x: e.containerPoint.x,\n              y: e.containerPoint.y\n            }\n          })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'dblclick',\n      function (e) {\n        this.dispatchEvent(\n          new CustomEvent('dblclick', {\n            detail: {\n              lat: e.latlng.lat,\n              lon: e.latlng.lng,\n              x: e.containerPoint.x,\n              y: e.containerPoint.y\n            }\n          })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'mousemove',\n      function (e) {\n        this.dispatchEvent(\n          new CustomEvent('mousemove', {\n            detail: {\n              lat: e.latlng.lat,\n              lon: e.latlng.lng,\n              x: e.containerPoint.x,\n              y: e.containerPoint.y\n            }\n          })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'mouseover',\n      function (e) {\n        this.dispatchEvent(\n          new CustomEvent('mouseover', {\n            detail: {\n              lat: e.latlng.lat,\n              lon: e.latlng.lng,\n              x: e.containerPoint.x,\n              y: e.containerPoint.y\n            }\n          })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'mouseout',\n      function (e) {\n        this.dispatchEvent(\n          new CustomEvent('mouseout', {\n            detail: {\n              lat: e.latlng.lat,\n              lon: e.latlng.lng,\n              x: e.containerPoint.x,\n              y: e.containerPoint.y\n            }\n          })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'mousedown',\n      function (e) {\n        this.dispatchEvent(\n          new CustomEvent('mousedown', {\n            detail: {\n              lat: e.latlng.lat,\n              lon: e.latlng.lng,\n              x: e.containerPoint.x,\n              y: e.containerPoint.y\n            }\n          })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'mouseup',\n      function (e) {\n        this.dispatchEvent(\n          new CustomEvent('mouseup', {\n            detail: {\n              lat: e.latlng.lat,\n              lon: e.latlng.lng,\n              x: e.containerPoint.x,\n              y: e.containerPoint.y\n            }\n          })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'contextmenu',\n      function (e) {\n        this.dispatchEvent(\n          new CustomEvent('contextmenu', {\n            detail: {\n              lat: e.latlng.lat,\n              lon: e.latlng.lng,\n              x: e.containerPoint.x,\n              y: e.containerPoint.y\n            }\n          })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'movestart',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(\n          new CustomEvent('movestart', { detail: { target: this } })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'move',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(\n          new CustomEvent('move', { detail: { target: this } })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'moveend',\n      function () {\n        this._updateMapCenter();\n        this._addToHistory();\n        this.dispatchEvent(\n          new CustomEvent('moveend', { detail: { target: this } })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'zoomstart',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(\n          new CustomEvent('zoomstart', { detail: { target: this } })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'zoom',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(\n          new CustomEvent('zoom', { detail: { target: this } })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'zoomend',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(\n          new CustomEvent('zoomend', { detail: { target: this } })\n        );\n      },\n      this\n    );\n    this.addEventListener('fullscreenchange', function (event) {\n      if (document.fullscreenElement === null) {\n        // full-screen mode has been exited\n        this._map.contextMenu.setViewFullScreenInnerHTML('view');\n      } else {\n        this._map.contextMenu.setViewFullScreenInnerHTML('exit');\n      }\n    });\n    this.addEventListener('keydown', function (event) {\n      if (document.activeElement.nodeName === 'MAPML-VIEWER') {\n        // Check if Ctrl+R is pressed and map is focused\n        if (event.ctrlKey && event.keyCode === 82) {\n          // Prevent default browser behavior\n          event.preventDefault();\n          this.reload();\n        } else if (event.altKey && event.keyCode === 39) {\n          // Prevent default browser behavior\n          event.preventDefault();\n          this.forward();\n        } else if (event.altKey && event.keyCode === 37) {\n          // Prevent default browser behavior\n          event.preventDefault();\n          this.back();\n        }\n      }\n    });\n  }\n\n  locate(options) {\n    //options: https://leafletjs.com/reference.html#locate-options\n    if (this._geolocationButton) {\n      this._geolocationButton.stop();\n    }\n    if (options) {\n      if (options.zoomTo) {\n        options.setView = options.zoomTo;\n        delete options.zoomTo;\n      }\n      this._map.locate(options);\n    } else {\n      this._map.locate({ setView: true, maxZoom: 16 });\n    }\n  }\n\n  toggleDebug() {\n    if (this._debug) {\n      this._debug.remove();\n      this._debug = undefined;\n    } else {\n      this._debug = M.debugOverlay().addTo(this._map);\n    }\n  }\n\n  _changeWidth(width) {\n    if (this._container) {\n      this._container.style.width = width + 'px';\n      this.shadowRoot.styleSheets[0].cssRules[0].style.width = width + 'px';\n    }\n    if (this._map) {\n      this._map.invalidateSize(false);\n    }\n  }\n  _changeHeight(height) {\n    if (this._container) {\n      this._container.style.height = height + 'px';\n      this.shadowRoot.styleSheets[0].cssRules[0].style.height = height + 'px';\n    }\n    if (this._map) {\n      this._map.invalidateSize(false);\n    }\n  }\n  zoomTo(lat, lon, zoom) {\n    zoom = Number.isInteger(+zoom) ? +zoom : this.zoom;\n    let location = new L.LatLng(+lat, +lon);\n    this._map.setView(location, zoom);\n    this.zoom = zoom;\n    this.lat = location.lat;\n    this.lon = location.lng;\n  }\n  _updateMapCenter() {\n    // remember to tell Leaflet event handler that 'this' in here refers to\n    //  something other than the map in this case the custom polymer element\n    this.lat = this._map.getCenter().lat;\n    this.lon = this._map.getCenter().lng;\n    this.zoom = this._map.getZoom();\n  }\n\n  /**\n   * Adds to the maps history on moveends\n   * @private\n   */\n  _addToHistory() {\n    if (this._traversalCall > 0) {\n      // this._traversalCall tracks how many consecutive moveends to ignore from history\n      this._traversalCall--; // this is useful for ignoring moveends corresponding to back, forward and reload\n      return;\n    }\n\n    let mapLocation = this._map.getPixelBounds().getCenter();\n    let location = {\n      zoom: this._map.getZoom(),\n      x: mapLocation.x,\n      y: mapLocation.y\n    };\n    this._historyIndex++;\n    this._history.splice(this._historyIndex, 0, location);\n    // Remove future history and overwrite it when map pan/zoom while inside history\n    if (this._historyIndex + 1 !== this._history.length) {\n      this._history.length = this._historyIndex + 1;\n    }\n    if (this._historyIndex === 0) {\n      // when at initial state of map, disable back, forward, and reload items\n      this._map.contextMenu.toggleContextMenuItem('Back', 'disabled'); // back contextmenu item\n      this._map.contextMenu.toggleContextMenuItem('Forward', 'disabled'); // forward contextmenu item\n      this._map.contextMenu.toggleContextMenuItem('Reload', 'disabled'); // reload contextmenu item\n      this._reloadButton?.disable();\n    } else {\n      this._map.contextMenu.toggleContextMenuItem('Back', 'enabled'); // back contextmenu item\n      this._map.contextMenu.toggleContextMenuItem('Forward', 'disabled'); // forward contextmenu item\n      this._map.contextMenu.toggleContextMenuItem('Reload', 'enabled'); // reload contextmenu item\n      this._reloadButton?.enable();\n    }\n  }\n  /**\n   * Allow user to move back in history\n   */\n  back() {\n    let history = this._history;\n    let curr = history[this._historyIndex];\n\n    if (this._historyIndex > 0) {\n      this._map.contextMenu.toggleContextMenuItem('Forward', 'enabled'); // forward contextmenu item\n      this._historyIndex--;\n      let prev = history[this._historyIndex];\n      // Disable back, reload contextmenu item when at the end of history\n      if (this._historyIndex === 0) {\n        this._map.contextMenu.toggleContextMenuItem('Back', 'disabled'); // back contextmenu item\n        this._map.contextMenu.toggleContextMenuItem('Reload', 'disabled'); // reload contextmenu item\n        this._reloadButton?.disable();\n      }\n\n      if (prev.zoom !== curr.zoom) {\n        this._traversalCall = 2; // allows the next 2 moveends to be ignored from history\n\n        let currScale = this._map.options.crs.scale(curr.zoom); // gets the scale of the current zoom level\n        let prevScale = this._map.options.crs.scale(prev.zoom); // gets the scale of the previous zoom level\n\n        let scale = currScale / prevScale; // used to convert the previous pixel location to be in terms of the current zoom level\n\n        this._map.panBy([prev.x * scale - curr.x, prev.y * scale - curr.y], {\n          animate: false\n        });\n        this._map.setZoom(prev.zoom);\n      } else {\n        this._traversalCall = 1;\n        this._map.panBy([prev.x - curr.x, prev.y - curr.y]);\n      }\n    }\n  }\n\n  /**\n   * Allows user to move forward in history\n   */\n  forward() {\n    let history = this._history;\n    let curr = history[this._historyIndex];\n    if (this._historyIndex < history.length - 1) {\n      this._map.contextMenu.toggleContextMenuItem('Back', 'enabled'); // back contextmenu item\n      this._map.contextMenu.toggleContextMenuItem('Reload', 'enabled'); // reload contextmenu item\n      this._reloadButton?.enable();\n      this._historyIndex++;\n      let next = history[this._historyIndex];\n      // disable forward contextmenu item, when at the end of forward history\n      if (this._historyIndex + 1 === this._history.length) {\n        this._map.contextMenu.toggleContextMenuItem('Forward', 'disabled'); // forward contextmenu item\n      }\n\n      if (next.zoom !== curr.zoom) {\n        this._traversalCall = 2; // allows the next 2 moveends to be ignored from history\n\n        let currScale = this._map.options.crs.scale(curr.zoom); // gets the scale of the current zoom level\n        let nextScale = this._map.options.crs.scale(next.zoom); // gets the scale of the next zoom level\n\n        let scale = currScale / nextScale; // used to convert the next pixel location to be in terms of the current zoom level\n\n        this._map.panBy([next.x * scale - curr.x, next.y * scale - curr.y], {\n          animate: false\n        });\n        this._map.setZoom(next.zoom);\n      } else {\n        this._traversalCall = 1;\n        this._map.panBy([next.x - curr.x, next.y - curr.y]);\n      }\n    }\n  }\n\n  /**\n   * Allows the user to reload/reset the map's location to it's initial location\n   */\n  reload() {\n    let initialLocation = this._history.shift();\n    let mapLocation = this._map.getPixelBounds().getCenter();\n    let curr = {\n      zoom: this._map.getZoom(),\n      x: mapLocation.x,\n      y: mapLocation.y\n    };\n\n    this._map.contextMenu.toggleContextMenuItem('Back', 'disabled'); // back contextmenu item\n    this._map.contextMenu.toggleContextMenuItem('Forward', 'disabled'); // forward contextmenu item\n    this._map.contextMenu.toggleContextMenuItem('Reload', 'disabled'); // reload contextmenu item\n    this._reloadButton?.disable();\n\n    this._history = [initialLocation];\n    this._historyIndex = 0;\n\n    if (initialLocation.zoom !== curr.zoom) {\n      this._traversalCall = 2; // ignores the next 2 moveend events\n\n      let currScale = this._map.options.crs.scale(curr.zoom); // gets the scale of the current zoom level\n      let initScale = this._map.options.crs.scale(initialLocation.zoom); // gets the scale of the initial location's zoom\n\n      let scale = currScale / initScale;\n\n      this._map.panBy(\n        [\n          initialLocation.x * scale - curr.x,\n          initialLocation.y * scale - curr.y\n        ],\n        { animate: false }\n      );\n      this._map.setZoom(initialLocation.zoom);\n    } else {\n      // if it's on the same zoom level as the initial location, no need to calculate scales\n      this._traversalCall = 1;\n      this._map.panBy([initialLocation.x - curr.x, initialLocation.y - curr.y]);\n    }\n  }\n\n  _toggleFullScreen() {\n    this._map.toggleFullscreen();\n  }\n\n  viewSource() {\n    let blob = new Blob([this._source], { type: 'text/plain' }),\n      url = URL.createObjectURL(blob);\n    window.open(url);\n    URL.revokeObjectURL(url);\n  }\n\n  defineCustomProjection(jsonTemplate) {\n    let t = JSON.parse(jsonTemplate);\n    if (\n      t === undefined ||\n      !t.proj4string ||\n      !t.projection ||\n      !t.resolutions ||\n      !t.origin ||\n      !t.bounds\n    )\n      throw new Error('Incomplete TCRS Definition');\n    if (t.projection.indexOf(':') >= 0)\n      throw new Error('\":\" is not permitted in projection name');\n    if (M[t.projection.toUpperCase()]) return t.projection.toUpperCase();\n    let tileSize = [256, 512, 1024, 2048, 4096].includes(t.tilesize)\n      ? t.tilesize\n      : 256;\n\n    M[t.projection] = new L.Proj.CRS(t.projection, t.proj4string, {\n      origin: t.origin,\n      resolutions: t.resolutions,\n      bounds: L.bounds(t.bounds),\n      crs: {\n        tcrs: {\n          horizontal: {\n            name: 'x',\n            min: 0,\n            max: (zoom) =>\n              Math.round(\n                M[t.projection].options.bounds.getSize().x /\n                  M[t.projection].options.resolutions[zoom]\n              )\n          },\n          vertical: {\n            name: 'y',\n            min: 0,\n            max: (zoom) =>\n              Math.round(\n                M[t.projection].options.bounds.getSize().y /\n                  M[t.projection].options.resolutions[zoom]\n              )\n          },\n          bounds: (zoom) =>\n            L.bounds(\n              [\n                M[t.projection].options.crs.tcrs.horizontal.min,\n                M[t.projection].options.crs.tcrs.vertical.min\n              ],\n              [\n                M[t.projection].options.crs.tcrs.horizontal.max(zoom),\n                M[t.projection].options.crs.tcrs.vertical.max(zoom)\n              ]\n            )\n        },\n        pcrs: {\n          horizontal: {\n            name: 'easting',\n            get min() {\n              return M[t.projection].options.bounds.min.x;\n            },\n            get max() {\n              return M[t.projection].options.bounds.max.x;\n            }\n          },\n          vertical: {\n            name: 'northing',\n            get min() {\n              return M[t.projection].options.bounds.min.y;\n            },\n            get max() {\n              return M[t.projection].options.bounds.max.y;\n            }\n          },\n          get bounds() {\n            return M[t.projection].options.bounds;\n          }\n        },\n        gcrs: {\n          horizontal: {\n            name: 'longitude',\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            get min() {\n              return M[t.projection].unproject(M.OSMTILE.options.bounds.min)\n                .lng;\n            },\n            get max() {\n              return M[t.projection].unproject(M.OSMTILE.options.bounds.max)\n                .lng;\n            }\n          },\n          vertical: {\n            name: 'latitude',\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            get min() {\n              return M[t.projection].unproject(M.OSMTILE.options.bounds.min)\n                .lat;\n            },\n            get max() {\n              return M[t.projection].unproject(M.OSMTILE.options.bounds.max)\n                .lat;\n            }\n          },\n          get bounds() {\n            return L.latLngBounds(\n              [\n                M[t.projection].options.crs.gcrs.vertical.min,\n                M[t.projection].options.crs.gcrs.horizontal.min\n              ],\n              [\n                M[t.projection].options.crs.gcrs.vertical.max,\n                M[t.projection].options.crs.gcrs.horizontal.max\n              ]\n            );\n          }\n        },\n        map: {\n          horizontal: {\n            name: 'i',\n            min: 0,\n            max: (map) => map.getSize().x\n          },\n          vertical: {\n            name: 'j',\n            min: 0,\n            max: (map) => map.getSize().y\n          },\n          bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n        },\n        tile: {\n          horizontal: {\n            name: 'i',\n            min: 0,\n            max: tileSize\n          },\n          vertical: {\n            name: 'j',\n            min: 0,\n            max: tileSize\n          },\n          get bounds() {\n            return L.bounds(\n              [\n                M[t.projection].options.crs.tile.horizontal.min,\n                M[t.projection].options.crs.tile.vertical.min\n              ],\n              [\n                M[t.projection].options.crs.tile.horizontal.max,\n                M[t.projection].options.crs.tile.vertical.max\n              ]\n            );\n          }\n        },\n        tilematrix: {\n          horizontal: {\n            name: 'column',\n            min: 0,\n            max: (zoom) =>\n              Math.round(\n                M[t.projection].options.crs.tcrs.horizontal.max(zoom) /\n                  M[t.projection].options.crs.tile.bounds.getSize().x\n              )\n          },\n          vertical: {\n            name: 'row',\n            min: 0,\n            max: (zoom) =>\n              Math.round(\n                M[t.projection].options.crs.tcrs.vertical.max(zoom) /\n                  M[t.projection].options.crs.tile.bounds.getSize().y\n              )\n          },\n          bounds: (zoom) =>\n            L.bounds(\n              [\n                M[t.projection].options.crs.tilematrix.horizontal.min,\n                M[t.projection].options.crs.tilematrix.vertical.min\n              ],\n              [\n                M[t.projection].options.crs.tilematrix.horizontal.max(zoom),\n                M[t.projection].options.crs.tilematrix.vertical.max(zoom)\n              ]\n            )\n        }\n      }\n    }); //creates crs using L.Proj\n    M[t.projection.toUpperCase()] = M[t.projection]; //adds the projection uppercase to global M\n    return t.projection;\n  }\n\n  geojson2mapml(json, options = {}) {\n    if (options.projection === undefined) {\n      options.projection = this.projection;\n    }\n    let geojsonLayer = M.geojson2mapml(json, options);\n    this.appendChild(geojsonLayer);\n    return geojsonLayer;\n  }\n}\n// need to provide options { extends: ... }  for custom built-in elements\nwindow.customElements.define('mapml-viewer', MapViewer);\nwindow.customElements.define('layer-', MapLayer);\nwindow.customElements.define('map-caption', MapCaption);\nwindow.customElements.define('map-feature', MapFeature);\nwindow.customElements.define('map-extent', MapExtent);\n"],"names":["DOMTokenList","MapLayer","MapCaption","MapFeature","MapExtent","MapViewer","HTMLElement","observedAttributes","controls","this","hasAttribute","value","Boolean","setAttribute","removeAttribute","controlsList","_controlsList","width","window","getComputedStyle","replace","val","height","lat","getAttribute","lon","projection","M","Error","_map","options","crs","let","layer","querySelectorAll","reAttach","removeChild","appendChild","_debug","i","toggleDebug","dispatchEvent","CustomEvent","zoom","parsedVal","parseInt","isNaN","layers","getElementsByTagName","extent","map","pcrsBounds","pixelToPCRSBounds","getPixelBounds","getZoom","formattedExtent","_convertAndFormatPCRS","getMaxZoom","Infinity","minZoom","getMinZoom","maxZoom","static","constructor","super","_source","outerHTML","_history","_historyIndex","_traversalCall","connectedCallback","_initShadowRoot","s","wpx","hpx","w","h","_changeWidth","_changeHeight","addEventListener","_createMap","includes","_toggleStatic","mapcaption","querySelector","setTimeout","innerHTML","mapCaptionObserver","MutationObserver","observe","childList","shadowRoot","attachShadow","mode","tmpl","document","createElement","URL","import","meta","url","href","_container","insertAdjacentHTML","mapDefaultCSS","hideElementsCSS","content","cloneNode","L","center","LatLng","query","contextMenu","announceMovement","featureIndex","mapEl","zoomControl","fadeAnimation","_addToHistory","_createControls","_toggleControls","_crosshair","crosshair","addTo","featureIndexOverlayOption","_featureIndexOverlay","featureIndexOverlay","_setUpEvents","disconnectedCallback","firstChild","_deleteControls","adoptedCallback","attributeChangedCallback","name","oldValue","newValue","valueSet","_hideControls","_showControls","mapSize","getSize","y","totalSize","_layerControl","layerControl","collapsed","scaleValue","announceScale","metric","imperial","_scaleBar","scaleBar","_zoomControl","control","_reloadButton","reloadButton","_fullScreenControl","fullscreenButton","_geolocationButton","geolocationButton","toggleContextMenuItem","_setControlsVisibility","forEach","toLowerCase","_layers","length","hide","container","children","childEl","isStatic","dragging","disable","touchZoom","doubleClickZoom","scrollWheelZoom","boxZoom","keyboard","enable","_dropHandler","event","preventDefault","text","dataTransfer","getData","_pasteLayer","_dragoverHandler","dropEffect","_removeEvents","off","removeEventListener","e","target","tagName","details","originalEvent","parentElement","keyCode","activeElement","nodeName","detail","ctrlKey","navigator","clipboard","readText","then","fire","on","latlng","accuracy","error","message","lng","x","containerPoint","_updateMapCenter","fullscreenElement","setViewFullScreenInnerHTML","reload","altKey","forward","back","locate","stop","zoomTo","setView","remove","undefined","debugOverlay","style","styleSheets","cssRules","invalidateSize","Number","isInteger","location","getCenter","mapLocation","splice","prev","history","curr","scale","panBy","animate","setZoom","next","initialLocation","shift","_toggleFullScreen","toggleFullscreen","viewSource","blob","Blob","type","createObjectURL","open","revokeObjectURL","defineCustomProjection","jsonTemplate","t","JSON","parse","proj4string","resolutions","origin","bounds","indexOf","toUpperCase","tileSize","tilesize","Proj","CRS","tcrs","horizontal","min","max","Math","round","vertical","pcrs","gcrs","unproject","OSMTILE","latLngBounds","point","tile","tilematrix","geojson2mapml","json","geojsonLayer","customElements","define"],"mappings":"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"}