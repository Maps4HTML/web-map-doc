{"version":3,"file":"mapml.js","sources":["mapml.js"],"sourcesContent":["(function () {\n  'use strict';\n\n  var StaticTileLayer = L.GridLayer.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      this.zoomBounds = this._getZoomBounds(\n        options.tileContainer,\n        options.maxZoomBound\n      );\n      L.extend(this.options, this.zoomBounds);\n      this._groups = this._groupTiles(\n        this.options.tileContainer.getElementsByTagName('map-tile')\n      );\n      this._bounds = this._getLayerBounds(this._groups, this.options.projection); //stores meter values of bounds\n      this.layerBounds = this._bounds[Object.keys(this._bounds)[0]];\n      for (let key of Object.keys(this._bounds)) {\n        this.layerBounds.extend(this._bounds[key].min);\n        this.layerBounds.extend(this._bounds[key].max);\n      }\n    },\n\n    onAdd: function (map) {\n      this._map = map;\n      L.GridLayer.prototype.onAdd.call(this, this._map);\n      this._handleMoveEnd();\n    },\n\n    getEvents: function () {\n      let events = L.GridLayer.prototype.getEvents.call(this, this._map);\n      this._parentOnMoveEnd = events.moveend;\n      events.moveend = this._handleMoveEnd;\n      events.move = () => {}; //needed to prevent moveend from running\n      return events;\n    },\n\n    //sets the bounds flag of the layer and calls default moveEnd if within bounds\n    //its the zoom level is between the nativeZoom and zoom then it uses the nativeZoom value to get the bound its checking\n    _handleMoveEnd: function (e) {\n      let mapZoom = this._map.getZoom();\n      let zoomLevel = mapZoom;\n      zoomLevel =\n        zoomLevel > this.options.maxNativeZoom\n          ? this.options.maxNativeZoom\n          : zoomLevel;\n      zoomLevel =\n        zoomLevel < this.options.minNativeZoom\n          ? this.options.minNativeZoom\n          : zoomLevel;\n      this.isVisible =\n        mapZoom <= this.zoomBounds.maxZoom &&\n        mapZoom >= this.zoomBounds.minZoom &&\n        this._bounds[zoomLevel] &&\n        this._bounds[zoomLevel].overlaps(\n          M.pixelToPCRSBounds(\n            this._map.getPixelBounds(),\n            this._map.getZoom(),\n            this._map.options.projection\n          )\n        );\n      if (!this.isVisible) return; //onMoveEnd still gets fired even when layer is out of bounds??, most likely need to overrride _onMoveEnd\n      this._parentOnMoveEnd();\n    },\n\n    _isValidTile(coords) {\n      return this._groups[this._tileCoordsToKey(coords)];\n    },\n\n    createTile: function (coords) {\n      let tileGroup = this._groups[this._tileCoordsToKey(coords)] || [],\n        tileElem = document.createElement('map-tile'),\n        tileSize = this.getTileSize();\n      tileElem.setAttribute('col', coords.x);\n      tileElem.setAttribute('row', coords.y);\n      tileElem.setAttribute('zoom', coords.z);\n\n      for (let i = 0; i < tileGroup.length; i++) {\n        let tile = document.createElement('img');\n        tile.width = tileSize.x;\n        tile.height = tileSize.y;\n        tile.alt = '';\n        tile.setAttribute('role', 'presentation');\n        tile.src = tileGroup[i].src;\n        tileElem.appendChild(tile);\n      }\n      return tileElem;\n    },\n\n    _getLayerBounds: function (tileGroups, projection) {\n      let layerBounds = {},\n        tileSize = M[projection].options.crs.tile.bounds.max.x;\n      for (let tile in tileGroups) {\n        let sCoords = tile.split(':'),\n          pixelCoords = {};\n        pixelCoords.x = +sCoords[0] * tileSize;\n        pixelCoords.y = +sCoords[1] * tileSize;\n        pixelCoords.z = +sCoords[2]; //+String same as parseInt(String)\n        if (sCoords[2] in layerBounds) {\n          layerBounds[sCoords[2]].extend(L.point(pixelCoords.x, pixelCoords.y));\n          layerBounds[sCoords[2]].extend(\n            L.point(pixelCoords.x + tileSize, pixelCoords.y + tileSize)\n          );\n        } else {\n          layerBounds[sCoords[2]] = L.bounds(\n            L.point(pixelCoords.x, pixelCoords.y),\n            L.point(pixelCoords.x + tileSize, pixelCoords.y + tileSize)\n          );\n        }\n      }\n      // TODO: optimize by removing 2nd loop, add util function to convert point in pixels to point in pcrs, use that instead then this loop\n      // won't be needed\n      for (let pixelBounds in layerBounds) {\n        let zoom = +pixelBounds;\n        layerBounds[pixelBounds] = M.pixelToPCRSBounds(\n          layerBounds[pixelBounds],\n          zoom,\n          projection\n        );\n      }\n      return layerBounds;\n    },\n\n    _getZoomBounds: function (container, maxZoomBound) {\n      if (!container) return null;\n      // should read zoom information from map-meta (of layer-) instead of the zoom attribute value of map-tile\n      let meta = M._metaContentToObject(\n          this.options._leafletLayer._layerEl\n            .querySelector('map-meta[name=zoom]')\n            .getAttribute('content')\n        ),\n        zoom = {},\n        tiles = container.getElementsByTagName('map-tile');\n      zoom.nativeZoom = +meta.value || 0;\n      zoom.maxNativeZoom = 0;\n      zoom.minNativeZoom = maxZoomBound;\n      for (let i = 0; i < tiles.length; i++) {\n        let lZoom = +tiles[i].getAttribute('zoom');\n        if (!tiles[i].getAttribute('zoom')) lZoom = zoom.nativeZoom;\n        zoom.minNativeZoom = Math.min(zoom.minNativeZoom, lZoom);\n        zoom.maxNativeZoom = Math.max(zoom.maxNativeZoom, lZoom);\n      }\n\n      // currently the min and max zoom bounds of staticTileLayer is set based on map-meta\n      // can be hard coded to only natively zoom out 2 levels, any more and too many tiles are going to be loaded in at one time\n      // it will avoid lagging the users computer, but it will also cause the bug that the initial zoom level of map is inproperly set\n      zoom.minZoom = +meta.min || 0;\n      zoom.maxZoom = +meta.max || maxZoomBound;\n      return zoom;\n    },\n\n    _groupTiles: function (tiles) {\n      let tileMap = {};\n      for (let i = 0; i < tiles.length; i++) {\n        let tile = {};\n        tile.row = +tiles[i].getAttribute('row');\n        tile.col = +tiles[i].getAttribute('col');\n        tile.zoom = +tiles[i].getAttribute('zoom') || this.options.nativeZoom;\n        tile.src = tiles[i].getAttribute('src');\n        let tileCode = tile.col + ':' + tile.row + ':' + tile.zoom;\n        if (tileCode in tileMap) {\n          tileMap[tileCode].push(tile);\n        } else {\n          tileMap[tileCode] = [tile];\n        }\n      }\n      return tileMap;\n    }\n  });\n\n  var staticTileLayer = function (options) {\n    return new StaticTileLayer(options);\n  };\n\n  var LayerControl = L.Control.Layers.extend({\n    /* removes 'base' layers as a concept */\n    options: {\n      autoZIndex: false,\n      sortLayers: true,\n      sortFunction: function (layerA, layerB) {\n        return layerA.options.zIndex < layerB.options.zIndex\n          ? -1\n          : layerA.options.zIndex > layerB.options.zIndex\n          ? 1\n          : 0;\n      }\n    },\n    initialize: function (overlays, options) {\n      L.setOptions(this, options);\n\n      // the _layers array contains objects like {layer: layer, name: \"name\", overlay: true}\n      // the array index is the id of the layer returned by L.stamp(layer) which I guess is a unique hash\n      this._layerControlInputs = [];\n      this._layers = [];\n      this._lastZIndex = 0;\n      this._handlingClick = false;\n\n      for (var i in overlays) {\n        this._addLayer(overlays[i], i, true);\n      }\n    },\n    onAdd: function () {\n      this._initLayout();\n      // Adding event on layer control button\n      L.DomEvent.on(\n        this._container.getElementsByTagName('a')[0],\n        'keydown',\n        this._focusFirstLayer,\n        this._container\n      );\n      L.DomEvent.on(\n        this._container,\n        'contextmenu',\n        this._preventDefaultContextMenu,\n        this\n      );\n      this._update();\n      if (this._layers.length < 1 && !this._map._showControls) {\n        this._container.setAttribute('hidden', '');\n      } else {\n        this._map._showControls = true;\n      }\n      return this._container;\n    },\n    onRemove: function (map) {\n      L.DomEvent.off(\n        this._container.getElementsByTagName('a')[0],\n        'keydown',\n        this._focusFirstLayer,\n        this._container\n      );\n    },\n    addOrUpdateOverlay: function (layer, name) {\n      var alreadyThere = false;\n      for (var i = 0; i < this._layers.length; i++) {\n        if (this._layers[i].layer === layer) {\n          alreadyThere = true;\n          this._layers[i].name = name;\n          // replace the controls with updated controls if necessary.\n          break;\n        }\n      }\n      if (!alreadyThere) {\n        this.addOverlay(layer, name);\n      }\n      if (this._layers.length > 0) {\n        this._container.removeAttribute('hidden');\n        this._map._showControls = true;\n      }\n      return this._map ? this._update() : this;\n    },\n    removeLayer: function (layer) {\n      L.Control.Layers.prototype.removeLayer.call(this, layer);\n      if (this._layers.length === 0) {\n        this._container.setAttribute('hidden', '');\n      }\n    },\n\n    _checkDisabledLayers: function () {},\n\n    // focus the first layer in the layer control when enter is pressed\n    _focusFirstLayer: function (e) {\n      if (\n        e.key === 'Enter' &&\n        this.className ===\n          'leaflet-control-layers leaflet-control leaflet-control-layers-expanded'\n      ) {\n        var elem =\n          this.children[1].children[2].children[0].children[0].children[0]\n            .children[0];\n        if (elem) setTimeout(() => elem.focus(), 0);\n      }\n    },\n\n    _withinZoomBounds: function (zoom, range) {\n      return range.min <= zoom && zoom <= range.max;\n    },\n    _addItem: function (obj) {\n      var layercontrols = obj.layer._layerEl._layerControlHTML;\n      // the input is required by Leaflet...\n      obj.input = layercontrols.querySelector(\n        'input.leaflet-control-layers-selector'\n      );\n\n      this._layerControlInputs.push(obj.input);\n      obj.input.layerId = L.stamp(obj.layer);\n\n      this._overlaysList.appendChild(layercontrols);\n      return layercontrols;\n    },\n\n    //overrides collapse and conditionally collapses the panel\n    collapse: function (e) {\n      if (\n        e.target.tagName === 'SELECT' ||\n        (e.relatedTarget &&\n          e.relatedTarget.parentElement &&\n          (e.relatedTarget.className === 'mapml-contextmenu mapml-layer-menu' ||\n            e.relatedTarget.parentElement.className ===\n              'mapml-contextmenu mapml-layer-menu')) ||\n        (this._map && this._map.contextMenu._layerMenu.style.display === 'block')\n      )\n        return this;\n\n      L.DomUtil.removeClass(this._container, 'leaflet-control-layers-expanded');\n      if (e.originalEvent?.pointerType === 'touch') {\n        this._container._isExpanded = false;\n      }\n      return this;\n    },\n    _preventDefaultContextMenu: function (e) {\n      let latlng = this._map.mouseEventToLatLng(e);\n      let containerPoint = this._map.mouseEventToContainerPoint(e);\n      e.preventDefault();\n      // for touch devices, when the layer control is not expanded,\n      // the layer context menu should not show on map\n      if (!this._container._isExpanded && e.pointerType === 'touch') {\n        this._container._isExpanded = true;\n        return;\n      }\n      this._map.fire('contextmenu', {\n        originalEvent: e,\n        containerPoint: containerPoint,\n        latlng: latlng\n      });\n    }\n  });\n  var layerControl = function (layers, options) {\n    return new LayerControl(layers, options);\n  };\n\n  var FeatureLayer = L.FeatureGroup.extend({\n    /*\n     * M.MapML turns any MapML feature data into a Leaflet layer. Based on L.GeoJSON.\n     *\n     * Used by MapMLLayer to create _mapmlvectors property, used to render features\n     */\n    initialize: function (mapml, options) {\n      /*\n          mapml:\n          1. for query: an array of map-feature elements that it fetches\n          2. for static templated feature: null\n          3. for non-templated feature: layer- (with no src) or mapml file (with src)\n        */\n      // options.extent: when you use a FeatureLayer, you can either get it to calculate the\n      // .layerBounds dynamically (the default), based on adds/removes of features from the layer/\n      // or you can construct it with a bounds (via options.extent),\n      // which will then remain static for the lifetime of the layer\n\n      L.setOptions(this, options);\n      if (this.options.static) {\n        this._container = L.DomUtil.create(\n          'div',\n          'leaflet-layer',\n          this.options.pane\n        );\n        // must have leaflet-pane class because of new/changed rule in leaflet.css\n        // info: https://github.com/Leaflet/Leaflet/pull/4597\n        L.DomUtil.addClass(\n          this._container,\n          'leaflet-pane mapml-vector-container'\n        );\n        L.setOptions(this.options.renderer, { pane: this._container });\n      }\n      this._layers = {};\n      if (this.options.query) {\n        this._mapmlFeatures = mapml.features ? mapml.features : mapml;\n        this.isVisible = true;\n        let native = M.getNativeVariables(mapml);\n        this.options.nativeZoom = native.zoom;\n        this.options.nativeCS = native.cs;\n      } else {\n        if (mapml) {\n          let native = M.getNativeVariables(mapml);\n          this.addData(mapml, native.cs, native.zoom);\n        } else if (!mapml) {\n          this.isVisible = false;\n          // use this.options._leafletLayer to distinguish the featureLayer constructed for initialization and for templated features / tiles\n          if (this.options._leafletLayer) {\n            // this._staticFeature should be set to true to make sure the _getEvents works properly\n            this._features = {};\n            this._staticFeature = true;\n          }\n        }\n      }\n    },\n\n    onAdd: function (map) {\n      this._map = map;\n      L.FeatureGroup.prototype.onAdd.call(this, map);\n      if (this._staticFeature) {\n        this._resetFeatures();\n        this.options._leafletLayer._map._addZoomLimit(this);\n      }\n      if (this._mapmlFeatures)\n        map.on('featurepagination', this.showPaginationFeature, this);\n    },\n\n    onRemove: function (map) {\n      if (this._mapmlFeatures) {\n        map.off('featurepagination', this.showPaginationFeature, this);\n        delete this._mapmlFeatures;\n        L.DomUtil.remove(this._container);\n      }\n      L.FeatureGroup.prototype.onRemove.call(this, map);\n      this._map.featureIndex.cleanIndex();\n    },\n\n    removeLayer: function (featureGroupLayer) {\n      L.FeatureGroup.prototype.removeLayer.call(this, featureGroupLayer);\n      delete this._layers[featureGroupLayer._leaflet_id];\n    },\n\n    getEvents: function () {\n      if (this._staticFeature) {\n        return {\n          moveend: this._handleMoveEnd,\n          zoomend: this._handleZoomEnd\n        };\n      }\n      return {};\n    },\n\n    // for query\n    showPaginationFeature: function (e) {\n      if (this.options.query && this._mapmlFeatures[e.i]) {\n        let feature = this._mapmlFeatures[e.i];\n        if (e.type === 'featurepagination') {\n          // remove map-feature only (keep meta's) when paginating\n          feature._extentEl.shadowRoot.querySelector('map-feature')?.remove();\n        } else {\n          // empty the map-extent shadowRoot\n          // remove the prev / next one <map-feature> and <map-meta>'s from shadow if there is any\n          feature._extentEl.shadowRoot.replaceChildren();\n        }\n        this.clearLayers();\n        feature._featureGroup = this.addData(\n          feature,\n          this.options.nativeCS,\n          this.options.nativeZoom\n        );\n        // append all map-meta from mapml document\n        if (e.meta) {\n          for (let i = 0; i < e.meta.length; i++) {\n            feature._extentEl.shadowRoot.appendChild(e.meta[i]);\n          }\n        }\n        feature._extentEl.shadowRoot.appendChild(feature);\n        e.popup._navigationBar.querySelector('p').innerText =\n          e.i + 1 + '/' + this.options._leafletLayer._totalFeatureCount;\n        e.popup._content\n          .querySelector('iframe')\n          .setAttribute('sandbox', 'allow-same-origin allow-forms');\n        e.popup._content.querySelector('iframe').srcdoc =\n          feature.querySelector('map-properties').innerHTML;\n        // \"zoom to here\" link need to be re-set for every pagination\n        this._map.fire('attachZoomLink', { i: e.i, currFeature: feature });\n        this._map.once(\n          'popupclose',\n          function (e) {\n            this.shadowRoot.innerHTML = '';\n          },\n          feature._extentEl\n        );\n      }\n    },\n\n    _handleMoveEnd: function () {\n      let mapZoom = this._map.getZoom(),\n        withinZoom = this.zoomBounds\n          ? mapZoom <= this.zoomBounds.maxZoom &&\n            mapZoom >= this.zoomBounds.minZoom\n          : false;\n      this.isVisible =\n        withinZoom &&\n        this._layers &&\n        this.layerBounds &&\n        this.layerBounds.overlaps(\n          M.pixelToPCRSBounds(\n            this._map.getPixelBounds(),\n            mapZoom,\n            this._map.options.projection\n          )\n        );\n      this._removeCSS();\n    },\n\n    _handleZoomEnd: function (e) {\n      // handle zoom end gets called twice for every zoom, this condition makes it go through once only.\n      if (this.zoomBounds) {\n        this._resetFeatures();\n      }\n    },\n\n    // remove or add features based on the min max attribute of the features,\n    //  and add placeholders to maintain position\n    _resetFeatures: function () {\n      // since features are removed and re-added by zoom level, need to clean the feature index before re-adding\n      if (this._map) this._map.featureIndex.cleanIndex();\n      let map = this._map || this.options._leafletLayer._map;\n      if (this._features) {\n        for (let zoom in this._features) {\n          for (let k = 0; k < this._features[zoom].length; k++) {\n            let featureGroupLayer = this._features[zoom][k],\n              checkRender = featureGroupLayer._checkRender(\n                map.getZoom(),\n                this.zoomBounds.minZoom,\n                this.zoomBounds.maxZoom\n              );\n            if (!checkRender) {\n              let placeholder = document.createElement('span');\n              placeholder.id = featureGroupLayer._leaflet_id;\n              featureGroupLayer.defaultOptions.group.insertAdjacentElement(\n                'beforebegin',\n                placeholder\n              );\n              // removing the rendering without removing the feature from the feature list\n              this.removeLayer(featureGroupLayer);\n            } else if (\n              // checking for _map so we do not enter this code block during the connectedCallBack of the map-feature\n              !map.hasLayer(featureGroupLayer) &&\n              !featureGroupLayer._map\n            ) {\n              this.addLayer(featureGroupLayer);\n              // update the layerbounds\n              let placeholder =\n                featureGroupLayer.defaultOptions.group.parentNode.querySelector(\n                  `span[id=\"${featureGroupLayer._leaflet_id}\"]`\n                );\n              placeholder.replaceWith(featureGroupLayer.defaultOptions.group);\n            }\n          }\n        }\n      }\n    },\n\n    _setZoomTransform: function (center, clampZoom) {\n      var scale = this._map.getZoomScale(this._map.getZoom(), clampZoom),\n        translate = center\n          .multiplyBy(scale)\n          .subtract(this._map._getNewPixelOrigin(center, this._map.getZoom()))\n          .round();\n\n      if (any3d) {\n        L.setTransform(this._layers[clampZoom], translate, scale);\n      } else {\n        L.setPosition(this._layers[clampZoom], translate);\n      }\n    },\n\n    addData: function (mapml, nativeCS, nativeZoom) {\n      if (mapml) {\n        this.isVisible = true;\n      }\n      var features =\n          mapml.nodeType === Node.DOCUMENT_NODE || mapml.nodeName === 'LAYER-'\n            ? mapml.getElementsByTagName('map-feature')\n            : null,\n        i,\n        len,\n        feature;\n\n      var linkedStylesheets =\n        mapml.nodeType === Node.DOCUMENT_NODE\n          ? mapml.querySelector('map-link[rel=stylesheet],map-style')\n          : null;\n      if (linkedStylesheets) {\n        var base =\n          mapml.querySelector('map-base') &&\n          mapml.querySelector('map-base').hasAttribute('href')\n            ? new URL(mapml.querySelector('map-base').getAttribute('href')).href\n            : mapml.URL;\n        M._parseStylesheetAsHTML(mapml, base, this._container);\n      }\n      if (features) {\n        for (i = 0, len = features.length; i < len; i++) {\n          // Only add this if geometry is set and not null\n          feature = features[i];\n          var geometriesExist =\n            feature.getElementsByTagName('map-geometry').length &&\n            feature.getElementsByTagName('map-coordinates').length;\n          if (geometriesExist) {\n            if (mapml.nodeType === Node.DOCUMENT_NODE) {\n              // if the <map-feature> element has migrated from mapml file,\n              // the featureGroup object should bind with the **CLONED** map-feature element in DOM instead of the feature in mapml\n              if (!feature._DOMnode) feature._DOMnode = feature.cloneNode(true);\n              feature._DOMnode._featureGroup = this.addData(\n                feature._DOMnode,\n                nativeCS,\n                nativeZoom\n              );\n            } else {\n              feature._featureGroup = this.addData(feature, nativeCS, nativeZoom);\n            }\n          }\n        }\n        return this; //if templated this runs\n      }\n\n      //if its a mapml with no more links this runs\n      var options = this.options;\n\n      if (options.filter && !options.filter(mapml)) {\n        return;\n      }\n\n      if (mapml.classList.length) {\n        options.className = mapml.classList.value;\n      }\n      let zoom = mapml.getAttribute('zoom') || nativeZoom,\n        title = mapml.querySelector('map-featurecaption');\n      title = title ? title.innerHTML : 'Feature';\n\n      if (mapml.querySelector('map-properties')) {\n        options.properties = document.createElement('div');\n        options.properties.classList.add('mapml-popup-content');\n        options.properties.insertAdjacentHTML(\n          'afterbegin',\n          mapml.querySelector('map-properties').innerHTML\n        );\n      }\n\n      let layer = this.geometryToLayer(mapml, options, nativeCS, +zoom, title);\n      if (layer) {\n        // if the layer is being used as a query handler output, it will have\n        // a color option set.  Otherwise, copy classes from the feature\n        if (!layer.options.color && mapml.hasAttribute('class')) {\n          layer.options.className = mapml.getAttribute('class');\n        }\n        layer.defaultOptions = layer.options;\n        this.resetStyle(layer);\n\n        if (options.onEachFeature) {\n          layer.bindTooltip(title, { interactive: true, sticky: true });\n        }\n        if (this._staticFeature) {\n          let featureZoom = mapml.getAttribute('zoom') || nativeZoom;\n          if (featureZoom in this._features) {\n            this._features[featureZoom].push(layer);\n          } else {\n            this._features[featureZoom] = [layer];\n          }\n        } else {\n          this.addLayer(layer);\n        }\n        if (mapml.tagName.toUpperCase() === 'MAP-FEATURE') {\n          mapml._groupEl = layer.options.group;\n        }\n        return layer;\n      }\n    },\n\n    resetStyle: function (layer) {\n      var style = this.options.style;\n      if (style) {\n        // reset any custom styles\n        L.Util.extend(layer.options, layer.defaultOptions);\n        this._setLayerStyle(layer, style);\n      }\n    },\n\n    setStyle: function (style) {\n      this.eachLayer(function (layer) {\n        this._setLayerStyle(layer, style);\n      }, this);\n    },\n\n    _setLayerStyle: function (layer, style) {\n      if (typeof style === 'function') {\n        style = style(layer.feature);\n      }\n      if (layer.setStyle) {\n        layer.setStyle(style);\n      }\n    },\n    _removeCSS: function () {\n      let toDelete = this._container.querySelectorAll(\n        'link[rel=stylesheet],style'\n      );\n      for (let i = 0; i < toDelete.length; i++) {\n        this._container.removeChild(toDelete[i]);\n      }\n    },\n    geometryToLayer: function (mapml, vectorOptions, nativeCS, zoom, title) {\n      let geometry =\n          mapml.tagName.toUpperCase() === 'MAP-FEATURE'\n            ? mapml.getElementsByTagName('map-geometry')[0]\n            : mapml,\n        cs = geometry?.getAttribute('cs') || nativeCS,\n        group = [],\n        svgGroup = L.SVG.create('g'),\n        copyOptions = Object.assign({}, vectorOptions);\n      if (geometry) {\n        for (let geo of geometry.querySelectorAll(\n          'map-polygon, map-linestring, map-multilinestring, map-point, map-multipoint'\n        )) {\n          group.push(\n            M.path(\n              geo,\n              Object.assign(copyOptions, {\n                nativeCS: cs,\n                nativeZoom: zoom,\n                projection: this.options.projection,\n                featureID: mapml.id,\n                group: svgGroup,\n                wrappers: this._getGeometryParents(geo.parentElement),\n                featureLayer: this,\n                _leafletLayer: this.options._leafletLayer\n              })\n            )\n          );\n        }\n        let groupOptions = {\n            group: svgGroup,\n            mapmlFeature: mapml,\n            featureID: mapml.id,\n            accessibleTitle: title,\n            onEachFeature: vectorOptions.onEachFeature,\n            properties: vectorOptions.properties,\n            _leafletLayer: this.options._leafletLayer\n          },\n          collections =\n            geometry.querySelector('map-multipolygon') ||\n            geometry.querySelector('map-geometrycollection');\n        if (collections)\n          groupOptions.wrappers = this._getGeometryParents(\n            collections.parentElement\n          );\n        return M.geometry(group, groupOptions);\n      }\n    },\n\n    _getGeometryParents: function (subType, elems = []) {\n      if (subType && subType.tagName.toUpperCase() !== 'MAP-GEOMETRY') {\n        if (\n          subType.tagName.toUpperCase() === 'MAP-MULTIPOLYGON' ||\n          subType.tagName.toUpperCase() === 'MAP-GEOMETRYCOLLECTION'\n        )\n          return this._getGeometryParents(subType.parentElement, elems);\n        return this._getGeometryParents(\n          subType.parentElement,\n          elems.concat([subType])\n        );\n      } else {\n        return elems;\n      }\n    }\n  });\n  var featureLayer = function (mapml, options) {\n    return new FeatureLayer(mapml, options);\n  };\n\n  var TemplatedTileLayer = L.TileLayer.extend({\n    // a TemplateTileLayer is similar to a L.TileLayer except its templates are\n    // defined by the <map-extent><template/></map-extent>\n    // content found in the MapML document.  As such, the client map does not\n    // 'revisit' the server for more MapML content, it simply fills the map extent\n    // with tiles for which it generates requests on demand (as the user pans/zooms/resizes\n    // the map)\n    initialize: function (template, options) {\n      // _setUpTileTemplateVars needs options.crs, not available unless we set\n      // options first...\n      let inputData = M._extractInputBounds(template);\n      this.zoomBounds = inputData.zoomBounds;\n      this.extentBounds = inputData.bounds;\n      this.isVisible = true;\n      L.extend(options, this.zoomBounds);\n      options.tms = template.tms;\n      delete options.opacity;\n      L.setOptions(this, options);\n      this._setUpTileTemplateVars(template);\n\n      this._template = template;\n      this._initContainer();\n      // call the parent constructor with the template tref value, per the\n      // Leaflet tutorial: http://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n      L.TileLayer.prototype.initialize.call(\n        this,\n        template.template,\n        L.extend(options, { pane: this.options.pane })\n      );\n    },\n    onAdd: function () {\n      this.options.pane.appendChild(this._container);\n      this._map._addZoomLimit(this);\n      L.TileLayer.prototype.onAdd.call(this, this._map);\n      this._handleMoveEnd();\n    },\n\n    onRemove: function () {\n      L.DomUtil.remove(this._container);\n      // should clean up the container\n      for (let child of this._container.children) {\n        L.DomUtil.remove(child);\n      }\n    },\n\n    getEvents: function () {\n      let events = L.TileLayer.prototype.getEvents.call(this, this._map);\n      this._parentOnMoveEnd = events.moveend;\n      events.moveend = this._handleMoveEnd;\n      return events;\n    },\n\n    _initContainer: function () {\n      if (this._container) {\n        return;\n      }\n\n      this._container = L.DomUtil.create(\n        'div',\n        'leaflet-layer',\n        this.options.pane\n      );\n      L.DomUtil.addClass(this._container, 'mapml-templated-tile-container');\n      this._updateZIndex();\n    },\n\n    _handleMoveEnd: function (e) {\n      let mapZoom = this._map.getZoom();\n      let mapBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        mapZoom,\n        this._map.options.projection\n      );\n      this.isVisible =\n        mapZoom <= this.options.maxZoom &&\n        mapZoom >= this.options.minZoom &&\n        this.extentBounds.overlaps(mapBounds);\n      if (!this.isVisible) return;\n      this._parentOnMoveEnd();\n    },\n    createTile: function (coords) {\n      let tileGroup = document.createElement('DIV'),\n        tileSize = this.getTileSize();\n      L.DomUtil.addClass(tileGroup, 'mapml-tile-group');\n      L.DomUtil.addClass(tileGroup, 'leaflet-tile');\n\n      this._template.linkEl.dispatchEvent(\n        new CustomEvent('tileloadstart', {\n          detail: {\n            x: coords.x,\n            y: coords.y,\n            zoom: coords.z,\n            appendTile: (elem) => {\n              tileGroup.appendChild(elem);\n            }\n          }\n        })\n      );\n\n      if (this._template.type.startsWith('image/')) {\n        let tile = L.TileLayer.prototype.createTile.call(\n          this,\n          coords,\n          function () {}\n        );\n        tile.width = tileSize.x;\n        tile.height = tileSize.y;\n        tileGroup.appendChild(tile);\n      } else if (!this._url.includes(M.BLANK_TT_TREF)) {\n        // tiles of type=\"text/mapml\" will have to fetch content while creating\n        // the tile here, unless there can be a callback associated to the element\n        // that will render the content in the alread-placed tile\n        // var tile = L.DomUtil.create('canvas', 'leaflet-tile');\n        this._fetchTile(coords, tileGroup);\n      }\n      return tileGroup;\n    },\n    _mapmlTileReady: function (tile) {\n      L.DomUtil.addClass(tile, 'leaflet-tile-loaded');\n    },\n    // instead of being child of a pane, the TemplatedTileLayers are 'owned' by the group,\n    // and so are DOM children of the group, not the pane element (the MapMLLayer is\n    // a child of the overlay pane and always has a set of sub-layers)\n    getPane: function () {\n      return this.options.pane;\n    },\n    _fetchTile: function (coords, tile) {\n      fetch(this.getTileUrl(coords), { redirect: 'follow' })\n        .then(function (response) {\n          if (response.status >= 200 && response.status < 300) {\n            return Promise.resolve(response);\n          } else {\n            console.log(\n              'Looks like there was a problem. Status Code: ' + response.status\n            );\n            return Promise.reject(response);\n          }\n        })\n        .then(function (response) {\n          return response.text();\n        })\n        .then((text) => {\n          var parser = new DOMParser();\n          return parser.parseFromString(text, 'application/xml');\n        })\n        .then((mapml) => {\n          this._createFeatures(mapml, coords, tile);\n          this._mapmlTileReady(tile);\n        })\n        .catch((err) => {\n          console.log('Error Creating Tile');\n        });\n    },\n\n    _createFeatures: function (markup, coords, tile) {\n      let stylesheets = markup.querySelector(\n        'map-link[rel=stylesheet],map-style'\n      );\n      if (stylesheets) {\n        let base =\n          markup.querySelector('map-base') &&\n          markup.querySelector('map-base').hasAttribute('href')\n            ? new URL(markup.querySelector('map-base').getAttribute('href')).href\n            : markup.URL;\n        M._parseStylesheetAsHTML(markup, base, tile);\n      }\n\n      let svg = L.SVG.create('svg'),\n        g = L.SVG.create('g'),\n        tileSize = this._map.options.crs.options.crs.tile.bounds.max.x,\n        xOffset = coords.x * tileSize,\n        yOffset = coords.y * tileSize;\n\n      let tileFeatures = M.featureLayer(markup, {\n        projection: this._map.options.projection,\n        static: false,\n        layerBounds: this.extentBounds,\n        zoomBounds: this.zoomBounds,\n        interactive: false\n      });\n\n      for (let groupID in tileFeatures._layers) {\n        for (let featureID in tileFeatures._layers[groupID]._layers) {\n          let layer = tileFeatures._layers[groupID]._layers[featureID];\n          M.FeatureRenderer.prototype._initPath(layer, false);\n          layer._project(this._map, L.point([xOffset, yOffset]), coords.z);\n          M.FeatureRenderer.prototype._addPath(layer, g, false);\n          M.FeatureRenderer.prototype._updateFeature(layer);\n        }\n      }\n      svg.setAttribute('width', tileSize.toString());\n      svg.setAttribute('height', tileSize.toString());\n      svg.appendChild(g);\n      tile.appendChild(svg);\n    },\n\n    getTileUrl: function (coords) {\n      if (\n        coords.z >= this._template.tilematrix.bounds.length ||\n        !this._template.tilematrix.bounds[coords.z].contains(coords)\n      ) {\n        return '';\n      }\n      var obj = {},\n        linkEl = this._template.linkEl,\n        zoomInput = linkEl.zoomInput;\n      obj[this._template.tilematrix.col.name] = coords.x;\n      obj[this._template.tilematrix.row.name] = coords.y;\n      if (\n        zoomInput &&\n        linkEl.hasAttribute('tref') &&\n        linkEl\n          .getAttribute('tref')\n          .includes(`{${zoomInput.getAttribute('name')}}`)\n      ) {\n        obj[this._template.zoom.name] = this._getZoomForUrl();\n      }\n      obj[this._template.pcrs.easting.left] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-left'\n      ).x;\n      obj[this._template.pcrs.easting.right] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-right'\n      ).x;\n      obj[this._template.pcrs.northing.top] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-left'\n      ).y;\n      obj[this._template.pcrs.northing.bottom] = this._tileMatrixToPCRSPosition(\n        coords,\n        'bottom-left'\n      ).y;\n      for (var v in this._template.tile) {\n        if (\n          ['row', 'col', 'zoom', 'left', 'right', 'top', 'bottom'].indexOf(v) < 0\n        ) {\n          obj[v] = this._template.tile[v];\n        }\n      }\n      if (this._map && !this._map.options.crs.infinite) {\n        let invertedY = this._globalTileRange.max.y - coords.y;\n        if (this.options.tms) {\n          obj[this._template.tilematrix.row.name] = invertedY;\n        }\n        //obj[`-${this._template.tilematrix.row.name}`] = invertedY; //leaflet has this but I dont see a use in storing row and -row as it doesnt follow that pattern\n      }\n      obj.r =\n        this.options.detectRetina && L.Browser.retina && this.options.maxZoom > 0\n          ? '@2x'\n          : '';\n      return L.Util.template(this._url, obj);\n    },\n    _tileMatrixToPCRSPosition: function (coords, pos) {\n      // this is a tile:\n      //\n      //   top-left         top-center           top-right\n      //      +------------------+------------------+\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      + center-left    center               + center-right\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      +------------------+------------------+\n      //   bottom-left     bottom-center      bottom-right\n\n      var map = this._map,\n        crs = map.options.crs,\n        tileSize = this.getTileSize(),\n        nwPoint = coords.scaleBy(tileSize),\n        sePoint = nwPoint.add(tileSize),\n        centrePoint = nwPoint.add(Math.floor(tileSize / 2)),\n        nw = crs.transformation.untransform(nwPoint, crs.scale(coords.z)),\n        se = crs.transformation.untransform(sePoint, crs.scale(coords.z)),\n        cen = crs.transformation.untransform(centrePoint, crs.scale(coords.z)),\n        result = null;\n\n      switch (pos) {\n        case 'top-left':\n          result = nw;\n          break;\n        case 'bottom-left':\n          result = new L.Point(nw.x, se.y);\n          break;\n        case 'center-left':\n          result = new L.Point(nw.x, cen.y);\n          break;\n        case 'top-right':\n          result = new L.Point(se.x, nw.y);\n          break;\n        case 'bottom-right':\n          result = se;\n          break;\n        case 'center-right':\n          result = new L.Point(se.x, cen.y);\n          break;\n        case 'top-center':\n          result = new L.Point(cen.x, nw.y);\n          break;\n        case 'bottom-center':\n          result = new L.Point(cen.x, se.y);\n          break;\n        case 'center':\n          result = cen;\n          break;\n      }\n      return result;\n    },\n    _setUpTileTemplateVars: function (template) {\n      // process the inputs associated to template and create an object named\n      // tile with member properties as follows:\n      // {row: 'rowvarname',\n      //  col: 'colvarname',\n      //  left: 'leftvarname',\n      //  right: 'rightvarname',\n      //  top: 'topvarname',\n      //  bottom: 'bottomvarname'}\n      template.tile = {};\n      var inputs = template.values,\n        crs = this.options.crs.options,\n        zoom,\n        east,\n        north,\n        row,\n        col;\n\n      for (var i = 0; i < template.values.length; i++) {\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select',\n          value = inputs[i].getAttribute('value'),\n          min = inputs[i].getAttribute('min'),\n          max = inputs[i].getAttribute('max');\n        if (type === 'location' && units === 'tilematrix') {\n          switch (axis) {\n            case 'column':\n              col = {\n                name: name,\n                min: crs.crs.tilematrix.horizontal.min,\n                max: crs.crs.tilematrix.horizontal.max(crs.resolutions.length - 1)\n              };\n              if (!isNaN(Number.parseFloat(min))) {\n                col.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                col.max = Number.parseFloat(max);\n              }\n              break;\n            case 'row':\n              row = {\n                name: name,\n                min: crs.crs.tilematrix.vertical.min,\n                max: crs.crs.tilematrix.vertical.max(crs.resolutions.length - 1)\n              };\n              if (!isNaN(Number.parseFloat(min))) {\n                row.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                row.max = Number.parseFloat(max);\n              }\n              break;\n            case 'longitude':\n            case 'easting':\n              if (!east) {\n                east = {\n                  min: crs.crs.pcrs.horizontal.min,\n                  max: crs.crs.pcrs.horizontal.max\n                };\n              }\n              if (!isNaN(Number.parseFloat(min))) {\n                east.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                east.max = Number.parseFloat(max);\n              }\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  east.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  east.right = name;\n                }\n              }\n              break;\n            case 'latitude':\n            case 'northing':\n              if (!north) {\n                north = {\n                  min: crs.crs.pcrs.vertical.min,\n                  max: crs.crs.pcrs.vertical.max\n                };\n              }\n              if (!isNaN(Number.parseFloat(min))) {\n                north.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                north.max = Number.parseFloat(max);\n              }\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  north.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  north.bottom = name;\n                }\n              }\n              break;\n            // unsuportted axis value\n          }\n        } else if (type && type.toLowerCase() === 'zoom') {\n          //<input name=\"...\" type=\"zoom\" value=\"0\" min=\"0\" max=\"17\">\n          zoom = {\n            name: name,\n            min: 0,\n            max: crs.resolutions.length,\n            value: crs.resolutions.length\n          };\n          if (\n            !isNaN(Number.parseInt(value, 10)) &&\n            Number.parseInt(value, 10) >= zoom.min &&\n            Number.parseInt(value, 10) <= zoom.max\n          ) {\n            zoom.value = Number.parseInt(value, 10);\n          } else {\n            zoom.value = zoom.max;\n          }\n          if (\n            !isNaN(Number.parseInt(min, 10)) &&\n            Number.parseInt(min, 10) >= zoom.min &&\n            Number.parseInt(min, 10) <= zoom.max\n          ) {\n            zoom.min = Number.parseInt(min, 10);\n          }\n          if (\n            !isNaN(Number.parseInt(max, 10)) &&\n            Number.parseInt(max, 10) >= zoom.min &&\n            Number.parseInt(max, 10) <= zoom.max\n          ) {\n            zoom.max = Number.parseInt(max, 10);\n          }\n          template.zoom = zoom;\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          template.tile[name] = function () {\n            return parsedselect.value;\n          };\n        } else {\n          // needs to be a const otherwise it gets overwritten\n          /*jshint -W104 */\n          const input = inputs[i];\n          template.tile[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      var transformation = this.options.crs.transformation,\n        tileSize = this.options.crs.options.crs.tile.bounds.max.x,\n        scale = L.bind(this.options.crs.scale, this.options.crs),\n        pcrs2tilematrix = function (c, zoom) {\n          return transformation\n            .transform(c, scale(zoom))\n            .divideBy(tileSize)\n            .floor();\n        };\n      if (east && north) {\n        template.pcrs = {};\n        template.pcrs.bounds = L.bounds(\n          [east.min, north.min],\n          [east.max, north.max]\n        );\n        template.pcrs.easting = east;\n        template.pcrs.northing = north;\n      } else if (col && row && !isNaN(zoom.value)) {\n        // convert the tile bounds at this zoom to a pcrs bounds, then\n        // go through the zoom min/max and create a tile-based bounds\n        // at each zoom that applies to the col/row values that constrain what tiles\n        // will be requested so that we don't generate too many 404s\n        if (!template.pcrs) {\n          template.pcrs = {};\n          template.pcrs.easting = '';\n          template.pcrs.northing = '';\n        }\n\n        template.pcrs.bounds = M.boundsToPCRSBounds(\n          L.bounds(L.point([col.min, row.min]), L.point([col.max, row.max])),\n          zoom.value,\n          this.options.crs,\n          M.axisToCS('column')\n        );\n\n        template.tilematrix = {};\n        template.tilematrix.col = col;\n        template.tilematrix.row = row;\n      } else {\n        console.log(\n          'Unable to determine bounds for tile template: ' + template.template\n        );\n      }\n\n      if (!template.tilematrix) {\n        template.tilematrix = {};\n        template.tilematrix.col = {};\n        template.tilematrix.row = {};\n      }\n      template.tilematrix.bounds = [];\n      var pcrsBounds = template.pcrs.bounds;\n      // the template should _always_ have a zoom, because we force it to\n      // by first processing the extent to determine the zoom and if none, adding\n      // one and second by copying that zoom into the set of template variable inputs\n      // even if it is not referenced by one of the template's variable references\n      var zmin = template.zoom ? template.zoom.min : 0,\n        zmax = template.zoom ? template.zoom.max : crs.resolutions.length;\n      for (var z = 0; z <= zmax; z++) {\n        template.tilematrix.bounds[z] =\n          z >= zmin\n            ? L.bounds(\n                pcrs2tilematrix(pcrsBounds.min, z),\n                pcrs2tilematrix(pcrsBounds.max, z)\n              )\n            : L.bounds(L.point([-1, -1]), L.point([-1, -1]));\n      }\n    },\n    _clampZoom: function (zoom) {\n      let clamp = L.GridLayer.prototype._clampZoom.call(this, zoom);\n      if (this._template.step > this.zoomBounds.maxNativeZoom)\n        this._template.step = this.zoomBounds.maxNativeZoom;\n\n      if (zoom !== clamp) {\n        zoom = clamp;\n      } else {\n        if (zoom % this._template.step !== 0) {\n          zoom = Math.floor(zoom / this._template.step) * this._template.step;\n        }\n      }\n      return zoom;\n    }\n  });\n  var templatedTileLayer = function (template, options) {\n    return new TemplatedTileLayer(template, options);\n  };\n\n  var TemplatedLayer = L.Layer.extend({\n    initialize: function (templates, options) {\n      this._templates = templates;\n      L.setOptions(this, options);\n      this._container = L.DomUtil.create('div', 'leaflet-layer');\n      this._extentEl = this.options.extentEl;\n      this.changeOpacity(this.options.opacity);\n      L.DomUtil.addClass(this._container, 'mapml-templatedlayer-container');\n\n      for (var i = 0; i < templates.length; i++) {\n        if (templates[i].rel === 'tile') {\n          this.setZIndex(options.extentZIndex);\n          this._templates[i].layer = M.templatedTileLayer(\n            templates[i],\n            L.Util.extend(options, {\n              errorTileUrl:\n                'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==',\n              zIndex: options.extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'image') {\n          this.setZIndex(options.extentZIndex);\n          this._templates[i].layer = M.templatedImageLayer(\n            templates[i],\n            L.Util.extend(options, {\n              zIndex: options.extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'features') {\n          this.setZIndex(options.extentZIndex);\n          this._templates[i].layer = M.templatedFeaturesLayer(\n            templates[i],\n            L.Util.extend(options, {\n              zIndex: options.extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'query') {\n          // add template to array of queryies to be added to map and processed\n          // on click/tap events\n          this.hasSetBoundsHandler = true;\n          if (!this._queries) {\n            this._queries = [];\n          }\n          let inputData = M._extractInputBounds(templates[i]);\n          templates[i].extentBounds = inputData.bounds;\n          templates[i].zoomBounds = inputData.zoomBounds;\n          templates[i]._extentEl = this.options.extentEl;\n          this._queries.push(\n            L.extend(templates[i], this._setupQueryVars(templates[i]))\n          );\n        }\n      }\n    },\n    getEvents: function () {\n      return {\n        zoomstart: this._onZoomStart\n      };\n    },\n    redraw: function () {\n      this.closePopup();\n      for (var i = 0; i < this._templates.length; i++) {\n        if (\n          this._templates[i].rel === 'tile' ||\n          this._templates[i].rel === 'image' ||\n          this._templates[i].rel === 'features'\n        ) {\n          this._templates[i].layer.redraw();\n        }\n      }\n    },\n    _onZoomStart: function () {\n      this.closePopup();\n    },\n\n    _setupQueryVars: function (template) {\n      // process the inputs associated to template and create an object named\n      // query with member properties as follows:\n      // {width: 'widthvarname',\n      //  height: 'heightvarname',\n      //  left: 'leftvarname',\n      //  right: 'rightvarname',\n      //  top: 'topvarname',\n      //  bottom: 'bottomvarname'\n      //  i: 'ivarname'\n      //  j: 'jvarname'}\n      //  x: 'xvarname' x being the tcrs x axis\n      //  y: 'yvarname' y being the tcrs y axis\n      //  z: 'zvarname' zoom\n      //  title: link title\n\n      var queryVarNames = { query: {} },\n        inputs = template.values;\n\n      for (var i = 0; i < template.values.length; i++) {\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          rel = inputs[i].getAttribute('rel'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select';\n        if (type === 'width') {\n          queryVarNames.query.width = name;\n        } else if (type === 'height') {\n          queryVarNames.query.height = name;\n        } else if (type === 'location') {\n          switch (axis) {\n            case 'x':\n            case 'y':\n            case 'column':\n            case 'row':\n              queryVarNames.query[axis] = name;\n              break;\n            case 'longitude':\n            case 'easting':\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixelleft = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tileleft = name;\n                  } else {\n                    queryVarNames.query.mapleft = name;\n                  }\n                } else if (position.match(/.*?-right/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixelright = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tileright = name;\n                  } else {\n                    queryVarNames.query.mapright = name;\n                  }\n                }\n              } else {\n                queryVarNames.query[axis] = name;\n              }\n              break;\n            case 'latitude':\n            case 'northing':\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixeltop = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tiletop = name;\n                  } else {\n                    queryVarNames.query.maptop = name;\n                  }\n                } else if (position.match(/bottom-.*?/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixelbottom = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tilebottom = name;\n                  } else {\n                    queryVarNames.query.mapbottom = name;\n                  }\n                }\n              } else {\n                queryVarNames.query[axis] = name;\n              }\n              break;\n            case 'i':\n              if (units === 'tile') {\n                queryVarNames.query.tilei = name;\n              } else {\n                queryVarNames.query.mapi = name;\n              }\n              break;\n            case 'j':\n              if (units === 'tile') {\n                queryVarNames.query.tilej = name;\n              } else {\n                queryVarNames.query.mapj = name;\n              }\n              break;\n            // unsuportted axis value\n          }\n        } else if (type === 'zoom') {\n          //<input name=\"...\" type=\"zoom\" value=\"0\" min=\"0\" max=\"17\">\n          queryVarNames.query.zoom = name;\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          queryVarNames.query[name] = function () {\n            return parsedselect.value;\n          };\n        } else {\n          /*jshint -W104 */\n          const input = inputs[i];\n          queryVarNames.query[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      queryVarNames.query.title = template.title;\n      return queryVarNames;\n    },\n    reset: function (templates, extentZIndex) {\n      if (!templates) {\n        return;\n      }\n      if (!this._map) {\n        return;\n      }\n      var addToMap = this._map && this._map.hasLayer(this),\n        old_templates = this._templates;\n      delete this._queries;\n      this._map.off('click', null, this);\n\n      this._templates = templates;\n      for (var i = 0; i < templates.length; i++) {\n        if (templates[i].rel === 'tile') {\n          this._templates[i].layer = M.templatedTileLayer(\n            templates[i],\n            L.Util.extend(this.options, {\n              errorTileUrl:\n                'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==',\n              zIndex: extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'image') {\n          this._templates[i].layer = M.templatedImageLayer(\n            templates[i],\n            L.Util.extend(this.options, {\n              zIndex: extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'features') {\n          this._templates[i].layer = M.templatedFeaturesLayer(\n            templates[i],\n            L.Util.extend(this.options, {\n              zIndex: extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'query') {\n          if (!this._queries) {\n            this._queries = [];\n          }\n          this._queries.push(\n            L.extend(templates[i], this._setupQueryVars(templates[i]))\n          );\n        }\n        if (addToMap) {\n          this.onAdd(this._map);\n        }\n      }\n      for (i = 0; i < old_templates.length; i++) {\n        if (this._map.hasLayer(old_templates[i].layer)) {\n          this._map.removeLayer(old_templates[i].layer);\n        }\n      }\n    },\n    onAdd: function (map) {\n      // add to this.options.pane\n      this.options.pane.appendChild(this._container);\n      for (var i = 0; i < this._templates.length; i++) {\n        if (this._templates[i].rel !== 'query') {\n          map.addLayer(this._templates[i].layer);\n        }\n      }\n    },\n    //addTo: function(map) {\n    //for(let i = 0; i < this._templates.length; i++){\n    //    this._templates[0].layer.addTo(map);\n    //}\n    //},\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    onRemove: function (map) {\n      L.DomUtil.remove(this._container);\n      for (var i = 0; i < this._templates.length; i++) {\n        if (this._templates[i].rel !== 'query') {\n          map.removeLayer(this._templates[i].layer);\n        }\n      }\n    },\n\n    _previousFeature: function (e) {\n      if (this._count + -1 >= 0) {\n        this._count--;\n        this._map.fire('featurepagination', { i: this._count, popup: this });\n      }\n    },\n\n    _nextFeature: function (e) {\n      if (this._count + 1 < this._source._totalFeatureCount) {\n        this._count++;\n        this._map.fire('featurepagination', { i: this._count, popup: this });\n      }\n    },\n\n    changeOpacity: function (opacity) {\n      this._container.style.opacity = opacity;\n      this._extentEl._opacity = opacity;\n      if (this._extentEl._opacitySlider)\n        this._extentEl._opacitySlider.value = opacity;\n    }\n  });\n  var templatedLayer = function (templates, options) {\n    // templates is an array of template objects\n    // a template object contains the template, plus associated <input> elements\n    // which need to be processed just prior to creating a url from the template\n    // with the values of the inputs\n    return new TemplatedLayer(templates, options);\n  };\n\n  var TemplatedFeaturesLayer = L.Layer.extend({\n    // this and M.ImageLayer could be merged or inherit from a common parent\n    initialize: function (template, options) {\n      let inputData = M._extractInputBounds(template);\n      this.zoomBounds = inputData.zoomBounds;\n      this.extentBounds = inputData.bounds;\n      this.isVisible = true;\n      this._template = template;\n      this._extentEl = options.extentEl;\n      this._container = L.DomUtil.create('div', 'leaflet-layer');\n      L.extend(options, this.zoomBounds);\n      L.DomUtil.addClass(this._container, 'mapml-features-container');\n      delete options.opacity;\n      L.setOptions(\n        this,\n        L.extend(options, this._setUpFeaturesTemplateVars(template))\n      );\n    },\n    getEvents: function () {\n      var events = {\n        moveend: this._onMoveEnd\n      };\n      return events;\n    },\n    onAdd: function () {\n      // this causes the layer (this._features) to actually render...\n      this.options.pane.appendChild(this._container);\n      this._map._addZoomLimit(this);\n      var opacity = this.options.opacity || 1,\n        container = this._container,\n        map = this._map;\n      if (!this._features) {\n        this._features = M.featureLayer(null, {\n          // pass the vector layer a renderer of its own, otherwise leaflet\n          // puts everything into the overlayPane\n          renderer: M.featureRenderer(),\n          // pass the vector layer the container for the parent into which\n          // it will append its own container for rendering into\n          pane: container,\n          // the bounds will be static, fixed, constant for the lifetime of the layer\n          layerBounds: this.extentBounds,\n          zoomBounds: this.zoomBounds,\n          opacity: opacity,\n          projection: map.options.projection,\n          static: true,\n          onEachFeature: function (properties, geometry) {\n            // need to parse as HTML to preserve semantics and styles\n            var c = document.createElement('div');\n            c.classList.add('mapml-popup-content');\n            c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n            geometry.bindPopup(c, { autoClose: false, minWidth: 108 });\n          }\n        });\n      } else {\n        // if this._features exists add the layer back\n        this._map.addLayer(this._features);\n      }\n\n      map.fire('moveend'); // TODO: replace with moveend handler for layer and not entire map\n    },\n    onRemove: function () {\n      this._map.removeLayer(this._features);\n    },\n    redraw: function () {\n      this._onMoveEnd();\n    },\n\n    _removeCSS: function () {\n      let toDelete = this._container.querySelectorAll(\n        'link[rel=stylesheet],style'\n      );\n      for (let i = 0; i < toDelete.length; i++) {\n        let parent = toDelete[i].parentNode;\n        parent.removeChild(toDelete[i]);\n      }\n    },\n\n    _onMoveEnd: function () {\n      let history = this._map.options.mapEl._history;\n      let current = history[history.length - 1];\n      let previous = history[history.length - 2] ?? current;\n      let step = this._template.step;\n      let mapZoom = this._map.getZoom();\n      let steppedZoom = mapZoom;\n      //If zooming out from one step interval into a lower one or panning, set the stepped zoom\n      if (\n        (step !== '1' &&\n          (mapZoom + 1) % step === 0 &&\n          current.zoom === previous.zoom - 1) ||\n        current.zoom === previous.zoom ||\n        Math.floor(mapZoom / step) * step !==\n          Math.floor(previous.zoom / step) * step\n      ) {\n        steppedZoom = Math.floor(mapZoom / step) * step;\n      }\n      //No request needed if in a step interval (unless panning)\n      else if (mapZoom % this._template.step !== 0) return;\n\n      let scaleBounds = this._map.getPixelBounds(\n        this._map.getCenter(),\n        steppedZoom\n      );\n\n      let mapBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        mapZoom,\n        this._map.options.projection\n      );\n      this.isVisible =\n        mapZoom <= this.zoomBounds.maxZoom &&\n        mapZoom >= this.zoomBounds.minZoom &&\n        this.extentBounds.overlaps(mapBounds);\n\n      // should set this.isVisible properly BEFORE return, otherwise will cause layer-.validateDisabled not work properly\n      let url = this._getfeaturesUrl(steppedZoom, scaleBounds);\n      // No request needed if the current template url is the same as the url to request\n      if (url === this._url) return;\n\n      // do cleaning up for new request\n      this._features.clearLayers();\n      // shadow may has not yet attached to <map-extent> for the first-time rendering\n      if (this._extentEl.shadowRoot) {\n        this._extentEl.shadowRoot.innerHTML = '';\n      }\n      this._removeCSS();\n      //Leave the layers cleared if the layer is not visible\n      if (!this.isVisible && steppedZoom === mapZoom) {\n        this._url = '';\n        return;\n      }\n\n      // TODO add preference with a bit less weight than that for text/mapml; 0.8 for application/geo+json; 0.6\n      var mapml,\n        headers = new Headers({\n          Accept: 'text/mapml;q=0.9,application/geo+json;q=0.8'\n        }),\n        parser = new DOMParser(),\n        features = this._features,\n        extentEl = this._extentEl,\n        map = this._map,\n        context = this,\n        MAX_PAGES = 10,\n        _pullFeatureFeed = function (url, limit) {\n          return fetch(url, { redirect: 'follow', headers: headers })\n            .then(function (response) {\n              return response.text();\n            })\n            .then(function (text) {\n              //TODO wrap this puppy in a try/catch/finally to parse application/geo+json if necessary\n              mapml = parser.parseFromString(text, 'application/xml');\n              var base = new URL(\n                mapml.querySelector('map-base')\n                  ? mapml.querySelector('map-base').getAttribute('href')\n                  : url\n              ).href;\n              url = mapml.querySelector('map-link[rel=next]')\n                ? mapml.querySelector('map-link[rel=next]').getAttribute('href')\n                : null;\n              url = url ? new URL(url, base).href : null;\n              // TODO if the xml parser barfed but the response is application/geo+json, use the parent addData method\n              let nativeZoom = (extentEl._nativeZoom =\n                (mapml.querySelector('map-meta[name=zoom]') &&\n                  +M._metaContentToObject(\n                    mapml\n                      .querySelector('map-meta[name=zoom]')\n                      .getAttribute('content')\n                  ).value) ||\n                0);\n              let nativeCS = (extentEl._nativeCS =\n                (mapml.querySelector('map-meta[name=cs]') &&\n                  M._metaContentToObject(\n                    mapml\n                      .querySelector('map-meta[name=cs]')\n                      .getAttribute('content')\n                  ).content) ||\n                'GCRS');\n              features.addData(mapml, nativeCS, nativeZoom);\n              // \"migrate\" to extent's shadow\n              // make a clone, prevent the elements from being removed from mapml file\n              // same as _attachToLayer() in MapMLLayer.js\n              for (let el of mapml.querySelector('map-body').children) {\n                extentEl.shadowRoot.append(el._DOMnode);\n                el._DOMnode._extentEl = extentEl;\n              }\n              if (url && --limit) {\n                return _pullFeatureFeed(url, limit);\n              }\n            });\n        };\n      this._url = url;\n      _pullFeatureFeed(url, MAX_PAGES)\n        .then(function () {\n          map.addLayer(features);\n          //Fires event for feature index overlay\n          map.fire('templatedfeatureslayeradd');\n          M.TemplatedFeaturesLayer.prototype._updateTabIndex(context);\n        })\n        .catch(function (error) {\n          console.log(error);\n        });\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n      return this;\n    },\n    _updateTabIndex: function (context) {\n      let c = context || this;\n      for (let layerNum in c._features._layers) {\n        let layer = c._features._layers[layerNum];\n        if (layer._path) {\n          if (layer._path.getAttribute('d') !== 'M0 0') {\n            layer._path.setAttribute('tabindex', 0);\n          } else {\n            layer._path.removeAttribute('tabindex');\n          }\n          if (layer._path.childElementCount === 0) {\n            let title = document.createElement('title');\n            title.innerText = 'Feature';\n            layer._path.appendChild(title);\n          }\n        }\n      }\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    _getfeaturesUrl: function (zoom, bounds) {\n      if (zoom === undefined) zoom = this._map.getZoom();\n      if (bounds === undefined) bounds = this._map.getPixelBounds();\n      var obj = {};\n      if (this.options.feature.zoom) {\n        obj[this.options.feature.zoom] = zoom;\n      }\n      if (this.options.feature.width) {\n        obj[this.options.feature.width] = this._map.getSize().x;\n      }\n      if (this.options.feature.height) {\n        obj[this.options.feature.height] = this._map.getSize().y;\n      }\n      if (this.options.feature.bottom) {\n        obj[this.options.feature.bottom] = this._TCRSToPCRS(bounds.max, zoom).y;\n      }\n      if (this.options.feature.left) {\n        obj[this.options.feature.left] = this._TCRSToPCRS(bounds.min, zoom).x;\n      }\n      if (this.options.feature.top) {\n        obj[this.options.feature.top] = this._TCRSToPCRS(bounds.min, zoom).y;\n      }\n      if (this.options.feature.right) {\n        obj[this.options.feature.right] = this._TCRSToPCRS(bounds.max, zoom).x;\n      }\n      // hidden and other variables that may be associated\n      for (var v in this.options.feature) {\n        if (\n          ['width', 'height', 'left', 'right', 'top', 'bottom', 'zoom'].indexOf(\n            v\n          ) < 0\n        ) {\n          obj[v] = this.options.feature[v];\n        }\n      }\n      return L.Util.template(this._template.template, obj);\n    },\n    _TCRSToPCRS: function (coords, zoom) {\n      // TCRS pixel point to Projected CRS point (in meters, presumably)\n      var map = this._map,\n        crs = map.options.crs,\n        loc = crs.transformation.untransform(coords, crs.scale(zoom));\n      return loc;\n    },\n    _setUpFeaturesTemplateVars: function (template) {\n      // process the inputs and create an object named \"extent\"\n      // with member properties as follows:\n      // {width: {name: 'widthvarname'}, // value supplied by map if necessary\n      //  height: {name: 'heightvarname'}, // value supplied by map if necessary\n      //  left: {name: 'leftvarname', axis: 'leftaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n      //  right: {name: 'rightvarname', axis: 'rightaxisname'}, // axis name (coordinate system of) drives the value supplied by the map\n      //  top: {name: 'topvarname', axis: 'topaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n      //  bottom: {name: 'bottomvarname', axis: 'bottomaxisname'} // axis name drives (coordinate system of) the value supplied by the map\n      //  zoom: {name: 'zoomvarname'}\n      //  hidden: [{name: name, value: value}]}\n\n      var featuresVarNames = { feature: {} },\n        inputs = template.values;\n      featuresVarNames.feature.hidden = [];\n      for (var i = 0; i < inputs.length; i++) {\n        // this can be removed when the spec removes the deprecated inputs...\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          value = inputs[i].getAttribute('value'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select';\n        if (type === 'width') {\n          featuresVarNames.feature.width = name;\n        } else if (type === 'height') {\n          featuresVarNames.feature.height = name;\n        } else if (type === 'zoom') {\n          featuresVarNames.feature.zoom = name;\n        } else if (\n          type === 'location' &&\n          (units === 'pcrs' || units === 'gcrs')\n        ) {\n          //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting\">\n          switch (axis) {\n            case 'x':\n            case 'longitude':\n            case 'easting':\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  featuresVarNames.feature.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  featuresVarNames.feature.right = name;\n                }\n              }\n              break;\n            case 'y':\n            case 'latitude':\n            case 'northing':\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  featuresVarNames.feature.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  featuresVarNames.feature.bottom = name;\n                }\n              }\n              break;\n          }\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          featuresVarNames.feature[name] = function () {\n            return parsedselect.value;\n          };\n          // projection is deprecated, make it hidden\n        } else {\n          /*jshint -W104 */\n          const input = inputs[i];\n          featuresVarNames.feature[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      return featuresVarNames;\n    }\n  });\n  var templatedFeaturesLayer = function (template, options) {\n    return new TemplatedFeaturesLayer(template, options);\n  };\n\n  var TemplatedImageLayer = L.Layer.extend({\n    initialize: function (template, options) {\n      this._template = template;\n      this._container = L.DomUtil.create('div', 'leaflet-layer');\n      L.DomUtil.addClass(this._container, 'mapml-image-container');\n      let inputData = M._extractInputBounds(template);\n      this.zoomBounds = inputData.zoomBounds;\n      this.extentBounds = inputData.bounds;\n      this.isVisible = true;\n      delete options.opacity;\n      L.extend(options, this.zoomBounds);\n      L.setOptions(\n        this,\n        L.extend(options, this._setUpExtentTemplateVars(template))\n      );\n    },\n    getEvents: function () {\n      var events = {\n        moveend: this._onMoveEnd,\n        zoomstart: this._clearLayer\n      };\n      return events;\n    },\n    onAdd: function () {\n      this.options.pane.appendChild(this._container);\n      this._map._addZoomLimit(this); //used to set the zoom limit of the map\n      this.setZIndex(this.options.zIndex);\n      this._onAdd();\n    },\n    redraw: function () {\n      this._onMoveEnd();\n    },\n\n    _clearLayer: function () {\n      let containerImages = this._container.querySelectorAll('img');\n      for (let i = 0; i < containerImages.length; i++) {\n        this._container.removeChild(containerImages[i]);\n      }\n    },\n\n    _addImage: function (bounds, zoom, loc) {\n      let map = this._map;\n      let overlayToRemove = this._imageOverlay;\n      let src = this.getImageUrl(bounds, zoom);\n      let size = map.getSize();\n      this._imageOverlay = M.imageLayer(src, loc, size, 0, this._container);\n      this._imageOverlay._step = this._template.step;\n      this._imageOverlay.addTo(map);\n      if (overlayToRemove) {\n        this._imageOverlay._overlayToRemove = overlayToRemove._url;\n        this._imageOverlay.on('load error', function () {\n          map.removeLayer(overlayToRemove);\n        });\n      }\n    },\n\n    _scaleImage: function (bounds, zoom) {\n      let obj = this;\n      setTimeout(function () {\n        let step = obj._template.step;\n        let steppedZoom = Math.floor(zoom / step) * step;\n        let scale = obj._map.getZoomScale(zoom, steppedZoom);\n        let translate = bounds.min\n          .multiplyBy(scale)\n          .subtract(obj._map._getNewPixelOrigin(obj._map.getCenter(), zoom))\n          .round();\n        L.DomUtil.setTransform(obj._imageOverlay._image, translate, scale);\n      });\n    },\n\n    _onAdd: function () {\n      let zoom = this._map.getZoom();\n      let steppedZoom = zoom;\n      let step = this._template.step;\n\n      if (zoom % step !== 0) steppedZoom = Math.floor(zoom / step) * step;\n      let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n      this._pixelOrigins = {};\n      this._pixelOrigins[steppedZoom] = bounds.min;\n      // if the map is panned before the new image layer is added,\n      // the location that the layer should be added to is no longer (0,0) but need to be calculated\n      let loc = this._map\n        .getPixelBounds()\n        .min.subtract(this._map.getPixelOrigin());\n      this._addImage(bounds, steppedZoom, loc);\n      if (zoom !== steppedZoom) {\n        this._scaleImage(bounds, zoom);\n      }\n    },\n\n    _onMoveEnd: function (e) {\n      let mapZoom = this._map.getZoom();\n      let history = this._map.options.mapEl._history;\n      let current = history[history.length - 1];\n      let previous = history[history.length - 2];\n      if (!previous) previous = current;\n      let step = this._template.step;\n      let steppedZoom = Math.floor(mapZoom / step) * step;\n      let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n      //Zooming from one step increment into a lower one\n      if (\n        step !== '1' &&\n        (mapZoom + 1) % step === 0 &&\n        current.zoom === previous.zoom - 1\n      ) {\n        this._addImage(bounds, steppedZoom, L.point(0, 0));\n        this._scaleImage(bounds, mapZoom);\n        //Zooming or panning within a step increment\n      } else if (e && mapZoom % step !== 0) {\n        this._imageOverlay._overlayToRemove = this._imageOverlay._url;\n        if (current.zoom !== previous.zoom) {\n          //Zoomed from within one step increment into another\n          this._addImage(bounds, steppedZoom, L.point(0, 0));\n          this._pixelOrigins[steppedZoom] = bounds.min;\n          this._scaleImage(bounds, mapZoom);\n        } else {\n          // Panning within a step increment\n          let pixelOrigin = this._pixelOrigins[steppedZoom];\n          let loc = bounds.min.subtract(pixelOrigin);\n          if (this.getImageUrl(bounds, steppedZoom) === this._imageOverlay._url)\n            return;\n          this._addImage(bounds, steppedZoom, loc);\n          this._scaleImage(bounds, mapZoom);\n        }\n        // Zooming from one step decrement into a higher one\n        // OR panning when mapZoom % step === 0\n      } else {\n        let mapBounds = M.pixelToPCRSBounds(\n          this._map.getPixelBounds(),\n          mapZoom,\n          this._map.options.projection\n        );\n        this.isVisible =\n          mapZoom <= this.zoomBounds.maxZoom &&\n          mapZoom >= this.zoomBounds.minZoom &&\n          this.extentBounds.overlaps(mapBounds);\n        if (!this.isVisible) {\n          this._clearLayer();\n          return;\n        }\n        var map = this._map,\n          loc = map.getPixelBounds().min.subtract(map.getPixelOrigin());\n        this._addImage(map.getPixelBounds(), mapZoom, loc);\n        this._pixelOrigins[mapZoom] = map.getPixelOrigin();\n      }\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    onRemove: function (map) {\n      L.DomUtil.remove(this._container);\n      this._clearLayer();\n      map._removeZoomLimit(this);\n    },\n    getImageUrl: function (pixelBounds, zoom) {\n      var obj = {};\n      obj[this.options.extent.width] = this._map.getSize().x;\n      obj[this.options.extent.height] = this._map.getSize().y;\n      obj[this.options.extent.bottom] = this._TCRSToPCRS(pixelBounds.max, zoom).y;\n      obj[this.options.extent.left] = this._TCRSToPCRS(pixelBounds.min, zoom).x;\n      obj[this.options.extent.top] = this._TCRSToPCRS(pixelBounds.min, zoom).y;\n      obj[this.options.extent.right] = this._TCRSToPCRS(pixelBounds.max, zoom).x;\n      // hidden and other variables that may be associated\n      for (var v in this.options.extent) {\n        if (\n          ['width', 'height', 'left', 'right', 'top', 'bottom'].indexOf(v) < 0\n        ) {\n          obj[v] = this.options.extent[v];\n        }\n      }\n      return L.Util.template(this._template.template, obj);\n    },\n    _TCRSToPCRS: function (coords, zoom) {\n      // TCRS pixel point to Projected CRS point (in meters, presumably)\n      var map = this._map,\n        crs = map.options.crs,\n        loc = crs.transformation.untransform(coords, crs.scale(zoom));\n      return loc;\n    },\n    _setUpExtentTemplateVars: function (template) {\n      // process the inputs associated to template and create an object named\n      // extent with member properties as follows:\n      // {width: 'widthvarname',\n      //  height: 'heightvarname',\n      //  left: 'leftvarname',\n      //  right: 'rightvarname',\n      //  top: 'topvarname',\n      //  bottom: 'bottomvarname'}\n\n      var extentVarNames = { extent: {} },\n        inputs = template.values;\n\n      for (var i = 0; i < template.values.length; i++) {\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select';\n        if (type === 'width') {\n          extentVarNames.extent.width = name;\n        } else if (type === 'height') {\n          extentVarNames.extent.height = name;\n        } else if (\n          type === 'location' &&\n          (units === 'pcrs' || units === 'gcrs')\n        ) {\n          //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting|latitude|longitude\">\n          switch (axis) {\n            case 'longitude':\n            case 'easting':\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  extentVarNames.extent.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  extentVarNames.extent.right = name;\n                }\n              }\n              break;\n            case 'latitude':\n            case 'northing':\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  extentVarNames.extent.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  extentVarNames.extent.bottom = name;\n                }\n              }\n              break;\n          }\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          extentVarNames.extent[name] = function () {\n            return parsedselect.value;\n          };\n        } else {\n          /*jshint -W104 */\n          const input = inputs[i];\n          extentVarNames.extent[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      return extentVarNames;\n    }\n  });\n  var templatedImageLayer = function (template, options) {\n    return new TemplatedImageLayer(template, options);\n  };\n\n  var ImageLayer = L.ImageOverlay.extend({\n    initialize: function (url, location, size, angle, container, options) {\n      // (String, Point, Point, Number, Element, Object)\n      this._container = container;\n      this._url = url;\n      // instead of calculating where the image goes, put it at 0,0\n      //this._location = L.point(location);\n      // the location for WMS requests will be the upper left hand\n      // corner of the map.  When the map is initialized, that is 0,0,\n      // but as the user pans, of course the\n      this._location = location;\n      this._size = L.point(size);\n      this._angle = angle;\n\n      L.setOptions(this, options);\n    },\n    getEvents: function () {\n      var events = {\n        viewreset: this._reset\n      };\n\n      if (this._zoomAnimated && this._step <= 1) {\n        events.zoomanim = this._animateZoom;\n      }\n\n      return events;\n    },\n    onAdd: function () {\n      this.on({\n        load: this._onImageLoad\n      });\n\n      if (!this._image) {\n        this._initImage();\n      }\n\n      if (this.options.interactive) {\n        L.DomUtil.addClass(this._image, 'leaflet-interactive');\n        this.addInteractiveTarget(this._image);\n      }\n\n      this._container.appendChild(this._image);\n      this._reset();\n    },\n    onRemove: function () {\n      L.DomUtil.remove(this._image);\n      if (this.options.interactive) {\n        this.removeInteractiveTarget(this._image);\n      }\n    },\n    _onImageLoad: function () {\n      if (!this._image) {\n        return;\n      }\n      this._image.loaded = +new Date();\n      this._updateOpacity();\n    },\n    _animateZoom: function (e) {\n      var scale = this._map.getZoomScale(e.zoom),\n        translate = this._map\n          .getPixelOrigin()\n          .add(this._location)\n          .multiplyBy(scale)\n          .subtract(this._map._getNewPixelOrigin(e.center, e.zoom))\n          .round();\n\n      if (L.Browser.any3d) {\n        L.DomUtil.setTransform(this._image, translate, scale);\n      } else {\n        L.DomUtil.setPosition(this._image, translate);\n      }\n    },\n    _reset: function (e) {\n      var image = this._image,\n        location = this._location,\n        size = this._size;\n      // TBD use the angle to establish the image rotation in CSS\n\n      if (\n        e &&\n        this._step > 1 &&\n        (this._overlayToRemove === undefined ||\n          this._url === this._overlayToRemove)\n      ) {\n        return;\n      }\n      L.DomUtil.setPosition(image, location);\n\n      image.style.width = size.x + 'px';\n      image.style.height = size.y + 'px';\n    },\n    _updateOpacity: function () {\n      if (!this._map) {\n        return;\n      }\n\n      //L.DomUtil.setOpacity(this._image, this.options.opacity);\n\n      var now = +new Date(),\n        nextFrame = false;\n\n      var image = this._image;\n\n      var fade = Math.min(1, (now - image.loaded) / 200);\n\n      L.DomUtil.setOpacity(image, fade);\n      if (fade < 1) {\n        nextFrame = true;\n      }\n      if (nextFrame) {\n        L.Util.cancelAnimFrame(this._fadeFrame);\n        this._fadeFrame = L.Util.requestAnimFrame(this._updateOpacity, this);\n      }\n      L.DomUtil.addClass(image, 'leaflet-image-loaded');\n    }\n  });\n  var imageLayer = function (\n    url,\n    location,\n    size,\n    angle,\n    container,\n    options\n  ) {\n    return new ImageLayer(url, location, size, angle, container, options);\n  };\n\n  var MapMLLayer = L.Layer.extend({\n    // zIndex has to be set, for the case where the layer is added to the\n    // map before the layercontrol is used to control it (where autoZindex is used)\n    // e.g. in the raw MapML-Leaflet-Client index.html page.\n    options: {\n      maxNext: 10,\n      zIndex: 0,\n      maxZoom: 25,\n      opacity: '1.0'\n    },\n    // initialize is executed before the layer is added to a map\n    initialize: function (href, layerEl, mapml, options) {\n      // in the custom element, the attribute is actually 'src'\n      // the _href version is the URL received from layer-@src\n      if (href) {\n        this._href = href;\n      }\n      let local;\n      this._layerEl = layerEl;\n      local = layerEl.querySelector('map-feature,map-tile,map-extent')\n        ? true\n        : false;\n      this._content = local ? layerEl : mapml;\n      L.setOptions(this, options);\n      this._container = L.DomUtil.create('div', 'leaflet-layer');\n      this.changeOpacity(this.options.opacity);\n      L.DomUtil.addClass(this._container, 'mapml-layer');\n      this._imageContainer = L.DomUtil.create(\n        'div',\n        'leaflet-layer',\n        this._container\n      );\n      L.DomUtil.addClass(this._imageContainer, 'mapml-image-container');\n\n      // this layer 'owns' a mapmlTileLayer, which is a subclass of L.GridLayer\n      // it 'passes' what tiles to load via the content of this._mapmlTileContainer\n      this._mapmlTileContainer = L.DomUtil.create(\n        'div',\n        'mapml-tile-container',\n        this._container\n      );\n      // hit the service to determine what its extent might be\n      // OR use the extent of the content provided\n\n      this._initialize(local ? layerEl : mapml);\n\n      // a default extent can't be correctly set without the map to provide\n      // its bounds , projection, zoom range etc, so if that stuff's not\n      // established by metadata in the content, we should use map properties\n      // to set the extent, but the map won't be available until the <layer>\n      // element is attached to the <map> element, wait for that to happen.\n      // weirdness.  options is actually undefined here, despite the hardcoded\n      // options above. If you use this.options, you see the options defined\n      // above.  Not going to change this, but failing to understand ATM.\n      // may revisit some time.\n      this.validProjection = true;\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    getHref: function () {\n      return this._href ?? '';\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    changeOpacity: function (opacity) {\n      this._container.style.opacity = opacity;\n      this._layerEl._opacity = opacity;\n      if (this._layerEl._opacitySlider)\n        this._layerEl._opacitySlider.value = opacity;\n    },\n    titleIsReadOnly() {\n      return !!this._titleIsReadOnly;\n    },\n    setName(newName) {\n      // a layer's accessible name is set by the <map-title>, if present\n      // if it's not available the <layer- label=\"accessible-name\"> attribute\n      // can be used\n      if (!this.titleIsReadOnly()) {\n        this._title = newName;\n        this._layerEl._layerControlHTML.querySelector(\n          '.mapml-layer-item-name'\n        ).innerHTML = newName;\n      }\n    },\n    getName() {\n      return this._title;\n    },\n\n    onAdd: function (map) {\n      // probably don't need it except for layer context menu usage\n      if (this._properties && !this._validProjection(map)) {\n        this.validProjection = false;\n        return;\n      }\n      this._map = map;\n      if (this._mapmlvectors) map.addLayer(this._mapmlvectors);\n\n      if (!this._imageLayer) {\n        this._imageLayer = L.layerGroup();\n      }\n      map.addLayer(this._imageLayer);\n      // the layer._imageContainer property contains an element in which\n      // content will be maintained\n\n      //only add the layer if there are tiles to be rendered\n      if (this._staticTileLayer) {\n        map.addLayer(this._staticTileLayer);\n      }\n\n      this.setZIndex(this.options.zIndex);\n      this.getPane().appendChild(this._container);\n      map.on('popupopen', this._attachSkipButtons, this);\n    },\n\n    _calculateBounds: function () {\n      let bounds,\n        zoomBounds = {\n          minZoom: 0,\n          maxZoom: 0,\n          maxNativeZoom: 0,\n          minNativeZoom: 0\n        };\n      let layerTypes = [\n        '_staticTileLayer',\n        '_imageLayer',\n        '_mapmlvectors',\n        '_templatedLayer'\n      ];\n      const mapExtents = this._layerEl.querySelectorAll('map-extent').length\n        ? this._layerEl.querySelectorAll('map-extent')\n        : this._layerEl.shadowRoot\n        ? this._layerEl.shadowRoot.querySelectorAll('map-extent')\n        : [];\n      layerTypes.forEach((type) => {\n        if (type === '_templatedLayer' && mapExtents.length) {\n          let zoomMax = zoomBounds.maxZoom,\n            zoomMin = zoomBounds.minZoom,\n            maxNativeZoom = zoomBounds.maxNativeZoom,\n            minNativeZoom = zoomBounds.minNativeZoom;\n          for (let i = 0; i < mapExtents.length; i++) {\n            if (mapExtents[i]._templatedLayer.bounds) {\n              let templatedLayer = mapExtents[i]._templatedLayer;\n              if (!bounds) {\n                bounds = templatedLayer.bounds;\n                zoomBounds = templatedLayer.zoomBounds;\n              } else {\n                bounds.extend(templatedLayer.bounds.min);\n                bounds.extend(templatedLayer.bounds.max);\n                zoomMax = Math.max(zoomMax, templatedLayer.zoomBounds.maxZoom);\n                zoomMin = Math.min(zoomMin, templatedLayer.zoomBounds.minZoom);\n                maxNativeZoom = Math.max(\n                  maxNativeZoom,\n                  templatedLayer.zoomBounds.maxNativeZoom\n                );\n                minNativeZoom = Math.min(\n                  minNativeZoom,\n                  templatedLayer.zoomBounds.minNativeZoom\n                );\n                zoomBounds.minZoom = zoomMin;\n                zoomBounds.maxZoom = zoomMax;\n                zoomBounds.minNativeZoom = minNativeZoom;\n                zoomBounds.maxNativeZoom = maxNativeZoom;\n              }\n            }\n          }\n        } else if (type === '_staticTileLayer' && this._staticTileLayer) {\n          if (this[type].layerBounds) {\n            if (!bounds) {\n              bounds = this[type].layerBounds;\n              zoomBounds = this[type].zoomBounds;\n            } else {\n              bounds.extend(this[type].layerBounds.min);\n              bounds.extend(this[type].layerBounds.max);\n            }\n          }\n        } else if (type === '_imageLayer' && this._imageLayer) {\n          if (this[type].layerBounds) {\n            if (!bounds) {\n              bounds = this[type].layerBounds;\n              zoomBounds = this[type].zoomBounds;\n            } else {\n              bounds.extend(this[type].layerBounds.min);\n              bounds.extend(this[type].layerBounds.max);\n            }\n          }\n        } else if (\n          // only process extent if mapmlvectors is not empty\n          type === '_mapmlvectors' &&\n          this._mapmlvectors &&\n          Object.keys(this[type]._layers).length !== 0\n        ) {\n          if (this[type].layerBounds) {\n            if (!bounds) {\n              bounds = this[type].layerBounds;\n              zoomBounds = this[type].zoomBounds;\n            } else {\n              bounds.extend(this[type].layerBounds.min);\n              bounds.extend(this[type].layerBounds.max);\n            }\n          }\n        }\n      });\n      if (bounds) {\n        //assigns the formatted extent object to .extent and spreads the zoom ranges to .extent also\n        this.bounds = bounds;\n        this.zoomBounds = zoomBounds;\n      }\n    },\n\n    _validProjection: function (map) {\n      const mapExtents = this._layerEl.querySelectorAll('map-extent');\n      let noLayer = false;\n      if (this._properties && mapExtents.length > 0) {\n        for (let i = 0; i < mapExtents.length; i++) {\n          if (mapExtents[i]._templateVars) {\n            for (let template of mapExtents[i]._templateVars)\n              if (\n                !template.projectionMatch &&\n                template.projection !== map.options.projection\n              ) {\n                noLayer = true; // if there's a single template where projections don't match, set noLayer to true\n                break;\n              }\n          }\n        }\n      }\n      return !(noLayer || this.getProjection() !== map.options.projection);\n    },\n\n    addTo: function (map) {\n      map.addLayer(this);\n      return this;\n    },\n    getEvents: function () {\n      return { zoomanim: this._onZoomAnim };\n    },\n    _onZoomAnim: function (e) {\n      // this callback will be invoked AFTER <layer- > has been removed\n      // but due to the characteristic of JavaScript, the context (this pointer) can still be used\n      // the easiest way to solve this:\n      if (!this._map) {\n        return;\n      }\n      // get the min and max zooms from all extents\n      const layerEl = this._layerEl,\n        // prerequisite: no inline and remote mapml elements exists at the same time\n        mapExtents = layerEl.shadowRoot\n          ? layerEl.shadowRoot.querySelectorAll('map-extent')\n          : layerEl.querySelectorAll('map-extent');\n      var toZoom = e.zoom,\n        zoom =\n          mapExtents.length > 0\n            ? mapExtents[0].querySelector('map-input[type=zoom]')\n            : null,\n        min =\n          zoom && zoom.hasAttribute('min')\n            ? parseInt(zoom.getAttribute('min'))\n            : this._map.getMinZoom(),\n        max =\n          zoom && zoom.hasAttribute('max')\n            ? parseInt(zoom.getAttribute('max'))\n            : this._map.getMaxZoom();\n      if (zoom) {\n        for (let i = 1; i < mapExtents.length; i++) {\n          zoom = mapExtents[i].querySelector('map-input[type=zoom]');\n          if (zoom && zoom.hasAttribute('min')) {\n            min = Math.min(parseInt(zoom.getAttribute('min')), min);\n          }\n          if (zoom && zoom.hasAttribute('max')) {\n            max = Math.max(parseInt(zoom.getAttribute('max')), max);\n          }\n        }\n      }\n      var canZoom =\n        (toZoom < min && this._properties.zoomout) ||\n        (toZoom > max && this._properties.zoomin);\n      if (!(min <= toZoom && toZoom <= max)) {\n        if (this._properties.zoomin && toZoom > max) {\n          // this._href is the 'original' url from which this layer came\n          // since we are following a zoom link we will be getting a new\n          // layer almost, resetting child content as appropriate\n          this._href = this._properties.zoomin;\n          this._layerEl.src = this._properties.zoomin;\n          // this.href is the \"public\" property. When a dynamic layer is\n          // accessed, this value changes with every new extent received\n          this.href = this._properties.zoomin;\n          this._layerEl.src = this._properties.zoomin;\n        } else if (this._properties.zoomout && toZoom < min) {\n          this._href = this._properties.zoomout;\n          this.href = this._properties.zoomout;\n          this._layerEl.src = this._properties.zoomout;\n        }\n      }\n    },\n    onRemove: function (map) {\n      L.DomUtil.remove(this._container);\n      if (this._staticTileLayer) map.removeLayer(this._staticTileLayer);\n      if (this._mapmlvectors) map.removeLayer(this._mapmlvectors);\n      if (this._imageLayer) map.removeLayer(this._imageLayer);\n      map.off('popupopen', this._attachSkipButtons);\n    },\n    getAttribution: function () {\n      return this.options.attribution;\n    },\n    getBase: function () {\n      return new URL(\n        this._content.querySelector('map-base')\n          ? this._content.querySelector('map-base').getAttribute('href')\n          : this._content.nodeName === 'LAYER-'\n          ? this._content.baseURI\n          : this._href,\n        this._href\n      ).href;\n    },\n    addExtentToLayerControl: function (contents) {\n      this._layerEl._propertiesGroupAnatomy.appendChild(contents);\n      // remove hidden attribute, if it exists\n      this._layerEl._propertiesGroupAnatomy.removeAttribute('hidden');\n    },\n    _initialize: function (content) {\n      if (!this._href && !content) {\n        return;\n      }\n      var layer = this;\n      // the this._href (comes from layer@src) should take precedence over\n      // content of the <layer> element, but if no this._href / src is provided\n      // but there *is* child content of the <layer> element (which is copied/\n      // referred to by this._content), we should use that content.\n      _processContent.call(this, content, this._href ? false : true);\n      function _processContent(mapml, local) {\n        var base = layer.getBase();\n        layer._properties = {};\n        // sets layer._properties.projection\n        determineLayerProjection();\n        // requires that layer._properties.projection be set\n        if (selectMatchingAlternateProjection()) return;\n        layer._styles = getAlternateStyles();\n        parseLicenseAndLegend();\n        setLayerTitle();\n        setZoomInOrOutLinks();\n        // crs is only set if the layer has the same projection as the map\n        if (layer._properties.crs) processTiles();\n        processFeatures();\n        M._parseStylesheetAsHTML(mapml, base, layer._container);\n        copyRemoteContentToShadowRoot();\n        // update controls if needed based on mapml-viewer controls/controlslist attribute\n        if (layer._layerEl.parentElement) {\n          // if layer does not have a parent Element, do not need to set Controls\n          layer._layerEl.parentElement._toggleControls();\n        }\n        // local functions\n        // sets layer._properties.projection.  Supposed to replace / simplify\n        // the dependencies on convoluted getProjection() interface, but doesn't quite\n        // succeed, yet.\n        function determineLayerProjection() {\n          let projection = layer.options.mapprojection;\n          if (mapml.querySelector('map-meta[name=projection][content]')) {\n            projection =\n              M._metaContentToObject(\n                mapml\n                  .querySelector('map-meta[name=projection]')\n                  .getAttribute('content')\n              ).content || projection;\n          } else if (mapml.querySelector('map-extent[units]')) {\n            const getProjectionFrom = (extents) => {\n              let extentProj = extents[0].attributes.units.value;\n              let isMatch = true;\n              for (let i = 0; i < extents.length; i++) {\n                if (extentProj !== extents[i].attributes.units.value) {\n                  isMatch = false;\n                }\n              }\n              return isMatch ? extentProj : null;\n            };\n            projection =\n              getProjectionFrom(\n                Array.from(mapml.querySelectorAll('map-extent[units]'))\n              ) || projection;\n          } else {\n            console.log(\n              `A projection was not assigned to the '${layer._layerEl.label}' Layer. Please specify a projection for that layer using a map-meta element. See more here - https://maps4html.org/web-map-doc/docs/elements/meta/`\n            );\n          }\n          layer._properties.projection = projection;\n          layer._properties.crs = M[layer._properties.projection];\n        }\n        // determine if, where there's no match of the current layer's projection\n        // and that of the map, if there is a linked alternate text/mapml\n        // resource that matches the map's projection\n        function selectMatchingAlternateProjection() {\n          let selectedAlternate =\n            layer._properties.projection !== layer.options.mapprojection &&\n            mapml.querySelector(\n              'map-head map-link[rel=alternate][projection=' +\n                layer.options.mapprojection +\n                '][href]'\n            );\n          try {\n            if (selectedAlternate) {\n              let url = new URL(selectedAlternate.getAttribute('href'), base)\n                .href;\n              layer._layerEl.dispatchEvent(\n                new CustomEvent('changeprojection', {\n                  detail: {\n                    href: url\n                  }\n                })\n              );\n              return true;\n              //if this is the only layer, but the projection doesn't match,\n              // set the map's projection to that of the layer\n            } else if (\n              layer._properties.projection !== layer.options.mapprojection &&\n              layer._layerEl.parentElement.layers.length === 1\n            ) {\n              layer._layerEl.parentElement.projection =\n                layer._properties.projection;\n              return true;\n            }\n          } catch (error) {}\n          return false;\n        }\n        function setZoomInOrOutLinks() {\n          var zoomin = mapml.querySelector('map-link[rel=zoomin]'),\n            zoomout = mapml.querySelector('map-link[rel=zoomout]');\n          if (zoomin) {\n            layer._properties.zoomin = new URL(\n              zoomin.getAttribute('href'),\n              base\n            ).href;\n          }\n          if (zoomout) {\n            layer._properties.zoomout = new URL(\n              zoomout.getAttribute('href'),\n              base\n            ).href;\n          }\n        }\n        function processFeatures() {\n          let native = M.getNativeVariables(layer._content);\n          layer._mapmlvectors = M.featureLayer(null, {\n            // pass the vector layer a renderer of its own, otherwise leaflet\n            // puts everything into the overlayPane\n            renderer: M.featureRenderer(),\n            // pass the vector layer the container for the parent into which\n            // it will append its own container for rendering into\n            pane: layer._container,\n            opacity: layer.options.opacity,\n            projection: layer._properties.projection,\n            // by NOT passing options.extent, we are asking the FeatureLayer\n            // to dynamically update its .layerBounds property as features are\n            // added or removed from it\n            native: native,\n            // each owned child layer gets a reference to the root layer\n            _leafletLayer: layer,\n            static: true,\n            onEachFeature: function (properties, geometry) {\n              // need to parse as HTML to preserve semantics and styles\n              if (properties) {\n                var c = document.createElement('div');\n                c.classList.add('mapml-popup-content');\n                c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n                geometry.bindPopup(c, { autoClose: false, minWidth: 165 });\n              }\n            }\n          });\n        }\n        function processTiles() {\n          if (mapml.querySelector('map-tile')) {\n            var tiles = document.createElement('map-tiles'),\n              zoom =\n                mapml.querySelector('map-meta[name=zoom][content]') ||\n                mapml.querySelector('map-input[type=zoom][value]');\n            tiles.setAttribute(\n              'zoom',\n              (zoom && zoom.getAttribute('content')) ||\n                (zoom && zoom.getAttribute('value')) ||\n                '0'\n            );\n            var newTiles = mapml.getElementsByTagName('map-tile');\n            for (var nt = 0; nt < newTiles.length; nt++) {\n              tiles.appendChild(document.importNode(newTiles[nt], true));\n            }\n            layer._mapmlTileContainer.appendChild(tiles);\n            layer._staticTileLayer = M.staticTileLayer({\n              pane: layer._container,\n              _leafletLayer: layer,\n              projection: layer._properties.projection,\n              className: 'mapml-static-tile-layer',\n              tileContainer: layer._mapmlTileContainer,\n              maxZoomBound: layer._properties.crs.options.resolutions.length - 1,\n              tileSize: layer._properties.crs.options.crs.tile.bounds.max.x\n            });\n          }\n        }\n        function getAlternateStyles() {\n          var styleLinks = mapml.querySelectorAll(\n            'map-link[rel=style],map-link[rel=\"self style\"],map-link[rel=\"style self\"]'\n          );\n          if (styleLinks.length > 1) {\n            var stylesControl = document.createElement('details'),\n              stylesControlSummary = document.createElement('summary');\n            stylesControlSummary.innerText = 'Style';\n            stylesControl.appendChild(stylesControlSummary);\n\n            var changeStyle = function (e) {\n              L.DomEvent.stop(e);\n              layer._layerEl.dispatchEvent(\n                new CustomEvent('changestyle', {\n                  detail: {\n                    src: e.target.getAttribute('data-href')\n                  }\n                })\n              );\n            };\n\n            for (var j = 0; j < styleLinks.length; j++) {\n              var styleOption = document.createElement('div'),\n                styleOptionInput = styleOption.appendChild(\n                  document.createElement('input')\n                );\n              styleOptionInput.setAttribute('type', 'radio');\n              styleOptionInput.setAttribute(\n                'id',\n                'rad-' + L.stamp(styleOptionInput)\n              );\n              styleOptionInput.setAttribute(\n                'name',\n                // grouping radio buttons based on parent layer's style <detail>\n                'styles-' + L.stamp(stylesControl)\n              );\n              styleOptionInput.setAttribute(\n                'value',\n                styleLinks[j].getAttribute('title')\n              );\n              styleOptionInput.setAttribute(\n                'data-href',\n                new URL(styleLinks[j].getAttribute('href'), base).href\n              );\n              var styleOptionLabel = styleOption.appendChild(\n                document.createElement('label')\n              );\n              styleOptionLabel.setAttribute(\n                'for',\n                'rad-' + L.stamp(styleOptionInput)\n              );\n              styleOptionLabel.innerText = styleLinks[j].getAttribute('title');\n              if (\n                styleLinks[j].getAttribute('rel') === 'style self' ||\n                styleLinks[j].getAttribute('rel') === 'self style'\n              ) {\n                styleOptionInput.checked = true;\n              }\n              stylesControl.appendChild(styleOption);\n              L.DomUtil.addClass(\n                stylesControl,\n                'mapml-layer-item-style mapml-control-layers'\n              );\n              L.DomEvent.on(styleOptionInput, 'click', changeStyle, layer);\n            }\n            return stylesControl;\n          }\n        }\n        function setLayerTitle() {\n          if (mapml.querySelector('map-title')) {\n            layer._title = mapml.querySelector('map-title').textContent.trim();\n            layer._titleIsReadOnly = true;\n          } else if (mapml instanceof Element && mapml.hasAttribute('label')) {\n            layer._title = mapml.getAttribute('label').trim();\n          }\n        }\n        function copyRemoteContentToShadowRoot() {\n          // only run when content is loaded from network, puts features etc\n          // into layer shadow root\n          if (local) {\n            return;\n          }\n          let shadowRoot = layer._layerEl.shadowRoot;\n          // get the map-meta[name=projection/cs/extent/zoom] from map-head of remote mapml, attach them to the shadowroot\n          let headMeta =\n            mapml.children[0].children[0].querySelectorAll('map-meta[name]');\n          // get the elements inside map-body of remote mapml\n          let bodyElements = mapml.children[0].children[1].children;\n          let elements = [...headMeta, ...bodyElements];\n          if (elements) {\n            let baseURL = mapml.children[0].children[0]\n              .querySelector('map-base')\n              ?.getAttribute('href');\n            for (let el of elements) {\n              // if not clone, the elements will be **REMOVED** from mapml file and re-attached to the layer's shadow root\n              // which makes the this._content (mapml file) changed and thus affects the later generation process of this._mapmlvectors\n              let node = el.cloneNode(true);\n              el._DOMnode = node;\n              // resolve relative url\n              if (node.nodeName === 'map-link') {\n                let url = node.getAttribute('href') || node.getAttribute('tref');\n                // if relative\n                if (\n                  url &&\n                  (url.indexOf('http://') === 0 || url.indexOf('https://') === 0)\n                ) {\n                  let resolvedURL = baseURL + url;\n                  if (node.hasAttribute('href')) {\n                    node.setAttribute('href', resolvedURL);\n                  } else {\n                    node.setAttribute('tref', resolvedURL);\n                  }\n                }\n              }\n              shadowRoot.appendChild(node);\n            }\n          }\n        }\n        function parseLicenseAndLegend() {\n          var licenseLink = mapml.querySelector('map-link[rel=license]'),\n            licenseTitle,\n            licenseUrl,\n            attText;\n          if (licenseLink) {\n            licenseTitle = licenseLink.getAttribute('title');\n            licenseUrl = licenseLink.getAttribute('href');\n            attText =\n              '<a href=\"' +\n              licenseUrl +\n              '\" title=\"' +\n              licenseTitle +\n              '\">' +\n              licenseTitle +\n              '</a>';\n          }\n          L.setOptions(layer, { attribution: attText });\n          var legendLink = mapml.querySelector('map-link[rel=legend]');\n          if (legendLink) {\n            layer._legendUrl = legendLink.getAttribute('href');\n          }\n          if (layer._map) {\n            // if the layer is checked in the layer control, force the addition\n            // of the attribution just received\n            if (layer._map.hasLayer(layer)) {\n              layer._map.attributionControl.addAttribution(\n                layer.getAttribution()\n              );\n            }\n          }\n        }\n      }\n    },\n    // new getProjection, maybe simpler, but doesn't work...\n    getProjection: function () {\n      if (!this._properties) {\n        return;\n      }\n      return this._properties.projection;\n    },\n    getQueryTemplates: function (pcrsClick) {\n      const mapExtents = this._layerEl.querySelectorAll('map-extent').length\n        ? this._layerEl.querySelectorAll('map-extent')\n        : this._layerEl.shadowRoot.querySelectorAll('map-extent');\n      if (this._properties && this._properties._queries) {\n        var templates = [];\n        // only return queries that are in bounds\n        if (\n          this._layerEl.checked &&\n          !this._layerEl.hidden &&\n          this._layerEl._layerControlHTML\n        ) {\n          let layerAndExtents = this._layerEl._layerControlHTML.querySelectorAll(\n            '.mapml-layer-item-name'\n          );\n          for (let i = 0; i < layerAndExtents.length; i++) {\n            if (layerAndExtents[i].extent || mapExtents.length === 1) {\n              // the layer won't have an .extent property, this is kind of a hack\n              let extent = layerAndExtents[i].extent || mapExtents[0];\n              for (let j = 0; j < extent._templateVars.length; j++) {\n                if (extent.checked) {\n                  let template = extent._templateVars[j];\n                  // for each template in the extent, see if it corresponds to one in the this._properties._queries array\n                  for (let k = 0; k < this._properties._queries.length; k++) {\n                    let queryTemplate = this._properties._queries[k];\n                    if (\n                      template === queryTemplate &&\n                      queryTemplate.extentBounds.contains(pcrsClick)\n                    ) {\n                      templates.push(queryTemplate);\n                    }\n                  }\n                }\n              }\n            }\n          }\n          return templates;\n        }\n      }\n    },\n    _attachSkipButtons: function (e) {\n      let popup = e.popup,\n        map = e.target,\n        layer,\n        group,\n        content = popup._container.getElementsByClassName(\n          'mapml-popup-content'\n        )[0];\n\n      popup._container.setAttribute('role', 'dialog');\n      content.setAttribute('tabindex', '-1');\n      // https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/467#issuecomment-844307818\n      content.setAttribute('role', 'document');\n      popup._count = 0; // used for feature pagination\n\n      if (popup._source._eventParents) {\n        // check if the popup is for a feature or query\n        layer =\n          popup._source._eventParents[\n            Object.keys(popup._source._eventParents)[0]\n          ]; // get first parent of feature, there should only be one\n        group = popup._source.group;\n        // if the popup is for a static / templated feature, the \"zoom to here\" link can be attached once the popup opens\n        attachZoomLink.call(popup);\n      } else {\n        // getting access to the first map-extent to get access to _templatedLayer to use it's (possibly) generic _previousFeature + _nextFeature methods.\n        const mapExtent =\n          popup._source._layerEl.querySelector('map-extent') ||\n          popup._source._layerEl.shadowRoot.querySelector('map-extent');\n        layer = mapExtent._templatedLayer;\n        // if the popup is for a query, the \"zoom to here\" link should be re-attached every time new pagination features are displayed\n        map.on('attachZoomLink', attachZoomLink, popup);\n      }\n\n      if (popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]')) {\n        L.DomUtil.remove(\n          popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]')\n        );\n        L.DomUtil.remove(popup._container.querySelector('hr'));\n      }\n      //add when popopen event happens instead\n      let div = L.DomUtil.create('nav', 'mapml-focus-buttons');\n\n      // creates |< button, focuses map\n      let mapFocusButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      mapFocusButton.type = 'button';\n      mapFocusButton.title = 'Focus Map';\n      mapFocusButton.innerHTML = \"<span aria-hidden='true'>|&#10094;</span>\";\n      L.DomEvent.on(\n        mapFocusButton,\n        'click',\n        (e) => {\n          L.DomEvent.stop(e);\n          map.featureIndex._sortIndex();\n          map.closePopup();\n          map._container.focus();\n        },\n        popup\n      );\n\n      // creates < button, focuses previous feature, if none exists focuses the current feature\n      let previousButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      previousButton.type = 'button';\n      previousButton.title = 'Previous Feature';\n      previousButton.innerHTML = \"<span aria-hidden='true'>&#10094;</span>\";\n      L.DomEvent.on(previousButton, 'click', layer._previousFeature, popup);\n\n      // static feature counter that 1/1\n      let featureCount = L.DomUtil.create('p', 'mapml-feature-count', div),\n        totalFeatures = this._totalFeatureCount ? this._totalFeatureCount : 1;\n      featureCount.innerText = popup._count + 1 + '/' + totalFeatures;\n\n      // creates > button, focuses next feature, if none exists focuses the current feature\n      let nextButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      nextButton.type = 'button';\n      nextButton.title = 'Next Feature';\n      nextButton.innerHTML = \"<span aria-hidden='true'>&#10095;</span>\";\n      L.DomEvent.on(nextButton, 'click', layer._nextFeature, popup);\n\n      // creates >| button, focuses map controls\n      let controlFocusButton = L.DomUtil.create(\n        'button',\n        'mapml-popup-button',\n        div\n      );\n      controlFocusButton.type = 'button';\n      controlFocusButton.title = 'Focus Controls';\n      controlFocusButton.innerHTML = \"<span aria-hidden='true'>&#10095;|</span>\";\n      L.DomEvent.on(\n        controlFocusButton,\n        'click',\n        (e) => {\n          map.featureIndex._sortIndex();\n          map.featureIndex.currentIndex =\n            map.featureIndex.inBoundFeatures.length - 1;\n          map.featureIndex.inBoundFeatures[0].path.setAttribute('tabindex', -1);\n          map.featureIndex.inBoundFeatures[\n            map.featureIndex.currentIndex\n          ].path.setAttribute('tabindex', 0);\n          L.DomEvent.stop(e);\n          map.closePopup();\n          map._controlContainer.querySelector('A:not([hidden])').focus();\n        },\n        popup\n      );\n\n      let divider = L.DomUtil.create('hr', 'mapml-popup-divider');\n\n      popup._navigationBar = div;\n      popup._content.appendChild(divider);\n      popup._content.appendChild(div);\n\n      content.focus();\n\n      if (group && !M.options.featureIndexOverlayOption) {\n        // e.target = this._map\n        // Looks for keydown, more specifically tab and shift tab\n        group.setAttribute('aria-expanded', 'true');\n        map.on('keydown', focusFeature);\n      } else {\n        map.on('keydown', focusMap);\n      }\n      // When popup is open, what gets focused with tab needs to be done using JS as the DOM order is not in an accessibility friendly manner\n      function focusFeature(focusEvent) {\n        let path =\n          focusEvent.originalEvent.path ||\n          focusEvent.originalEvent.composedPath();\n        let isTab = focusEvent.originalEvent.keyCode === 9,\n          shiftPressed = focusEvent.originalEvent.shiftKey;\n        if (\n          (path[0].classList.contains('leaflet-popup-close-button') &&\n            isTab &&\n            !shiftPressed) ||\n          focusEvent.originalEvent.keyCode === 27 ||\n          (path[0].classList.contains('leaflet-popup-close-button') &&\n            focusEvent.originalEvent.keyCode === 13)\n        ) {\n          setTimeout(() => {\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        } else if (\n          path[0].classList.contains('mapml-popup-content') &&\n          isTab &&\n          shiftPressed\n        ) {\n          setTimeout(() => {\n            //timeout needed so focus of the feature is done even after the keypressup event occurs\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        } else if (\n          path[0] === popup._content.querySelector('a') &&\n          isTab &&\n          shiftPressed\n        ) {\n          setTimeout(() => {\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        }\n      }\n\n      function focusMap(focusEvent) {\n        let path =\n          focusEvent.originalEvent.path ||\n          focusEvent.originalEvent.composedPath();\n        let isTab = focusEvent.originalEvent.keyCode === 9,\n          shiftPressed = focusEvent.originalEvent.shiftKey;\n\n        if (\n          (focusEvent.originalEvent.keyCode === 13 &&\n            path[0].classList.contains('leaflet-popup-close-button')) ||\n          focusEvent.originalEvent.keyCode === 27\n        ) {\n          L.DomEvent.stopPropagation(focusEvent);\n          map.closePopup(popup);\n          map._container.focus();\n          if (focusEvent.originalEvent.keyCode !== 27) map._popupClosed = true;\n        } else if (\n          isTab &&\n          path[0].classList.contains('leaflet-popup-close-button')\n        ) {\n          map.closePopup(popup);\n        } else if (\n          path[0].classList.contains('mapml-popup-content') &&\n          isTab &&\n          shiftPressed\n        ) {\n          map.closePopup(popup);\n          setTimeout(() => {\n            //timeout needed so focus of the feature is done even after the keypressup event occurs\n            L.DomEvent.stop(focusEvent);\n            map._container.focus();\n          }, 0);\n        } else if (\n          path[0] === popup._content.querySelector('a') &&\n          isTab &&\n          shiftPressed\n        ) {\n          map.closePopup(popup);\n          setTimeout(() => {\n            L.DomEvent.stop(focusEvent);\n            map._container.focus();\n          }, 0);\n        }\n      }\n\n      function attachZoomLink(e) {\n        // this === popup\n        let content = this._content,\n          featureEl = e ? e.currFeature : this._source._groupLayer._featureEl;\n        if (content.querySelector('a.mapml-zoom-link')) {\n          content.querySelector('a.mapml-zoom-link').remove();\n        }\n        if (!featureEl.querySelector('map-geometry')) return;\n        featureEl.whenReady().then(() => {\n          let tL = featureEl.extent.topLeft.gcrs,\n            bR = featureEl.extent.bottomRight.gcrs,\n            center = L.latLngBounds(\n              L.latLng(tL.horizontal, tL.vertical),\n              L.latLng(bR.horizontal, bR.vertical)\n            ).getCenter(true);\n          let zoomLink = document.createElement('a');\n          zoomLink.href = `#${featureEl.getMaxZoom()},${center.lng},${\n          center.lat\n        }`;\n          zoomLink.innerHTML = `${M.options.locale.popupZoom}`;\n          zoomLink.className = 'mapml-zoom-link';\n          zoomLink.onclick = zoomLink.onkeydown = function (e) {\n            if (!(e instanceof MouseEvent) && e.keyCode !== 13) return;\n            e.preventDefault();\n            featureEl.zoomTo();\n            featureEl._map.closePopup();\n            featureEl._map.getContainer().focus();\n          };\n          // we found that the popupopen event is fired as many times as there\n          // are layers on the map (<layer-> elements / MapMLLayers that is).\n          // In each case the target layer is always this layer, so we can't\n          // detect and conditionally add the zoomLink if the target is not this.\n          // so, like Ahmad, we are taking a 'delete everyting each time'\n          // approach (see _attachSkipButtons for this approach taken with\n          // feature navigation buttons); obviously he dealt with this leaflet bug\n          // this way some time ago, and we can't figure out how to get around it\n          // apart from this slightly non-optimal method. Revisit sometime!\n          let link = content.querySelector('.mapml-zoom-link');\n          if (link) link.remove();\n          content.insertBefore(\n            zoomLink,\n            content.querySelector('hr.mapml-popup-divider')\n          );\n        });\n      }\n\n      // if popup closes then the focusFeature handler can be removed\n      map.on('popupclose', removeHandlers);\n      function removeHandlers(removeEvent) {\n        if (removeEvent.popup === popup) {\n          map.off('keydown', focusFeature);\n          map.off('keydown', focusMap);\n          map.off('popupopen', attachZoomLink);\n          map.off('popupclose', removeHandlers);\n          if (group) group.setAttribute('aria-expanded', 'false');\n        }\n      }\n    }\n  });\n  var mapMLLayer = function (url, node, mapml, options) {\n    if (!url && !node) return null;\n    return new MapMLLayer(url, node, mapml, options);\n  };\n\n  var DebugOverlay = L.Layer.extend({\n    onAdd: function (map) {\n      let mapSize = map.getSize();\n\n      //conditionally show container for debug panel/banner only when the map has enough space for it\n      if (mapSize.x > 400 || mapSize.y > 300) {\n        this._container = L.DomUtil.create(\n          'table',\n          'mapml-debug',\n          map._container\n        );\n\n        this._panel = debugPanel({\n          className: 'mapml-debug-panel',\n          pane: this._container\n        });\n        map.addLayer(this._panel);\n      }\n\n      this._grid = debugGrid({\n        className: 'mapml-debug-grid',\n        pane: map._panes.mapPane,\n        zIndex: 400,\n        tileSize: map.options.crs.options.crs.tile.bounds.max.x\n      });\n      map.addLayer(this._grid);\n\n      this._vectors = debugVectors({\n        className: 'mapml-debug-vectors',\n        pane: map._panes.mapPane,\n        toolPane: this._container\n      });\n      map.addLayer(this._vectors);\n    },\n\n    onRemove: function (map) {\n      map.removeLayer(this._grid);\n      map.removeLayer(this._vectors);\n      if (this._panel) {\n        //conditionally remove the panel, as it's not always added\n        map.removeLayer(this._panel);\n        L.DomUtil.remove(this._container);\n      }\n    }\n  });\n\n  var debugOverlay = function () {\n    return new DebugOverlay();\n  };\n\n  var DebugPanel = L.Layer.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n    },\n\n    onAdd: function (map) {\n      this._title = L.DomUtil.create(\n        'caption',\n        'mapml-debug-banner',\n        this.options.pane\n      );\n      this._title.innerHTML = 'Debug mode';\n\n      map.debug = {};\n      map.debug._infoContainer = this._debugContainer = L.DomUtil.create(\n        'tbody',\n        'mapml-debug-panel',\n        this.options.pane\n      );\n\n      let infoContainer = map.debug._infoContainer;\n\n      map.debug._tileCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._tileMatrixCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._mapCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._tcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._pcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._gcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n\n      this._map.on('mousemove', this._updateCoords);\n    },\n    onRemove: function () {\n      L.DomUtil.remove(this._title);\n      if (this._debugContainer) {\n        L.DomUtil.remove(this._debugContainer);\n        this._map.off('mousemove', this._updateCoords);\n      }\n    },\n    _updateCoords: function (e) {\n      if (this.contextMenu._visible) return;\n      let mapEl = this.options.mapEl,\n        point = mapEl._map.project(e.latlng),\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation.untransform(point, scale),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointI = point.x % tileSize,\n        pointJ = point.y % tileSize;\n\n      if (pointI < 0) pointI += tileSize;\n      if (pointJ < 0) pointJ += tileSize;\n\n      this.debug._tileCoord.innerHTML = `\n      <th scope=\"row\">tile: </th>\n      <td>i: ${Math.trunc(pointI)}, </td>\n      <td>j: ${Math.trunc(pointJ)}</td>\n      `;\n      this.debug._mapCoord.innerHTML = `\n      <th scope=\"row\">map: </th>\n      <td>i: ${Math.trunc(e.containerPoint.x)}, </td>\n      <td>j: ${Math.trunc(e.containerPoint.y)}</td>\n      `;\n      this.debug._gcrsCoord.innerHTML = `\n      <th scope=\"row\">gcrs: </th>\n      <td>lon: ${e.latlng.lng.toFixed(6)}, </td>\n      <td>lat: ${e.latlng.lat.toFixed(6)}</td>\n      `;\n      this.debug._tcrsCoord.innerHTML = `\n      <th scope=\"row\">tcrs: </th>\n      <td>x: ${Math.trunc(point.x)}, </td>\n      <td>y: ${Math.trunc(point.y)}</td>\n      `;\n      this.debug._tileMatrixCoord.innerHTML = `\n      <th scope=\"row\">tilematrix: </th>\n      <td>column: ${Math.trunc(point.x / tileSize)}, </td>\n      <td>row: ${Math.trunc(point.y / tileSize)}</td>\n      `;\n      this.debug._pcrsCoord.innerHTML = `\n      <th scope=\"row\">pcrs: </th>\n      <td>easting: ${pcrs.x.toFixed(2)}, </td>\n      <td>northing: ${pcrs.y.toFixed(2)}</td>\n      `;\n    }\n  });\n\n  var debugPanel = function (options) {\n    return new DebugPanel(options);\n  };\n\n  var DebugGrid = L.GridLayer.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.GridLayer.prototype.initialize.call(this, this._map);\n    },\n\n    createTile: function (coords) {\n      let tile = L.DomUtil.create('div', 'mapml-debug-tile');\n      tile.setAttribute('col', coords.x);\n      tile.setAttribute('row', coords.y);\n      tile.setAttribute('zoom', coords.z);\n      tile.innerHTML = [\n        `col: ${coords.x}`,\n        `row: ${coords.y}`,\n        `zoom: ${coords.z}`\n      ].join(', ');\n\n      tile.style.outline = '1px dashed red';\n      return tile;\n    }\n  });\n\n  var debugGrid = function (options) {\n    return new DebugGrid(options);\n  };\n\n  var DebugVectors = L.LayerGroup.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.LayerGroup.prototype.initialize.call(this, this._map, options);\n    },\n    onAdd: function (map) {\n      map.on('overlayremove', this._mapLayerUpdate, this);\n      map.on('overlayadd', this._mapLayerUpdate, this);\n      let center = map.options.crs.transformation.transform(\n        L.point(0, 0),\n        map.options.crs.scale(0)\n      );\n      this._centerVector = L.circle(map.options.crs.pointToLatLng(center, 0), {\n        radius: 250,\n        className: 'mapml-debug-vectors projection-centre'\n      });\n      this._centerVector.bindTooltip('Projection Center');\n\n      this._addBounds(map);\n    },\n    onRemove: function (map) {\n      this.clearLayers();\n    },\n\n    _addBounds: function (map) {\n      // to delay the addBounds to wait for the layer.extentbounds / layer.layerbounds to be ready when the layer- checked attribute is changed\n      setTimeout(() => {\n        let id = Object.keys(map._layers),\n          layers = map._layers,\n          colors = ['#FF5733', '#8DFF33', '#3397FF', '#E433FF', '#F3FF33'],\n          j = 0;\n\n        this.addLayer(this._centerVector);\n\n        for (let i of id) {\n          if (layers[i].layerBounds || layers[i].extentBounds) {\n            let boundsArray;\n            if (layers[i].layerBounds) {\n              boundsArray = [\n                layers[i].layerBounds.min,\n                L.point(layers[i].layerBounds.max.x, layers[i].layerBounds.min.y),\n                layers[i].layerBounds.max,\n                L.point(layers[i].layerBounds.min.x, layers[i].layerBounds.max.y)\n              ];\n            } else {\n              boundsArray = [\n                layers[i].extentBounds.min,\n                L.point(\n                  layers[i].extentBounds.max.x,\n                  layers[i].extentBounds.min.y\n                ),\n                layers[i].extentBounds.max,\n                L.point(\n                  layers[i].extentBounds.min.x,\n                  layers[i].extentBounds.max.y\n                )\n              ];\n            }\n\n            // boundsTestTag adds the value of from the <layer-@data-testid> element\n            // if it exists. this simplifies debugging because the svg path will be\n            // tagged with the layer it came from\n            let boundsTestTag =\n              layers[i].extentBounds &&\n              layers[i].options.extentEl.parentLayer.hasAttribute('data-testid')\n                ? layers[i].options.extentEl.parentLayer.getAttribute(\n                    'data-testid'\n                  )\n                : layers[i].layerBounds &&\n                  layers[i].options._leafletLayer._layerEl.hasAttribute(\n                    'data-testid'\n                  )\n                ? layers[i].options._leafletLayer._layerEl.getAttribute(\n                    'data-testid'\n                  )\n                : '';\n            let boundsRect = projectedExtent(boundsArray, {\n              className: this.options.className.concat(' ', boundsTestTag),\n              color: colors[j % colors.length],\n              weight: 2,\n              opacity: 1,\n              fillOpacity: 0.01,\n              fill: true\n            });\n            if (layers[i].options._leafletLayer)\n              boundsRect.bindTooltip(layers[i].options._leafletLayer._title, {\n                sticky: true\n              });\n            this.addLayer(boundsRect);\n            j++;\n          }\n        }\n\n        if (map.totalLayerBounds) {\n          let totalBoundsArray = [\n            map.totalLayerBounds.min,\n            L.point(map.totalLayerBounds.max.x, map.totalLayerBounds.min.y),\n            map.totalLayerBounds.max,\n            L.point(map.totalLayerBounds.min.x, map.totalLayerBounds.max.y)\n          ];\n\n          let totalBounds = projectedExtent(totalBoundsArray, {\n            className: 'mapml-debug-vectors mapml-total-bounds',\n            color: '#808080',\n            weight: 5,\n            opacity: 0.5,\n            fill: false\n          });\n          this.addLayer(totalBounds);\n        }\n      }, 0);\n    },\n\n    _mapLayerUpdate: function (e) {\n      this.clearLayers();\n      this._addBounds(e.target);\n    }\n  });\n\n  var debugVectors = function (options) {\n    return new DebugVectors(options);\n  };\n\n  var ProjectedExtent = L.Path.extend({\n    getCenter: function (round) {\n      let crs = this._map.options.crs;\n      return crs.unproject(L.bounds(this._locations).getCenter());\n    },\n\n    options: {\n      className: 'mapml-debug-extent'\n    },\n    initialize: function (locations, options) {\n      //locations passed in as pcrs coordinates\n      this._locations = locations;\n      L.setOptions(this, options);\n    },\n\n    _project: function () {\n      this._rings = [];\n      let scale = this._map.options.crs.scale(this._map.getZoom()),\n        map = this._map;\n      for (let i = 0; i < this._locations.length; i++) {\n        let point = map.options.crs.transformation.transform(\n          this._locations[i],\n          scale\n        );\n        //substract the pixel origin from the pixel coordinates to get the location relative to map viewport\n        this._rings.push(\n          L.point(point.x, point.y)._subtract(map.getPixelOrigin())\n        );\n      }\n      //leaflet SVG renderer looks for and array of arrays to build polygons,\n      //in this case it only deals with a rectangle so one closed array or points\n      this._parts = [this._rings];\n    },\n\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updatePoly(this, true); //passing true creates a closed path i.e. a rectangle\n    }\n  });\n\n  var projectedExtent = function (locations, options) {\n    return new ProjectedExtent(locations, options);\n  };\n\n  var QueryHandler = L.Handler.extend({\n    addHooks: function () {\n      // get a reference to the actual <map> element, so we can\n      // use its layers property to iterate the layers from top down\n      // evaluating if they are 'on the map' (enabled)\n      L.setOptions(this, { mapEl: this._map.options.mapEl });\n      L.DomEvent.on(this._map, 'click', this._queryTopLayer, this);\n      L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n    },\n    removeHooks: function () {\n      L.DomEvent.off(this._map, 'click', this._queryTopLayer, this);\n      L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n    },\n    _getTopQueryableLayer: function () {\n      var layers = this.options.mapEl.layers;\n      // work backwards in document order (top down)\n      for (var l = layers.length - 1; l >= 0; l--) {\n        var mapmlLayer = layers[l]._layer;\n        if (layers[l].checked && mapmlLayer && mapmlLayer.queryable) {\n          return mapmlLayer;\n        }\n      }\n    },\n    _queryTopLayerAtMapCenter: function (event) {\n      setTimeout(() => {\n        if (\n          this._map.isFocused &&\n          !this._map._popupClosed &&\n          (event.originalEvent.key === ' ' || +event.originalEvent.keyCode === 13)\n        ) {\n          this._map.fire('click', {\n            latlng: this._map.getCenter(),\n            layerPoint: this._map.latLngToLayerPoint(this._map.getCenter()),\n            containerPoint: this._map.latLngToContainerPoint(\n              this._map.getCenter()\n            )\n          });\n        } else {\n          delete this._map._popupClosed;\n        }\n      }, 0);\n    },\n    _queryTopLayer: function (event) {\n      var layer = this._getTopQueryableLayer();\n      if (layer) {\n        if (layer._mapmlFeatures) delete layer._mapmlFeatures;\n        this._query(event, layer);\n      }\n    },\n    _query(e, layer) {\n      var zoom = e.target.getZoom(),\n        map = this._map,\n        crs = layer._properties.crs, // the crs for each extent would be the same\n        tileSize = map.options.crs.options.crs.tile.bounds.max.x,\n        container = layer._container,\n        popupOptions = {\n          autoClose: false,\n          autoPan: true,\n          maxHeight: map.getSize().y * 0.5 - 50\n        },\n        tcrs2pcrs = function (c) {\n          return crs.transformation.untransform(c, crs.scale(zoom));\n        },\n        tcrs2gcrs = function (c) {\n          return crs.unproject(\n            crs.transformation.untransform(c, crs.scale(zoom)),\n            zoom\n          );\n        };\n      var tcrsClickLoc = crs.latLngToPoint(e.latlng, zoom),\n        tileMatrixClickLoc = tcrsClickLoc.divideBy(tileSize).floor(),\n        tileBounds = new L.Bounds(\n          tcrsClickLoc.divideBy(tileSize).floor().multiplyBy(tileSize),\n          tcrsClickLoc.divideBy(tileSize).ceil().multiplyBy(tileSize)\n        );\n\n      let point = this._map.project(e.latlng),\n        scale = this._map.options.crs.scale(this._map.getZoom()),\n        pcrsClick = this._map.options.crs.transformation.untransform(\n          point,\n          scale\n        );\n      let templates = layer.getQueryTemplates(pcrsClick);\n\n      let fetches = [];\n\n      var fetchFeatures = function (template, obj) {\n        const parser = new DOMParser();\n        return fetch(L.Util.template(template.template, obj), {\n          redirect: 'follow'\n        })\n          .then((response) => {\n            if (response.status >= 200 && response.status < 300) {\n              return response.text().then((text) => {\n                return {\n                  contenttype: response.headers.get('Content-Type'),\n                  text: text\n                };\n              });\n            } else {\n              throw new Error(response.status);\n            }\n          })\n          .then((response) => {\n            let features = [];\n            if (response.contenttype.startsWith('text/mapml')) {\n              // the mapmldoc could have <map-meta> elements that are important, perhaps\n              // also, the mapmldoc can have many features\n              let mapmldoc = parser.parseFromString(\n                response.text,\n                'application/xml'\n              );\n              features = Array.prototype.slice.call(\n                mapmldoc.querySelectorAll('map-feature')\n              );\n              // <map-meta> elements for this query\n              layer.queryMetas = Array.prototype.slice.call(\n                mapmldoc.querySelectorAll(\n                  'map-meta[name=cs], map-meta[name=zoom], map-meta[name=projection]'\n                )\n              );\n            } else {\n              // synthesize a single feature from text or html content\n              let geom =\n                  \"<map-geometry cs='gcrs'><map-point><map-coordinates>\" +\n                  e.latlng.lng +\n                  ' ' +\n                  e.latlng.lat +\n                  '</map-coordinates></map-point></map-geometry>',\n                feature = parser\n                  .parseFromString(\n                    '<map-feature><map-properties>' +\n                      response.text +\n                      '</map-properties>' +\n                      geom +\n                      '</map-feature>',\n                    'text/html'\n                  )\n                  .querySelector('map-feature');\n              features.push(feature);\n            }\n            return { features: features, template: template };\n          })\n          .catch((err) => {\n            console.log('Looks like there was a problem. Status: ' + err.message);\n          });\n      };\n\n      for (let i = 0; i < templates.length; i++) {\n        var obj = {},\n          template = templates[i];\n\n        // all of the following are locations that might be used in a query, I think.\n        obj[template.query.tilei] =\n          tcrsClickLoc.x.toFixed() - tileMatrixClickLoc.x * tileSize;\n        obj[template.query.tilej] =\n          tcrsClickLoc.y.toFixed() - tileMatrixClickLoc.y * tileSize;\n\n        // this forces the click to the centre of the map extent in the layer crs\n        obj[template.query.mapi] = map.getSize().divideBy(2).x.toFixed();\n        obj[template.query.mapj] = map.getSize().divideBy(2).y.toFixed();\n\n        obj[template.query.pixelleft] = crs.pointToLatLng(tcrsClickLoc, zoom).lng;\n        obj[template.query.pixeltop] = crs.pointToLatLng(tcrsClickLoc, zoom).lat;\n        obj[template.query.pixelright] = crs.pointToLatLng(\n          tcrsClickLoc.add([1, 1]),\n          zoom\n        ).lng;\n        obj[template.query.pixelbottom] = crs.pointToLatLng(\n          tcrsClickLoc.add([1, 1]),\n          zoom\n        ).lat;\n\n        obj[template.query.column] = tileMatrixClickLoc.x;\n        obj[template.query.row] = tileMatrixClickLoc.y;\n        obj[template.query.x] = tcrsClickLoc.x.toFixed();\n        obj[template.query.y] = tcrsClickLoc.y.toFixed();\n\n        // whereas the layerPoint is calculated relative to the origin plus / minus any\n        // pan movements so is equal to containerPoint at first before any pans, but\n        // changes as the map pans.\n        obj[template.query.easting] = tcrs2pcrs(tcrsClickLoc).x;\n        obj[template.query.northing] = tcrs2pcrs(tcrsClickLoc).y;\n        obj[template.query.longitude] = tcrs2gcrs(tcrsClickLoc).lng;\n        obj[template.query.latitude] = tcrs2gcrs(tcrsClickLoc).lat;\n        obj[template.query.zoom] = zoom;\n        obj[template.query.width] = map.getSize().x;\n        obj[template.query.height] = map.getSize().y;\n        // assumes the click is at the centre of the map, per template.query.mapi, mapj above\n        obj[template.query.mapbottom] = tcrs2pcrs(\n          tcrsClickLoc.add(map.getSize().divideBy(2))\n        ).y;\n        obj[template.query.mapleft] = tcrs2pcrs(\n          tcrsClickLoc.subtract(map.getSize().divideBy(2))\n        ).x;\n        obj[template.query.maptop] = tcrs2pcrs(\n          tcrsClickLoc.subtract(map.getSize().divideBy(2))\n        ).y;\n        obj[template.query.mapright] = tcrs2pcrs(\n          tcrsClickLoc.add(map.getSize().divideBy(2))\n        ).x;\n\n        obj[template.query.tilebottom] = tcrs2pcrs(tileBounds.max).y;\n        obj[template.query.tileleft] = tcrs2pcrs(tileBounds.min).x;\n        obj[template.query.tiletop] = tcrs2pcrs(tileBounds.min).y;\n        obj[template.query.tileright] = tcrs2pcrs(tileBounds.max).x;\n        // add hidden or other variables that may be present into the values to\n        // be processed by L.Util.template below.\n        for (var v in template.query) {\n          if (\n            [\n              'mapi',\n              'mapj',\n              'tilei',\n              'tilej',\n              'row',\n              'col',\n              'x',\n              'y',\n              'easting',\n              'northing',\n              'longitude',\n              'latitude',\n              'width',\n              'height',\n              'zoom',\n              'mapleft',\n              'mapright',\n              ',maptop',\n              'mapbottom',\n              'tileleft',\n              'tileright',\n              'tiletop',\n              'tilebottom',\n              'pixeltop',\n              'pixelbottom',\n              'pixelleft',\n              'pixelright'\n            ].indexOf(v) < 0\n          ) {\n            obj[v] = template.query[v];\n          }\n        }\n\n        if (template.extentBounds.contains(pcrsClick)) {\n          fetches.push(fetchFeatures(template, obj));\n        }\n      }\n      Promise.allSettled(fetches).then((results) => {\n        layer._mapmlFeatures = [];\n        // f is an array of {features[], template}\n\n        for (let f of results) {\n          if (f.status === 'fulfilled') {\n            // create connection between queried <map-feature> and its parent <map-extent>\n            for (let feature of f.value.features) {\n              feature._extentEl = f.value.template._extentEl;\n            }\n            layer._mapmlFeatures = layer._mapmlFeatures.concat(f.value.features);\n          }\n        }\n        if (layer._mapmlFeatures.length > 0)\n          displayFeaturesPopup(layer._mapmlFeatures, e.latlng);\n      });\n\n      function displayFeaturesPopup(features, loc) {\n        if (features.length === 0) return;\n        let f = M.featureLayer(features, {\n          // pass the vector layer a renderer of its own, otherwise leaflet\n          // puts everything into the overlayPane\n          renderer: M.featureRenderer(),\n          // pass the vector layer the container for the parent into which\n          // it will append its own container for rendering into\n          pane: container,\n          //color: 'yellow',\n          // instead of unprojecting and then projecting and scaling,\n          // a much smarter approach would be to scale at the current\n          // zoom\n          projection: map.options.projection,\n          _leafletLayer: layer,\n          query: true,\n          static: true\n        });\n        f.addTo(map);\n\n        let div = L.DomUtil.create('div', 'mapml-popup-content'),\n          c = L.DomUtil.create('iframe');\n        c.style = 'border: none';\n        c.srcdoc = features[0].querySelector(\n          'map-feature map-properties'\n        ).innerHTML;\n        c.setAttribute('sandbox', 'allow-same-origin allow-forms');\n        div.appendChild(c);\n        // passing a latlng to the popup is necessary for when there is no\n        // geometry / null geometry\n        layer._totalFeatureCount = features.length;\n        layer.bindPopup(div, popupOptions).openPopup(loc);\n        layer.on('popupclose', function () {\n          map.removeLayer(f);\n        });\n        f.showPaginationFeature({\n          i: 0,\n          popup: layer._popup,\n          meta: layer.queryMetas\n        });\n      }\n    }\n  });\n\n  /*\n  MIT License related to portions of M.ContextMenu \n  Copyright (c) 2017 adam.ratcliffe@gmail.com\n  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), \n  to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, \n  and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n  */\n  /* global M, KeyboardEvent */\n\n  var ContextMenu = L.Handler.extend({\n    _touchstart: L.Browser.msPointer\n      ? 'MSPointerDown'\n      : L.Browser.pointer\n      ? 'pointerdown'\n      : 'touchstart',\n\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n      this.activeIndex = 0; //current fous index on menu\n      this.excludedIndices = [4, 7]; //menu indexes that are --------\n      this.isRunned = false; //variable for tracking edge case\n      //setting the items in the context menu and their callback functions\n      this._menuItems = {};\n\n      const CTXBACK = 0,\n        CTXFWD = 1,\n        CTXRELOAD = 2,\n        CTXFULLSCR = 3,\n        CTXSPACER1 = 4,\n        CTXCOPY = 5,\n        CTXPASTE = 6,\n        CTXSPACER2 = 7,\n        CTXCNTRLS = 8,\n        CTXDEBUG = 9,\n        CTXVWSRC = 10;\n      this._menuItems.CTXBACK = CTXBACK;\n      this._menuItems.CTXFWD = CTXFWD;\n      this._menuItems.CTXRELOAD = CTXRELOAD;\n      this._menuItems.CTXFULLSCR = CTXFULLSCR;\n      this._menuItems.CTXSPACER1 = CTXSPACER1;\n      this._menuItems.CTXCOPY = CTXCOPY;\n      this._menuItems.CTXPASTE = CTXPASTE;\n      this._menuItems.CTXSPACER2 = CTXSPACER2;\n      this._menuItems.CTXCNTRLS = CTXCNTRLS;\n      this._menuItems.CTXDEBUG = CTXDEBUG;\n      this._menuItems.CTXVWSRC = CTXVWSRC;\n\n      this._items = [\n        {\n          // 0\n          text: M.options.locale.cmBack + ' (<kbd>Alt+Left Arrow</kbd>)',\n          callback: this._goBack\n        },\n        {\n          // 1\n          text: M.options.locale.cmForward + ' (<kbd>Alt+Right Arrow</kbd>)',\n          callback: this._goForward\n        },\n        {\n          // 2\n          text: M.options.locale.cmReload + ' (<kbd>Ctrl+R</kbd>)',\n          callback: this._reload\n        },\n        {\n          // 3\n          text: M.options.locale.btnFullScreen + ' (<kbd>F</kbd>)',\n          callback: this._toggleFullScreen\n        },\n        {\n          // 4\n          spacer: '-'\n        },\n        {\n          // 5\n          text: M.options.locale.cmCopyCoords + ' (<kbd>C</kbd>)<span></span>',\n          callback: this._copyCoords,\n          hideOnSelect: false,\n          popup: true,\n          submenu: [\n            {\n              // 5.0\n              text: M.options.locale.cmCopyMapML,\n              callback: this._copyMapML\n            },\n            {\n              // 5.1\n              text: M.options.locale.cmCopyExtent,\n              callback: this._copyExtent\n            },\n            {\n              // 5.2\n              text: M.options.locale.cmCopyLocation,\n              callback: this._copyLocation\n            }\n          ]\n        },\n        {\n          // 6\n          text: M.options.locale.cmPasteLayer + ' (<kbd>P</kbd>)',\n          callback: this._paste\n        },\n        {\n          // 7\n          spacer: '-'\n        },\n        {\n          // 8\n          text: M.options.locale.cmToggleControls + ' (<kbd>T</kbd>)',\n          callback: this._toggleControls\n        },\n        {\n          // 9\n          text: M.options.locale.cmToggleDebug + ' (<kbd>D</kbd>)',\n          callback: this._toggleDebug\n        },\n        {\n          // 10\n          text: M.options.locale.cmViewSource + ' (<kbd>V</kbd>)',\n          callback: this._viewSource\n        }\n      ];\n\n      // setting the default cs for copying location and extent\n      // should be public as they are used in tests\n      this.defExtCS = M.options.defaultExtCoor;\n      this.defLocCS = M.options.defaultLocCoor;\n      const LYRZOOMTO = 0,\n        LYRCOPY = 1;\n      this._menuItems.LYRZOOMTO = LYRZOOMTO;\n      this._menuItems.LYRCOPY = LYRCOPY;\n      this._layerItems = [\n        {\n          // 0\n          text: M.options.locale.lmZoomToLayer + ' (<kbd>Z</kbd>)',\n          callback: this._zoomToLayer\n        },\n        {\n          // 1\n          text: M.options.locale.lmCopyLayer + ' (<kbd>L</kbd>)',\n          callback: this._copyLayer\n        }\n      ];\n      this._mapMenuVisible = false;\n      this._keyboardEvent = false;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu',\n        map.getContainer()\n      );\n      this._container.setAttribute('hidden', '');\n\n      this._items[CTXBACK].el = this._createItem(\n        this._container,\n        this._items[CTXBACK]\n      );\n      this._items[CTXFWD].el = this._createItem(\n        this._container,\n        this._items[CTXFWD]\n      );\n      this._items[CTXRELOAD].el = this._createItem(\n        this._container,\n        this._items[CTXRELOAD]\n      );\n      this._items[CTXFULLSCR].el = this._createItem(\n        this._container,\n        this._items[CTXFULLSCR]\n      );\n      this._items[CTXSPACER1].el = this._createItem(\n        this._container,\n        this._items[CTXSPACER1]\n      );\n      this._items[CTXCOPY].el = this._createItem(\n        this._container,\n        this._items[CTXCOPY]\n      );\n\n      this._copySubMenu = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu mapml-submenu',\n        this._container\n      );\n      this._copySubMenu.id = 'mapml-copy-submenu';\n      this._copySubMenu.setAttribute('hidden', '');\n\n      this._clickEvent = null;\n\n      const CPYMENUMAP = 0,\n        CPYMENUEXTENT = 1,\n        CPYMENULOC = 2;\n      this._menuItems.CPYMENUMAP = CPYMENUMAP;\n      this._menuItems.CPYMENUEXTENT = CPYMENUEXTENT;\n      this._menuItems.CPYMENULOC = CPYMENULOC;\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENUMAP],\n        CPYMENUMAP\n      );\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENUEXTENT],\n        CPYMENUEXTENT\n      );\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENULOC],\n        CPYMENULOC\n      );\n\n      this._items[CTXPASTE].el = this._createItem(\n        this._container,\n        this._items[CTXPASTE]\n      );\n      this._items[CTXSPACER2].el = this._createItem(\n        this._container,\n        this._items[CTXSPACER2]\n      );\n      this._items[CTXCNTRLS].el = this._createItem(\n        this._container,\n        this._items[CTXCNTRLS]\n      );\n      this._items[CTXDEBUG].el = this._createItem(\n        this._container,\n        this._items[CTXDEBUG]\n      );\n      this._items[CTXVWSRC].el = this._createItem(\n        this._container,\n        this._items[CTXVWSRC]\n      );\n\n      this._layerMenu = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu mapml-layer-menu',\n        map.getContainer()\n      );\n      this._layerMenu.setAttribute('hidden', '');\n      this._createItem(this._layerMenu, this._layerItems[LYRZOOMTO]);\n      this._createItem(this._layerMenu, this._layerItems[LYRCOPY]);\n\n      L.DomEvent.on(this._container, 'click', L.DomEvent.stop)\n        .on(this._container, 'mousedown', L.DomEvent.stop)\n        .on(this._container, 'dblclick', L.DomEvent.stop)\n        .on(this._container, 'contextmenu', L.DomEvent.stop)\n        .on(this._layerMenu, 'click', L.DomEvent.stop)\n        .on(this._layerMenu, 'mousedown', L.DomEvent.stop)\n        .on(this._layerMenu, 'dblclick', L.DomEvent.stop)\n        .on(this._layerMenu, 'contextmenu', L.DomEvent.stop);\n\n      this.t = document.createElement('template');\n      this.t.innerHTML = `<map-feature zoom=\"\">\n        <map-featurecaption></map-featurecaption>\n        <map-properties>\n            <h2></h2>\n            <div style=\"text-align:center\"></div>\n        </map-properties>\n        <map-geometry cs=\"\">\n          <map-point>\n            <map-coordinates></map-coordinates>\n          </map-point>\n        </map-geometry>\n      </map-feature>`;\n    },\n\n    addHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent.on(container, 'mouseleave', this._hide, this).on(\n        document,\n        'keydown',\n        this._onKeyDown,\n        this\n      );\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.on(\n        {\n          contextmenu: this._show,\n          mousedown: this._hide,\n          zoomstart: this._hide\n        },\n        this\n      );\n    },\n\n    removeHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent.off(container, 'mouseleave', this._hide, this).off(\n        document,\n        'keydown',\n        this._onKeyDown,\n        this\n      );\n\n      if (L.Browser.touch) {\n        L.DomEvent.off(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.off(\n        {\n          contextmenu: this._show,\n          mousedown: this._hide,\n          zoomstart: this._hide\n        },\n        this\n      );\n    },\n\n    _updateCS: function () {\n      if (\n        this.defExtCS !== M.options.defaultExtCoor ||\n        this.defLocCS !== M.options.defaultLocCoor\n      ) {\n        this.defExtCS = M.options.defaultExtCoor;\n        this.defLocCS = M.options.defaultLocCoor;\n      }\n    },\n\n    _copyExtent: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        coord = context.defExtCS ? context.defExtCS.toLowerCase() : 'pcrs',\n        tL =\n          e instanceof KeyboardEvent\n            ? this.extent.topLeft[coord]\n            : this.options.mapEl.extent.topLeft[coord],\n        bR =\n          e instanceof KeyboardEvent\n            ? this.extent.bottomRight[coord]\n            : this.options.mapEl.extent.bottomRight[coord],\n        data = '';\n      switch (coord) {\n        case 'MapML':\n        default:\n          if (coord === 'pcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-easting=${Math.round(\n            tL.horizontal\n          )}, top-left-northing=${Math.round(\n            tL.vertical\n          )}, bottom-right-easting=${Math.round(\n            bR.horizontal\n          )}, bottom-right-northing=${Math.round(bR.vertical)}\"></map-meta>`;\n          } else if (coord === 'gcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-longitude=${tL.horizontal}, top-left-latitude=${tL.vertical}, bottom-right-longitude=${bR.horizontal}, bottom-right-latitude=${bR.vertical}\"></map-meta>`;\n          } else if (coord === 'tcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-x=${\n            tL[0].horizontal\n          }, top-left-y=${tL[0].vertical}, bottom-right-x=${\n            bR[bR.length - 1].horizontal\n          }, bottom-right-y=${bR[bR.length - 1].vertical}\"></map-meta>`;\n          } else if (coord === 'tilematrix') {\n            data = `<map-meta name=\"extent\" content=\"top-left-column=${\n            tL[0].horizontal\n          }, top-left-row=${tL[0].vertical}, bottom-right-column=${\n            bR[bR.length - 1].horizontal\n          }, bottom-right-row=${bR[bR.length - 1].vertical}\"></map-meta>`;\n          } else {\n            console.log('not support');\n          }\n          break;\n      }\n      context._copyData(data);\n    },\n\n    _zoomToLayer: function (e) {\n      let context =\n        e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu;\n      context._layerClicked.layer._layerEl.zoomTo();\n    },\n\n    _copyLayer: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        layerElem = context._layerClicked.layer._layerEl;\n      context._copyData(layerElem.getOuterHTML());\n    },\n\n    _goForward: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.forward();\n    },\n\n    _goBack: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.back();\n    },\n\n    _reload: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.reload();\n    },\n\n    _toggleFullScreen: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl._toggleFullScreen();\n    },\n\n    _toggleControls: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      if (mapEl.controls) {\n        mapEl.controls = false;\n      } else {\n        mapEl.controls = true;\n      }\n    },\n\n    _copyMapML: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl =\n          e instanceof KeyboardEvent\n            ? this._map.options.mapEl\n            : this.options.mapEl;\n      context._copyData(\n        mapEl.outerHTML.replace(\n          /<div class=\"mapml-web-map\">.*?<\\/div>|<style>\\[is=\"web-map\"].*?<\\/style>|<style>mapml-viewer.*?<\\/style>/gm,\n          ''\n        )\n      );\n    },\n\n    // Add support for pasting GeoJSON in the future\n    _paste: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl =\n          e instanceof KeyboardEvent\n            ? this._map.options.mapEl\n            : this.options.mapEl;\n      navigator.clipboard.readText().then((layer) => {\n        M._pasteLayer(mapEl, layer);\n      });\n    },\n\n    _viewSource: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.viewSource();\n    },\n\n    _toggleDebug: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.toggleDebug();\n    },\n\n    _copyCoords: function (e) {\n      let directory = this.contextMenu ? this.contextMenu : this;\n      directory._showCopySubMenu(e);\n    },\n\n    _copyData: function (data) {\n      const el = document.createElement('textarea');\n      el.value = data;\n      document.body.appendChild(el);\n      el.select();\n      document.execCommand('copy');\n      document.body.removeChild(el);\n    },\n\n    _copyLocation: function (e) {\n      const menu = this.contextMenu;\n      switch (menu.defLocCS.toLowerCase()) {\n        case 'tile':\n          menu._copyTile.call(this, e);\n          break;\n        case 'tilematrix':\n          menu._copyTileMatrix.call(this, e);\n          break;\n        case 'map':\n          menu._copyMap.call(this, e);\n          break;\n        case 'tcrs':\n          menu._copyTCRS.call(this, e);\n          break;\n        case 'pcrs':\n          menu._copyPCRS.call(this, e);\n          break;\n        case 'gcrs':\n        default:\n          menu._copyGCRS.call(this, e);\n          break;\n      }\n    },\n\n    _copyGCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} gcrs location`;\n      h2.textContent = `Copied ${projection} gcrs location`;\n      div.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        pt = { x: point.x.toFixed(), y: point.y.toFixed() },\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'tcrs');\n      caption.textContent = `Copied ${projection} tcrs location`;\n      h2.textContent = `Copied ${projection} tcrs location`;\n      div.textContent = `${pt.x} ${pt.y}`;\n      coords.textContent = `${pt.x} ${pt.y}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTileMatrix: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} tilematrix location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} tilematrix location (not implemented yet)`;\n      div.textContent = `${Math.trunc(point.x / tileSize)} ${Math.trunc(\n      point.y / tileSize\n    )}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyPCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation\n          .untransform(point, scale)\n          .round(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'pcrs');\n      caption.textContent = `Copied ${projection} pcrs location`;\n      h2.textContent = `Copied ${projection} pcrs location`;\n      div.textContent = `${pcrs.x} ${pcrs.y}`;\n      coords.textContent = `${pcrs.x} ${pcrs.y}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTile: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        // the _map.project method returns pixels, while the _map.crs.project\n        // method returns meters, confusingly:\n        // https://leafletjs.com/reference.html#map-project\n        // https://leafletjs.com/reference.html#crs-project\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointX = point.x % tileSize,\n        pointY = point.y % tileSize,\n        pt = L.point(pointX, pointY).trunc(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      if (pt.x < 0) pt.x += tileSize;\n      if (pt.y < 0) pt.y += tileSize;\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} tile location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} tile location (not implemented yet)`;\n      div.textContent = `${pt.x} ${pt.y}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyMap: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        mapPt = click.containerPoint.trunc(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} map location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} map location (not implemented yet)`;\n      div.textContent = `${mapPt.x} ${mapPt.y}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyAllCoords: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointX = point.x % tileSize,\n        pointY = point.y % tileSize,\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation.untransform(point, scale);\n      let allData = `z:${mapEl.zoom}\\n`;\n      allData += `tile: i:${Math.trunc(pointX)}, j:${Math.trunc(pointY)}\\n`;\n      allData += `tilematrix: column:${Math.trunc(\n      point.x / tileSize\n    )}, row:${Math.trunc(point.y / tileSize)}\\n`;\n      allData += `map: i:${Math.trunc(click.containerPoint.x)}, j:${Math.trunc(\n      click.containerPoint.y\n    )}\\n`;\n      allData += `tcrs: x:${Math.trunc(point.x)}, y:${Math.trunc(point.y)}\\n`;\n      allData += `pcrs: easting:${pcrs.x.toFixed(2)}, northing:${pcrs.y.toFixed(\n      2\n    )}\\n`;\n      allData += `gcrs: lon :${click.latlng.lng.toFixed(\n      6\n    )}, lat:${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(allData);\n    },\n\n    _createItem: function (container, options, index) {\n      if (options.spacer) {\n        return this._createSeparator(container, index);\n      }\n\n      var itemCls = 'mapml-contextmenu-item',\n        el = this._insertElementAt('button', itemCls, container, index),\n        callback = this._createEventHandler(\n          el,\n          options.callback,\n          options.context,\n          options.hideOnSelect\n        ),\n        html = '';\n\n      el.innerHTML = html + options.text;\n      el.setAttribute('type', 'button');\n      el.classList.add('mapml-button');\n      if (options.popup) {\n        el.setAttribute('aria-haspopup', 'true');\n        el.setAttribute('aria-expanded', 'false');\n        el.setAttribute('aria-controls', 'mapml-copy-submenu');\n      }\n\n      L.DomEvent.on(el, 'mouseover', this._onItemMouseOver, this)\n        .on(el, 'mouseout', this._onItemMouseOut, this)\n        .on(el, 'mousedown', L.DomEvent.stopPropagation)\n        .on(el, 'click', callback);\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(el, this._touchstart, L.DomEvent.stopPropagation);\n      }\n\n      // Devices without a mouse fire \"mouseover\" on tap, but never “mouseout\"\n      if (!L.Browser.pointer) {\n        L.DomEvent.on(el, 'click', this._onItemMouseOut, this);\n      }\n\n      return {\n        id: L.Util.stamp(el),\n        el: el,\n        callback: callback\n      };\n    },\n\n    _createSeparator: function (container, index) {\n      let el = this._insertElementAt(\n        'div',\n        'mapml-contextmenu-separator',\n        container,\n        index\n      );\n\n      return {\n        id: L.Util.stamp(el),\n        el: el\n      };\n    },\n\n    _createEventHandler: function (el, func, context, hideOnSelect) {\n      let parent = this;\n\n      hideOnSelect = hideOnSelect !== undefined ? hideOnSelect : true;\n\n      return function (e) {\n        let map = parent._map,\n          containerPoint = parent._showLocation.containerPoint,\n          layerPoint = map.containerPointToLayerPoint(containerPoint),\n          latlng = map.layerPointToLatLng(layerPoint),\n          relatedTarget = parent._showLocation.relatedTarget,\n          data = {\n            containerPoint: containerPoint,\n            layerPoint: layerPoint,\n            latlng: latlng,\n            relatedTarget: relatedTarget\n          };\n\n        if (hideOnSelect) {\n          parent._hide();\n        }\n\n        if (func) {\n          func.call(context || map, data);\n        }\n\n        parent._map.fire('contextmenu.select', {\n          contextmenu: parent,\n          el: el\n        });\n      };\n    },\n\n    _insertElementAt: function (tagName, className, container, index) {\n      let refEl,\n        el = document.createElement(tagName);\n\n      el.className = className;\n\n      if (index !== undefined) {\n        refEl = container.children[index];\n      }\n\n      if (refEl) {\n        container.insertBefore(el, refEl);\n      } else {\n        container.appendChild(el);\n      }\n\n      return el;\n    },\n\n    _show: function (e) {\n      // don't show a context menu for features\n      if (e.originalEvent.target.closest('.mapml-vector-container')) return;\n      if (this._mapMenuVisible) this._hide();\n      this._clickEvent = e;\n      let elem = e.originalEvent.target;\n      if (elem.closest('fieldset')) {\n        elem = elem.closest('fieldset');\n        elem =\n          elem.className === 'mapml-layer-extent'\n            ? elem\n                .closest('fieldset')\n                .parentNode.parentNode.parentNode.querySelector('span')\n            : elem.querySelector('span');\n        if (!elem.layer.validProjection) return;\n        this._layerClicked = elem;\n        this._layerMenu.removeAttribute('hidden');\n        this._showAtPoint(e.containerPoint, e, this._layerMenu);\n      } else if (\n        elem.classList.contains('leaflet-container') ||\n        elem.classList.contains('mapml-debug-extent') ||\n        elem.tagName === 'path'\n      ) {\n        let layerList = this._map.options.mapEl.layers;\n        this._layerClicked = Array.from(layerList).find((el) => el.checked);\n        // the 'hidden' attribute must be removed before any attempt to get the size of container\n        let pt = e.containerPoint;\n        // this is for firefox, which reports the e.containerPoint as x=0 when you\n        // use a keyboard Shift+F10 to display the context menu; this appears\n        // to be because blink returns a PointerEvent of type==='contextmenu',\n        // while gecko returns an object (for e.originalEvent).\n        if (L.Browser.gecko) {\n          const getCenter = function (el) {\n            let w = el.getBoundingClientRect().width;\n            let h = el.getBoundingClientRect().height;\n            return { x: Number.parseInt(w / 2), y: Number.parseInt(h / 2) };\n          };\n          pt = getCenter(this._map.getContainer());\n        }\n        this._container.removeAttribute('hidden');\n        this._showAtPoint(pt, e, this._container);\n        this._updateCS();\n      }\n      if (e.originalEvent.button === 0 || e.originalEvent.button === -1) {\n        this._keyboardEvent = true;\n        if (this._layerClicked.className.includes('mapml-layer-item')) {\n          let activeEl = document.activeElement;\n          this._elementInFocus = activeEl.shadowRoot.activeElement;\n          this._layerMenuTabs = 1;\n          this._layerMenu.firstChild.focus();\n        } else {\n          this._container.querySelectorAll('button:not([disabled])')[0].focus();\n        }\n      }\n    },\n\n    _showAtPoint: function (pt, data, container) {\n      if (this._items.length) {\n        let event = L.extend(data || {}, { contextmenu: this });\n\n        this._showLocation = {\n          containerPoint: pt\n        };\n\n        if (data && data.relatedTarget) {\n          this._showLocation.relatedTarget = data.relatedTarget;\n        }\n\n        this._setPosition(pt, container);\n\n        if (!this._mapMenuVisible) {\n          container.removeAttribute('hidden');\n          this._mapMenuVisible = true;\n        }\n\n        this._map.fire('contextmenu.show', event);\n      }\n    },\n\n    _hide: function () {\n      if (this._mapMenuVisible) {\n        this._mapMenuVisible = false;\n        this._container.setAttribute('hidden', '');\n        this._copySubMenu.setAttribute('hidden', '');\n        this._layerMenu.setAttribute('hidden', '');\n        this._map.fire('contextmenu.hide', { contextmenu: this });\n        setTimeout(() => this._map._container.focus(), 0);\n        this.activeIndex = 0;\n        this.isRunned = false;\n      }\n    },\n\n    _setPosition: function (pt, container) {\n      let mapSize = this._map.getSize(),\n        containerSize = this._getElementSize(container),\n        anchor;\n\n      if (this._map.options.contextmenuAnchor) {\n        anchor = L.point(this._map.options.contextmenuAnchor);\n        pt = pt.add(anchor);\n      }\n\n      container._leaflet_pos = pt;\n\n      if (pt.x + containerSize.x > mapSize.x) {\n        container.style.left = 'auto';\n        container.style.right =\n          Math.min(\n            Math.max(mapSize.x - pt.x, 0),\n            mapSize.x - containerSize.x - 1\n          ) + 'px';\n      } else {\n        container.style.left = Math.max(pt.x, 0) + 'px';\n        container.style.right = 'auto';\n      }\n\n      if (pt.y + containerSize.y > mapSize.y) {\n        container.style.top = 'auto';\n        container.style.bottom =\n          Math.min(\n            Math.max(mapSize.y - pt.y, 0),\n            mapSize.y - containerSize.y - 1\n          ) + 'px';\n      } else {\n        container.style.top = Math.max(pt.y, 0) + 'px';\n        container.style.bottom = 'auto';\n      }\n    },\n\n    _getElementSize: function (el) {\n      let size = this._size;\n\n      if (!size || this._sizeChanged) {\n        size = {};\n\n        el.style.left = '-999999px';\n        el.style.right = 'auto';\n\n        size.x = el.offsetWidth;\n        size.y = el.offsetHeight;\n\n        el.style.left = 'auto';\n\n        this._sizeChanged = false;\n      }\n\n      return size;\n    },\n\n    // once tab is clicked on the layer menu, change the focus back to the layer control\n    _focusOnLayerControl: function () {\n      this._mapMenuVisible = false;\n      delete this._layerMenuTabs;\n      this._layerMenu.setAttribute('hidden', '');\n      if (this._elementInFocus) {\n        this._elementInFocus.focus();\n      } else {\n        this._layerClicked.parentElement.firstChild.focus();\n      }\n      delete this._elementInFocus;\n    },\n\n    _setActiveItem: function (index) {\n      if (\n        document.activeElement.shadowRoot === null &&\n        this.noActiveEl === true\n      ) {\n        //bug fix when theres no active element\n        this.noActiveEl = false;\n        //setting this._items[9] is just for preventing some diabled index, it will be override by later code.\n        this._items[9].el.el.focus();\n      }\n      if (\n        document.activeElement.shadowRoot.activeElement.innerHTML ===\n        this._items[index].el.el.innerHTML\n      ) {\n        //edge case where pressing shift f10 focuses the first element on contextmenu (if already focused, have to press arrow twice to go down)\n        let next = index + 1;\n        while (this._items[next].el.el.disabled) {\n          next++;\n          if (next >= this._items.length) {\n            next = 0;\n          }\n        }\n        this._setActiveItem(next);\n      } else {\n        if (this.excludedIndices.includes(index)) {\n          // find the next or previous non-excluded item\n          let nextIndex = index + 1;\n          let prevIndex = index - 1;\n          while (\n            this.excludedIndices.includes(nextIndex) ||\n            this._items[nextIndex].el.el.disabled\n          ) {\n            nextIndex++;\n            if (nextIndex >= this._items.length) {\n              nextIndex = 0;\n            }\n          }\n          while (\n            this.excludedIndices.includes(prevIndex) ||\n            this._items[prevIndex].el.el.disabled\n          ) {\n            prevIndex--;\n            if (prevIndex < 0) {\n              prevIndex = this._items.length - 1;\n            }\n          }\n          // set the active item to the next or previous non-excluded item\n          if (this.activeIndex < index) {\n            this._setActiveItem(nextIndex);\n          } else {\n            this._setActiveItem(prevIndex);\n          }\n        } else {\n          // set the focus item\n          this._items[index].el.el.focus();\n          this.activeIndex = index;\n        }\n      }\n    },\n\n    _onKeyDown: function (e) {\n      if (!this._mapMenuVisible || e.key === 'Shift') return;\n\n      if (e.code === 'Enter' || e.code === 'Tab' || e.code.startsWith('Arrow'))\n        e.preventDefault();\n\n      if (e.code === 'ArrowUp' || (e.shiftKey && e.code === 'Tab')) {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          (document.activeElement.shadowRoot === null || //null happens when the focus is on submenu and when mouse hovers on main menu, submenu disappears\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML)\n        ) {\n          //\"map\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML\n        ) {\n          //\"extent\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n        ) {\n          //\"Location\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();\n        } else if (\n          !this._layerMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML\n        ) {\n          //\"zoom to layer\" on layermenu\n          this._layerMenu.children[this._menuItems.LYRCOPY].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden')) {\n          this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();\n        } else {\n          if (this.activeIndex > 0) {\n            let prevIndex = this.activeIndex - 1;\n            while (this._items[prevIndex].el.el.disabled) {\n              prevIndex--;\n              if (prevIndex < 0) {\n                prevIndex = this._items.length - 1;\n              }\n            }\n            this._setActiveItem(prevIndex);\n          } else {\n            this._setActiveItem(this._items.length - 1);\n          }\n        }\n      } else if (e.code === 'ArrowDown' || e.code === 'Tab') {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          (document.activeElement.shadowRoot === null ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML)\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();\n        } else if (\n          !this._layerMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML\n        ) {\n          this._layerMenu.children[this._menuItems.LYRCOPY].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden')) {\n          this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();\n        } else {\n          if (this.activeIndex < this._items.length - 1) {\n            //edge case at index 0\n            if (\n              !this.isRunned &&\n              this.activeIndex === 0 &&\n              !this._items[this.activeIndex].el.el.disabled\n            ) {\n              this._setActiveItem(0);\n              this.isRunned = true;\n            } else {\n              //edge case over\n              let nextIndex = this.activeIndex + 1;\n              while (this._items[nextIndex].el.el.disabled) {\n                nextIndex++;\n                if (nextIndex >= this._items.length) {\n                  nextIndex = 0;\n                }\n              }\n              this._setActiveItem(nextIndex);\n            }\n          } else {\n            let nextIndex = 0;\n            while (this._items[nextIndex].el.el.disabled) {\n              nextIndex++;\n              if (nextIndex >= this._items.length) {\n                nextIndex = 0;\n              }\n            }\n            this._setActiveItem(nextIndex);\n          }\n        }\n      } else if (e.code === 'ArrowRight') {\n        if (\n          document.activeElement.shadowRoot !== null &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML && //'copy'\n          this._copySubMenu.hasAttribute('hidden')\n        ) {\n          this._showCopySubMenu();\n          this._copySubMenu.children[0].focus();\n        } else if (\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML &&\n          !this._copySubMenu.hasAttribute('hidden')\n        ) {\n          this._copySubMenu.children[0].focus();\n        }\n      } else if (e.code === 'ArrowLeft') {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot !== null\n        ) {\n          if (\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUEXTENT]\n                .innerHTML ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n          ) {\n            this._copySubMenu.setAttribute('hidden', '');\n            this._setActiveItem(this._menuItems.CTXCOPY);\n          }\n        }\n      } else if (e.code === 'Escape') {\n        if (this._layerMenuTabs) {\n          L.DomEvent.stop(e);\n          this._focusOnLayerControl();\n          return;\n        }\n        if (document.activeElement.shadowRoot === null) {\n          this._hide();\n        } else {\n          if (!this._copySubMenu.hasAttribute('hidden')) {\n            if (\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENUMAP]\n                  .innerHTML ||\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENUEXTENT]\n                  .innerHTML ||\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n            ) {\n              this._copySubMenu.setAttribute('hidden', '');\n              this._setActiveItem(this._menuItems.CTXCOPY);\n            }\n          } else {\n            this._hide();\n          }\n        }\n      } else if (\n        e.code !== 'KeyC' &&\n        document.activeElement.shadowRoot.activeElement.innerHTML !==\n          this._items[this._menuItems.CTXCOPY].el.el.innerHTML\n      ) {\n        this._hide();\n      }\n      // using KeyboardEvent.code for its mnemonics and case-independence\n      switch (e.code) {\n        case 'Enter':\n          if (\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML\n          ) {\n            this._copyCoords({\n              latlng: this._map.getCenter()\n            });\n            this._copySubMenu.firstChild.focus();\n          } else {\n            if (\n              this._map._container.parentNode.activeElement.parentNode.classList.contains(\n                'mapml-contextmenu'\n              )\n            )\n              this._map._container.parentNode.activeElement.click();\n          }\n          break;\n        case 'Space':\n          if (\n            this._map._container.parentNode.activeElement.parentNode.classList.contains(\n              'mapml-contextmenu'\n            )\n          )\n            this._map._container.parentNode.activeElement.click();\n          break;\n        case 'KeyC':\n          this._copyCoords({\n            latlng: this._map.getCenter()\n          });\n          this._copySubMenu.firstChild.focus();\n          break;\n        case 'KeyD':\n          this._toggleDebug(e);\n          break;\n        case 'KeyM':\n          this._copyMapML(e);\n          break;\n        case 'KeyL':\n          if (this._layerClicked.className.includes('mapml-layer-item'))\n            this._copyLayer(e);\n          break;\n        case 'KeyF':\n          this._toggleFullScreen(e);\n          break;\n        case 'KeyP':\n          this._paste(e);\n          break;\n        case 'KeyT':\n          this._toggleControls(e);\n          break;\n        case 'KeyV':\n          this._viewSource(e);\n          break;\n        case 'KeyZ':\n          if (this._layerClicked.className.includes('mapml-layer-item')) {\n            this._zoomToLayer(e);\n          }\n          break;\n      }\n    },\n\n    _showCopySubMenu: function (e) {\n      let mapSize = this._map.getSize(),\n        click = this._clickEvent,\n        menu = this._copySubMenu,\n        copyEl = this._items[5].el.el;\n\n      copyEl.setAttribute('aria-expanded', 'true');\n      menu.removeAttribute('hidden');\n\n      const menuWidth = this._container.offsetWidth,\n        menuHeight = this._container.offsetHeight,\n        submenuWidth = menu.offsetWidth;\n      if (click.containerPoint.x + menuWidth + submenuWidth > mapSize.x) {\n        menu.style.left = 'auto';\n        menu.style.right = menuWidth + 'px';\n      } else {\n        menu.style.left = menuWidth + 'px';\n        menu.style.right = 'auto';\n      }\n\n      menu.style.top = 100 - 22 + 'px';\n      menu.style.bottom = 'auto';\n    },\n\n    _hideCopySubMenu: function (e) {\n      if (\n        !e.relatedTarget ||\n        !e.relatedTarget.parentElement ||\n        e.relatedTarget.parentElement.classList.contains('mapml-submenu') ||\n        e.relatedTarget.classList.contains('mapml-submenu')\n      )\n        return;\n      let menu = this._copySubMenu,\n        copyEl = this._items[4].el.el;\n      copyEl.setAttribute('aria-expanded', 'false');\n      menu.setAttribute('hidden', '');\n      this.noActiveEl = true; //variable to keep track of no focus element on contextmenu, bug fix for arrow key navigation\n    },\n\n    _onItemMouseOver: function (e) {\n      L.DomUtil.addClass(e.target || e.srcElement, 'over');\n      if (e.srcElement.innerText === M.options.locale.cmCopyCoords + ' (C)')\n        this._showCopySubMenu(e);\n    },\n\n    _onItemMouseOut: function (e) {\n      L.DomUtil.removeClass(e.target || e.srcElement, 'over');\n      this._hideCopySubMenu(e);\n    },\n\n    toggleContextMenuItem: function (options, state) {\n      options = options.toUpperCase();\n      if (state === 'disabled') {\n        if (options === 'CONTROLS') {\n          this._items[8].el.el.disabled = true;\n        } else if (options === 'BACK') {\n          this._items[0].el.el.disabled = true;\n        } else if (options === 'FORWARD') {\n          this._items[1].el.el.disabled = true;\n        } else if (options === 'RELOAD') {\n          this._items[2].el.el.disabled = true;\n        }\n      } else if (state === 'enabled') {\n        if (options === 'CONTROLS') {\n          this._items[8].el.el.disabled = false;\n        } else if (options === 'BACK') {\n          this._items[0].el.el.disabled = false;\n        } else if (options === 'FORWARD') {\n          this._items[1].el.el.disabled = false;\n        } else if (options === 'RELOAD') {\n          this._items[2].el.el.disabled = false;\n        }\n      }\n    },\n\n    setViewFullScreenInnerHTML: function (options) {\n      if (options === 'view') {\n        this._map.contextMenu._items[3].el.el.innerHTML =\n          M.options.locale.btnFullScreen + ' (<kbd>F</kbd>)';\n      } else if (options === 'exit') {\n        this._map.contextMenu._items[3].el.el.innerHTML =\n          M.options.locale.btnExitFullScreen + ' (<kbd>F</kbd>)';\n      }\n    }\n  });\n\n  var Util = {\n    // _convertAndFormatPCRS returns the converted CRS and formatted pcrsBounds in gcrs, pcrs, tcrs, and tilematrix. Used for setting extent for the map and layer (map.extent, layer.extent).\n    // _convertAndFormatPCRS: L.Bounds, _map, projection -> {...}\n    _convertAndFormatPCRS: function (pcrsBounds, crs, projection) {\n      if (!pcrsBounds || !crs) return {};\n\n      let tcrsTopLeft = [],\n        tcrsBottomRight = [],\n        tileMatrixTopLeft = [],\n        tileMatrixBottomRight = [],\n        tileSize = crs.options.crs.tile.bounds.max.y;\n\n      for (let i = 0; i < crs.options.resolutions.length; i++) {\n        let scale = crs.scale(i),\n          minConverted = crs.transformation.transform(pcrsBounds.min, scale),\n          maxConverted = crs.transformation.transform(pcrsBounds.max, scale);\n\n        tcrsTopLeft.push({\n          horizontal: minConverted.x,\n          vertical: maxConverted.y\n        });\n        tcrsBottomRight.push({\n          horizontal: maxConverted.x,\n          vertical: minConverted.y\n        });\n\n        //converts the tcrs values from earlier to tilematrix\n        tileMatrixTopLeft.push({\n          horizontal: tcrsTopLeft[i].horizontal / tileSize,\n          vertical: tcrsTopLeft[i].vertical / tileSize\n        });\n        tileMatrixBottomRight.push({\n          horizontal: tcrsBottomRight[i].horizontal / tileSize,\n          vertical: tcrsBottomRight[i].vertical / tileSize\n        });\n      }\n\n      //converts the gcrs, I believe it can take any number values from -inf to +inf\n      let unprojectedMin = crs.unproject(pcrsBounds.min),\n        unprojectedMax = crs.unproject(pcrsBounds.max);\n\n      let gcrs = {\n        topLeft: {\n          horizontal: unprojectedMin.lng,\n          vertical: unprojectedMax.lat\n        },\n        bottomRight: {\n          horizontal: unprojectedMax.lng,\n          vertical: unprojectedMin.lat\n        }\n      };\n\n      //formats known pcrs bounds to correct format\n      let pcrs = {\n        topLeft: {\n          horizontal: pcrsBounds.min.x,\n          vertical: pcrsBounds.max.y\n        },\n        bottomRight: {\n          horizontal: pcrsBounds.max.x,\n          vertical: pcrsBounds.min.y\n        }\n      };\n\n      //formats all extent data\n      let extent = {\n        topLeft: {\n          tcrs: tcrsTopLeft,\n          tilematrix: tileMatrixTopLeft,\n          gcrs: gcrs.topLeft,\n          pcrs: pcrs.topLeft\n        },\n        bottomRight: {\n          tcrs: tcrsBottomRight,\n          tilematrix: tileMatrixBottomRight,\n          gcrs: gcrs.bottomRight,\n          pcrs: pcrs.bottomRight\n        }\n      };\n      if (projection) {\n        extent.projection = projection;\n      }\n      return extent;\n    },\n    // extentToBounds: returns bounds in gcrs, pcrs. Used for setting bounds for the map (map.totalLayerBounds).\n    // extentToBounds: {...}, crs -> L.Bounds / L.LatlngBounds\n    extentToBounds(extent, crs) {\n      switch (crs.toUpperCase()) {\n        case 'PCRS':\n          return L.bounds(\n            L.point(extent.topLeft.pcrs.horizontal, extent.topLeft.pcrs.vertical),\n            L.point(\n              extent.bottomRight.pcrs.horizontal,\n              extent.bottomRight.pcrs.vertical\n            )\n          );\n        case 'GCRS':\n          return L.latLngBounds(\n            L.latLng(\n              extent.topLeft.gcrs.vertical,\n              extent.topLeft.gcrs.horizontal\n            ),\n            L.latLng(\n              extent.bottomRight.gcrs.vertical,\n              extent.bottomRight.gcrs.horizontal\n            )\n          );\n      }\n    },\n\n    // _extractInputBounds extracts and returns Input Bounds from the provided template\n    // _extractInputBounds: Object -> {zoomBounds: ..., bounds: ...}\n    _extractInputBounds: function (template) {\n      if (!template) return undefined;\n\n      //sets variables with their respective fallback values incase content is missing from the template\n      let inputs = template.values,\n        projection = template.projection || M.FALLBACK_PROJECTION,\n        value = 0,\n        boundsUnit = M.FALLBACK_CS;\n      let bounds = this[projection].options.crs.tilematrix.bounds(0),\n        defaultMinZoom = 0,\n        defaultMaxZoom = this[projection].options.resolutions.length - 1,\n        nativeMinZoom = defaultMinZoom,\n        nativeMaxZoom = defaultMaxZoom;\n      let locInputs = false,\n        numberOfAxes = 0;\n      for (let i = 0; i < inputs.length; i++) {\n        switch (inputs[i].getAttribute('type')) {\n          case 'zoom':\n            nativeMinZoom = +(inputs[i].hasAttribute('min') &&\n            !isNaN(+inputs[i].getAttribute('min'))\n              ? inputs[i].getAttribute('min')\n              : defaultMinZoom);\n            nativeMaxZoom = +(inputs[i].hasAttribute('max') &&\n            !isNaN(+inputs[i].getAttribute('max'))\n              ? inputs[i].getAttribute('max')\n              : defaultMaxZoom);\n            value = +inputs[i].getAttribute('value');\n            break;\n          case 'location':\n            if (!inputs[i].getAttribute('max') || !inputs[i].getAttribute('min'))\n              continue;\n            let max = +inputs[i].getAttribute('max'),\n              min = +inputs[i].getAttribute('min');\n            switch (inputs[i].getAttribute('axis').toLowerCase()) {\n              case 'x':\n              case 'longitude':\n              case 'column':\n              case 'easting':\n                boundsUnit = M.axisToCS(\n                  inputs[i].getAttribute('axis').toLowerCase()\n                );\n                bounds.min.x = min;\n                bounds.max.x = max;\n                numberOfAxes++;\n                break;\n              case 'y':\n              case 'latitude':\n              case 'row':\n              case 'northing':\n                boundsUnit = M.axisToCS(\n                  inputs[i].getAttribute('axis').toLowerCase()\n                );\n                bounds.min.y = min;\n                bounds.max.y = max;\n                numberOfAxes++;\n                break;\n            }\n            break;\n        }\n      }\n      if (numberOfAxes >= 2) {\n        locInputs = true;\n      }\n      // min/maxZoom are copied from <meta name=zoom content=\"min=n,max=m>, are *display* range for content\n      // min/maxNativeZoom are received from <input type=zoom min=... max=...>, describe *server* content availability\n      let zoomBounds = {\n        minZoom:\n          template.zoomBounds?.min && !isNaN(+template.zoomBounds.min)\n            ? +template.zoomBounds.min\n            : defaultMinZoom,\n        maxZoom:\n          template.zoomBounds?.max && !isNaN(+template.zoomBounds.max)\n            ? +template.zoomBounds.max\n            : defaultMaxZoom,\n        minNativeZoom: nativeMinZoom,\n        maxNativeZoom: nativeMaxZoom\n      };\n      if (\n        !locInputs &&\n        template.boundsFallbackPCRS &&\n        template.boundsFallbackPCRS.bounds\n      ) {\n        bounds = template.boundsFallbackPCRS.bounds;\n      } else if (locInputs) {\n        bounds = this.boundsToPCRSBounds(bounds, value, projection, boundsUnit);\n      } else {\n        bounds = this[projection].options.crs.pcrs.bounds;\n      }\n      return {\n        zoomBounds: zoomBounds,\n        bounds: bounds\n      };\n    },\n\n    // axisToCS returns the CRS when given the axis:\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // axisToCS: (Axis String) -> (CRS String)\n    axisToCS: function (axis) {\n      try {\n        switch (axis.toLowerCase()) {\n          case 'row':\n          case 'column':\n            return 'TILEMATRIX';\n          case 'i':\n          case 'j':\n            return ['MAP', 'TILE'];\n          case 'x':\n          case 'y':\n            return 'TCRS';\n          case 'latitude':\n          case 'longitude':\n            return 'GCRS';\n          case 'northing':\n          case 'easting':\n            return 'PCRS';\n          default:\n            return M.FALLBACK_CS;\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // csToAxes takes a given cs and retuns the axes, first horizontal then vertical\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // csToAxes: (CRS String) -> [(horizontal axis String), (Vertical axis String)]\n    csToAxes: function (cs) {\n      try {\n        switch (cs.toLowerCase()) {\n          case 'tilematrix':\n            return ['column', 'row'];\n          case 'map':\n          case 'tile':\n            return ['i', 'j'];\n          case 'tcrs':\n            return ['x', 'y'];\n          case 'gcrs':\n            return ['longitude', 'latitude'];\n          case 'pcrs':\n            return ['easting', 'northing'];\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // axisToXY takes horizontal axis and returns 'x', or takes vertical axis and returns 'y'\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // axisToXY: (Axis String) -> 'x' or 'y'\n    axisToXY: function (axis) {\n      try {\n        switch (axis.toLowerCase()) {\n          case 'i':\n          case 'column':\n          case 'longitude':\n          case 'x':\n          case 'easting':\n            return 'x';\n          case 'row':\n          case 'j':\n          case 'latitude':\n          case 'y':\n          case 'northing':\n            return 'y';\n\n          default:\n            return undefined;\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // convertPCRSBounds converts pcrsBounds to the given cs Bounds.\n    // convertPCRSBounds: L.Bounds, Int, L.CRS, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.Bounds\n    convertPCRSBounds: function (pcrsBounds, zoom, projection, cs) {\n      if (\n        !pcrsBounds ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection ||\n        !cs\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      switch (cs.toUpperCase()) {\n        case 'PCRS':\n          return pcrsBounds;\n        case 'TCRS':\n        case 'TILEMATRIX':\n          let minPixel = projection.transformation.transform(\n              pcrsBounds.min,\n              projection.scale(+zoom)\n            ),\n            maxPixel = projection.transformation.transform(\n              pcrsBounds.max,\n              projection.scale(+zoom)\n            );\n          if (cs.toUpperCase() === 'TCRS') return L.bounds(minPixel, maxPixel);\n          let tileSize = projection.options.crs.tile.bounds.max.x;\n          return L.bounds(\n            L.point(minPixel.x / tileSize, minPixel.y / tileSize),\n            L.point(maxPixel.x / tileSize, maxPixel.y / tileSize)\n          );\n        case 'GCRS':\n          let minGCRS = projection.unproject(pcrsBounds.min),\n            maxGCRS = projection.unproject(pcrsBounds.max);\n          return L.bounds(\n            L.point(minGCRS.lng, minGCRS.lat),\n            L.point(maxGCRS.lng, maxGCRS.lat)\n          );\n        default:\n          return undefined;\n      }\n    },\n\n    // pointToPCRSPoint takes a point, with a projection and cs and converts it to a pcrs L.point/L.latLng\n    //pointToPCRSPoint: L.Point, Int, L.CRS, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.point|L.latLng\n    pointToPCRSPoint: function (point, zoom, projection, cs) {\n      if (\n        !point ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !cs ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      let tileSize = projection.options.crs.tile.bounds.max.x;\n      switch (cs.toUpperCase()) {\n        case 'TILEMATRIX':\n          return M.pixelToPCRSPoint(\n            L.point(point.x * tileSize, point.y * tileSize),\n            zoom,\n            projection\n          );\n        case 'PCRS':\n          return point;\n        case 'TCRS' :\n          return M.pixelToPCRSPoint(point, zoom, projection);\n        case 'GCRS':\n          return projection.project(L.latLng(point.y, point.x));\n        default:\n          return undefined;\n      }\n    },\n\n    // pixelToPCRSPoint takes a pixel L.point, the zoom and projection and returns a L.point in pcrs\n    // pixelToPCRSPoint: L.Point, Int, L.CRS|Str -> L.point\n    pixelToPCRSPoint: function (point, zoom, projection) {\n      if (\n        !point ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return projection.transformation.untransform(point, projection.scale(zoom));\n    },\n\n    // boundsToPCRSBounds converts bounds with projection and cs to PCRS bounds\n    // boundsToPCRSBounds: L.bounds, Int, L.CRS|Str, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.bounds\n    boundsToPCRSBounds: function (bounds, zoom, projection, cs) {\n      if (\n        !bounds ||\n        !bounds.max ||\n        !bounds.min ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection ||\n        !cs\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return L.bounds(\n        M.pointToPCRSPoint(bounds.min, zoom, projection, cs),\n        M.pointToPCRSPoint(bounds.max, zoom, projection, cs)\n      );\n    },\n\n    //L.bounds have fixed point positions, where min is always topleft, max is always bottom right, and the values are always sorted by leaflet\n    //important to consider when working with pcrs where the origin is not topleft but rather bottomleft, could lead to confusion\n    pixelToPCRSBounds: function (bounds, zoom, projection) {\n      if (\n        !bounds ||\n        !bounds.max ||\n        !bounds.min ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return L.bounds(\n        M.pixelToPCRSPoint(bounds.min, zoom, projection),\n        M.pixelToPCRSPoint(bounds.max, zoom, projection)\n      );\n    },\n\n    //meta content is the content attribute of meta\n    // input \"max=5,min=4\" => [[max,5][min,5]]\n    _metaContentToObject: function (input) {\n      if (!input || input instanceof Object) return {};\n      let content = input.split(/\\s+/).join('');\n      let contentArray = {};\n      let stringSplit = content.split(',');\n\n      for (let i = 0; i < stringSplit.length; i++) {\n        let prop = stringSplit[i].split('=');\n        if (prop.length === 2) contentArray[prop[0]] = prop[1];\n      }\n      if (contentArray !== '' && stringSplit[0].split('=').length === 1)\n        contentArray.content = stringSplit[0];\n      return contentArray;\n    },\n\n    // _coordsToArray returns an array of arrays of coordinate pairs\n    // _coordsToArray: (\"1,2,3,4\") -> [[1,2],[3,4]]\n    _coordsToArray: function (containerPoints) {\n      for (\n        var i = 1, pairs = [], coords = containerPoints.split(',');\n        i < coords.length;\n        i += 2\n      ) {\n        pairs.push([parseInt(coords[i - 1]), parseInt(coords[i])]);\n      }\n      return pairs;\n    },\n\n    // _parseStylesheetAsHTML parses map-link and map-style from mapml and inserts them to the container as HTML\n    _parseStylesheetAsHTML: function (mapml, base, container) {\n      if (\n        !(container instanceof Element) ||\n        !mapml ||\n        !mapml.querySelector('map-link[rel=stylesheet],map-style')\n      )\n        return;\n\n      if (base instanceof Element) {\n        base = base.getAttribute('href')\n          ? base.getAttribute('href')\n          : document.URL;\n      } else if (!base || base === '' || base instanceof Object) {\n        return;\n      }\n\n      var ss = [];\n      var stylesheets = mapml.querySelectorAll(\n        'map-link[rel=stylesheet],map-style'\n      );\n      for (var i = 0; i < stylesheets.length; i++) {\n        if (stylesheets[i].nodeName.toUpperCase() === 'MAP-LINK') {\n          var href = stylesheets[i].hasAttribute('href')\n            ? new URL(stylesheets[i].getAttribute('href'), base).href\n            : null;\n          if (href) {\n            if (!container.querySelector(\"link[href='\" + href + \"']\")) {\n              var linkElm = document.createElement('link');\n              linkElm.setAttribute('href', href);\n              linkElm.setAttribute('rel', 'stylesheet');\n              ss.push(linkElm);\n            }\n          }\n        } else {\n          // <map-style>\n          var styleElm = document.createElement('style');\n          styleElm.textContent = stylesheets[i].textContent;\n          ss.push(styleElm);\n        }\n      }\n      // insert <link> or <style> elements after the begining  of the container\n      // element, in document order as copied from original mapml document\n      // note the code below assumes hrefs have been resolved and elements\n      // re-parsed from xml and serialized as html elements ready for insertion\n      for (var s = ss.length - 1; s >= 0; s--) {\n        container.insertAdjacentElement('afterbegin', ss[s]);\n      }\n    },\n\n    // _splitCoordinate splits string coordinates to an array as floating point numbers\n    _splitCoordinate: function (element, index, array) {\n      var a = [];\n      element.split(/\\s+/gim).forEach(M._parseNumber, a);\n      this.push(a);\n    },\n\n    // _parseNumber parses a string as a floating point number, helper function for _splitCoordinate\n    _parseNumber: function (element, index, array) {\n      this.push(parseFloat(element));\n    },\n\n    // _handleLink handles map-a links, when clicked on a map-a link\n    _handleLink: function (link, leafletLayer) {\n      let zoomTo,\n        justPan = false,\n        layer,\n        map = leafletLayer._map,\n        opacity;\n      if (link.type === 'text/html' && link.target !== '_blank') {\n        // all other target values other than blank behave as _top\n        link.target = '_top';\n      } else if (link.type !== 'text/html' && link.url.includes('#')) {\n        let hash = link.url.split('#'),\n          loc = hash[1].split(',');\n        zoomTo = { z: loc[0] || 0, lng: loc[1] || 0, lat: loc[2] || 0 };\n        justPan = !hash[0]; // if the first half of the array is an empty string then the link is just for panning\n        if (['/', '.', '#'].includes(link.url[0])) link.target = '_self';\n      }\n      if (!justPan) {\n        layer = document.createElement('layer-');\n        layer.setAttribute('src', link.url);\n        layer.setAttribute('checked', '');\n        switch (link.target) {\n          case '_blank':\n            if (link.type === 'text/html') {\n              window.open(link.url);\n            } else {\n              postTraversalSetup();\n              map.options.mapEl.appendChild(layer);\n            }\n            break;\n          case '_parent':\n            postTraversalSetup();\n            for (let l of map.options.mapEl.querySelectorAll('layer-'))\n              if (l._layer !== leafletLayer) map.options.mapEl.removeChild(l);\n            map.options.mapEl.appendChild(layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n            break;\n          case '_top':\n            window.location.href = link.url;\n            break;\n          default:\n            postTraversalSetup();\n            opacity = leafletLayer._layerEl.opacity;\n            leafletLayer._layerEl.insertAdjacentElement('beforebegin', layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n        }\n      } else if (zoomTo && !link.inPlace && justPan) {\n        leafletLayer._map.options.mapEl.zoomTo(\n          +zoomTo.lat,\n          +zoomTo.lng,\n          +zoomTo.z\n        );\n        if (opacity) layer.opacity = opacity;\n        map.getContainer().focus();\n      }\n\n      function postTraversalSetup() {\n        // when the projection is changed as part of the link traversal process,\n        // it's necessary to set the map viewer's lat, lon and zoom NOW, so that\n        // the promises that are created when the viewer's projection is changed\n        // can use the viewer's lat, lon and zoom properties that were in effect\n        // before the projection change i.e. in the closure for that code\n        // see mapml-viewer / map is=web-map projection attributeChangedCallback\n        // specifically required for use cases like changing projection after\n        // link traversal, e.g. BC link here https://maps4html.org/experiments/linking/features/\n        if (!link.inPlace && zoomTo) updateMapZoomTo(zoomTo);\n        // the layer is newly created, so have to wait until it's fully init'd\n        // before setting properties.\n        layer.whenReady().then(() => {\n          // if the map projection isnt' changed by link traversal, it's necessary\n          // to perform pan/zoom operations after the layer is ready\n          if (!link.inPlace && zoomTo)\n            layer.parentElement.zoomTo(+zoomTo.lat, +zoomTo.lng, +zoomTo.z);\n          else if (!link.inPlace) layer.zoomTo();\n          // not sure if this is necessary\n          if (opacity) layer.opacity = opacity;\n          // this is necessary to display the FeatureIndexOverlay, I believe\n          map.getContainer().focus();\n        });\n      }\n\n      function updateMapZoomTo(zoomTo) {\n        // can't use mapEl.zoomTo(...) here, it's too slow!\n        map.options.mapEl.lat = +zoomTo.lat;\n        map.options.mapEl.lon = +zoomTo.lng;\n        map.options.mapEl.zoom = +zoomTo.z;\n      }\n    },\n    // TODO: make this dynamic based on the individual features/extents\n    getBounds: function (mapml) {\n      if (!mapml) return null;\n      let cs = M.FALLBACK_CS,\n        projection =\n          (mapml.querySelector('map-meta[name=projection]') &&\n            M._metaContentToObject(\n              mapml\n                .querySelector('map-meta[name=projection]')\n                .getAttribute('content')\n            ).content.toUpperCase()) ||\n          M.FALLBACK_PROJECTION;\n      try {\n        let meta =\n          mapml.querySelector('map-meta[name=extent]') &&\n          M._metaContentToObject(\n            mapml.querySelector('map-meta[name=extent]').getAttribute('content')\n          );\n\n        let zoom = meta.zoom || 0;\n\n        let metaKeys = Object.keys(meta);\n        for (let i = 0; i < metaKeys.length; i++) {\n          if (!metaKeys[i].includes('zoom')) {\n            cs = M.axisToCS(metaKeys[i].split('-')[2]);\n            break;\n          }\n        }\n        let axes = M.csToAxes(cs);\n        return M.boundsToPCRSBounds(\n          L.bounds(\n            L.point(+meta[`top-left-${axes[0]}`], +meta[`top-left-${axes[1]}`]),\n            L.point(\n              +meta[`bottom-right-${axes[0]}`],\n              +meta[`bottom-right-${axes[1]}`]\n            )\n          ),\n          zoom,\n          projection,\n          cs\n        );\n      } catch (error) {\n        //if error then by default set the layer to osm and bounds to the entire map view\n        return M.boundsToPCRSBounds(\n          M[projection].options.crs.tilematrix.bounds(0),\n          0,\n          projection,\n          cs\n        );\n      }\n    },\n    getZoomBounds: function (mapml, nativeZoom) {\n      if (!mapml) return null;\n      let nMin = 100,\n        nMax = 0,\n        features = mapml.querySelectorAll('map-feature'),\n        meta,\n        projection;\n      for (let i = 0; i < features.length; i++) {\n        let lZoom = +features[i].getAttribute('zoom');\n        if (!features[i].getAttribute('zoom')) lZoom = nativeZoom;\n        nMax = Math.max(nMax, lZoom);\n        nMin = Math.min(nMin, lZoom);\n      }\n      try {\n        projection = M._metaContentToObject(\n          mapml.querySelector('map-meta[name=projection]').getAttribute('content')\n        ).content;\n        meta = M._metaContentToObject(\n          mapml.querySelector('map-meta[name=zoom]').getAttribute('content')\n        );\n      } catch (error) {\n        return {\n          minZoom: 0,\n          maxZoom:\n            M[projection || M.FALLBACK_PROJECTION].options.resolutions.length - 1,\n          minNativeZoom: nMin,\n          maxNativeZoom: nMax\n        };\n      }\n      return {\n        minZoom: +meta.min,\n        maxZoom: +meta.max,\n        minNativeZoom: nMin,\n        maxNativeZoom: nMax\n      };\n    },\n    // getNativeVariables: returns an object with the native zoom and CS,\n    //                     based on the map-metas that are available within\n    //                     the layer or the fallback default values.\n    // getNativeVariables: mapml-||layer-||null||[map-feature,...] -> {zoom: _, val: _}\n    // mapml can be a mapml- element, layer- element, null, or an array of map-features\n    getNativeVariables: function (mapml) {\n      let nativeZoom, nativeCS;\n      // when mapml is an array of features provided by the query\n      if (\n        mapml.length &&\n        mapml[0].parentElement.parentElement &&\n        mapml[0].parentElement.parentElement.tagName === 'mapml-'\n      ) {\n        let mapmlEl = mapml[0].parentElement.parentElement;\n        nativeZoom =\n          (mapmlEl.querySelector &&\n            mapmlEl.querySelector('map-meta[name=zoom]') &&\n            +M._metaContentToObject(\n              mapmlEl.querySelector('map-meta[name=zoom]').getAttribute('content')\n            ).value) ||\n          0;\n        nativeCS =\n          (mapmlEl.querySelector &&\n            mapmlEl.querySelector('map-meta[name=cs]') &&\n            M._metaContentToObject(\n              mapmlEl.querySelector('map-meta[name=cs]').getAttribute('content')\n            ).content) ||\n          'GCRS';\n      } else {\n        // when mapml is null or a layer-/mapml- element\n        nativeZoom =\n          (mapml.querySelector &&\n            mapml.querySelector('map-meta[name=zoom]') &&\n            +M._metaContentToObject(\n              mapml.querySelector('map-meta[name=zoom]').getAttribute('content')\n            ).value) ||\n          0;\n        nativeCS =\n          (mapml.querySelector &&\n            mapml.querySelector('map-meta[name=cs]') &&\n            M._metaContentToObject(\n              mapml.querySelector('map-meta[name=cs]').getAttribute('content')\n            ).content) ||\n          'GCRS';\n      }\n      return { zoom: nativeZoom, cs: nativeCS };\n    },\n\n    // _gcrsToTileMatrix returns the [column, row] of the tiles at map center. Used for Announce movement for screen readers\n    // _gcrsToTileMatrix: map/mapml-viewer -> [column, row]\n    _gcrsToTileMatrix: function (mapEl) {\n      let point = mapEl._map.project(mapEl._map.getCenter());\n      let tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.y;\n      let column = Math.trunc(point.x / tileSize);\n      let row = Math.trunc(point.y / tileSize);\n      return [column, row];\n    },\n\n    // Pastes text to a mapml-viewer/map element(mapEl), text can be a mapml link, geojson, or a layer-\n    //    used for pasting layers through ctrl+v, drag/drop, and pasting through the contextmenu\n    // _pasteLayer: HTMLElement Str -> None\n    // Effects: append a layer- element to mapEl, if it is valid\n    _pasteLayer: function (mapEl, text) {\n      try {\n        new URL(text);\n        // create a new <layer-> child of the <mapml-viewer> element\n        let l =\n          '<layer- src=\"' +\n          text +\n          '\" label=\"' +\n          M.options.locale.dfLayer +\n          '\" checked=\"\"></layer->';\n        mapEl.insertAdjacentHTML('beforeend', l);\n        mapEl.lastElementChild.whenReady().catch(() => {\n          if (mapEl) {\n            // should invoke lifecyle callbacks automatically by removing it from DOM\n            mapEl.removeChild(mapEl.lastChild);\n          }\n          // garbage collect it\n          l = null;\n        });\n      } catch (err) {\n        text = text\n          .replace(/(<!--.*?-->)|(<!--[\\S\\s]+?-->)|(<!--[\\S\\s]*?$)/g, '')\n          .trim();\n        if (text.slice(0, 7) === '<layer-' && text.slice(-9) === '</layer->') {\n          mapEl.insertAdjacentHTML('beforeend', text);\n        } else if (\n          text.slice(0, 12) === '<map-feature' &&\n          text.slice(-14) === '</map-feature>'\n        ) {\n          let layer =\n            `<layer- label=\"${M.options.locale.dfPastedLayer}\" checked>\n                       <map-meta name='projection' content='${mapEl.projection}'></map-meta>` +\n            text +\n            '</layer->';\n          mapEl.insertAdjacentHTML('beforeend', layer);\n        } else {\n          try {\n            mapEl.geojson2mapml(JSON.parse(text));\n          } catch {\n            console.log('Invalid Input!');\n          }\n        }\n      }\n    },\n\n    // Takes GeoJSON Properties to return an HTML table, helper function\n    //    for geojson2mapml\n    // _properties2Table: geojsonPropertiesOBJ -> HTML Table\n    _properties2Table: function (json) {\n      let table = document.createElement('table');\n\n      // Creating a Table Header\n      let thead = table.createTHead();\n      let row = thead.insertRow();\n      let th1 = document.createElement('th');\n      let th2 = document.createElement('th');\n      th1.appendChild(document.createTextNode('Property name'));\n      th2.appendChild(document.createTextNode('Property value'));\n      th1.setAttribute('role', 'columnheader');\n      th2.setAttribute('role', 'columnheader');\n      th1.setAttribute('scope', 'col');\n      th2.setAttribute('scope', 'col');\n      row.appendChild(th1);\n      row.appendChild(th2);\n\n      // Creating table body and populating it from the JSON\n      let tbody = table.createTBody();\n      for (let key in json) {\n        if (json.hasOwnProperty(key)) {\n          let row = tbody.insertRow();\n          let th = document.createElement('th');\n          let td = document.createElement('td');\n          th.appendChild(document.createTextNode(key));\n          td.appendChild(document.createTextNode(json[key]));\n          th.setAttribute('scope', 'row');\n          td.setAttribute('itemprop', key);\n          row.appendChild(th);\n          row.appendChild(td);\n        }\n      }\n      return table;\n    },\n\n    // Takes bbox array and a x,y coordinate to possibly update the extent, returns extent\n    //    for geojson2mapml\n    // _updateExtent: [min x, min y, max x, max y], x, y -> [min x, min y, max x, max y]\n    _updateExtent: function (bboxExtent, x, y) {\n      if (bboxExtent === {}) {\n        return bboxExtent;\n      }\n      bboxExtent[0] = Math.min(x, bboxExtent[0]);\n      bboxExtent[1] = Math.min(y, bboxExtent[1]);\n      bboxExtent[2] = Math.max(x, bboxExtent[2]);\n      bboxExtent[3] = Math.max(y, bboxExtent[3]);\n      return bboxExtent;\n    },\n\n    // Takes a GeoJSON geojson and an options Object which returns a <layer-> Element\n    // The options object can contain the following:\n    //      label            - String, contains the layer name, if included overrides the default label mapping\n    //      projection       - String, contains the projection of the layer (OSMTILE, WGS84, CBMTILE, APSTILE), defaults to   OSMTILE\n    //      caption          - Function | String, function accepts one argument being the feature object which produces the   featurecaption string OR a string that is the name of the property that will be mapped to featurecaption\n    //      properties       - Function | String | HTMLElement, a function which maps the geojson feature to an HTMLElement   or a string that will be parsed as an HTMLElement or an HTMLElement\n    //      geometryFunction - Function, A function you supply that can add classes, hyperlinks and spans to the created  <map-geometry> element, default would be the plain map-geometry element\n    // geojson2mapml: geojson Object <layer-> [min x, min y, max x, max y] -> <layer->\n    geojson2mapml: function (json, options = {}, layer = null, bboxExtent = {}) {\n      let defaults = {\n        label: null,\n        projection: 'OSMTILE',\n        caption: null,\n        properties: null,\n        geometryFunction: null\n      };\n      // assign default values for undefined options\n      options = Object.assign({}, defaults, options);\n\n      // If string json is received\n      if (typeof json === 'string') {\n        json = JSON.parse(json);\n      }\n      let geometryType = [\n        'POINT',\n        'LINESTRING',\n        'POLYGON',\n        'MULTIPOINT',\n        'MULTILINESTRING',\n        'MULTIPOLYGON',\n        'GEOMETRYCOLLECTION'\n      ];\n      let jsonType = json.type.toUpperCase();\n      let out = '';\n      let setExtent = false;\n\n      // HTML parser\n      let parser = new DOMParser();\n\n      // initializing layer\n      if (layer === null) {\n        if (!json.bbox) {\n          setExtent = true;\n        }\n        // creating an empty mapml layer\n        let xmlStringLayer =\n          \"<layer- label='' checked><map-meta name='projection' content='\" +\n          options.projection +\n          \"'></map-meta><map-meta name='cs' content='gcrs'></map-meta></layer->\";\n        layer = parser.parseFromString(xmlStringLayer, 'text/html');\n        //console.log(layer)\n        if (options.label !== null) {\n          layer.querySelector('layer-').setAttribute('label', options.label);\n        } else if (json.name) {\n          layer.querySelector('layer-').setAttribute('label', json.name);\n        } else if (json.title) {\n          layer.querySelector('layer-').setAttribute('label', json.title);\n        } else {\n          layer\n            .querySelector('layer-')\n            .setAttribute('label', M.options.locale.dfLayer);\n        }\n      }\n      let point = '<map-point></map-point>';\n      point = parser.parseFromString(point, 'text/html');\n\n      let multiPoint =\n        '<map-multipoint><map-coordinates></map-coordinates></map-multipoint>';\n      multiPoint = parser.parseFromString(multiPoint, 'text/html');\n\n      let linestring =\n        '<map-linestring><map-coordinates></map-coordinates></map-linestring>';\n      linestring = parser.parseFromString(linestring, 'text/html');\n\n      let multilinestring = '<map-multilinestring></map-multilinestring>';\n      multilinestring = parser.parseFromString(multilinestring, 'text/html');\n\n      let polygon = '<map-polygon></map-polygon>';\n      polygon = parser.parseFromString(polygon, 'text/html');\n\n      let multiPolygon = '<map-multipolygon></map-multipolygon>';\n      multiPolygon = parser.parseFromString(multiPolygon, 'text/html');\n\n      let geometrycollection =\n        '<map-geometrycollection></map-geometrycollection>';\n      geometrycollection = parser.parseFromString(\n        geometrycollection,\n        'text/html'\n      );\n\n      let feature =\n        '<map-feature><map-featurecaption></map-featurecaption><map-geometry></map-geometry><map-properties></map-properties></map-feature>';\n      feature = parser.parseFromString(feature, 'text/html');\n\n      // Template to add coordinates to Geometries\n      let coords = '<map-coordinates></map-coordinates>';\n      coords = parser.parseFromString(coords, 'text/html');\n\n      //console.log(layer);\n      if (jsonType === 'FEATURECOLLECTION') {\n        // Setting bbox if it exists\n        if (json.bbox) {\n          layer\n            .querySelector('layer-')\n            .insertAdjacentHTML(\n              'afterbegin',\n              \"<map-meta name='extent' content='top-left-longitude=\" +\n                json.bbox[0] +\n                ', top-left-latitude=' +\n                json.bbox[1] +\n                ', bottom-right-longitude=' +\n                json.bbox[2] +\n                ',bottom-right-latitude=' +\n                json.bbox[3] +\n                \"'></map-meta>\"\n            );\n        } else {\n          bboxExtent = [\n            Infinity,\n            Infinity,\n            Number.NEGATIVE_INFINITY,\n            Number.NEGATIVE_INFINITY\n          ];\n        }\n\n        let features = json.features;\n        //console.log(\"Features length - \" + features.length);\n        for (let l = 0; l < features.length; l++) {\n          M.geojson2mapml(features[l], options, layer, bboxExtent);\n        }\n      } else if (jsonType === 'FEATURE') {\n        let clone_feature = feature.cloneNode(true);\n        let curr_feature = clone_feature.querySelector('map-feature');\n\n        // Setting bbox if it exists\n        if (json.bbox) {\n          layer\n            .querySelector('layer-')\n            .insertAdjacentHTML(\n              'afterbegin',\n              \"<map-meta name='extent' content='top-left-longitude=\" +\n                json.bbox[0] +\n                ', top-left-latitude=' +\n                json.bbox[1] +\n                ', bottom-right-longitude=' +\n                json.bbox[2] +\n                ',bottom-right-latitude=' +\n                json.bbox[3] +\n                \"'></map-meta>\"\n            );\n        } else if (\n          typeof bboxExtent === 'object' &&\n          bboxExtent.length === undefined\n        ) {\n          bboxExtent = [\n            Infinity,\n            Infinity,\n            Number.NEGATIVE_INFINITY,\n            Number.NEGATIVE_INFINITY\n          ];\n        }\n\n        // Setting featurecaption\n        let featureCaption = layer.querySelector('layer-').getAttribute('label');\n        if (typeof options.caption === 'function') {\n          featureCaption = options.caption(json);\n        } else if (typeof options.caption === 'string') {\n          featureCaption = json.properties[options.caption];\n          // if property does not exist\n          if (featureCaption === undefined) {\n            featureCaption = options.caption;\n          }\n        } else if (json.id) {\n          // when no caption option available try setting id as featurecaption\n          featureCaption = json.id;\n        }\n        curr_feature.querySelector('map-featurecaption').innerHTML =\n          featureCaption;\n\n        // Setting Properties\n        let p;\n        // if properties function is passed\n        if (typeof options.properties === 'function') {\n          p = options.properties(json);\n          // if function output is not an element, ignore the properties.\n          if (!(p instanceof Element)) {\n            p = false;\n            console.error(\n              'options.properties function returns a string instead of an HTMLElement.'\n            );\n          }\n        } else if (typeof options.properties === 'string') {\n          // if properties string is passed\n          curr_feature\n            .querySelector('map-properties')\n            .insertAdjacentHTML('beforeend', options.properties);\n          p = false;\n        } else if (options.properties instanceof HTMLElement) {\n          // if an HTMLElement is passed - NOT TESTED\n          p = options.properties;\n        } else {\n          // If no properties function, string or HTMLElement is passed\n          p = M._properties2Table(json.properties);\n        }\n\n        if (p) {\n          curr_feature.querySelector('map-properties').appendChild(p);\n        }\n\n        // Setting map-geometry\n        let g = M.geojson2mapml(json.geometry, options, layer, bboxExtent);\n        if (typeof options.geometryFunction === 'function') {\n          curr_feature\n            .querySelector('map-geometry')\n            .appendChild(options.geometryFunction(g, json));\n        } else {\n          curr_feature.querySelector('map-geometry').appendChild(g);\n        }\n\n        // Appending feature to layer\n        layer.querySelector('layer-').appendChild(curr_feature);\n      } else if (geometryType.includes(jsonType)) {\n        //console.log(\"Geometry Type - \" + jsonType);\n        switch (jsonType) {\n          case 'POINT':\n            bboxExtent = M._updateExtent(\n              bboxExtent,\n              json.coordinates[0],\n              json.coordinates[1]\n            );\n            out = json.coordinates[0] + ' ' + json.coordinates[1];\n\n            // Create Point element\n            let clone_point = point.cloneNode(true);\n            clone_point = clone_point.querySelector('map-point');\n\n            // Create map-coords to add to the polygon\n            let clone_coords = coords.cloneNode(true);\n            clone_coords = clone_coords.querySelector('map-coordinates');\n\n            clone_coords.innerHTML = out;\n\n            clone_point.appendChild(clone_coords);\n            //console.log(clone_point);\n            return clone_point;\n\n          case 'LINESTRING':\n            let clone_linestring = linestring.cloneNode(true);\n            let linestring_coordindates =\n              clone_linestring.querySelector('map-coordinates');\n\n            out = '';\n\n            for (let x = 0; x < json.coordinates.length; x++) {\n              bboxExtent = M._updateExtent(\n                bboxExtent,\n                json.coordinates[x][0],\n                json.coordinates[x][1]\n              );\n              out =\n                out + json.coordinates[x][0] + ' ' + json.coordinates[x][1] + ' ';\n            }\n\n            linestring_coordindates.innerHTML = out;\n            //console.log(clone_linestring.querySelector('map-linestring'));\n            return clone_linestring.querySelector('map-linestring');\n\n          case 'POLYGON':\n            let clone_polygon = polygon.cloneNode(true);\n            clone_polygon = clone_polygon.querySelector('map-polygon');\n\n            // Going over each coordinates\n            for (let y = 0; y < json.coordinates.length; y++) {\n              let out = '';\n              let clone_coords = coords.cloneNode(true);\n              clone_coords = clone_coords.querySelector('map-coordinates');\n\n              // Going over coordinates for the polygon\n              for (let x = 0; x < json.coordinates[y].length; x++) {\n                bboxExtent = M._updateExtent(\n                  bboxExtent,\n                  json.coordinates[y][x][0],\n                  json.coordinates[y][x][1]\n                );\n                out =\n                  out +\n                  json.coordinates[y][x][0] +\n                  ' ' +\n                  json.coordinates[y][x][1] +\n                  ' ';\n              }\n\n              // Create map-coordinates element and append it to clone_polygon\n              clone_coords.innerHTML = out;\n\n              clone_polygon.appendChild(clone_coords);\n            }\n            //console.log(clone_polygon);\n            return clone_polygon;\n\n          case 'MULTIPOINT':\n            out = '';\n            // Create multipoint element\n            let clone_multipoint = multiPoint.cloneNode(true);\n            clone_multipoint = clone_multipoint.querySelector('map-multipoint');\n\n            for (let i = 0; i < json.coordinates.length; i++) {\n              bboxExtent = M._updateExtent(\n                bboxExtent,\n                json.coordinates[i][0],\n                json.coordinates[i][1]\n              );\n              out =\n                out + json.coordinates[i][0] + ' ' + json.coordinates[i][1] + ' ';\n            }\n            clone_multipoint.querySelector('map-coordinates').innerHTML = out;\n            return clone_multipoint;\n\n          case 'MULTILINESTRING':\n            let clone_multilinestring = multilinestring.cloneNode(true);\n            clone_multilinestring = clone_multilinestring.querySelector(\n              'map-multilinestring'\n            );\n\n            for (let i = 0; i < json.coordinates.length; i++) {\n              let out = '';\n              let clone_coords = coords.cloneNode(true);\n              clone_coords = clone_coords.querySelector('map-coordinates');\n              for (let y = 0; y < json.coordinates[i].length; y++) {\n                bboxExtent = M._updateExtent(\n                  bboxExtent,\n                  json.coordinates[i][y][0],\n                  json.coordinates[i][y][1]\n                );\n                out =\n                  out +\n                  json.coordinates[i][y][0] +\n                  ' ' +\n                  json.coordinates[i][y][1] +\n                  ' ';\n              }\n              clone_coords.innerHTML = out;\n              clone_multilinestring.appendChild(clone_coords);\n            }\n            return clone_multilinestring;\n\n          case 'MULTIPOLYGON':\n            let m = multiPolygon.cloneNode(true);\n            m = m.querySelector('map-multiPolygon');\n\n            // Going over each Polygon\n            for (let i = 0; i < json.coordinates.length; i++) {\n              let clone_polygon = polygon.cloneNode(true);\n              clone_polygon = clone_polygon.querySelector('map-polygon');\n\n              // Going over each coordinates\n              for (let y = 0; y < json.coordinates[i].length; y++) {\n                let out = '';\n                let clone_coords = coords.cloneNode(true);\n                clone_coords = clone_coords.querySelector('map-coordinates');\n\n                // Going over coordinates for the polygon\n                for (let x = 0; x < json.coordinates[i][y].length; x++) {\n                  bboxExtent = M._updateExtent(\n                    bboxExtent,\n                    json.coordinates[i][y][x][0],\n                    json.coordinates[i][y][x][1]\n                  );\n                  out =\n                    out +\n                    json.coordinates[i][y][x][0] +\n                    ' ' +\n                    json.coordinates[i][y][x][1] +\n                    ' ';\n                }\n\n                // Create map-coordinates element and append it to clone_polygon\n                clone_coords.innerHTML = out;\n\n                clone_polygon.appendChild(clone_coords);\n              }\n              m.appendChild(clone_polygon);\n            }\n            return m;\n          case 'GEOMETRYCOLLECTION': // ---------------------------------------------------------------------------\n            let g = geometrycollection.cloneNode(true);\n            g = g.querySelector('map-geometrycollection');\n            //console.log(json.geometries);\n            for (let i = 0; i < json.geometries.length; i++) {\n              let fg = M.geojson2mapml(\n                json.geometries[i],\n                options,\n                layer,\n                bboxExtent\n              );\n              g.appendChild(fg);\n            }\n            return g;\n        }\n      }\n      //Add default bbox\n      if (setExtent) {\n        layer\n          .querySelector('layer-')\n          .insertAdjacentHTML(\n            'afterbegin',\n            \"<map-meta name='extent' content='top-left-longitude=\" +\n              bboxExtent[0] +\n              ', top-left-latitude=' +\n              bboxExtent[1] +\n              ', bottom-right-longitude=' +\n              bboxExtent[2] +\n              ',bottom-right-latitude=' +\n              bboxExtent[3] +\n              \"'></map-meta>\"\n          );\n      }\n      return layer.querySelector('layer-');\n    },\n\n    // Takes an array of length n to return an array of arrays with length 2, helper function\n    //    for mapml2geojson\n    // _breakArray: arr(float) -> arr(arr(float, float))\n    _breakArray: function (arr) {\n      let size = 2;\n      let arrayOfArrays = [];\n      // removing anything other than numbers, ., - (used to remove <map-span> tags)\n      arr = arr.filter((x) => !/[^\\d.-]/g.test(x)).filter((x) => x);\n      for (let i = 0; i < arr.length; i += size) {\n        arrayOfArrays.push(arr.slice(i, i + size).map(Number));\n      }\n      return arrayOfArrays;\n    },\n\n    // Takes an HTML Table to return geojson properties, helper function\n    //    for mapml2geojson\n    // _table2properties: HTML Table -> geojson\n    _table2properties: function (table) {\n      // removing thead, if it exists\n      let head = table.querySelector('thead');\n      if (head !== null) {\n        table.querySelector('thead').remove();\n      }\n      let json = {};\n      table.querySelectorAll('tr').forEach((tr) => {\n        let tableData = tr.querySelectorAll('th, td');\n        json[tableData[0].innerHTML] = tableData[1].innerHTML;\n      });\n      return json;\n    },\n\n    // Converts a geometry element (el) to geojson, helper function\n    //    for mapml2geojson, NOTE - el can not be a map-geometrycollection\n    // _geometry2geojson: (child of <map-geometry>), Proj4, Proj4, Bool -> geojson\n    _geometry2geojson: function (el, source, dest, transform) {\n      // remove map-a, map-span elements if the geometry is wrapped in them\n      while (\n        el.nodeName.toUpperCase() === 'MAP-SPAN' ||\n        el.nodeName.toUpperCase() === 'MAP-A'\n      ) {\n        el = el.firstElementChild;\n      }\n      let elem = el.nodeName;\n      let j = {};\n      let coord;\n\n      switch (elem.toUpperCase()) {\n        case 'MAP-POINT':\n          j.type = 'Point';\n          if (transform) {\n            let pointConv = proj4.transform(\n              source,\n              dest,\n              el\n                .querySelector('map-coordinates')\n                .innerHTML.split(/[<>\\ ]/g)\n                .map(Number)\n            );\n            j.coordinates = [pointConv.x, pointConv.y];\n          } else {\n            j.coordinates = el\n              .querySelector('map-coordinates')\n              .innerHTML.split(/[<>\\ ]/g)\n              .map(Number);\n          }\n          break;\n        case 'MAP-LINESTRING':\n          j.type = 'LineString';\n          coord = el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g);\n          coord = M._breakArray(coord);\n          if (transform) {\n            coord = M._pcrsToGcrs(coord, source, dest);\n          }\n          j.coordinates = coord;\n          break;\n        case 'MAP-POLYGON':\n          j.type = 'Polygon';\n          j.coordinates = [];\n          let x = 0;\n          el.querySelectorAll('map-coordinates').forEach((coord) => {\n            coord = coord.innerHTML.split(/[<>\\ ]/g);\n            coord = M._breakArray(coord);\n            if (transform) {\n              coord = M._pcrsToGcrs(coord, source, dest);\n            }\n            j.coordinates[x] = coord;\n            x++;\n          });\n          break;\n        case 'MAP-MULTIPOINT':\n          j.type = 'MultiPoint';\n          coord = M._breakArray(\n            el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g)\n          );\n          if (transform) {\n            coord = M._pcrsToGcrs(coord, source, dest);\n          }\n          j.coordinates = coord;\n          break;\n        case 'MAP-MULTILINESTRING':\n          j.type = 'MultiLineString';\n          j.coordinates = [];\n          let i = 0;\n          el.querySelectorAll('map-coordinates').forEach((coord) => {\n            coord = coord.innerHTML.split(/[<>\\ ]/g);\n            coord = M._breakArray(coord);\n            if (transform) {\n              coord = M._pcrsToGcrs(coord, source, dest);\n            }\n            j.coordinates[i] = coord;\n            i++;\n          });\n          break;\n        case 'MAP-MULTIPOLYGON':\n          j.type = 'MultiPolygon';\n          j.coordinates = [];\n          let p = 0;\n          el.querySelectorAll('map-polygon').forEach((poly) => {\n            let y = 0;\n            j.coordinates.push([]);\n            poly.querySelectorAll('map-coordinates').forEach((coord) => {\n              coord = coord.innerHTML.split(/[<>\\ ]/g);\n              coord = M._breakArray(coord);\n              if (transform) {\n                coord = M._pcrsToGcrs(coord, source, dest);\n              }\n              j.coordinates[p].push([]);\n              j.coordinates[p][y] = coord;\n              y++;\n            });\n            p++;\n          });\n          break;\n      }\n      return j;\n    },\n\n    // _pcrsToGcrs: arrof([x,y]) Proj4, Proj4 -> arrof[x,y]\n    _pcrsToGcrs: function (arr, source, dest) {\n      let newArr = [];\n      for (let i = 0; i < arr.length; i++) {\n        let conv = proj4.transform(source, dest, arr[i]);\n        conv = [conv.x, conv.y];\n        newArr.push(conv);\n      }\n      return newArr;\n    },\n\n    // Takes an <layer-> element and returns a geojson feature collection object\n    // The options object can contain the following:\n    //      propertyFunction   - function(<map-properties>), A function that maps the features' <map-properties> element to   a GeoJSON \"properties\" member.\n    //      transform          - Bool, Transform coordinates to gcrs values, defaults to True\n    // mapml2geojson: <layer-> Object -> GeoJSON\n    mapml2geojson: function (element, options = {}) {\n      let defaults = {\n        propertyFunction: null,\n        transform: true\n      };\n      // assign default values for undefined options\n      options = Object.assign({}, defaults, options);\n\n      let json = {};\n      json.type = 'FeatureCollection';\n      json.title = element.getAttribute('label');\n      json.features = [];\n\n      // Transforming Coordinates to gcrs if transformation = true and coordinate is not (EPSG:3857 or EPSG:4326)\n      let source = null;\n      let dest = null;\n      if (options.transform) {\n        source = new proj4.Proj(element.parentElement._map.options.crs.code);\n        dest = new proj4.Proj('EPSG:4326');\n        if (\n          element.parentElement._map.options.crs.code === 'EPSG:3857' ||\n          element.parentElement._map.options.crs.code === 'EPSG:4326'\n        ) {\n          options.transform = false;\n        }\n      }\n\n      // Setting all meta settings, if any\n      let metas = element.querySelectorAll('map-meta');\n      metas.forEach((meta) => {\n        let name = meta.getAttribute('name');\n        if (name === 'extent') {\n          let content = meta.getAttribute('content');\n          let arr = content.split(',');\n          let ex = {};\n          for (let i = 0; i < arr.length; i++) {\n            let s = arr[i].split('=');\n            s[0] = s[0].trim(); // removing whitespace\n            s[1] = parseFloat(s[1]);\n            ex[s[0]] = s[1];\n          }\n          json.bbox = [\n            ex['top-left-longitude'],\n            ex['top-left-latitude'],\n            ex['bottom-right-longitude'],\n            ex['bottom-right-latitude']\n          ];\n        }\n      });\n\n      // Iterating over each feature\n      let features = element.querySelectorAll('map-feature');\n      let num = 0;\n\n      // Going over each feature in the layer\n      features.forEach((feature) => {\n        //console.log(feature);\n\n        json.features[num] = { type: 'Feature' };\n        json.features[num].geometry = {};\n        json.features[num].properties = {};\n\n        // setting properties when function presented\n        if (!feature.querySelector('map-properties')) {\n          json.features[num].properties = null;\n        } else if (typeof options.propertyFunction === 'function') {\n          let properties = options.propertyFunction(\n            feature.querySelector('map-properties')\n          );\n          json.features[num].properties = properties;\n        } else if (\n          feature.querySelector('map-properties').querySelector('table') !== null\n        ) {\n          // setting properties when table presented\n          let table = feature\n              .querySelector('map-properties')\n              .querySelector('table')\n              .cloneNode(true),\n            properties = M._table2properties(table);\n          json.features[num].properties = properties;\n        } else {\n          // when no table present, strip any possible html tags to only get text\n          json.features[num].properties = {\n            prop0: feature\n              .querySelector('map-properties')\n              .innerHTML.replace(/(<([^>]+)>)/gi, '')\n          };\n        }\n\n        let geom = feature.querySelector('map-geometry').firstElementChild;\n\n        // remove map-a, map-span elements if the geometry is wrapped in them\n        while (\n          geom.nodeName.toUpperCase() === 'MAP-SPAN' ||\n          geom.nodeName.toUpperCase() === 'MAP-A'\n        ) {\n          geom = geom.firstElementChild;\n        }\n\n        // Adding Geometry\n        if (geom.nodeName.toUpperCase() !== 'MAP-GEOMETRYCOLLECTION') {\n          json.features[num].geometry = M._geometry2geojson(\n            geom,\n            source,\n            dest,\n            options.transform\n          );\n        } else {\n          json.features[num].geometry.type = 'GeometryCollection';\n          json.features[num].geometry.geometries = [];\n\n          let geoms = geom.children;\n          Array.from(geoms).forEach((g) => {\n            // omit all map-span, map-a that may be present in geometry-collection\n            let n = g.nodeName.toUpperCase();\n            if (n === 'MAP-SPAN' || n === 'MAP-A') {\n              g = g.cloneNode(true);\n              [...g.querySelectorAll('map-a, map-span')].forEach((e) =>\n                e.replaceWith(...e.children)\n              );\n              Array.from(g.children).forEach((i) => {\n                i = M._geometry2geojson(i, source, dest, options.transform);\n                json.features[num].geometry.geometries.push(i);\n              });\n            } else {\n              g = M._geometry2geojson(g, source, dest, options.transform);\n              json.features[num].geometry.geometries.push(g);\n            }\n          });\n        }\n        //going to next feature\n        num++;\n      });\n\n      return json;\n    },\n\n    // Takes leaflet bound, leaflet map and min and max zoom limit,\n    // return the maximum zoom level that can show the bound completely\n    // getMaxZoom: L.Bound, L.Map, Number, Number -> Number\n    getMaxZoom: function (bound, map, minZoom, maxZoom) {\n      if (!bound) return;\n\n      let newZoom = map.getZoom(),\n        scale = map.options.crs.scale(newZoom),\n        mapCenterTCRS = map.options.crs.transformation.transform(\n          bound.getCenter(true),\n          scale\n        );\n\n      let mapHalf = map.getSize().divideBy(2),\n        mapTlNew = mapCenterTCRS.subtract(mapHalf).round(),\n        mapBrNew = mapCenterTCRS.add(mapHalf).round();\n\n      let mapTlPCRSNew = M.pixelToPCRSPoint(\n          mapTlNew,\n          newZoom,\n          map.options.projection\n        ),\n        mapBrPCRSNew = M.pixelToPCRSPoint(\n          mapBrNew,\n          newZoom,\n          map.options.projection\n        );\n\n      let mapPCRS = L.bounds(mapTlPCRSNew, mapBrPCRSNew),\n        zOffset = mapPCRS.contains(bound) ? 1 : -1;\n\n      while (\n        (zOffset === -1 && !mapPCRS.contains(bound) && newZoom - 1 >= minZoom) ||\n        (zOffset === 1 && mapPCRS.contains(bound) && newZoom + 1 <= maxZoom)\n      ) {\n        newZoom += zOffset;\n        scale = map.options.crs.scale(newZoom);\n        mapCenterTCRS = map.options.crs.transformation.transform(\n          bound.getCenter(true),\n          scale\n        );\n\n        mapTlNew = mapCenterTCRS.subtract(mapHalf).round();\n        mapBrNew = mapCenterTCRS.add(mapHalf).round();\n        mapTlPCRSNew = M.pixelToPCRSPoint(\n          mapTlNew,\n          newZoom,\n          map.options.projection\n        );\n        mapBrPCRSNew = M.pixelToPCRSPoint(\n          mapBrNew,\n          newZoom,\n          map.options.projection\n        );\n\n        mapPCRS = L.bounds(mapTlPCRSNew, mapBrPCRSNew);\n      }\n\n      if (\n        zOffset === 1 &&\n        newZoom - 1 >= 0 &&\n        !(newZoom === maxZoom && mapPCRS.contains(bound))\n      )\n        newZoom--;\n      return newZoom;\n    }\n  };\n\n  var AttributionButton = L.Control.Attribution.extend({\n    options: {\n      prefix:\n        '<img src=\"https://www.w3.org/community/src/templates/wordpress/StoryTeller/favicon.ico\" style=\"position: relative; top: 5px\" alt=\"W3C Community and Business Groups logo\"> <a href=\"https://www.w3.org/community/maps4html/\">Maps for HTML Community Group</a> | <img src=\"data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTIiIGhlaWdodD0iOCI+PHBhdGggZmlsbD0iIzRDN0JFMSIgZD0iTTAgMGgxMnY0SDB6Ii8+PHBhdGggZmlsbD0iI0ZGRDUwMCIgZD0iTTAgNGgxMnYzSDB6Ii8+PHBhdGggZmlsbD0iI0UwQkMwMCIgZD0iTTAgN2gxMnYxSDB6Ii8+PC9zdmc+\" style=\"padding-right: 0.3em;\" alt=\"Slava Ukraini\"> <a href=\"https://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a> '\n    },\n\n    onAdd: function (map) {\n      map.attributionControl = this;\n      this._container = L.DomUtil.create(\n        'details',\n        'leaflet-control-attribution'\n      );\n      L.DomEvent.disableClickPropagation(this._container);\n\n      for (var i in map._layers) {\n        if (map._layers[i].getAttribution) {\n          this.addAttribution(map._layers[i].getAttribution());\n        }\n      }\n\n      this._update();\n\n      map.on('layeradd', this._addAttribution, this);\n\n      let dialog = document.createElement('dialog');\n      dialog.setAttribute('class', 'shortcuts-dialog');\n      dialog.setAttribute('autofocus', '');\n      dialog.onclick = function (e) {\n        e.stopPropagation();\n      };\n      dialog.innerHTML =\n        `<b>${M.options.locale.kbdShortcuts} </b><button aria-label=\"Close\" onclick='this.parentElement.close()'>X</button>` +\n        `<ul><b>${M.options.locale.kbdMovement}</b><li><kbd>&#8593</kbd> ${M.options.locale.kbdPanUp}</li><li><kbd>&#8595</kbd> ${M.options.locale.kbdPanDown}</li><li><kbd>&#8592</kbd> ${M.options.locale.kbdPanLeft}</li><li><kbd>&#8594</kbd> ${M.options.locale.kbdPanRight}</li><li><kbd>+</kbd> ${M.options.locale.btnZoomIn}</li><li><kbd>-</kbd> ${M.options.locale.btnZoomOut}</li><li><kbd>shift</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 3x ${M.options.locale.kbdPanIncrement}</li><li><kbd>ctrl</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 0.2x ${M.options.locale.kbdPanIncrement}</li><li><kbd>shift</kbd> + <kbd>+/-</kbd> ${M.options.locale.kbdZoom}</li></ul>` +\n        `<ul><b>${M.options.locale.kbdFeature}</b><li><kbd>&#8592/&#8593</kbd> ${M.options.locale.kbdPrevFeature}</li><li><kbd>&#8594/&#8595</kbd> ${M.options.locale.kbdNextFeature}</li></ul>`;\n      map._container.appendChild(dialog);\n\n      return this._container;\n    },\n\n    _update: function () {\n      if (!this._map) {\n        return;\n      }\n\n      var attribs = [];\n\n      for (var i in this._attributions) {\n        if (this._attributions[i]) {\n          attribs.push(i);\n        }\n      }\n\n      var prefixAndAttribs = [];\n\n      if (this.options.prefix) {\n        prefixAndAttribs.push(this.options.prefix);\n      }\n      if (attribs.length) {\n        prefixAndAttribs.push(attribs.join(', '));\n      }\n      this._container.innerHTML =\n        `<summary><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" height=\"30px\" viewBox=\"0 0 24 24\" width=\"30px\" fill=\"currentColor\"><path d=\"M0 0h24v24H0V0z\" fill=\"none\"></path><path d=\"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z\"></path></svg></summary>` +\n        '<div class=\"mapml-attribution-container\">' +\n        `<button onclick=\"this.closest(\\'.leaflet-container\\').querySelector(\\'.shortcuts-dialog\\').showModal()\" class=\"shortcuts-button mapml-button\">${M.options.locale.kbdShortcuts}</button> | ` +\n        prefixAndAttribs.join(' <span aria-hidden=\"true\">|</span> ') +\n        '</div>';\n      this._container.setAttribute('role', 'group');\n      this._container.setAttribute(\n        'aria-label',\n        `${M.options.locale.btnAttribution}`\n      );\n    }\n  });\n\n  L.Map.mergeOptions({\n    attributionControl: false,\n    toggleableAttributionControl: true\n  });\n\n  L.Map.addInitHook(function () {\n    if (this.options.toggleableAttributionControl) {\n      new AttributionButton().addTo(this);\n    }\n  });\n\n  var attributionButton = function (options) {\n    return new AttributionButton(options);\n  };\n\n  var ReloadButton = L.Control.extend({\n    options: {\n      position: 'topleft'\n    },\n\n    onAdd: function (map) {\n      let container = L.DomUtil.create('div', 'mapml-reload-button leaflet-bar');\n\n      let link = L.DomUtil.create('button', 'mapml-reload-button', container);\n      link.innerHTML = \"<span aria-hidden='true'>&#x021BA</span>\";\n      link.title = M.options.locale.cmReload;\n      link.setAttribute('type', 'button');\n      link.classList.add('mapml-button');\n      link.setAttribute('aria-label', 'Reload');\n\n      L.DomEvent.disableClickPropagation(link);\n      L.DomEvent.on(link, 'click', L.DomEvent.stop);\n      L.DomEvent.on(link, 'click', this._goReload, this);\n\n      this._reloadButton = link;\n\n      this._updateDisabled();\n      map.on('moveend', this._updateDisabled, this);\n\n      return container;\n    },\n\n    onRemove: function (map) {\n      map.off('moveend', this._updateDisabled, this);\n    },\n\n    disable: function () {\n      this._disabled = true;\n      this._updateDisabled();\n      return this;\n    },\n\n    enable: function () {\n      this._disabled = false;\n      this._updateDisabled();\n      return this;\n    },\n\n    _goReload: function (e) {\n      if (!this._disabled && this._map.options.mapEl._history.length > 1) {\n        this._map.options.mapEl.reload();\n      }\n    },\n\n    _updateDisabled: function () {\n      setTimeout(() => {\n        L.DomUtil.removeClass(this._reloadButton, 'leaflet-disabled');\n        this._reloadButton.setAttribute('aria-disabled', 'false');\n\n        if (\n          this._map &&\n          (this._disabled || this._map.options.mapEl._history.length <= 1)\n        ) {\n          L.DomUtil.addClass(this._reloadButton, 'leaflet-disabled');\n          this._reloadButton.setAttribute('aria-disabled', 'true');\n        }\n      }, 0);\n    }\n  });\n\n  var reloadButton = function (options) {\n    return new ReloadButton(options);\n  };\n\n  var ScaleBar = L.Control.Scale.extend({\n    options: {\n      maxWidth: 100,\n      updateWhenIdle: true,\n      position: 'bottomleft'\n    },\n\n    onAdd: function (map) {\n      // create output tag for screenreader to read from\n      let outputScale =\n        \"<output role='status' aria-live='polite' aria-atomic='true' class='mapml-screen-reader-output-scale'></output>\";\n      map._container.insertAdjacentHTML('beforeend', outputScale);\n\n      // initialize _container\n      this._container = L.DomUtil.create('div', 'mapml-control-scale');\n      let scaleControl = L.Control.Scale.prototype.onAdd.call(this, map);\n      this._container.appendChild(scaleControl);\n      this._container.setAttribute('tabindex', 0);\n      this._scaleControl = this;\n\n      // run on load\n      setTimeout(() => {\n        this._updateOutput();\n        this._focusOutput();\n      }, 0);\n\n      // update whenever map is zoomed or dragged\n      map.on('zoomend moveend', this._updateOutput, this);\n\n      // have screenreader read out everytime the map is focused\n      this._map._container.addEventListener('focus', () => this._focusOutput());\n\n      return this._container;\n    },\n\n    onRemove: function (map) {\n      map.off('zoomend moveend', this._updateOutput, this);\n    },\n\n    getContainer: function () {\n      return this._container;\n    },\n\n    _pixelsToDistance: function (px, units) {\n      let dpi = window.devicePixelRatio * 96; // default dpi\n      if (units === 'metric') {\n        return (px / dpi) * 2.54; // inches to cm\n      }\n      return px / dpi;\n    },\n\n    _scaleLength: function (scale) {\n      let scaleLength = scale.getAttribute('style');\n      let finalLength = parseInt(scaleLength.match(/width:\\s*(\\d+)px/)[1]);\n\n      return finalLength;\n    },\n\n    _focusOutput: function () {\n      setTimeout(() => {\n        let outputFocus = this._map._container.querySelector(\n          '.mapml-screen-reader-output-scale'\n        );\n        outputFocus.textContent = '';\n        setTimeout(() => {\n          outputFocus.textContent = this._container.getAttribute('aria-label');\n        }, 100);\n      }, 0);\n    },\n\n    _updateOutput: function () {\n      let output = '';\n      let scaleLine = this._scaleControl\n        .getContainer()\n        .getElementsByClassName('leaflet-control-scale-line')[0];\n\n      if (this.options.metric) {\n        let distance = parseFloat(\n          this._pixelsToDistance(this._scaleLength(scaleLine), 'metric').toFixed(\n            1\n          )\n        );\n        output = `${distance} centimeters to ${scaleLine.textContent.trim()}`;\n        output = output.replace(/(\\d+)\\s*m\\b/g, '$1 meters');\n        output = output.replace(/ km/g, ' kilometers');\n      } else {\n        let distance = parseFloat(\n          this._pixelsToDistance(\n            this._scaleLength(scaleLine),\n            'imperial'\n          ).toFixed(1)\n        );\n        output = `${distance} inches to ${scaleLine.textContent.trim()}`;\n        output = output.replace(/ft/g, 'feet');\n        output = output.replace(/mi/g, 'miles');\n      }\n\n      this._container.setAttribute('aria-label', output);\n      this._map._container.querySelector(\n        '.mapml-screen-reader-output-scale'\n      ).textContent = output;\n    }\n  });\n  var scaleBar = function (options) {\n    return new ScaleBar(options);\n  };\n\n  var FullscreenButton = L.Control.extend({\n    options: {\n      position: 'topleft',\n      title: {\n        false: 'View Fullscreen',\n        true: 'Exit Fullscreen'\n      }\n    },\n\n    onAdd: function (map) {\n      var container = L.DomUtil.create(\n        'div',\n        'leaflet-control-fullscreen leaflet-bar leaflet-control'\n      );\n\n      this.link = L.DomUtil.create(\n        'a',\n        'leaflet-control-fullscreen-button leaflet-bar-part',\n        container\n      );\n      this.link.href = '#';\n      this.link.setAttribute('role', 'button');\n\n      this._map = map;\n      this._map.on('fullscreenchange', this._toggleTitle, this);\n      this._toggleTitle();\n\n      L.DomEvent.on(this.link, 'click', this._click, this);\n\n      return container;\n    },\n\n    onRemove: function (map) {\n      map.off('fullscreenchange', this._toggleTitle, this);\n    },\n\n    _click: function (e) {\n      L.DomEvent.stopPropagation(e);\n      L.DomEvent.preventDefault(e);\n      this._map.toggleFullscreen(this.options);\n    },\n\n    _toggleTitle: function () {\n      this.link.title = this.options.title[this._map.isFullscreen()];\n    }\n  });\n\n  L.Map.include({\n    isFullscreen: function () {\n      return this._isFullscreen || false;\n    },\n\n    toggleFullscreen: function (options) {\n      // the <map> element can't contain a shadow root, so we used a child <div>\n      // <mapml-viewer> can contain a shadow root, so return it directly\n      var mapEl = this.getContainer().getRootNode().host,\n        container = mapEl.nodeName === 'DIV' ? mapEl.parentElement : mapEl;\n      if (this.isFullscreen()) {\n        if (options && options.pseudoFullscreen) {\n          this._disablePseudoFullscreen(container);\n        } else if (document.exitFullscreen) {\n          document.exitFullscreen();\n        } else if (document.mozCancelFullScreen) {\n          document.mozCancelFullScreen();\n        } else if (document.webkitCancelFullScreen) {\n          document.webkitCancelFullScreen();\n        } else if (document.msExitFullscreen) {\n          document.msExitFullscreen();\n        } else {\n          this._disablePseudoFullscreen(container);\n        }\n      } else {\n        if (options && options.pseudoFullscreen) {\n          this._enablePseudoFullscreen(container);\n        } else if (container.requestFullscreen) {\n          container.requestFullscreen();\n        } else if (container.mozRequestFullScreen) {\n          container.mozRequestFullScreen();\n        } else if (container.webkitRequestFullscreen) {\n          container.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n        } else if (container.msRequestFullscreen) {\n          container.msRequestFullscreen();\n        } else {\n          this._enablePseudoFullscreen(container);\n        }\n      }\n      this.getContainer().focus();\n    },\n\n    _enablePseudoFullscreen: function (container) {\n      L.DomUtil.addClass(container, 'leaflet-pseudo-fullscreen');\n      this._setFullscreen(true);\n      this.fire('fullscreenchange');\n    },\n\n    _disablePseudoFullscreen: function (container) {\n      L.DomUtil.removeClass(container, 'leaflet-pseudo-fullscreen');\n      this._setFullscreen(false);\n      this.fire('fullscreenchange');\n    },\n\n    _setFullscreen: function (fullscreen) {\n      this._isFullscreen = fullscreen;\n      var container = this.getContainer().getRootNode().host;\n      if (fullscreen) {\n        L.DomUtil.addClass(container, 'mapml-fullscreen-on');\n      } else {\n        L.DomUtil.removeClass(container, 'mapml-fullscreen-on');\n      }\n      this.invalidateSize();\n    },\n\n    _onFullscreenChange: function (e) {\n      var fullscreenElement =\n          document.fullscreenElement ||\n          document.mozFullScreenElement ||\n          document.webkitFullscreenElement ||\n          document.msFullscreenElement,\n        mapEl = this.getContainer().getRootNode().host,\n        container = mapEl.nodeName === 'DIV' ? mapEl.parentElement : mapEl;\n\n      if (fullscreenElement === container && !this._isFullscreen) {\n        this._setFullscreen(true);\n        this.fire('fullscreenchange');\n      } else if (fullscreenElement !== container && this._isFullscreen) {\n        this._setFullscreen(false);\n        this.fire('fullscreenchange');\n      }\n    }\n  });\n\n  L.Map.mergeOptions({\n    fullscreenControl: false\n  });\n\n  L.Map.addInitHook(function () {\n    if (this.options.fullscreenControl) {\n      this.fullscreenControl = new FullscreenButton(\n        this.options.fullscreenControl\n      );\n      this.addControl(this.fullscreenControl);\n    }\n\n    var fullscreenchange;\n\n    if ('onfullscreenchange' in document) {\n      fullscreenchange = 'fullscreenchange';\n    } else if ('onmozfullscreenchange' in document) {\n      fullscreenchange = 'mozfullscreenchange';\n    } else if ('onwebkitfullscreenchange' in document) {\n      fullscreenchange = 'webkitfullscreenchange';\n    } else if ('onmsfullscreenchange' in document) {\n      fullscreenchange = 'MSFullscreenChange';\n    }\n\n    if (fullscreenchange) {\n      var onFullscreenChange = L.bind(this._onFullscreenChange, this);\n\n      this.whenReady(function () {\n        L.DomEvent.on(document, fullscreenchange, onFullscreenChange);\n      });\n\n      this.on('unload', function () {\n        L.DomEvent.off(document, fullscreenchange, onFullscreenChange);\n      });\n    }\n  });\n\n  var fullscreenButton = function (options) {\n    return new FullscreenButton(options);\n  };\n\n  var GeolocationButton = L.Control.extend({\n    options: {\n      position: 'bottomright'\n    },\n\n    onAdd: function (map) {\n      // customize locate control to focus map after start/stop, so that\n      // featureIndexOverlay is correctly displayed\n      L.Control.CustomLocate = L.Control.Locate.extend({\n        start: function () {\n          L.Control.Locate.prototype.start.call(this);\n          map.getContainer().focus();\n        },\n        stop: function () {\n          L.Control.Locate.prototype.stop.call(this);\n          map.getContainer().focus();\n        }\n      });\n      this.locateControl = new L.Control.CustomLocate({\n        showPopup: false,\n        strings: {\n          title: M.options.locale.btnLocTrackOff\n        },\n        position: this.options.position,\n        locateOptions: {\n          maxZoom: 16\n        }\n      }).addTo(map);\n\n      var container = this.locateControl._container;\n      var button = this.locateControl;\n      var observer = new MutationObserver(function (mutations) {\n        if (\n          container.classList.contains('active') &&\n          container.classList.contains('following')\n        ) {\n          container.firstChild.title = M.options.locale.btnLocTrackOn;\n          button._marker.bindTooltip(M.options.locale.btnMyLocTrackOn, {\n            permanent: true\n          });\n        } else if (container.classList.contains('active')) {\n          container.firstChild.title = M.options.locale.btnLocTrackLastKnown;\n          button._marker.bindTooltip(M.options.locale.btnMyLastKnownLocTrackOn);\n        } else {\n          container.firstChild.title = M.options.locale.btnLocTrackOff;\n        }\n      });\n      var observerConfig = { attributes: true, attributeFilter: ['class'] };\n      observer.observe(container, observerConfig);\n\n      return container;\n    },\n\n    stop: function () {\n      return this.locateControl.stop();\n    }\n  });\n\n  var geolocationButton = function (options) {\n    return new GeolocationButton(options);\n  };\n\n  var Crosshair = L.Layer.extend({\n    onAdd: function (map) {\n      // SVG crosshair design from https://github.com/xguaita/Leaflet.MapCenterCoord/blob/master/src/icons/MapCenterCoordIcon1.svg?short_path=81a5c76\n      // Optimized with SVGOMG: https://jakearchibald.github.io/svgomg/\n      let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><g stroke=\"#fff\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"50.028\" cy=\"50.219\" r=\"3.923\" stroke-width=\"2\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M4.973 54.424h31.768a4.204 4.204 0 1 0 0-8.409H4.973A4.203 4.203 0 0 0 .77 50.22a4.203 4.203 0 0 0 4.204 4.205z\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M54.232 5.165a4.204 4.204 0 1 0-8.408 0v31.767a4.204 4.204 0 1 0 8.408 0V5.165z\"/><path stroke-width=\"3\" d=\"M99.288 50.22a4.204 4.204 0 0 0-4.204-4.205H63.317a4.204 4.204 0 1 0 0 8.409h31.767a4.205 4.205 0 0 0 4.204-4.205zM45.823 95.274a4.204 4.204 0 1 0 8.409 0V63.506a4.204 4.204 0 1 0-8.409 0v31.768z\" color=\"currentColor\" overflow=\"visible\"/></g></svg>`;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-crosshair',\n        map._container\n      );\n      this._container.innerHTML = svgInnerHTML;\n      map.isFocused = false;\n      this._isQueryable = false;\n\n      map.on(\n        'layerchange layeradd layerremove overlayremove',\n        this._toggleEvents,\n        this\n      );\n      map.on('popupopen', this._isMapFocused, this);\n      L.DomEvent.on(\n        map._container,\n        'keydown keyup mousedown',\n        this._isMapFocused,\n        this\n      );\n\n      this._addOrRemoveCrosshair();\n    },\n\n    onRemove: function (map) {\n      map.off(\n        'layerchange layeradd layerremove overlayremove',\n        this._toggleEvents\n      );\n      map.off('popupopen', this._isMapFocused);\n      L.DomEvent.off(\n        map._container,\n        'keydown keyup mousedown',\n        this._isMapFocused\n      );\n    },\n\n    _toggleEvents: function () {\n      if (this._hasQueryableLayer()) {\n        this._map.on('viewreset move moveend', this._addOrRemoveCrosshair, this);\n      } else {\n        this._map.off('viewreset move moveend', this._addOrRemoveCrosshair, this);\n      }\n      this._addOrRemoveCrosshair();\n    },\n\n    _addOrRemoveCrosshair: function (e) {\n      if (this._hasQueryableLayer()) {\n        this._container.removeAttribute('hidden');\n      } else {\n        this._container.setAttribute('hidden', '');\n      }\n    },\n\n    _addOrRemoveMapOutline: function (e) {\n      let mapContainer = this._map._container;\n      if (this._map.isFocused && !this._outline) {\n        this._outline = L.DomUtil.create('div', 'mapml-outline', mapContainer);\n      } else if (!this._map.isFocused && this._outline) {\n        L.DomUtil.remove(this._outline);\n        delete this._outline;\n      }\n    },\n\n    _hasQueryableLayer: function () {\n      let layers = this._map.options.mapEl.layers;\n      if (this._map.isFocused) {\n        for (let layer of layers) {\n          if (layer.checked && layer._layer.queryable) {\n            return true;\n          }\n        }\n      }\n      return false;\n    },\n\n    // TODO: should be merged with the 'mapfocused' event emitted by mapml-viewer and map, not trivial\n    _isMapFocused: function (e) {\n      //set this._map.isFocused = true if arrow buttons are used\n      if (!this._map._container.parentNode.activeElement) {\n        this._map.isFocused = false;\n        return;\n      }\n      let isLeafletContainer =\n        this._map._container.parentNode.activeElement.classList.contains(\n          'leaflet-container'\n        );\n      if (\n        isLeafletContainer &&\n        ['keydown'].includes(e.type) &&\n        e.shiftKey &&\n        e.keyCode === 9\n      ) {\n        this._map.isFocused = false;\n      } else\n        this._map.isFocused =\n          isLeafletContainer && ['keyup', 'keydown'].includes(e.type);\n\n      if (this._map.isFocused) this._map.fire('mapkeyboardfocused');\n      this._addOrRemoveMapOutline();\n      this._addOrRemoveCrosshair();\n    }\n  });\n\n  var crosshair = function (options) {\n    return new Crosshair(options);\n  };\n\n  /**\n   * M.Path is a extension of L.Path that understands mapml feature markup\n   * It converts the markup to the following structure (abstract enough to encompass all feature types) for example:\n   *  this._outlinePath = HTMLElement;\n   *  this._parts = [\n   *    {\n   *      path: HTMLElement,\n   *      rings:[\n   *        {points:[{x:1,y:1}, ...]},\n   *        ...\n   *      ],\n   *      subrings:[\n   *        {points:[{x:2, y:2}, ...], cls:\"Span Class Name\", path: HTMLElement,},\n   *        ...\n   *      ],\n   *      cls:\"className\",\n   *    },\n   *    ...\n   *  ];\n   */\n  var Path = L.Path.extend({\n    /**\n     * Initializes the M.Path\n     * @param {HTMLElement} markup - The markup representation of the feature\n     * @param {Object} options - The options of the feature\n     */\n    initialize: function (markup, options) {\n      this.type = markup.tagName.toUpperCase();\n\n      if (this.type === 'MAP-POINT' || this.type === 'MAP-MULTIPOINT')\n        options.fillOpacity = 1;\n\n      if (options.wrappers.length > 0)\n        options = Object.assign(this._convertWrappers(options.wrappers), options);\n      L.setOptions(this, options);\n\n      this.group = this.options.group;\n      this.options.interactive =\n        this.options.link ||\n        (this.options.properties && this.options.onEachFeature);\n\n      this._parts = [];\n      this._markup = markup;\n      this.options.zoom = markup.getAttribute('zoom') || this.options.nativeZoom;\n\n      this._convertMarkup();\n\n      if (markup.querySelector('map-span') || markup.querySelector('map-a')) {\n        this._generateOutlinePoints();\n      }\n\n      this.isClosed = this._isClosed();\n    },\n\n    /**\n     * Attaches link handler to the sub parts' paths\n     * @param {SVGElement} elem - The element to add listeners to, either path or g elements\n     * @param {Object} link - The link object that contains the url, type and target data\n     * @param leafletLayer\n     */\n    attachLinkHandler: function (elem, link, leafletLayer) {\n      let dragStart,\n        container = document.createElement('div'),\n        p = document.createElement('p'),\n        hovered = false;\n      container.classList.add('mapml-link-preview');\n      container.appendChild(p);\n      elem.classList.add('map-a');\n      if (link.visited) elem.classList.add('map-a-visited');\n      elem.mousedown = (e) => (dragStart = { x: e.clientX, y: e.clientY });\n      L.DomEvent.on(elem, 'mousedown', elem.mousedown, this);\n      elem.mouseup = (e) => {\n        if (e.button !== 0) return; // don't trigger when button isn't left click\n        let onTop = true,\n          nextLayer = this.options._leafletLayer._layerEl.nextElementSibling;\n        while (nextLayer && onTop) {\n          if (nextLayer.tagName && nextLayer.tagName.toUpperCase() === 'LAYER-')\n            onTop = !(\n              nextLayer.checked &&\n              nextLayer._layer &&\n              nextLayer._layer.queryable\n            );\n          nextLayer = nextLayer.nextElementSibling;\n        }\n        if (onTop && dragStart) {\n          //M._handleLink gets called twice, once in the target phase on the path\n          //element, then in the bubble phase on the g element\n          //Using stopPropagation leaves the mouse in the mousedown state\n          if (e.eventPhase === Event.BUBBLING_PHASE) return;\n          let dist = Math.sqrt(\n            Math.pow(dragStart.x - e.clientX, 2) +\n              Math.pow(dragStart.y - e.clientY, 2)\n          );\n          if (dist <= 5) {\n            link.visited = true;\n            elem.setAttribute('stroke', '#6c00a2');\n            elem.classList.add('map-a-visited');\n            M._handleLink(link, leafletLayer);\n          }\n        }\n      };\n      L.DomEvent.on(elem, 'mouseup', elem.mouseup, this);\n      L.DomEvent.on(\n        elem,\n        'keypress',\n        (e) => {\n          L.DomEvent.stop(e);\n          if (e.keyCode === 13 || e.keyCode === 32) {\n            link.visited = true;\n            elem.setAttribute('stroke', '#6c00a2');\n            elem.classList.add('map-a-visited');\n            M._handleLink(link, leafletLayer);\n          }\n        },\n        this\n      );\n      L.DomEvent.on(\n        elem,\n        'mouseenter keyup',\n        (e) => {\n          if (e.target !== e.currentTarget) return;\n          hovered = true;\n          let resolver = document.createElement('a'),\n            mapWidth = this._map.getContainer().clientWidth;\n          resolver.href = link.url;\n          p.innerHTML = resolver.href;\n\n          this._map.getContainer().appendChild(container);\n\n          while (p.clientWidth > mapWidth / 2) {\n            p.innerHTML =\n              p.innerHTML.substring(0, p.innerHTML.length - 5) + '...';\n          }\n          setTimeout(() => {\n            if (hovered) p.innerHTML = resolver.href;\n          }, 1000);\n        },\n        this\n      );\n      L.DomEvent.on(\n        elem,\n        'mouseout keydown mousedown',\n        (e) => {\n          if (e.target !== e.currentTarget || !container.parentElement) return;\n          hovered = false;\n          this._map.getContainer().removeChild(container);\n        },\n        this\n      );\n      leafletLayer.on('add', addMouseHandler, leafletLayer);\n      function handleMouse(e) {\n        //adds a lot of event handlers\n        if (!container.parentElement) return;\n        hovered = false;\n        this._map.getContainer().removeChild(container);\n      }\n      function addMouseHandler() {\n        L.DomEvent.on(\n          this._map.getContainer(),\n          'mouseout mouseenter click',\n          handleMouse,\n          this\n        );\n      }\n      leafletLayer.on('remove', removeMouseHandler, leafletLayer);\n      function removeMouseHandler() {\n        L.DomEvent.off(this._map.getContainer(), {\n          mouseout: handleMouse,\n          mouseenter: handleMouse,\n          click: handleMouse\n        });\n      }\n    },\n\n    /**\n     * Updates internal structure of the feature to the new map state, the structure can be found in this._parts\n     * @param {L.Map} addedMap - The map that the feature is part of, can be left blank in the case of static features\n     * @param {L.Point} tileOrigin - The tile origin for the feature, if blank then it takes the maps pixel origin in the function\n     * @param {int} zoomingTo - The zoom the map is animating to, if left blank then it takes the map zoom, its provided because in templated tiles zoom is delayed\n     * @private\n     */\n    _project: function (addedMap, tileOrigin = undefined, zoomingTo = undefined) {\n      let map = addedMap || this._map,\n        origin = tileOrigin || map.getPixelOrigin(),\n        zoom = zoomingTo === undefined ? map.getZoom() : zoomingTo;\n      for (let p of this._parts) {\n        p.pixelRings = this._convertRing(p.rings, map, origin, zoom);\n        for (let subP of p.subrings) {\n          subP.pixelSubrings = this._convertRing([subP], map, origin, zoom);\n        }\n      }\n      if (!this._outline) return;\n      this.pixelOutline = [];\n      for (let o of this._outline) {\n        this.pixelOutline = this.pixelOutline.concat(\n          this._convertRing(o, map, origin, zoom)\n        );\n      }\n    },\n\n    /**\n     * Converts the PCRS points to pixel points that can be used to create the SVG\n     * @param {L.Point[][]} r - Is the rings of a feature, either the mainParts, subParts or outline\n     * @param {L.Map} map - The map that the feature is part of\n     * @param {L.Point} origin - The origin used to calculate the pixel points\n     * @param {int} zoom - The current zoom level of the map\n     * @returns {L.Point[][]}\n     * @private\n     */\n    _convertRing: function (r, map, origin, zoom) {\n      // TODO: Implement Ramer-Douglas-Peucer Algo for simplifying points\n      let scale = map.options.crs.scale(zoom),\n        parts = [];\n      for (let sub of r) {\n        let interm = [];\n        for (let p of sub.points) {\n          let conv = map.options.crs.transformation.transform(p, scale);\n          interm.push(L.point(conv.x, conv.y)._subtract(origin).round());\n        }\n        parts.push(interm);\n      }\n      return parts;\n    },\n\n    /**\n     * Updates the features\n     * @private\n     */\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updateFeature(this);\n    },\n\n    /**\n     * Converts the map-spans, a and divs around a geometry subtype into options for the feature\n     * @param {HTMLElement[]} elems - The current zoom level of the map\n     * @private\n     */\n    _convertWrappers: function (elems) {\n      if (!elems || elems.length === 0) return;\n      let classList = '',\n        output = {};\n      for (let elem of elems) {\n        if (elem.tagName.toUpperCase() !== 'MAP-A' && elem.className) {\n          classList += `${elem.className} `;\n        } else if (!output.link && elem.getAttribute('href')) {\n          let link = {};\n          link.url = elem.getAttribute('href');\n          if (elem.hasAttribute('target'))\n            link.target = elem.getAttribute('target');\n          if (elem.hasAttribute('type')) link.type = elem.getAttribute('type');\n          if (elem.hasAttribute('inplace')) link.inPlace = true;\n          output.link = link;\n        }\n      }\n      output.className = `${classList} ${this.options.className}`.trim();\n      return output;\n    },\n\n    /**\n     * Converts this._markup to the internal structure of features\n     * @private\n     */\n    _convertMarkup: function () {\n      if (!this._markup) return;\n\n      let attr = this._markup.attributes;\n      this.featureAttributes = {};\n      if (\n        this.options.link &&\n        this._markup.parentElement.tagName.toUpperCase() === 'MAP-A' &&\n        this._markup.parentElement.parentElement.tagName.toUpperCase() !==\n          'MAP-GEOMETRY'\n      )\n        this.featureAttributes.tabindex = '0';\n      for (let i = 0; i < attr.length; i++) {\n        this.featureAttributes[attr[i].name] = attr[i].value;\n      }\n\n      let first = true;\n      for (let c of this._markup.querySelectorAll('map-coordinates')) {\n        //loops through the coordinates of the child\n        let ring = [],\n          subRings = [];\n        this._coordinateToArrays(c, ring, subRings, this.options.className); //creates an array of pcrs points for the main ring and the subparts\n        if (!first && this.type === 'MAP-POLYGON') {\n          this._parts[0].rings.push(ring[0]);\n          if (subRings.length > 0)\n            this._parts[0].subrings = this._parts[0].subrings.concat(subRings);\n        } else if (this.type === 'MAP-MULTIPOINT') {\n          for (let point of ring[0].points.concat(subRings)) {\n            this._parts.push({\n              rings: [{ points: [point] }],\n              subrings: [],\n              cls: `${point.cls || ''} ${this.options.className || ''}`.trim()\n            });\n          }\n        } else {\n          this._parts.push({\n            rings: ring,\n            subrings: subRings,\n            cls: `${this.featureAttributes.class || ''} ${\n            this.options.className || ''\n          }`.trim()\n          });\n        }\n        first = false;\n      }\n    },\n\n    /**\n     * Generates the feature outline, subtracting the map-spans to generate those separately\n     * @private\n     */\n    _generateOutlinePoints: function () {\n      if (\n        this.type === 'MAP-MULTIPOINT' ||\n        this.type === 'MAP-POINT' ||\n        this.type === 'MAP-LINESTRING' ||\n        this.type === 'MAP-MULTILINESTRING'\n      )\n        return;\n\n      this._outline = [];\n      for (let coords of this._markup.querySelectorAll('map-coordinates')) {\n        let nodes = coords.childNodes,\n          cur = 0,\n          tempDiv = document.createElement('div'),\n          nodeLength = nodes.length;\n        for (let i = 0; i < nodes.length; i++) {\n          if (nodes[i].textContent.trim().length === 0) {\n            nodes[i].remove();\n          }\n        }\n        for (let n of nodes) {\n          let line = [];\n          if (!n.tagName) {\n            //no tagName means it's text content\n            let c = '',\n              ind = (((cur - 1) % nodes.length) + nodes.length) % nodes.length; // this equation turns Javascript's % to how it behaves in C for example\n            if (nodes[ind].tagName) {\n              let prev = nodes[ind].textContent.trim().split(/\\s+/);\n              c += `${prev[prev.length - 2]} ${prev[prev.length - 1]} `;\n            }\n            c += n.textContent;\n            ind = (((cur + 1) % nodes.length) + nodes.length) % nodes.length; // this is equivalent to C/C++'s (cur + 1) % nodes.length\n            if (nodes[ind].tagName) {\n              let next = nodes[ind].textContent.trim().split(/\\s+/);\n              c += `${next[0]} ${next[1]} `;\n            }\n            tempDiv.innerHTML = c;\n            this._coordinateToArrays(\n              tempDiv,\n              line,\n              [],\n              true,\n              this.featureAttributes.class || this.options.className\n            );\n            this._outline.push(line);\n          }\n          cur++;\n        }\n      }\n    },\n\n    /**\n     * Converts map-coordinates element to an object representing the parts and subParts\n     * @param {HTMLElement} coords - A single map-coordinates element\n     * @param {Object[]} main - An empty array representing the main parts\n     * @param {Object[]} subParts - An empty array representing the sub parts\n     * @param {boolean} isFirst - A true | false representing if the current HTML element is the parent map-coordinates element or not\n     * @param {string} cls - The class of the coordinate/span\n     * @param parents\n     * @private\n     */\n    _coordinateToArrays: function (\n      coords,\n      main,\n      subParts,\n      isFirst = true,\n      cls = undefined,\n      parents = []\n    ) {\n      for (let span of coords.children) {\n        this._coordinateToArrays(\n          span,\n          main,\n          subParts,\n          false,\n          span.getAttribute('class'),\n          parents.concat([span])\n        );\n      }\n      let noSpan = coords.textContent.replace(/(<([^>]+)>)/gi, ''),\n        pairs = noSpan.match(/(\\S+\\s+\\S+)/gim),\n        local = [],\n        bounds;\n      for (let p of pairs) {\n        let numPair = [];\n        p.split(/\\s+/gim).forEach(M._parseNumber, numPair);\n        let point = M.pointToPCRSPoint(\n          L.point(numPair),\n          this.options.zoom,\n          this.options.projection,\n          this.options.nativeCS\n        );\n        local.push(point);\n        bounds = bounds ? bounds.extend(point) : L.bounds(point, point);\n      }\n      if (this._bounds) {\n        this._bounds.extend(bounds.min);\n        this._bounds.extend(bounds.max);\n      } else {\n        this._bounds = bounds;\n      }\n      if (isFirst) {\n        main.push({ points: local });\n      } else {\n        let attrMap = {},\n          attr = coords.attributes,\n          wrapperAttr = this._convertWrappers(parents);\n        if (wrapperAttr.link) attrMap.tabindex = '0';\n        for (let i = 0; i < attr.length; i++) {\n          if (attr[i].name === 'class') continue;\n          attrMap[attr[i].name] = attr[i].value;\n        }\n        subParts.unshift({\n          points: local,\n          center: bounds.getCenter(),\n          cls: `${cls || ''} ${wrapperAttr.className || ''}`.trim(),\n          attr: attrMap,\n          link: wrapperAttr.link,\n          linkTarget: wrapperAttr.linkTarget,\n          linkType: wrapperAttr.linkType\n        });\n      }\n    },\n\n    /**\n     * Returns if the feature is closed or open, useful when styling\n     * @returns {boolean}\n     * @private\n     */\n    _isClosed: function () {\n      switch (this.type) {\n        case 'MAP-POLYGON':\n        case 'MAP-MULTIPOLYGON':\n        case 'MAP-POINT':\n        case 'MAP-MULTIPOINT':\n          return true;\n        case 'MAP-LINESTRING':\n        case 'MAP-MULTILINESTRING':\n          return false;\n        default:\n          return false;\n      }\n    },\n\n    /**\n     * Returns the center of the entire feature\n     * @returns {L.Point}\n     */\n    getCenter: function () {\n      if (!this._bounds) return null;\n      return this._map.options.crs.unproject(this._bounds.getCenter());\n    },\n\n    getPCRSCenter: function () {\n      return this._bounds.getCenter();\n    }\n  });\n\n  /**\n   *\n   * @param {HTMLElement} markup - The markup of the feature\n   * @param {Object} options - Options of the feature\n   * @returns {M.Path}\n   */\n  var path = function (markup, options) {\n    return new Path(markup, options);\n  };\n\n  /**\n   * Returns a new Feature Renderer\n   * @param {Object} options - Options for the renderer\n   * @returns {*}\n   */\n  var FeatureRenderer = L.SVG.extend({\n    /**\n     * Override method of same name from L.SVG, use the this._container property\n     * to set up the role=\"none presentation\" on featureGroupu container,\n     * per this recommendation:\n     * https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/471#issuecomment-845192246\n     * @private overrides ancestor method so that we have a _container to work with\n     */\n    _initContainer: function () {\n      // call the method we're overriding, per https://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n      // note you have to pass 'this' as the first arg\n      L.SVG.prototype._initContainer.call(this);\n      // knowing that the previous method call creates the this._container, we\n      // access it and set the role=\"none presetation\" which suppresses the\n      // announcement of \"Graphic\" on each feature focus.\n      this._container.setAttribute('role', 'none presentation');\n    },\n\n    /**\n     * Creates all the appropriate path elements for a M.Path\n     * @param {M.Path} layer - The M.Path that needs paths generated\n     * @param {boolean} stampLayer - Whether or not a layer should be stamped and stored in the renderer layers\n     * @private\n     */\n    _initPath: function (layer, stampLayer = true) {\n      if (layer._outline) {\n        let outlinePath = L.SVG.create('path');\n        if (layer.options.className)\n          L.DomUtil.addClass(\n            outlinePath,\n            layer.featureAttributes.class || layer.options.className\n          );\n        L.DomUtil.addClass(outlinePath, 'mapml-feature-outline');\n        outlinePath.style.fill = 'none';\n        layer.outlinePath = outlinePath;\n      }\n\n      //creates the main parts and sub parts paths\n      for (let p of layer._parts) {\n        if (p.rings) {\n          this._createPath(\n            p,\n            layer.options.className,\n            layer.featureAttributes['aria-label'],\n            layer.options.interactive,\n            layer.featureAttributes\n          );\n          if (layer.outlinePath) p.path.style.stroke = 'none';\n        }\n        if (p.subrings) {\n          for (let r of p.subrings) {\n            this._createPath(\n              r,\n              layer.options.className,\n              r.attr['aria-label'],\n              r.link !== undefined,\n              r.attr\n            );\n          }\n        }\n        this._updateStyle(layer);\n      }\n      if (stampLayer) {\n        let stamp = L.stamp(layer);\n        this._layers[stamp] = layer;\n      }\n    },\n\n    /**\n     * Creates paths for either mainParts, subParts or outline of a feature\n     * @param {Object} ring - The ring the current path is being generated for\n     * @param {string} title - The accessible aria-label of a path\n     * @param {string} cls - The class of the path\n     * @param {boolean} interactive - The boolean representing whether a feature is interactive or not\n     * @param {Object} attr - Attributes map\n     * @private\n     */\n    _createPath: function (\n      ring,\n      cls,\n      title,\n      interactive = false,\n      attr = undefined\n    ) {\n      let p = L.SVG.create('path');\n      ring.path = p;\n      if (!attr) {\n        if (title) p.setAttribute('aria-label', title);\n      } else {\n        for (let [name, value] of Object.entries(attr)) {\n          if (name === 'id' || name === 'tabindex') continue;\n          p.setAttribute(name, value);\n        }\n      }\n      if (ring.cls || cls) {\n        L.DomUtil.addClass(p, ring.cls || cls);\n      }\n      if (interactive) {\n        L.DomUtil.addClass(p, 'leaflet-interactive');\n      }\n    },\n\n    /**\n     * Adds all the paths needed for a feature\n     * @param {M.Path} layer - The feature that needs it's paths added\n     * @param {HTMLElement} container - The location the paths need to be added to\n     * @param {boolean} interactive - Whether a feature is interactive or not\n     * @private\n     */\n    _addPath: function (layer, container = undefined, interactive = true) {\n      if (!this._rootGroup && !container) {\n        this._initContainer();\n      }\n      let c = container || this._rootGroup,\n        outlineAdded = false;\n      if (interactive) {\n        layer.addInteractiveTarget(layer.group);\n      }\n      for (let p of layer._parts) {\n        if (p.path) layer.group.appendChild(p.path);\n        if (interactive) {\n          if (layer.options.link)\n            layer.attachLinkHandler(\n              p.path,\n              layer.options.link,\n              layer.options._leafletLayer\n            );\n          layer.addInteractiveTarget(p.path);\n        }\n\n        if (!outlineAdded && layer.pixelOutline) {\n          layer.group.appendChild(layer.outlinePath);\n          outlineAdded = true;\n        }\n\n        for (let subP of p.subrings) {\n          if (subP.path) {\n            if (subP.link) {\n              layer.attachLinkHandler(\n                subP.path,\n                subP.link,\n                layer.options._leafletLayer\n              );\n              layer.addInteractiveTarget(subP.path);\n            }\n            layer.group.appendChild(subP.path);\n          }\n        }\n      }\n      c.appendChild(layer.group);\n    },\n\n    /**\n     * Removes all the paths related to a feature\n     * @param {M.Path} layer - The feature who's paths need to be removed\n     * @private\n     */\n    _removePath: function (layer) {\n      for (let p of layer._parts) {\n        if (p.path) {\n          layer.removeInteractiveTarget(p.path);\n          L.DomUtil.remove(p.path);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path) L.DomUtil.remove(subP.path);\n        }\n      }\n      if (layer.outlinePath) L.DomUtil.remove(layer.outlinePath);\n      layer.removeInteractiveTarget(layer.group);\n      L.DomUtil.remove(layer.group);\n      delete this._layers[L.stamp(layer)];\n    },\n\n    /**\n     * Updates the d attribute of all paths of a feature\n     * @param {M.Path} layer - The Feature that needs updating\n     * @private\n     */\n    _updateFeature: function (layer) {\n      if (layer.pixelOutline)\n        this._setPath(\n          layer.outlinePath,\n          this.geometryToPath(layer.pixelOutline, false)\n        );\n      for (let p of layer._parts) {\n        this._setPath(p.path, this.geometryToPath(p.pixelRings, layer.isClosed));\n        for (let subP of p.subrings) {\n          this._setPath(\n            subP.path,\n            this.geometryToPath(subP.pixelSubrings, false)\n          );\n        }\n      }\n    },\n\n    /**\n     * Generates the marker d attribute for a given point\n     * @param {L.Point} p - The point of the marker\n     * @returns {string}\n     * @private\n     */\n    _pointToMarker: function (p) {\n      return `M${p.x} ${p.y} L${p.x - 12.5} ${p.y - 30} C${p.x - 12.5} ${\n      p.y - 50\n    }, ${p.x + 12.5} ${p.y - 50}, ${p.x + 12.5} ${p.y - 30} L${p.x} ${p.y}z`;\n    },\n\n    /**\n     * Updates the styles of all paths of a feature\n     * @param {M.Path} layer - The feature that needs styles updated\n     * @private\n     */\n    _updateStyle: function (layer) {\n      this._updatePathStyle(layer.outlinePath, layer, false, true);\n      for (let p of layer._parts) {\n        if (p.path) {\n          this._updatePathStyle(p.path, layer, true);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path) this._updatePathStyle(subP.path, layer);\n        }\n      }\n    },\n\n    /**\n     * Updates the style of a single path\n     * @param {HTMLElement} path - The path that needs updating\n     * @param {M.Path} layer - The feature layer\n     * @param {boolean} isMain - Whether it's the main parts or not\n     * @param {boolean} isOutline - Whether a path is an outline or not\n     * @private\n     */\n    _updatePathStyle: function (path, layer, isMain = false, isOutline = false) {\n      if (!path || !layer) {\n        return;\n      }\n      let options = layer.options,\n        isClosed = layer.isClosed;\n      if (\n        (options.stroke && (!isClosed || isOutline)) ||\n        (isMain && !layer.outlinePath)\n      ) {\n        path.setAttribute('stroke', options.color);\n        path.setAttribute('stroke-opacity', options.opacity);\n        path.setAttribute('stroke-width', options.weight);\n        path.setAttribute('stroke-linecap', options.lineCap);\n        path.setAttribute('stroke-linejoin', options.lineJoin);\n\n        if (options.dashArray) {\n          path.setAttribute('stroke-dasharray', options.dashArray);\n        } else {\n          path.removeAttribute('stroke-dasharray');\n        }\n\n        if (options.dashOffset) {\n          path.setAttribute('stroke-dashoffset', options.dashOffset);\n        } else {\n          path.removeAttribute('stroke-dashoffset');\n        }\n\n        if (options.link) {\n          path.setAttribute(\n            'stroke',\n            options.link.visited ? '#6c00a2' : '#0000EE'\n          );\n          path.setAttribute('stroke-opacity', '1');\n          path.setAttribute('stroke-width', '1px');\n          path.setAttribute('stroke-dasharray', 'none');\n        }\n      } else {\n        path.setAttribute('stroke', 'none');\n      }\n\n      if (isClosed && !isOutline) {\n        if (!options.fill) {\n          path.setAttribute('fill', options.fillColor || options.color);\n          path.setAttribute('fill-opacity', options.fillOpacity);\n          path.setAttribute('fill-rule', options.fillRule || 'evenodd');\n        } else {\n          path.setAttribute('fill', options.color);\n        }\n      } else {\n        path.setAttribute('fill', 'none');\n      }\n    },\n\n    /**\n     * Sets the d attribute of a path\n     * @param {HTMLElement} path - The path that is being updated\n     * @param {string} def - The new d attribute of the path\n     * @private\n     */\n    _setPath: function (path, def) {\n      path.setAttribute('d', def);\n    },\n\n    /**\n     * Generates the d string of a feature part\n     * @param {L.Point[]} rings - The points making up a given part of a feature\n     * @param {boolean} closed - Whether a feature is closed or not\n     * @returns {string}\n     */\n    geometryToPath: function (rings, closed) {\n      let str = '',\n        i,\n        j,\n        len,\n        len2,\n        points,\n        p;\n\n      for (i = 0, len = rings.length; i < len; i++) {\n        points = rings[i];\n        if (points.length === 1) {\n          return this._pointToMarker(points[0]);\n        }\n        for (j = 0, len2 = points.length; j < len2; j++) {\n          p = points[j];\n          str += (j ? 'L' : 'M') + p.x + ' ' + p.y;\n        }\n        str += closed ? 'z' : '';\n      }\n      return str || 'M0 0';\n    }\n  });\n\n  /**\n   * Returns new M.FeatureRenderer\n   * @param {Object} options - Options for the renderer\n   * @returns {M.FeatureRenderer}\n   */\n  var featureRenderer = function (options) {\n    return new FeatureRenderer(options);\n  };\n\n  var Geometry = L.FeatureGroup.extend({\n    /**\n     * Initialize the feature group\n     * @param {M.Path[]} layers\n     * @param {Object} options\n     */\n    initialize: function (layers, options) {\n      if (options.wrappers && options.wrappers.length > 0)\n        options = Object.assign(\n          M.Path.prototype._convertWrappers(options.wrappers),\n          options\n        );\n\n      L.LayerGroup.prototype.initialize.call(this, layers, options);\n      this._featureEl = this.options.mapmlFeature;\n\n      let firstLayer = layers[Object.keys(layers)[0]];\n      if (layers.length === 1 && firstLayer.options.link)\n        this.options.link = firstLayer.options.link;\n      if (\n        (this.options.onEachFeature && this.options.properties) ||\n        this.options.link\n      ) {\n        L.DomUtil.addClass(this.options.group, 'leaflet-interactive');\n        if (this.options.link) {\n          M.Path.prototype.attachLinkHandler.call(\n            this,\n            this.options.group,\n            this.options.link,\n            this.options._leafletLayer\n          );\n          this.options.group.setAttribute('role', 'link');\n        } else {\n          this.options.group.setAttribute('aria-expanded', 'false');\n          this.options.group.setAttribute('role', 'button');\n          this.options.onEachFeature(this.options.properties, this);\n          this.off('click', this._openPopup);\n        }\n      }\n\n      L.DomEvent.on(this.options.group, 'keyup keydown', this._handleFocus, this);\n      this.options.group.setAttribute('aria-label', this.options.accessibleTitle);\n      if (this.options.featureID)\n        this.options.group.setAttribute('data-fid', this.options.featureID);\n      for (let feature of layers) {\n        feature._groupLayer = this;\n      }\n    },\n\n    onAdd: function (map) {\n      L.LayerGroup.prototype.onAdd.call(this, map);\n      this.updateInteraction();\n    },\n\n    updateInteraction: function () {\n      let map = this._map || this.options._leafletLayer._map;\n      if (this.options.onEachFeature || this.options.link)\n        map.featureIndex.addToIndex(\n          this,\n          this.getPCRSCenter(),\n          this.options.group\n        );\n\n      for (let layerID in this._layers) {\n        let layer = this._layers[layerID];\n        for (let part of layer._parts) {\n          if (layer.featureAttributes && layer.featureAttributes.tabindex)\n            map.featureIndex.addToIndex(layer, layer.getPCRSCenter(), part.path);\n          for (let subPart of part.subrings) {\n            if (subPart.attr && subPart.attr.tabindex)\n              map.featureIndex.addToIndex(layer, subPart.center, subPart.path);\n          }\n        }\n      }\n    },\n\n    /**\n     * Check whether the feature group should be rendered at current map zoom level\n     * @param {Number} zoom - current map zoom\n     * @param {Object} vectorMinZoom - the minimum zoom bound of vector layer\n     * @param {Object} vectorMinZoom - the maximum zoom bound of vector layer\n     * @returns {Boolean}\n     * @private\n     */\n    _checkRender: function (zoom, vectorMinZoom, vectorMaxZoom) {\n      let minZoom = this._featureEl.getAttribute('min'),\n        maxZoom = this._featureEl.getAttribute('max');\n      // if the current map zoom falls below/above the zoom bounds of the vector layer\n      if (zoom > vectorMaxZoom || zoom < vectorMinZoom) return false;\n      // if no min and max attribute present\n      if (minZoom === null && maxZoom === null) return true;\n      // if the current map zoom falls below/above the [min, max] range\n      if (\n        (minZoom !== null && zoom < +minZoom) ||\n        (maxZoom !== null && zoom > +maxZoom)\n      ) {\n        return false;\n      }\n      return true;\n    },\n\n    /**\n     * Handler for focus events\n     * @param {L.DOMEvent} e - Event that occurred\n     * @private\n     */\n    _handleFocus: function (e) {\n      // tab, shift, cr, esc, up, left, down, right,\n      if (\n        [9, 16, 27, 37, 38, 39, 40].includes(e.keyCode) &&\n        e.type === 'keydown'\n      ) {\n        let index = this._map.featureIndex.currentIndex;\n        // Down/right arrow keys replicate tabbing through the feature index\n        // Up/left arrow keys replicate shift-tabbing through the feature index\n        if (e.keyCode === 37 || e.keyCode === 38) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\n            'tabindex',\n            -1\n          );\n          if (index === 0) {\n            this._map.featureIndex.inBoundFeatures[\n              this._map.featureIndex.inBoundFeatures.length - 1\n            ].path.focus();\n            this._map.featureIndex.currentIndex =\n              this._map.featureIndex.inBoundFeatures.length - 1;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index - 1].path.focus();\n            this._map.featureIndex.currentIndex--;\n          }\n        } else if (e.keyCode === 39 || e.keyCode === 40) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\n            'tabindex',\n            -1\n          );\n          if (index === this._map.featureIndex.inBoundFeatures.length - 1) {\n            this._map.featureIndex.inBoundFeatures[0].path.focus();\n            this._map.featureIndex.currentIndex = 0;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index + 1].path.focus();\n            this._map.featureIndex.currentIndex++;\n          }\n        } else if (e.keyCode === 27) {\n          let shadowRoot = this._map.options.mapEl.shadowRoot\n            ? this._map.options.mapEl.shadowRoot\n            : this._map.options.mapEl.querySelector('.mapml-web-map').shadowRoot;\n          if (shadowRoot.activeElement.nodeName !== 'g') return;\n          this._map._container.focus();\n        } else if (e.keyCode === 9) {\n          let obj = this;\n          setTimeout(function () {\n            obj._map.featureIndex.inBoundFeatures[0].path.setAttribute(\n              'tabindex',\n              0\n            );\n          }, 0);\n        }\n        // tab, shift, cr, esc, right, left, up, down,\n        // 1, 2, 3, 4, 5, 6, 7 (featureIndexOverlay available index items\n        // [8, 9] being allocated to next, previous menu items).\n      } else if (\n        ![9, 16, 13, 27, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55].includes(\n          e.keyCode\n        )\n      ) {\n        this._map.featureIndex.currentIndex = 0;\n        this._map.featureIndex.inBoundFeatures[0].path.focus();\n      }\n\n      // 27 added so that the tooltip opens when dismissing popup with 'esc' key\n      if (e.target.tagName.toUpperCase() !== 'G') return;\n      if (\n        [9, 13, 16, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55, 27].includes(\n          e.keyCode\n        ) &&\n        e.type === 'keyup'\n      ) {\n        this.openTooltip();\n      } else if (e.keyCode === 13 || e.keyCode === 32) {\n        this.closeTooltip();\n        if (!this.options.link && this.options.onEachFeature) {\n          L.DomEvent.stop(e);\n          this.openPopup();\n        }\n      } else {\n        this.closeTooltip();\n      }\n    },\n\n    /**\n     * Add a M.Path to the M.Geometry\n     * @param layer\n     */\n    addLayer: function (layer) {\n      if (!layer.options.link && layer.options.interactive) {\n        this.options.onEachFeature(this.options.properties, layer);\n      }\n      L.FeatureGroup.prototype.addLayer.call(this, layer);\n    },\n\n    /**\n     * Focuses the previous function in the sequence on previous button press\n     * @param e\n     * @private\n     */\n    _previousFeature: function (e) {\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.max(\n        this._map.featureIndex.currentIndex - 1,\n        0\n      );\n      let prevFocus =\n        this._map.featureIndex.inBoundFeatures[\n          this._map.featureIndex.currentIndex\n        ];\n      prevFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    /**\n     * Focuses next feature in sequence\n     * @param e\n     * @private\n     */\n    _nextFeature: function (e) {\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.min(\n        this._map.featureIndex.currentIndex + 1,\n        this._map.featureIndex.inBoundFeatures.length - 1\n      );\n      let nextFocus =\n        this._map.featureIndex.inBoundFeatures[\n          this._map.featureIndex.currentIndex\n        ];\n      nextFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    getPCRSCenter: function () {\n      let bounds;\n      for (let l in this._layers) {\n        let layer = this._layers[l];\n        if (!bounds) {\n          bounds = L.bounds(layer.getPCRSCenter(), layer.getPCRSCenter());\n        } else {\n          bounds.extend(layer.getPCRSCenter());\n        }\n      }\n      return bounds.getCenter();\n    }\n  });\n\n  /**\n   * Returns new M.Geometry\n   * @param {M.Path[]} layers - Layers belonging to feature group\n   * @param {Object} options - Options for the feature group\n   * @returns {M.Geometry}\n   */\n  var geometry = function (layers, options) {\n    return new Geometry(layers, options);\n  };\n\n  var AnnounceMovement = L.Handler.extend({\n    addHooks: function () {\n      this._map.on({\n        layeradd: this.totalBounds,\n        layerremove: this.totalBounds\n      });\n\n      this._map.options.mapEl.addEventListener(\n        'map-moveend',\n        this.announceBounds\n      );\n      this._map.dragging._draggable.addEventListener('dragstart', this.dragged);\n      this._map.options.mapEl.addEventListener(\n        'mapfocused',\n        this.focusAnnouncement\n      );\n    },\n    removeHooks: function () {\n      this._map.off({\n        layeradd: this.totalBounds,\n        layerremove: this.totalBounds\n      });\n\n      this._map.options.mapEl.removeEventListener(\n        'map-moveend',\n        this.announceBounds\n      );\n      this._map.dragging._draggable.removeEventListener(\n        'dragstart',\n        this.dragged\n      );\n      this._map.options.mapEl.removeEventListener(\n        'mapfocused',\n        this.focusAnnouncement\n      );\n    },\n\n    focusAnnouncement: function () {\n      let mapEl = this;\n      setTimeout(function () {\n        let el = mapEl.querySelector('.mapml-web-map')\n          ? mapEl\n              .querySelector('.mapml-web-map')\n              .shadowRoot.querySelector('.leaflet-container')\n          : mapEl.shadowRoot.querySelector('.leaflet-container');\n\n        let mapZoom = mapEl._map.getZoom();\n        let standard = M.options.locale.amZoom + ' ' + mapZoom;\n\n        if (mapZoom === mapEl._map.getMaxZoom()) {\n          standard = M.options.locale.amMaxZoom + ' ' + standard;\n        } else if (mapZoom === mapEl._map._layersMinZoom) {\n          standard = M.options.locale.amMinZoom + ' ' + standard;\n        }\n\n        el.setAttribute('aria-roledescription', 'region ' + standard);\n        setTimeout(function () {\n          el.removeAttribute('aria-roledescription');\n        }, 2000);\n      }, 0);\n    },\n\n    announceBounds: function () {\n      if (this._traversalCall > 0) {\n        return;\n      }\n      let mapZoom = this._map.getZoom();\n      let mapBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        mapZoom,\n        this._map.options.projection\n      );\n\n      let visible = true;\n      if (this._map.totalLayerBounds) {\n        visible =\n          mapZoom <= this._map.getMaxZoom() &&\n          mapZoom >= this._map.getMinZoom() &&\n          this._map.totalLayerBounds.overlaps(mapBounds);\n      }\n\n      let output = this.querySelector('.mapml-web-map')\n        ? this.querySelector('.mapml-web-map').shadowRoot.querySelector(\n            '.mapml-screen-reader-output'\n          )\n        : this.shadowRoot.querySelector('.mapml-screen-reader-output');\n\n      let standard = M.options.locale.amZoom + ' ' + mapZoom;\n\n      if (!visible) {\n        let outOfBoundsPos = this._history[this._historyIndex];\n        let inBoundsPos = this._history[this._historyIndex - 1];\n        this.back();\n        this._history.pop();\n\n        if (outOfBoundsPos.zoom !== inBoundsPos.zoom) {\n          output.innerText = M.options.locale.amZoomedOut;\n        } else if (this._map.dragging._draggable.wasDragged) {\n          output.innerText = M.options.locale.amDraggedOut;\n        } else if (outOfBoundsPos.x > inBoundsPos.x) {\n          output.innerText = M.options.locale.amEastBound;\n        } else if (outOfBoundsPos.x < inBoundsPos.x) {\n          output.innerText = M.options.locale.amWestBound;\n        } else if (outOfBoundsPos.y < inBoundsPos.y) {\n          output.innerText = M.options.locale.amNorthBound;\n        } else if (outOfBoundsPos.y > inBoundsPos.y) {\n          output.innerText = M.options.locale.amSouthBound;\n        }\n      } else {\n        let prevZoom = this._history[this._historyIndex - 1]\n          ? this._history[this._historyIndex - 1].zoom\n          : this._history[this._historyIndex].zoom;\n        if (mapZoom === this._map.getMaxZoom() && mapZoom !== prevZoom) {\n          output.innerText = M.options.locale.amMaxZoom + ' ' + standard;\n        } else if (mapZoom === this._map._layersMinZoom && mapZoom !== prevZoom) {\n          output.innerText = M.options.locale.amMinZoom + ' ' + standard;\n        } else {\n          output.innerText = standard;\n        }\n      }\n      this._map.dragging._draggable.wasDragged = false;\n    },\n\n    totalBounds: function (e) {\n      // don't bother with non-MapMLLayer layers...\n      if (!e.layer._layerEl) return;\n      let map = this.options.mapEl;\n      map.whenLayersReady().then(() => {\n        let layers = map.querySelectorAll('layer-');\n        let bounds;\n        for (let i = 0; i < layers.length; i++) {\n          // the _layer may no longer exist if this is invoked by layerremove\n          if (layers[i]._layer) {\n            let extent = layers[i].extent;\n            if (bounds && extent) {\n              bounds.extend(M.extentToBounds(extent, 'pcrs'));\n            } else if (extent) {\n              bounds = M.extentToBounds(extent, 'pcrs');\n            }\n          }\n        }\n\n        this.totalLayerBounds = bounds;\n      });\n    },\n\n    dragged: function () {\n      this.wasDragged = true;\n    }\n  });\n\n  var FeatureIndex = L.Handler.extend({\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n      this.inBoundFeatures = [];\n      this.outBoundFeatures = [];\n      this.currentIndex = 0;\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        map.getZoom(),\n        map.options.projection\n      );\n    },\n\n    addHooks: function () {\n      this._map.on('mapkeyboardfocused', this._updateMapBounds, this);\n      this._map.on('mapkeyboardfocused', this._sortIndex, this);\n    },\n\n    removeHooks: function () {\n      this._map.off('mapkeyboardfocused', this._updateMapBounds);\n      this._map.off('mapkeyboardfocused', this._sortIndex);\n    },\n\n    /**\n     * Adds a svg element to the index of tabbable features, it also keeps track of the layer it's associated + center\n     * @param layer - the layer object the feature is associated with\n     * @param lc - the layer center\n     * @param path - the svg element that needs to be focused, can be a path or g\n     */\n    addToIndex: function (layer, lc, path) {\n      let mc = this._mapPCRSBounds.getCenter();\n      let dist = Math.sqrt(Math.pow(lc.x - mc.x, 2) + Math.pow(lc.y - mc.y, 2));\n      let index = this._mapPCRSBounds.contains(lc)\n        ? this.inBoundFeatures\n        : this.outBoundFeatures;\n\n      let elem = { path: path, layer: layer, center: lc, dist: dist };\n      path.setAttribute('tabindex', -1);\n\n      index.push(elem);\n\n      // TODO: this insertion loop has potential to be improved slightly\n      for (\n        let i = index.length - 1;\n        i > 0 && index[i].dist < index[i - 1].dist;\n        i--\n      ) {\n        let tmp = index[i];\n        index[i] = index[i - 1];\n        index[i - 1] = tmp;\n      }\n\n      if (this._mapPCRSBounds.contains(lc)) this.inBoundFeatures = index;\n      else this.outBoundFeatures = index;\n    },\n\n    /**\n     * Removes features that are no longer on the map, also moves features to the respective array depending\n     * on whether the feature is in the maps viewport or not\n     */\n    cleanIndex: function () {\n      this.currentIndex = 0;\n      this.inBoundFeatures = this.inBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute('tabindex', -1);\n        if (elem.layer._map && !inbound) {\n          this.outBoundFeatures.push(elem);\n        }\n        return elem.layer._map && inbound;\n      });\n      this.outBoundFeatures = this.outBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute('tabindex', -1);\n        if (elem.layer._map && inbound) {\n          this.inBoundFeatures.push(elem);\n        }\n        return elem.layer._map && !inbound;\n      });\n    },\n\n    /**\n     * Sorts the index of features in the map's viewport based on distance from center\n     * @private\n     */\n    _sortIndex: function () {\n      this.cleanIndex();\n      if (this.inBoundFeatures.length === 0) return;\n\n      let mc = this._mapPCRSBounds.getCenter();\n\n      this.inBoundFeatures.sort(function (a, b) {\n        let ac = a.center;\n        let bc = b.center;\n        a.dist = Math.sqrt(Math.pow(ac.x - mc.x, 2) + Math.pow(ac.y - mc.y, 2));\n        b.dist = Math.sqrt(Math.pow(bc.x - mc.x, 2) + Math.pow(bc.y - mc.y, 2));\n        return a.dist - b.dist;\n      });\n      this.inBoundFeatures[0].path.setAttribute('tabindex', 0);\n    },\n\n    /**\n     * Event handler for 'mapfocused' event to update the map's bounds in terms of PCRS\n     * @param e - the event object\n     * @private\n     */\n    _updateMapBounds: function (e) {\n      // TODO: map's PCRS bounds is used in other parts of the viewer, can be moved out to the map object directly\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        this._map.getZoom(),\n        this._map.options.projection\n      );\n    }\n  });\n\n  var Options = {\n    featureIndexOverlayOption: false,\n    announceMovement: false,\n    announceScale: { metric: true, imperial: false },\n    defaultExtCoor: 'pcrs',\n    defaultLocCoor: 'gcrs',\n    locale: {\n      cmBack: 'Back',\n      cmForward: 'Forward',\n      cmReload: 'Reload',\n      cmToggleControls: 'Toggle Controls',\n      cmCopyCoords: 'Copy',\n      cmCopyMapML: 'Map',\n      cmCopyExtent: 'Extent',\n      cmCopyLocation: 'Location',\n      cmToggleDebug: 'Toggle Debug Mode',\n      cmPasteLayer: 'Paste',\n      cmViewSource: 'View Map Source',\n      lmZoomToLayer: 'Zoom To Layer',\n      lmCopyLayer: 'Copy Layer',\n      lcOpacity: 'Opacity',\n      btnAttribution: 'Map data attribution',\n      btnZoomIn: 'Zoom in',\n      btnZoomOut: 'Zoom out',\n      btnFullScreen: 'View Fullscreen',\n      btnExitFullScreen: 'Exit Fullscreen',\n      btnLocTrackOn: 'Show my location - location tracking on',\n      btnMyLocTrackOn: 'My current location, shown on map',\n      btnLocTrackOff: 'Show my location - location tracking off',\n      btnLocTrackLastKnown: 'Show my location - last known location shown',\n      btnMyLastKnownLocTrackOn: 'My last known location, shown on map',\n      amZoom: 'zoom level',\n      amColumn: 'column',\n      amRow: 'row',\n      amMaxZoom: 'At maximum zoom level, zoom in disabled',\n      amMinZoom: 'At minimum zoom level, zoom out disabled',\n      amZoomedOut: 'Zoomed out of bounds, returning to',\n      amDraggedOut: 'Dragged out of bounds, returning to',\n      amEastBound: 'Reached east bound, panning east disabled',\n      amWestBound: 'Reached west bound, panning west disabled',\n      amNorthBound: 'Reached north bound, panning north disabled',\n      amSouthBound: 'Reached south bound, panning south disabled',\n      kbdShortcuts: 'Keyboard shortcuts',\n      kbdMovement: 'Movement keys',\n      kbdFeature: 'Feature navigation keys',\n      kbdPanUp: 'Pan up',\n      kbdPanDown: 'Pan down',\n      kbdPanLeft: 'Pan left',\n      kbdPanRight: 'Pan right',\n      kbdPanIncrement: 'pan increment',\n      kbdZoom: 'Zoom in/out 3 levels',\n      kbdPrevFeature: 'Previous feature',\n      kbdNextFeature: 'Next feature',\n      dfLayer: 'Layer',\n      dfExtent: 'Sub-layer',\n      popupZoom: 'Zoom to here',\n      dfPastedLayer: 'Pasted layer',\n      fIndexNoFeatures: 'No features found'\n    }\n  };\n\n  L.Map.Keyboard.include({\n    _onKeyDown: function (e) {\n      if (e.altKey || e.metaKey) {\n        return;\n      }\n\n      let zoomIn = {\n        187: 187,\n        107: 107,\n        61: 61,\n        171: 171\n      };\n\n      let zoomOut = {\n        189: 189,\n        109: 109,\n        54: 54,\n        173: 173\n      };\n\n      var key = e.keyCode,\n        map = this._map,\n        offset;\n\n      if (key in this._panKeys) {\n        if (!map._panAnim || !map._panAnim._inProgress) {\n          offset = this._panKeys[key];\n          if (e.shiftKey) {\n            offset = L.point(offset).multiplyBy(3);\n          }\n          if (e.ctrlKey) {\n            offset = L.point(offset).divideBy(5);\n          }\n\n          map.panBy(offset);\n\n          if (map.options.maxBounds) {\n            map.panInsideBounds(map.options.maxBounds);\n          }\n        }\n      } else if (key in this._zoomKeys) {\n        if (\n          (key in zoomIn && map.getMaxZoom() !== map.getZoom()) ||\n          (key in zoomOut && map._layersMinZoom !== map.getZoom())\n        )\n          map.setZoom(map.getZoom() + (e.shiftKey ? 3 : 1) * this._zoomKeys[key]);\n      } else if (\n        key === 27 &&\n        map._popup &&\n        map._popup.options.closeOnEscapeKey\n      ) {\n        map.closePopup();\n      } else {\n        return;\n      }\n\n      L.DomEvent.stop(e);\n    }\n  });\n\n  var FeatureIndexOverlay = L.Layer.extend({\n    onAdd: function (map) {\n      let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><path fill=\"none\" stroke=\"#000\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"3\" d=\"M0 0h100v100H0z\" color=\"#000\" overflow=\"visible\"/></svg>`;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-feature-index-box',\n        map._container\n      );\n      this._container.innerHTML = svgInnerHTML;\n\n      this._output = L.DomUtil.create(\n        'output',\n        'mapml-feature-index',\n        map._container\n      );\n      this._output.setAttribute('role', 'status');\n      this._output.setAttribute('aria-live', 'polite');\n      this._output.setAttribute('aria-atomic', 'true');\n      this._body = L.DomUtil.create(\n        'span',\n        'mapml-feature-index-content',\n        this._output\n      );\n      this._body.index = 0;\n      this._output.initialFocus = false;\n      map.on('focus blur popupclose', this._addOrRemoveFeatureIndex, this);\n      map.on('moveend focus templatedfeatureslayeradd', this._checkOverlap, this);\n      map.on('keydown', this._onKeyDown, this);\n      this._addOrRemoveFeatureIndex();\n    },\n\n    _calculateReticleBounds: function () {\n      let bounds = this._map.getPixelBounds();\n      let center = bounds.getCenter();\n      let wRatio =\n        Math.abs(bounds.min.x - bounds.max.x) / this._map.options.mapEl.width;\n      let hRatio =\n        Math.abs(bounds.min.y - bounds.max.y) / this._map.options.mapEl.height;\n\n      let reticleDimension = getComputedStyle(this._container).width.replace(\n        /[^\\d.]/g,\n        ''\n      );\n      if (getComputedStyle(this._container).width.slice(-1) === '%') {\n        reticleDimension =\n          (reticleDimension * this._map.options.mapEl.width) / 100;\n      }\n      let w = (wRatio * reticleDimension) / 2;\n      let h = (hRatio * reticleDimension) / 2;\n      let minPoint = L.point(center.x - w, center.y + h);\n      let maxPoint = L.point(center.x + w, center.y - h);\n      let b = L.bounds(minPoint, maxPoint);\n      return M.pixelToPCRSBounds(\n        b,\n        this._map.getZoom(),\n        this._map.options.projection\n      );\n    },\n\n    _checkOverlap: function (e) {\n      if (e.type === 'focus') this._output.initialFocus = true;\n      if (!this._output.initialFocus) return;\n      if (this._output.popupClosed) {\n        this._output.popupClosed = false;\n        return;\n      }\n\n      this._map.fire('mapkeyboardfocused');\n\n      let featureIndexBounds = this._calculateReticleBounds();\n      let features = this._map.featureIndex.inBoundFeatures;\n      let index = 1;\n      let keys = Object.keys(features);\n      let body = this._body;\n      let noFeaturesMessage = document.createElement('span');\n      noFeaturesMessage.innerHTML = M.options.locale.fIndexNoFeatures;\n\n      body.innerHTML = '';\n      body.index = 0;\n\n      body.allFeatures = [];\n      keys.forEach((i) => {\n        let layer = features[i].layer;\n        let layers = features[i].layer._layers;\n        let bounds = L.bounds();\n\n        if (layers) {\n          let keys = Object.keys(layers);\n          keys.forEach((j) => {\n            if (!bounds)\n              bounds = L.bounds(\n                layer._layers[j]._bounds.min,\n                layer._layers[j]._bounds.max\n              );\n            bounds.extend(layer._layers[j]._bounds.min);\n            bounds.extend(layer._layers[j]._bounds.max);\n          });\n        } else if (layer._bounds) {\n          bounds = L.bounds(layer._bounds.min, layer._bounds.max);\n        }\n\n        if (featureIndexBounds.overlaps(bounds)) {\n          let label = features[i].path.getAttribute('aria-label');\n\n          if (index < 8) {\n            body.appendChild(this._updateOutput(label, index, index));\n          }\n          if (index % 7 === 0 || index === 1) {\n            body.allFeatures.push([]);\n          }\n          body.allFeatures[Math.floor((index - 1) / 7)].push({\n            label,\n            index,\n            layer\n          });\n          if (body.allFeatures[1] && body.allFeatures[1].length === 1) {\n            body.appendChild(this._updateOutput('More results', 0, 9));\n          }\n          index += 1;\n        }\n      });\n      this._addToggleKeys();\n      if (index === 1) {\n        body.appendChild(noFeaturesMessage);\n      }\n    },\n\n    _updateOutput: function (label, index, key) {\n      let span = document.createElement('span');\n      span.setAttribute('data-index', index);\n      //\", \" adds a brief auditory pause when a screen reader is reading through the feature index\n      //also prevents names with numbers + key from being combined when read\n      span.innerHTML = `<kbd>${key}</kbd>` + ' ' + label + '<span>, </span>';\n      return span;\n    },\n\n    _addToggleKeys: function () {\n      let allFeatures = this._body.allFeatures;\n      for (let i = 0; i < allFeatures.length; i++) {\n        if (allFeatures[i].length === 0) return;\n        if (allFeatures[i - 1]) {\n          let label = 'Previous results';\n          allFeatures[i].push({ label });\n        }\n\n        if (allFeatures[i + 1] && allFeatures[i + 1].length > 0) {\n          let label = 'More results';\n          allFeatures[i].push({ label });\n        }\n      }\n    },\n\n    _onKeyDown: function (e) {\n      let body = this._body;\n      let key = e.originalEvent.keyCode;\n      if (key >= 49 && key <= 55) {\n        if (!body.allFeatures[body.index]) return;\n        let feature = body.allFeatures[body.index][key - 49];\n        if (!feature) return;\n        let layer = feature.layer;\n        if (layer) {\n          this._map.featureIndex.currentIndex = feature.index - 1;\n          if (layer._popup) {\n            this._map.closePopup();\n            layer.openPopup();\n          } else layer.options.group.focus();\n        }\n      } else if (key === 56) {\n        this._newContent(body, -1);\n      } else if (key === 57) {\n        this._newContent(body, 1);\n      }\n    },\n\n    _newContent: function (body, direction) {\n      let index = body.firstChild.getAttribute('data-index');\n      let newContent = body.allFeatures[Math.floor((index - 1) / 7 + direction)];\n      if (newContent && newContent.length > 0) {\n        body.innerHTML = '';\n        body.index += direction;\n        for (let i = 0; i < newContent.length; i++) {\n          let feature = newContent[i];\n          let index = feature.index ? feature.index : 0;\n          let key = i + 1;\n          if (feature.label === 'More results') key = 9;\n          if (feature.label === 'Previous results') key = 8;\n          body.appendChild(this._updateOutput(feature.label, index, key));\n        }\n      }\n    },\n\n    _addOrRemoveFeatureIndex: function (e) {\n      //Toggle aria-hidden attribute so screen reader rereads the feature index on focus\n      if (!this._output.initialFocus) {\n        this._output.setAttribute('aria-hidden', 'true');\n      } else if (this._output.hasAttribute('aria-hidden')) {\n        let obj = this;\n        setTimeout(function () {\n          obj._output.removeAttribute('aria-hidden');\n        }, 100);\n      }\n\n      if (e && e.type === 'popupclose') {\n        this._output.setAttribute('aria-hidden', 'true');\n        this._output.popupClosed = true;\n      } else if (e && e.type === 'focus') {\n        this._container.removeAttribute('hidden');\n        this._output.classList.remove('mapml-screen-reader-output');\n        // this is a very subtle branch.  The event that gets handled below is a blur\n        // event, which happens to have the e.target._popup property\n        // when there will be a popup.  Because blur gets handled here, it doesn't\n        // get handled in the next else if block, which would hide both the reticle\n        // and the index menu, and then recursively call this method with no event\n        // argument, which manipulates the aria-hidden attribute on the output\n        // in order to have the screenreader read its contents when the focus returns\n        // to (what exactly???).\n      } else if (e && e.target._popup) {\n        this._container.setAttribute('hidden', '');\n      } else if (e && e.type === 'blur') {\n        this._container.setAttribute('hidden', '');\n        this._output.classList.add('mapml-screen-reader-output');\n        this._output.initialFocus = false;\n        this._addOrRemoveFeatureIndex();\n      } else {\n        // this is the default block, called when no event is passed (recursive call)\n        this._container.setAttribute('hidden', '');\n        this._output.classList.add('mapml-screen-reader-output');\n      }\n    }\n  });\n\n  var featureIndexOverlay = function (options) {\n    return new FeatureIndexOverlay(options);\n  };\n\n  var createLayerControlExtentHTML = function () {\n    var extent = L.DomUtil.create('fieldset', 'mapml-layer-extent'),\n      extentProperties = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-properties',\n        extent\n      ),\n      extentSettings = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-settings',\n        extent\n      ),\n      extentLabel = L.DomUtil.create(\n        'label',\n        'mapml-layer-item-toggle',\n        extentProperties\n      ),\n      input = L.DomUtil.create('input'),\n      svgExtentControlIcon = L.SVG.create('svg'),\n      extentControlPath1 = L.SVG.create('path'),\n      extentControlPath2 = L.SVG.create('path'),\n      extentNameIcon = L.DomUtil.create('span'),\n      extentItemControls = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-controls',\n        extentProperties\n      ),\n      opacityControl = L.DomUtil.create(\n        'details',\n        'mapml-layer-item-details mapml-control-layers',\n        extentSettings\n      ),\n      extentOpacitySummary = L.DomUtil.create('summary', '', opacityControl),\n      mapEl = this.parentLayer.parentNode,\n      layerEl = this.parentLayer,\n      opacity = L.DomUtil.create('input', '', opacityControl);\n    extentSettings.hidden = true;\n    extent.setAttribute('aria-grabbed', 'false');\n\n    // append the svg paths\n    svgExtentControlIcon.setAttribute('viewBox', '0 0 24 24');\n    svgExtentControlIcon.setAttribute('height', '22');\n    svgExtentControlIcon.setAttribute('width', '22');\n    extentControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n    extentControlPath1.setAttribute('fill', 'none');\n    extentControlPath2.setAttribute(\n      'd',\n      'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z'\n    );\n    svgExtentControlIcon.appendChild(extentControlPath1);\n    svgExtentControlIcon.appendChild(extentControlPath2);\n\n    if (this._userInputs) {\n      var frag = document.createDocumentFragment();\n      var templates = this._templateVars;\n      if (templates) {\n        this._selectdetails = [];\n        for (var i = 0; i < templates.length; i++) {\n          var template = templates[i];\n          for (var j = 0; j < template.values.length; j++) {\n            var mapmlInput = template.values[j],\n              id = '#' + mapmlInput.getAttribute('id');\n            // don't add it again if it is referenced > once\n            if (\n              mapmlInput.tagName.toLowerCase() === 'map-select' &&\n              !frag.querySelector(id)\n            ) {\n              // generate a <details><summary></summary><select...></details>\n              var selectdetails = L.DomUtil.create(\n                  'details',\n                  'mapml-layer-item-details mapml-control-layers',\n                  frag\n                ),\n                selectsummary = L.DomUtil.create('summary'),\n                selectSummaryLabel = L.DomUtil.create('label');\n              selectSummaryLabel.innerText = mapmlInput.getAttribute('name');\n              selectSummaryLabel.setAttribute(\n                'for',\n                mapmlInput.getAttribute('id')\n              );\n              selectsummary.appendChild(selectSummaryLabel);\n              selectdetails.appendChild(selectsummary);\n              selectdetails.appendChild(mapmlInput.htmlselect);\n              this._selectdetails.push(selectdetails);\n            }\n          }\n        }\n      }\n      extentSettings.appendChild(frag);\n    }\n\n    let removeExtentButton = L.DomUtil.create(\n      'button',\n      'mapml-layer-item-remove-control',\n      extentItemControls\n    );\n    removeExtentButton.type = 'button';\n    removeExtentButton.title = 'Remove Sub Layer';\n    removeExtentButton.innerHTML = \"<span aria-hidden='true'>&#10005;</span>\";\n    removeExtentButton.classList.add('mapml-button');\n    removeExtentButton.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.remove();\n    });\n\n    let extentsettingsButton = L.DomUtil.create(\n      'button',\n      'mapml-layer-item-settings-control',\n      extentItemControls\n    );\n    extentsettingsButton.type = 'button';\n    extentsettingsButton.title = 'Extent Settings';\n    extentsettingsButton.setAttribute('aria-expanded', false);\n    extentsettingsButton.classList.add('mapml-button');\n    L.DomEvent.on(\n      extentsettingsButton,\n      'click',\n      (e) => {\n        if (extentSettings.hidden === true) {\n          extentsettingsButton.setAttribute('aria-expanded', true);\n          extentSettings.hidden = false;\n        } else {\n          extentsettingsButton.setAttribute('aria-expanded', false);\n          extentSettings.hidden = true;\n        }\n      },\n      this\n    );\n\n    extentNameIcon.setAttribute('aria-hidden', true);\n    extentLabel.appendChild(input);\n    extentsettingsButton.appendChild(extentNameIcon);\n    extentNameIcon.appendChild(svgExtentControlIcon);\n    extentOpacitySummary.innerText = 'Opacity';\n    extentOpacitySummary.id =\n      'mapml-extent-item-opacity-' + L.stamp(extentOpacitySummary);\n    opacity.setAttribute('type', 'range');\n    opacity.setAttribute('min', '0');\n    opacity.setAttribute('max', '1.0');\n    opacity.setAttribute('step', '0.1');\n    opacity.setAttribute(\n      'aria-labelledby',\n      'mapml-extent-item-opacity-' + L.stamp(extentOpacitySummary)\n    );\n    const changeOpacity = function (e) {\n      if (e && e.target && e.target.value >= 0 && e.target.value <= 1.0) {\n        this._templatedLayer.changeOpacity(e.target.value);\n      }\n    };\n    opacity.setAttribute('value', this.opacity);\n    opacity.value = this._templatedLayer._container.style.opacity || '1.0';\n    opacity.addEventListener('change', changeOpacity.bind(this));\n\n    var extentItemNameSpan = L.DomUtil.create(\n      'span',\n      'mapml-layer-item-name',\n      extentLabel\n    );\n    input.type = 'checkbox';\n    input.defaultChecked = this.checked;\n    extentItemNameSpan.innerHTML = this.label;\n    const changeCheck = function () {\n      this.checked = !this.checked;\n    };\n    // save for later access by API\n    this._layerControlCheckbox = input;\n    input.addEventListener('change', changeCheck.bind(this));\n    extentItemNameSpan.id =\n      'mapml-extent-item-name-{' + L.stamp(extentItemNameSpan) + '}';\n    extent.setAttribute('aria-labelledby', extentItemNameSpan.id);\n    extentItemNameSpan.extent = this;\n\n    extent.ontouchstart = extent.onmousedown = (downEvent) => {\n      if (\n        (downEvent.target.parentElement.tagName.toLowerCase() === 'label' &&\n          downEvent.target.tagName.toLowerCase() !== 'input') ||\n        downEvent.target.tagName.toLowerCase() === 'label'\n      ) {\n        downEvent.stopPropagation();\n        downEvent =\n          downEvent instanceof TouchEvent ? downEvent.touches[0] : downEvent;\n\n        let control = extent,\n          controls = extent.parentNode,\n          moving = false,\n          yPos = downEvent.clientY,\n          originalPosition = Array.from(\n            extent.parentElement.querySelectorAll('fieldset')\n          ).indexOf(extent);\n\n        document.body.ontouchmove = document.body.onmousemove = (moveEvent) => {\n          moveEvent.preventDefault();\n          moveEvent =\n            moveEvent instanceof TouchEvent ? moveEvent.touches[0] : moveEvent;\n\n          // Fixes flickering by only moving element when there is enough space\n          let offset = moveEvent.clientY - yPos;\n          moving = Math.abs(offset) > 15 || moving;\n          if (\n            (controls && !moving) ||\n            (controls && controls.childElementCount <= 1) ||\n            controls.getBoundingClientRect().top >\n              control.getBoundingClientRect().bottom ||\n            controls.getBoundingClientRect().bottom <\n              control.getBoundingClientRect().top\n          ) {\n            return;\n          }\n\n          controls.classList.add('mapml-draggable');\n          control.style.transform = 'translateY(' + offset + 'px)';\n          control.style.pointerEvents = 'none';\n\n          let x = moveEvent.clientX,\n            y = moveEvent.clientY,\n            root =\n              mapEl.tagName === 'MAPML-VIEWER'\n                ? mapEl.shadowRoot\n                : mapEl.querySelector('.mapml-web-map').shadowRoot,\n            elementAt = root.elementFromPoint(x, y),\n            swapControl =\n              !elementAt || !elementAt.closest('fieldset')\n                ? control\n                : elementAt.closest('fieldset');\n\n          swapControl =\n            Math.abs(offset) <= swapControl.offsetHeight ? control : swapControl;\n\n          control.setAttribute('aria-grabbed', 'true');\n          control.setAttribute('aria-dropeffect', 'move');\n          if (swapControl && controls === swapControl.parentNode) {\n            swapControl =\n              swapControl !== control.nextSibling\n                ? swapControl\n                : swapControl.nextSibling;\n            if (control !== swapControl) {\n              yPos = moveEvent.clientY;\n              control.style.transform = null;\n            }\n            controls.insertBefore(control, swapControl);\n          }\n        };\n\n        document.body.ontouchend = document.body.onmouseup = () => {\n          let newPosition = Array.from(\n            extent.parentElement.querySelectorAll('fieldset')\n          ).indexOf(extent);\n          control.setAttribute('aria-grabbed', 'false');\n          control.removeAttribute('aria-dropeffect');\n          control.style.pointerEvents = null;\n          control.style.transform = null;\n          if (originalPosition !== newPosition) {\n            let controlsElems = controls.children,\n              zIndex = 0;\n            for (let c of controlsElems) {\n              let extentEl = c.querySelector('span').extent;\n\n              extentEl.setAttribute('data-moving', '');\n              layerEl.insertAdjacentElement('beforeend', extentEl);\n              extentEl.removeAttribute('data-moving');\n\n              extentEl.extentZIndex = zIndex;\n              extentEl._templatedLayer.setZIndex(zIndex);\n              zIndex++;\n            }\n          }\n          controls.classList.remove('mapml-draggable');\n          document.body.ontouchmove =\n            document.body.onmousemove =\n            document.body.ontouchend =\n            document.body.onmouseup =\n              null;\n        };\n      }\n    };\n    this._extentRootFieldset = extent;\n    this._opacitySlider = opacity;\n    this._opacityControl = opacityControl;\n    this._layerControlLabel = extentLabel;\n    return extent;\n  };\n\n  var createLayerControlHTML = function () {\n    var fieldset = L.DomUtil.create('fieldset', 'mapml-layer-item'),\n      input = L.DomUtil.create('input'),\n      layerItemName = L.DomUtil.create('span', 'mapml-layer-item-name'),\n      settingsButtonNameIcon = L.DomUtil.create('span'),\n      layerItemProperty = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-properties',\n        fieldset\n      ),\n      layerItemSettings = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-settings',\n        fieldset\n      ),\n      itemToggleLabel = L.DomUtil.create(\n        'label',\n        'mapml-layer-item-toggle',\n        layerItemProperty\n      ),\n      layerItemControls = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-controls',\n        layerItemProperty\n      ),\n      opacityControl = L.DomUtil.create(\n        'details',\n        'mapml-layer-item-opacity mapml-control-layers',\n        layerItemSettings\n      ),\n      opacity = L.DomUtil.create('input'),\n      opacityControlSummary = L.DomUtil.create('summary'),\n      svgSettingsControlIcon = L.SVG.create('svg'),\n      settingsControlPath1 = L.SVG.create('path'),\n      settingsControlPath2 = L.SVG.create('path'),\n      extentsFieldset = L.DomUtil.create(\n        'fieldset',\n        'mapml-layer-grouped-extents'\n      ),\n      mapEl = this.parentNode;\n\n    // append the paths in svg for the remove layer and toggle icons\n    svgSettingsControlIcon.setAttribute('viewBox', '0 0 24 24');\n    svgSettingsControlIcon.setAttribute('height', '22');\n    svgSettingsControlIcon.setAttribute('width', '22');\n    svgSettingsControlIcon.setAttribute('fill', 'currentColor');\n    settingsControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n    settingsControlPath1.setAttribute('fill', 'none');\n    settingsControlPath2.setAttribute(\n      'd',\n      'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z'\n    );\n    svgSettingsControlIcon.appendChild(settingsControlPath1);\n    svgSettingsControlIcon.appendChild(settingsControlPath2);\n\n    layerItemSettings.hidden = true;\n    settingsButtonNameIcon.setAttribute('aria-hidden', true);\n\n    let removeControlButton = L.DomUtil.create(\n      'button',\n      'mapml-layer-item-remove-control',\n      layerItemControls\n    );\n    removeControlButton.type = 'button';\n    removeControlButton.title = 'Remove Layer';\n    removeControlButton.innerHTML = \"<span aria-hidden='true'>&#10005;</span>\";\n    removeControlButton.classList.add('mapml-button');\n    L.DomEvent.on(removeControlButton, 'click', L.DomEvent.stop);\n    L.DomEvent.on(\n      removeControlButton,\n      'click',\n      (e) => {\n        let fieldset = 0,\n          elem,\n          root;\n        root =\n          mapEl.tagName === 'MAPML-VIEWER'\n            ? mapEl.shadowRoot\n            : mapEl.querySelector('.mapml-web-map').shadowRoot;\n        if (\n          e.target.closest('fieldset').nextElementSibling &&\n          !e.target.closest('fieldset').nextElementSibling.disbaled\n        ) {\n          elem = e.target.closest('fieldset').previousElementSibling;\n          while (elem) {\n            fieldset += 2; // find the next layer menu item\n            elem = elem.previousElementSibling;\n          }\n        } else {\n          // focus on the link\n          elem = 'link';\n        }\n        mapEl.removeChild(\n          e.target.closest('fieldset').querySelector('span').layer._layerEl\n        );\n        elem = elem\n          ? root.querySelector('.leaflet-control-attribution').firstElementChild\n          : (elem = root.querySelectorAll('input')[fieldset]);\n        elem.focus();\n      },\n      this._layer\n    );\n\n    let itemSettingControlButton = L.DomUtil.create(\n      'button',\n      'mapml-layer-item-settings-control',\n      layerItemControls\n    );\n    itemSettingControlButton.type = 'button';\n    itemSettingControlButton.title = 'Layer Settings';\n    itemSettingControlButton.setAttribute('aria-expanded', false);\n    itemSettingControlButton.classList.add('mapml-button');\n    L.DomEvent.on(\n      itemSettingControlButton,\n      'click',\n      (e) => {\n        let layerControl = this._layer._layerEl._layerControl._container;\n        if (!layerControl._isExpanded && e.pointerType === 'touch') {\n          layerControl._isExpanded = true;\n          return;\n        }\n        if (layerItemSettings.hidden === true) {\n          itemSettingControlButton.setAttribute('aria-expanded', true);\n          layerItemSettings.hidden = false;\n        } else {\n          itemSettingControlButton.setAttribute('aria-expanded', false);\n          layerItemSettings.hidden = true;\n        }\n      },\n      this._layer\n    );\n\n    input.defaultChecked = this.checked;\n    input.type = 'checkbox';\n    input.setAttribute('class', 'leaflet-control-layers-selector');\n    layerItemName.layer = this._layer;\n    const changeCheck = function () {\n      this.checked = !this.checked;\n    };\n    input.addEventListener('change', changeCheck.bind(this));\n    if (this._layer._legendUrl) {\n      var legendLink = document.createElement('a');\n      legendLink.text = ' ' + this._layer._title;\n      legendLink.href = this._layer._legendUrl;\n      legendLink.target = '_blank';\n      legendLink.draggable = false;\n      layerItemName.appendChild(legendLink);\n    } else {\n      layerItemName.innerHTML = this._layer._title;\n    }\n    layerItemName.id = 'mapml-layer-item-name-{' + L.stamp(layerItemName) + '}';\n    opacityControlSummary.innerText = 'Opacity';\n    opacityControlSummary.id =\n      'mapml-layer-item-opacity-' + L.stamp(opacityControlSummary);\n    opacityControl.appendChild(opacityControlSummary);\n    opacityControl.appendChild(opacity);\n    opacity.setAttribute('type', 'range');\n    opacity.setAttribute('min', '0');\n    opacity.setAttribute('max', '1.0');\n    opacity.setAttribute('value', this._layer._container.style.opacity || '1.0');\n    opacity.setAttribute('step', '0.1');\n    opacity.setAttribute(\n      'aria-labelledby',\n      'mapml-layer-item-opacity-' + L.stamp(opacityControlSummary)\n    );\n\n    const changeOpacity = function (e) {\n      if (e && e.target && e.target.value >= 0 && e.target.value <= 1.0) {\n        this._layer.changeOpacity(e.target.value);\n      }\n    };\n    opacity.value = this._layer._container.style.opacity || '1.0';\n    opacity.addEventListener('change', changeOpacity.bind(this));\n\n    fieldset.setAttribute('aria-grabbed', 'false');\n    fieldset.setAttribute('aria-labelledby', layerItemName.id);\n\n    fieldset.ontouchstart = fieldset.onmousedown = (downEvent) => {\n      if (\n        (downEvent.target.parentElement.tagName.toLowerCase() === 'label' &&\n          downEvent.target.tagName.toLowerCase() !== 'input') ||\n        downEvent.target.tagName.toLowerCase() === 'label'\n      ) {\n        downEvent =\n          downEvent instanceof TouchEvent ? downEvent.touches[0] : downEvent;\n        let control = fieldset,\n          controls = fieldset.parentNode,\n          moving = false,\n          yPos = downEvent.clientY,\n          originalPosition = Array.from(\n            controls.querySelectorAll('fieldset')\n          ).indexOf(fieldset);\n\n        document.body.ontouchmove = document.body.onmousemove = (moveEvent) => {\n          moveEvent.preventDefault();\n          moveEvent =\n            moveEvent instanceof TouchEvent ? moveEvent.touches[0] : moveEvent;\n\n          // Fixes flickering by only moving element when there is enough space\n          let offset = moveEvent.clientY - yPos;\n          moving = Math.abs(offset) > 15 || moving;\n          if (\n            (controls && !moving) ||\n            (controls && controls.childElementCount <= 1) ||\n            controls.getBoundingClientRect().top >\n              control.getBoundingClientRect().bottom ||\n            controls.getBoundingClientRect().bottom <\n              control.getBoundingClientRect().top\n          ) {\n            return;\n          }\n\n          controls.classList.add('mapml-draggable');\n          control.style.transform = 'translateY(' + offset + 'px)';\n          control.style.pointerEvents = 'none';\n\n          let x = moveEvent.clientX,\n            y = moveEvent.clientY,\n            root =\n              mapEl.tagName === 'MAPML-VIEWER'\n                ? mapEl.shadowRoot\n                : mapEl.querySelector('.mapml-web-map').shadowRoot,\n            elementAt = root.elementFromPoint(x, y),\n            swapControl =\n              !elementAt || !elementAt.closest('fieldset')\n                ? control\n                : elementAt.closest('fieldset');\n\n          swapControl =\n            Math.abs(offset) <= swapControl.offsetHeight ? control : swapControl;\n\n          control.setAttribute('aria-grabbed', 'true');\n          control.setAttribute('aria-dropeffect', 'move');\n          if (swapControl && controls === swapControl.parentNode) {\n            swapControl =\n              swapControl !== control.nextSibling\n                ? swapControl\n                : swapControl.nextSibling;\n            if (control !== swapControl) {\n              yPos = moveEvent.clientY;\n              control.style.transform = null;\n            }\n            controls.insertBefore(control, swapControl);\n          }\n        };\n\n        document.body.ontouchend = document.body.onmouseup = () => {\n          let newPosition = Array.from(\n            controls.querySelectorAll('fieldset')\n          ).indexOf(fieldset);\n          control.setAttribute('aria-grabbed', 'false');\n          control.removeAttribute('aria-dropeffect');\n          control.style.pointerEvents = null;\n          control.style.transform = null;\n          if (originalPosition !== newPosition) {\n            let controlsElems = controls.children,\n              zIndex = 1;\n            // re-order layer elements DOM order\n            for (let c of controlsElems) {\n              let layerEl = c.querySelector('span').layer._layerEl;\n              layerEl.setAttribute('data-moving', '');\n              mapEl.insertAdjacentElement('beforeend', layerEl);\n              layerEl.removeAttribute('data-moving');\n            }\n            // update zIndex of all layer- elements\n            let layers = mapEl.querySelectorAll('layer-');\n            for (let i = 0; i < layers.length; i++) {\n              let layer = layers[i]._layer;\n              if (layer.options.zIndex !== zIndex) {\n                layer.setZIndex(zIndex);\n              }\n              zIndex++;\n            }\n          }\n          controls.classList.remove('mapml-draggable');\n          document.body.ontouchmove =\n            document.body.onmousemove =\n            document.body.onmouseup =\n              null;\n        };\n      }\n    };\n\n    itemToggleLabel.appendChild(input);\n    itemToggleLabel.appendChild(layerItemName);\n    itemSettingControlButton.appendChild(settingsButtonNameIcon);\n    settingsButtonNameIcon.appendChild(svgSettingsControlIcon);\n\n    if (this._layer._styles) {\n      layerItemSettings.appendChild(this._layer._styles);\n    }\n\n    this._layerControlCheckbox = input;\n    this._layerControlLabel = itemToggleLabel;\n    this._opacityControl = opacityControl;\n    this._opacitySlider = opacity;\n    this._layerControlHTML = fieldset;\n    this._layerItemSettingsHTML = layerItemSettings;\n    this._propertiesGroupAnatomy = extentsFieldset;\n    this._styles = this._layer._styles;\n    extentsFieldset.setAttribute('aria-label', 'Sublayers');\n    extentsFieldset.setAttribute('hidden', '');\n    layerItemSettings.appendChild(extentsFieldset);\n    return this._layerControlHTML;\n  };\n\n  class ZoomInput {\n    constructor(name, min, max, value, step, layer) {\n      this.name = name;\n      this.min = min;\n      this.max = max;\n      this.value = value;\n      this.step = step;\n      this.layer = layer;\n    }\n\n    validateInput() {\n      // name is required\n      if (!this.name) {\n        return false;\n      }\n      // min and max can not be present\n      // fallback would be layer's meta, -> projection min, max\n      // don't need value, map-meta max value, -> fallback is max zoom of projection\n      // don't need step, defaults to 1\n      return true;\n    }\n\n    getValue() {\n      return this.layer._map.options.mapEl.zoom;\n    }\n  }\n\n  class HiddenInput {\n    constructor(name, value) {\n      this.name = name;\n      this.value = value;\n    }\n\n    validateInput() {\n      // name is required\n      // value is required\n      if (!this.name || !this.value) {\n        return false;\n      }\n      return true;\n    }\n\n    getValue() {\n      return this.value;\n    }\n  }\n\n  class WidthInput {\n    constructor(name, layer) {\n      this.name = name;\n      this.layer = layer;\n    }\n\n    validateInput() {\n      // name is required\n      if (!this.name) {\n        return false;\n      }\n      return true;\n    }\n\n    getValue() {\n      return this.layer._map.getSize().x;\n    }\n  }\n\n  class HeightInput {\n    constructor(name, layer) {\n      this.name = name;\n      this.layer = layer;\n    }\n\n    validateInput() {\n      // name is required\n      if (!this.name) {\n        return false;\n      }\n      return true;\n    }\n\n    getValue() {\n      return this.layer._map.getSize().y;\n    }\n  }\n\n  class LocationInput {\n    constructor(name, position, axis, units, min, max, rel, layer) {\n      this.name = name;\n      this.position = position;\n      this.axis = axis;\n      // if unit/cs not present, find it\n      if (!units && axis && !['i', 'j'].includes(axis)) {\n        this.units = M.axisToCS(axis).toLowerCase();\n      } else {\n        this.units = units; // cs\n      }\n      this.min = min;\n      this.max = max;\n      this.rel = rel;\n      this.layer = layer;\n    }\n\n    validateInput() {\n      // name is required\n      // axis is required\n      if (!this.name || !this.axis) {\n        return false;\n      }\n      // cs/units is only required when the axis is i/j. To differentiate between the units/cs\n      if (\n        (this.axis === 'i' || this.axis === 'j') &&\n        !['map', 'tile'].includes(this.units)\n      ) {\n        return false;\n      }\n      // check if axis match the units/cs\n      if (this.units) {\n        let axisCS = M.axisToCS(this.axis);\n        if (\n          typeof axisCS === 'string' &&\n          axisCS.toUpperCase() !== this.units.toUpperCase()\n        ) {\n          return false;\n        }\n      }\n      // position is not required, will default to top-left\n      // min max fallbacks, map-meta -> projection\n      // rel not required, default is image/extent\n      return true;\n    }\n\n    _TCRSToPCRS(coords, zoom) {\n      // TCRS pixel point to Projected CRS point (in meters, presumably)\n      var map = this.layer._map,\n        crs = map.options.crs,\n        loc = crs.transformation.untransform(coords, crs.scale(zoom));\n      return loc;\n    }\n\n    getValue(zoom = undefined, bounds = undefined) {\n      // units = cs\n      //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting|latitude|longitude\">\n      if (zoom === undefined) zoom = this.layer._map.getZoom();\n      if (bounds === undefined) bounds = this.layer._map.getPixelBounds();\n\n      if (this.units === 'pcrs' || this.units === 'gcrs') {\n        switch (this.axis) {\n          case 'longitude':\n          case 'easting':\n            if (this.position) {\n              if (this.position.match(/.*?-left/i)) {\n                return this._TCRSToPCRS(bounds.min, zoom).x;\n              } else if (this.position.match(/.*?-right/i)) {\n                return this._TCRSToPCRS(bounds.max, zoom).x;\n              }\n            } else {\n              // position is not required, will default to top-left\n              return this._TCRSToPCRS(bounds.min, zoom).x;\n            }\n            break;\n          case 'latitude':\n          case 'northing':\n            if (this.position) {\n              if (this.position.match(/top-.*?/i)) {\n                return this._TCRSToPCRS(bounds.min, zoom).y;\n              } else if (this.position.match(/bottom-.*?/i)) {\n                return this._TCRSToPCRS(bounds.max, zoom).y;\n              }\n            } else {\n              // position is not required, will default to top-left\n              return this._TCRSToPCRS(bounds.min, zoom).y;\n            }\n            break;\n        }\n      } else if (this.units === 'tilematrix') {\n        // Value is retrieved from the createTile method of TemplatedTileLayer, on move end.\n        // Different values for each tile when filling in the map tiles on the map.\n        // Currently storing all x,y,z within one object,\n        // TODO: change return value as needed based on usage by map-input\n        // https://github.com/Leaflet/Leaflet/blob/6994baf25f267db1c8b720c28a61e0700d0aa0e8/src/layer/tile/GridLayer.js#L652\n        const center = this.layer._map.getCenter();\n        const templatedTileLayer = this.layer._templatedLayer._templates[0].layer;\n        const pixelBounds = templatedTileLayer._getTiledPixelBounds(center);\n        const tileRange = templatedTileLayer._pxBoundsToTileRange(pixelBounds);\n        let obj = [];\n        for (let j = tileRange.min.y; j <= tileRange.max.y; j++) {\n          for (let i = tileRange.min.x; i <= tileRange.max.x; i++) {\n            const coords = new L.Point(i, j);\n            coords.z = templatedTileLayer._tileZoom;\n            obj.push(coords);\n          }\n        }\n        return obj;\n      } else if (this.units === 'tile' || this.units === 'map') ;\n      return;\n    }\n  }\n\n  class DOMTokenList {\n    /* jshint ignore:start */\n    #element; // create element as a private property\n    #valueSet; // needed to prevent infinite recursive calls to CE setAttribute\n    #attribute; // the name of the attribute that will be a DOMTokenList\n    #domain; // the domain of token values supported by this attribute\n    /* jshint ignore:end */\n    constructor(initialValue, element, attribute, domain) {\n      // create donor/host div to extract DomTokenList from\n      const hostingElement = document.createElement('div');\n      this.domtokenlist = hostingElement.classList;\n\n      // to check if value is being set, protects from infinite recursion\n      // from attributeChangedCallback of mapml-viewer and web-map\n      this.#valueSet = false; // jshint ignore:line\n      this.domtokenlist.value = initialValue ?? '';\n      this.#element = element; // jshint ignore:line\n      this.#attribute = attribute; // jshint ignore:line\n      this.#domain = domain; // jshint ignore:line\n    }\n\n    get valueSet() {\n      return this.#valueSet; // jshint ignore:line\n    }\n\n    get length() {\n      return this.domtokenlist.length;\n    }\n\n    get value() {\n      return this.domtokenlist.value;\n    }\n    set value(val) {\n      if (val === null) {\n        // when attribute is being removed\n        this.domtokenlist.value = '';\n      } else {\n        this.domtokenlist.value = val.toLowerCase();\n        /* jshint ignore:start */\n        this.#valueSet = true;\n        this.#element.setAttribute(this.#attribute, this.domtokenlist.value);\n        this.#valueSet = false;\n        /* jshint ignore:end */\n      }\n    }\n\n    item(index) {\n      return this.domtokenlist.item(index);\n    }\n\n    contains(token) {\n      return this.domtokenlist.contains(token);\n    }\n\n    // Modified default behavior\n    add(token) {\n      this.domtokenlist.add(token);\n      this.#element.setAttribute(this.#attribute, this.domtokenlist.value); // jshint ignore:line\n    }\n\n    // Modified default behavior\n    remove(token) {\n      this.domtokenlist.remove(token);\n      this.#element.setAttribute(this.#attribute, this.domtokenlist.value); // jshint ignore:line\n    }\n\n    // Modified default behavior\n    replace(oldToken, newToken) {\n      this.domtokenlist.replace(oldToken, newToken);\n      this.#element.setAttribute(this.#attribute, this.domtokenlist.value); // jshint ignore:line\n    }\n\n    // Modified default behavior\n    supports(token) {\n      /* jshint ignore:start */\n      if (this.#domain.includes(token)) {\n        return true;\n      } else {\n        return false;\n      }\n      /* jshint ignore:end */\n    }\n\n    // Modified default behavior\n    //https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList/toggle\n    toggle(token, force) {\n      this.domtokenlist.toggle(token, force);\n      this.#element.setAttribute(this.#attribute, this.domtokenlist.value); // jshint ignore:line\n    }\n\n    entries() {\n      return this.domtokenlist.entries();\n    }\n\n    //https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList/forEach\n    forEach(callback, thisArg) {\n      this.domtokenlist.forEach(callback, thisArg);\n    }\n\n    //https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList/keys\n    keys() {\n      return this.domtokenlist.keys();\n    }\n\n    //https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList/values\n    values() {\n      return this.domtokenlist.values();\n    }\n  }\n\n  /*\n   * Copyright 2015-2016 Canada Centre for Mapping and Earth Observation,\n   * Earth Sciences Sector, Natural Resources Canada.\n   *\n   * License\n   *\n   * By obtaining and/or copying this work, you (the licensee) agree that you have\n   * read, understood, and will comply with the following terms and conditions.\n   *\n   * Permission to copy, modify, and distribute this work, with or without\n   * modification, for any purpose and without fee or royalty is hereby granted,\n   * provided that you include the following on ALL copies of the work or portions\n   * thereof, including modifications:\n   *\n   * The full text of this NOTICE in a location viewable to users of the\n   * redistributed or derivative work.\n   *\n   * Any pre-existing intellectual property disclaimers, notices, or terms and\n   * conditions. If none exist, the W3C Software and Document Short Notice should\n   * be included.\n   *\n   * Notice of any changes or modifications, through a copyright statement on the\n   * new code or document such as \"This software or document includes material\n   * copied from or derived from [title and URI of the W3C document].\n   * Copyright © [YEAR] W3C® (MIT, ERCIM, Keio, Beihang).\"\n   *\n   * Disclaimers\n   *\n   * THIS WORK IS PROVIDED \"AS IS,\" AND COPYRIGHT HOLDERS MAKE NO REPRESENTATIONS\n   * OR WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO, WARRANTIES OF\n   * MERCHANTABILITY OR FITNESS FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF THE\n   * SOFTWARE OR DOCUMENT WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS,\n   * TRADEMARKS OR OTHER RIGHTS.\n   * COPYRIGHT HOLDERS WILL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL OR\n   * CONSEQUENTIAL DAMAGES ARISING OUT OF ANY USE OF THE SOFTWARE OR DOCUMENT.\n   *\n   * The name and trademarks of copyright holders may NOT be used in advertising or\n   * publicity pertaining to the work without specific, written prior permission.\n   * Title to copyright in this work will at all times remain with copyright holders.\n   */\n\n  /* global L, Node */\n  (function (window, document, undefined$1) {\n    var M = {};\n    window.M = M;\n\n    (function () {\n      M.detectImagePath = function (container) {\n        // this relies on the CSS style leaflet-default-icon-path containing a\n        // relative url() that leads to a valid icon file.  Since that depends on\n        // how all of this stuff is deployed (i.e. custom element or as leaflet-plugin)\n        // also, because we're using 'shady DOM' api, the container must be\n        // a shady dom container, because the custom element tags it with added\n        // style-scope ... and related classes.\n        var el = L.DomUtil.create('div', 'leaflet-default-icon-path', container);\n        var path =\n          L.DomUtil.getStyle(el, 'background-image') ||\n          L.DomUtil.getStyle(el, 'backgroundImage'); // IE8\n\n        container.removeChild(el);\n\n        if (path === null || path.indexOf('url') !== 0) {\n          path = '';\n        } else {\n          path = path\n            .replace(/^url\\([\"']?/, '')\n            .replace(/marker-icon\\.png[\"']?\\)$/, '');\n        }\n\n        return path;\n      };\n      M.mime = 'text/mapml';\n\n      let mapOptions = window.document.head.querySelector('map-options');\n      M.options = Options;\n      if (mapOptions)\n        M.options = Object.assign(M.options, JSON.parse(mapOptions.innerHTML));\n\n      // see https://leafletjs.com/reference-1.5.0.html#crs-l-crs-base\n      // \"new classes can't inherit from (L.CRS), and methods can't be added\n      // to (L.CRS.anything) with the include function\n      // so we'll use the options property as a way to integrate needed\n      // properties and methods...\n      M.WGS84 = new L.Proj.CRS(\n        'EPSG:4326',\n        '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ',\n        {\n          origin: [-180, +90],\n          bounds: L.bounds([\n            [-180, -90],\n            [180, 90]\n          ]),\n          resolutions: [\n            0.703125, 0.3515625, 0.17578125, 0.087890625, 0.0439453125,\n            0.02197265625, 0.010986328125, 0.0054931640625, 0.00274658203125,\n            0.001373291015625, 0.0006866455078125, 0.0003433227539062,\n            0.0001716613769531, 0.0000858306884766, 0.0000429153442383,\n            0.0000214576721191, 0.0000107288360596, 0.0000053644180298,\n            0.0000026822090149, 0.0000013411045074, 0.0000006705522537,\n            0.0000003352761269\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.bounds.getSize().x /\n                      M.WGS84.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.bounds.getSize().y /\n                      M.WGS84.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.WGS84.options.crs.tcrs.horizontal.min,\n                    M.WGS84.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tcrs.horizontal.max(zoom),\n                    M.WGS84.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'longitude',\n                get min() {\n                  return M.WGS84.options.crs.gcrs.horizontal.min;\n                },\n                get max() {\n                  return M.WGS84.options.crs.gcrs.horizontal.max;\n                }\n              },\n              vertical: {\n                name: 'latitude',\n                get min() {\n                  return M.WGS84.options.crs.gcrs.vertical.min;\n                },\n                get max() {\n                  return M.WGS84.options.crs.gcrs.vertical.max;\n                }\n              },\n              get bounds() {\n                return M.WGS84.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -180.0,\n                max: 180.0\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -90.0,\n                max: 90.0\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.WGS84.options.crs.gcrs.vertical.min,\n                    M.WGS84.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.WGS84.options.crs.gcrs.vertical.max,\n                    M.WGS84.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.WGS84.options.crs.tile.horizontal.min,\n                    M.WGS84.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tile.horizontal.max,\n                    M.WGS84.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.crs.tcrs.horizontal.max(zoom) /\n                      M.WGS84.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.crs.tcrs.vertical.max(zoom) /\n                      M.WGS84.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.WGS84.options.crs.tilematrix.horizontal.min,\n                    M.WGS84.options.crs.tilematrix.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tilematrix.horizontal.max(zoom),\n                    M.WGS84.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.CBMTILE = new L.Proj.CRS(\n        'EPSG:3978',\n        '+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\n        {\n          origin: [-34655800, 39310000],\n          bounds: L.bounds([\n            [-34655800, -39000000],\n            [10000000, 39310000]\n          ]),\n          resolutions: [\n            38364.660062653464, 22489.62831258996, 13229.193125052918,\n            7937.5158750317505, 4630.2175937685215, 2645.8386250105837,\n            1587.5031750063501, 926.0435187537042, 529.1677250021168,\n            317.50063500127004, 185.20870375074085, 111.12522225044451,\n            66.1459656252646, 38.36466006265346, 22.48962831258996,\n            13.229193125052918, 7.9375158750317505, 4.6302175937685215,\n            2.6458386250105836, 1.5875031750063502, 0.92604351875370428,\n            0.52916772500211673, 0.31750063500127002, 0.18520870375074083,\n            0.11112522225044451, 0.066145965625264591\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.bounds.getSize().x /\n                      M.CBMTILE.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.bounds.getSize().y /\n                      M.CBMTILE.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.CBMTILE.options.crs.tcrs.horizontal.min,\n                    M.CBMTILE.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.tcrs.horizontal.max(zoom),\n                    M.CBMTILE.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'easting',\n                get min() {\n                  return M.CBMTILE.options.bounds.min.x;\n                },\n                get max() {\n                  return M.CBMTILE.options.bounds.max.x;\n                }\n              },\n              vertical: {\n                name: 'northing',\n                get min() {\n                  return M.CBMTILE.options.bounds.min.y;\n                },\n                get max() {\n                  return M.CBMTILE.options.bounds.max.y;\n                }\n              },\n              get bounds() {\n                return M.CBMTILE.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -141.01,\n                max: -47.74\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: 40.04,\n                max: 86.46\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.CBMTILE.options.crs.gcrs.vertical.min,\n                    M.CBMTILE.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.gcrs.vertical.max,\n                    M.CBMTILE.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.CBMTILE.options.crs.tile.horizontal.min,\n                    M.CBMTILE.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.tile.horizontal.max,\n                    M.CBMTILE.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.crs.tcrs.horizontal.max(zoom) /\n                      M.CBMTILE.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.crs.tcrs.vertical.max(zoom) /\n                      M.CBMTILE.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [0, 0],\n                  [\n                    M.CBMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.CBMTILE.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.APSTILE = new L.Proj.CRS(\n        'EPSG:5936',\n        '+proj=stere +lat_0=90 +lat_ts=50 +lon_0=-150 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m +no_defs',\n        {\n          origin: [-2.8567784109255e7, 3.2567784109255e7],\n          bounds: L.bounds([\n            [-28567784.109254867, -28567784.109254755],\n            [32567784.109255023, 32567784.10925506]\n          ]),\n          resolutions: [\n            238810.813354, 119405.406677, 59702.7033384999, 29851.3516692501,\n            14925.675834625, 7462.83791731252, 3731.41895865639, 1865.70947932806,\n            932.854739664032, 466.427369832148, 233.213684916074,\n            116.606842458037, 58.3034212288862, 29.1517106145754,\n            14.5758553072877, 7.28792765351156, 3.64396382688807,\n            1.82198191331174, 0.910990956788164, 0.45549547826179\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.bounds.getSize().x /\n                      M.APSTILE.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.bounds.getSize().y /\n                      M.APSTILE.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.APSTILE.options.crs.tcrs.horizontal.min,\n                    M.APSTILE.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.tcrs.horizontal.max(zoom),\n                    M.APSTILE.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'easting',\n                get min() {\n                  return M.APSTILE.options.bounds.min.x;\n                },\n                get max() {\n                  return M.APSTILE.options.bounds.max.x;\n                }\n              },\n              vertical: {\n                name: 'northing',\n                get min() {\n                  return M.APSTILE.options.bounds.min.y;\n                },\n                get max() {\n                  return M.APSTILE.options.bounds.max.y;\n                }\n              },\n              get bounds() {\n                return M.APSTILE.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -180.0,\n                max: 180.0\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: 60.0,\n                max: 90.0\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.APSTILE.options.crs.gcrs.vertical.min,\n                    M.APSTILE.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.gcrs.vertical.max,\n                    M.APSTILE.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.APSTILE.options.crs.tile.horizontal.min,\n                    M.APSTILE.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.tile.horizontal.max,\n                    M.APSTILE.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.crs.tcrs.horizontal.max(zoom) /\n                      M.APSTILE.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.crs.tcrs.vertical.max(zoom) /\n                      M.APSTILE.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [0, 0],\n                  [\n                    M.APSTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.APSTILE.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.OSMTILE = L.CRS.EPSG3857;\n      L.setOptions(M.OSMTILE, {\n        origin: [-20037508.342787, 20037508.342787],\n        bounds: L.bounds([\n          [-20037508.342787, -20037508.342787],\n          [20037508.342787, 20037508.342787]\n        ]),\n        resolutions: [\n          156543.0339, 78271.51695, 39135.758475, 19567.8792375, 9783.93961875,\n          4891.969809375, 2445.9849046875, 1222.9924523438, 611.49622617188,\n          305.74811308594, 152.87405654297, 76.437028271484, 38.218514135742,\n          19.109257067871, 9.5546285339355, 4.7773142669678, 2.3886571334839,\n          1.1943285667419, 0.59716428337097, 0.29858214168549, 0.14929107084274,\n          0.074645535421371, 0.03732276771068573, 0.018661383855342865,\n          0.009330691927671432495\n        ],\n        crs: {\n          tcrs: {\n            horizontal: {\n              name: 'x',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.bounds.getSize().x /\n                    M.OSMTILE.options.resolutions[zoom]\n                )\n            },\n            vertical: {\n              name: 'y',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.bounds.getSize().y /\n                    M.OSMTILE.options.resolutions[zoom]\n                )\n            },\n            bounds: (zoom) =>\n              L.bounds(\n                [\n                  M.OSMTILE.options.crs.tcrs.horizontal.min,\n                  M.OSMTILE.options.crs.tcrs.vertical.min\n                ],\n                [\n                  M.OSMTILE.options.crs.tcrs.horizontal.max(zoom),\n                  M.OSMTILE.options.crs.tcrs.vertical.max(zoom)\n                ]\n              )\n          },\n          pcrs: {\n            horizontal: {\n              name: 'easting',\n              get min() {\n                return M.OSMTILE.options.bounds.min.x;\n              },\n              get max() {\n                return M.OSMTILE.options.bounds.max.x;\n              }\n            },\n            vertical: {\n              name: 'northing',\n              get min() {\n                return M.OSMTILE.options.bounds.min.y;\n              },\n              get max() {\n                return M.OSMTILE.options.bounds.max.y;\n              }\n            },\n            get bounds() {\n              return M.OSMTILE.options.bounds;\n            }\n          },\n          gcrs: {\n            horizontal: {\n              name: 'longitude',\n              get min() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lng;\n              },\n              get max() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lng;\n              }\n            },\n            vertical: {\n              name: 'latitude',\n              get min() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lat;\n              },\n              get max() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lat;\n              }\n            },\n            get bounds() {\n              return L.latLngBounds(\n                [\n                  M.OSMTILE.options.crs.gcrs.vertical.min,\n                  M.OSMTILE.options.crs.gcrs.horizontal.min\n                ],\n                [\n                  M.OSMTILE.options.crs.gcrs.vertical.max,\n                  M.OSMTILE.options.crs.gcrs.horizontal.max\n                ]\n              );\n            }\n          },\n          map: {\n            horizontal: {\n              name: 'i',\n              min: 0,\n              max: (map) => map.getSize().x\n            },\n            vertical: {\n              name: 'j',\n              min: 0,\n              max: (map) => map.getSize().y\n            },\n            bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n          },\n          tile: {\n            horizontal: {\n              name: 'i',\n              min: 0,\n              max: 256\n            },\n            vertical: {\n              name: 'j',\n              min: 0,\n              max: 256\n            },\n            get bounds() {\n              return L.bounds(\n                [\n                  M.OSMTILE.options.crs.tile.horizontal.min,\n                  M.OSMTILE.options.crs.tile.vertical.min\n                ],\n                [\n                  M.OSMTILE.options.crs.tile.horizontal.max,\n                  M.OSMTILE.options.crs.tile.vertical.max\n                ]\n              );\n            }\n          },\n          tilematrix: {\n            horizontal: {\n              name: 'column',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.crs.tcrs.horizontal.max(zoom) /\n                    M.OSMTILE.options.crs.tile.bounds.getSize().x\n                )\n            },\n            vertical: {\n              name: 'row',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.crs.tcrs.vertical.max(zoom) /\n                    M.OSMTILE.options.crs.tile.bounds.getSize().y\n                )\n            },\n            bounds: (zoom) =>\n              L.bounds(\n                [0, 0],\n                [\n                  M.OSMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                  M.OSMTILE.options.crs.tilematrix.vertical.max(zoom)\n                ]\n              )\n          }\n        }\n      });\n    })();\n\n    M._handleLink = Util._handleLink;\n    M.convertPCRSBounds = Util.convertPCRSBounds;\n    M.axisToXY = Util.axisToXY;\n    M.csToAxes = Util.csToAxes;\n    M._convertAndFormatPCRS = Util._convertAndFormatPCRS;\n    M.extentToBounds = Util.extentToBounds;\n    M.axisToCS = Util.axisToCS;\n    M._parseNumber = Util._parseNumber;\n    M._extractInputBounds = Util._extractInputBounds;\n    M._splitCoordinate = Util._splitCoordinate;\n    M.boundsToPCRSBounds = Util.boundsToPCRSBounds;\n    M.pixelToPCRSBounds = Util.pixelToPCRSBounds;\n    M._metaContentToObject = Util._metaContentToObject;\n    M._coordsToArray = Util._coordsToArray;\n    M._parseStylesheetAsHTML = Util._parseStylesheetAsHTML;\n    M.pointToPCRSPoint = Util.pointToPCRSPoint;\n    M.pixelToPCRSPoint = Util.pixelToPCRSPoint;\n    M._gcrsToTileMatrix = Util._gcrsToTileMatrix;\n    M._pasteLayer = Util._pasteLayer;\n    M._properties2Table = Util._properties2Table;\n    M._updateExtent = Util._updateExtent;\n    M.geojson2mapml = Util.geojson2mapml;\n    M._breakArray = Util._breakArray;\n    M._table2properties = Util._table2properties;\n    M._geometry2geojson = Util._geometry2geojson;\n    M._pcrsToGcrs = Util._pcrsToGcrs;\n    M.mapml2geojson = Util.mapml2geojson;\n    M.getMaxZoom = Util.getMaxZoom;\n    M.getBounds = Util.getBounds;\n    M.getZoomBounds = Util.getZoomBounds;\n    M.getNativeVariables = Util.getNativeVariables;\n\n    M.QueryHandler = QueryHandler;\n    M.ContextMenu = ContextMenu;\n    M.AnnounceMovement = AnnounceMovement;\n    M.FeatureIndex = FeatureIndex;\n\n    // see https://leafletjs.com/examples/extending/extending-3-controls.html#handlers\n    L.Map.addInitHook('addHandler', 'query', M.QueryHandler);\n    L.Map.addInitHook('addHandler', 'contextMenu', M.ContextMenu);\n    L.Map.addInitHook('addHandler', 'announceMovement', M.AnnounceMovement);\n    L.Map.addInitHook('addHandler', 'featureIndex', M.FeatureIndex);\n\n    M.MapMLLayer = MapMLLayer;\n    M.mapMLLayer = mapMLLayer;\n\n    M.ImageLayer = ImageLayer;\n    M.imageLayer = imageLayer;\n\n    M.TemplatedImageLayer = TemplatedImageLayer;\n    M.templatedImageLayer = templatedImageLayer;\n\n    M.TemplatedFeaturesLayer = TemplatedFeaturesLayer;\n    M.templatedFeaturesLayer = templatedFeaturesLayer;\n\n    M.TemplatedLayer = TemplatedLayer;\n    M.templatedLayer = templatedLayer;\n\n    M.TemplatedTileLayer = TemplatedTileLayer;\n    M.templatedTileLayer = templatedTileLayer;\n\n    M.FeatureLayer = FeatureLayer;\n    M.featureLayer = featureLayer;\n\n    M.LayerControl = LayerControl;\n    M.layerControl = layerControl;\n\n    M.AttributionButton = AttributionButton;\n    M.attributionButton = attributionButton;\n\n    M.ReloadButton = ReloadButton;\n    M.reloadButton = reloadButton;\n\n    M.ScaleBar = ScaleBar;\n    M.scaleBar = scaleBar;\n\n    M.FullscreenButton = FullscreenButton;\n    M.fullscreenButton = fullscreenButton;\n\n    M.geolocationButton = geolocationButton;\n\n    M.StaticTileLayer = StaticTileLayer;\n    M.staticTileLayer = staticTileLayer;\n\n    M.DebugOverlay = DebugOverlay;\n    M.debugOverlay = debugOverlay;\n\n    M.Crosshair = Crosshair;\n    M.crosshair = crosshair;\n\n    M.FeatureIndexOverlay = FeatureIndexOverlay;\n    M.featureIndexOverlay = featureIndexOverlay;\n\n    M.Path = Path;\n    M.path = path;\n\n    M.FeatureRenderer = FeatureRenderer;\n    M.featureRenderer = featureRenderer;\n\n    M.Geometry = Geometry;\n    M.geometry = geometry;\n\n    // element support\n    M._createLayerControlExtentHTML = createLayerControlExtentHTML;\n    M._createLayerControlHTML = createLayerControlHTML;\n    M.ZoomInput = ZoomInput;\n    M.HiddenInput = HiddenInput;\n    M.WidthInput = WidthInput;\n    M.HeightInput = HeightInput;\n    M.LocationInput = LocationInput;\n\n    // constants\n    M.TILE_SIZE = 256;\n    M.FALLBACK_PROJECTION = 'OSMTILE';\n    M.FALLBACK_CS = 'TILEMATRIX';\n    M.BLANK_TT_TREF = 'mapmltemplatedtileplaceholder';\n\n    M.DOMTokenList = DOMTokenList;\n  })(window);\n\n}());\n"],"names":["staticTileLayer","options","StaticTileLayer","layerControl","layers","LayerControl","featureLayer","mapml","FeatureLayer","templatedTileLayer","template","TemplatedTileLayer","templatedLayer","templates","TemplatedLayer","templatedFeaturesLayer","TemplatedFeaturesLayer","templatedImageLayer","TemplatedImageLayer","imageLayer","url","location","size","angle","container","ImageLayer","mapMLLayer","node","MapMLLayer","debugOverlay","DebugOverlay","L","GridLayer","extend","initialize","setOptions","this","zoomBounds","_getZoomBounds","tileContainer","maxZoomBound","_groups","_groupTiles","getElementsByTagName","_bounds","_getLayerBounds","projection","layerBounds","Object","keys","let","key","min","max","onAdd","map","_map","prototype","call","_handleMoveEnd","getEvents","events","_parentOnMoveEnd","moveend","move","e","mapZoom","getZoom","zoomLevel","maxNativeZoom","minNativeZoom","isVisible","maxZoom","minZoom","overlaps","M","pixelToPCRSBounds","getPixelBounds","_isValidTile","coords","_tileCoordsToKey","createTile","tileGroup","tileElem","document","createElement","tileSize","getTileSize","setAttribute","x","y","z","i","length","tile","width","height","alt","src","appendChild","tileGroups","crs","bounds","sCoords","split","pixelCoords","point","pixelBounds","zoom","meta","_metaContentToObject","_leafletLayer","_layerEl","querySelector","getAttribute","tiles","nativeZoom","value","lZoom","Math","tileMap","row","col","tileCode","push","Control","Layers","autoZIndex","sortLayers","sortFunction","layerA","layerB","zIndex","overlays","_layerControlInputs","_layers","_lastZIndex","_handlingClick","_addLayer","_initLayout","DomEvent","on","_container","_focusFirstLayer","_preventDefaultContextMenu","_update","_showControls","onRemove","off","addOrUpdateOverlay","layer","name","alreadyThere","addOverlay","removeAttribute","removeLayer","_checkDisabledLayers","elem","className","children","setTimeout","focus","_withinZoomBounds","range","_addItem","obj","layercontrols","_layerControlHTML","input","layerId","stamp","_overlaysList","collapse","target","tagName","relatedTarget","parentElement","contextMenu","_layerMenu","style","display","DomUtil","removeClass","originalEvent","pointerType","_isExpanded","latlng","mouseEventToLatLng","containerPoint","mouseEventToContainerPoint","preventDefault","fire","FeatureGroup","native","static","create","pane","addClass","renderer","query","_mapmlFeatures","features","getNativeVariables","nativeCS","cs","addData","_features","_staticFeature","_resetFeatures","_addZoomLimit","showPaginationFeature","remove","featureIndex","cleanIndex","featureGroupLayer","_leaflet_id","zoomend","_handleZoomEnd","feature","type","_extentEl","shadowRoot","replaceChildren","clearLayers","_featureGroup","popup","_navigationBar","innerText","_totalFeatureCount","_content","srcdoc","innerHTML","currFeature","once","withinZoom","_removeCSS","k","checkRender","_checkRender","hasLayer","addLayer","placeholder","defaultOptions","group","parentNode","replaceWith","id","insertAdjacentElement","_setZoomTransform","center","clampZoom","scale","getZoomScale","translate","multiplyBy","subtract","_getNewPixelOrigin","round","any3d","setTransform","setPosition","len","nodeType","Node","DOCUMENT_NODE","nodeName","base","hasAttribute","URL","href","_parseStylesheetAsHTML","_DOMnode","cloneNode","filter","classList","title","properties","add","insertAdjacentHTML","geometryToLayer","color","resetStyle","onEachFeature","bindTooltip","interactive","sticky","featureZoom","toUpperCase","_groupEl","Util","_setLayerStyle","setStyle","eachLayer","toDelete","querySelectorAll","removeChild","vectorOptions","geometry","svgGroup","SVG","copyOptions","assign","geo","path","featureID","wrappers","_getGeometryParents","groupOptions","mapmlFeature","accessibleTitle","collections","subType","elems","concat","TileLayer","inputData","_extractInputBounds","extentBounds","tms","opacity","_setUpTileTemplateVars","_template","_initContainer","child","_updateZIndex","mapBounds","linkEl","dispatchEvent","CustomEvent","detail","appendTile","startsWith","_url","includes","BLANK_TT_TREF","_fetchTile","_mapmlTileReady","getPane","fetch","getTileUrl","redirect","then","response","status","Promise","resolve","console","log","reject","text","DOMParser","parseFromString","_createFeatures","catch","markup","svg","g","xOffset","yOffset","groupID","tileFeatures","FeatureRenderer","_initPath","_project","_addPath","_updateFeature","toString","tilematrix","contains","v","zoomInput","_getZoomForUrl","pcrs","easting","left","_tileMatrixToPCRSPosition","right","northing","top","bottom","indexOf","infinite","invertedY","_globalTileRange","r","detectRetina","Browser","retina","pos","nwPoint","scaleBy","sePoint","centrePoint","floor","nw","transformation","untransform","se","cen","result","Point","east","north","inputs","values","units","axis","position","select","toLowerCase","horizontal","resolutions","isNaN","Number","parseFloat","vertical","match","parseInt","parsedselect","htmlselect","pcrs2tilematrix","c","transform","divideBy","bind","boundsToPCRSBounds","axisToCS","pcrsBounds","zmin","zmax","_clampZoom","clamp","step","Layer","_templates","extentEl","changeOpacity","rel","setZIndex","extentZIndex","errorTileUrl","hasSetBoundsHandler","_queries","_setupQueryVars","zoomstart","_onZoomStart","redraw","closePopup","queryVarNames","pixelleft","tileleft","mapleft","pixelright","tileright","mapright","pixeltop","tiletop","maptop","pixelbottom","tilebottom","mapbottom","tilei","mapi","tilej","mapj","reset","addToMap","old_templates","undefined","_previousFeature","_count","_nextFeature","_source","_opacity","_opacitySlider","_setUpFeaturesTemplateVars","_onMoveEnd","featureRenderer","bindPopup","autoClose","minWidth","parent","history","mapEl","_history","current","previous","steppedZoom","scaleBounds","getCenter","headers","parser","context","_pullFeatureFeed","_getfeaturesUrl","Headers","Accept","limit","el","_nativeZoom","_nativeCS","content","append","_updateTabIndex","error","layerNum","_path","childElementCount","getSize","_TCRSToPCRS","featuresVarNames","hidden","_setUpExtentTemplateVars","_clearLayer","_onAdd","containerImages","_addImage","loc","overlayToRemove","_imageOverlay","getImageUrl","_step","addTo","_overlayToRemove","_scaleImage","_image","_pixelOrigins","getPixelOrigin","pixelOrigin","_removeZoomLimit","extent","extentVarNames","ImageOverlay","_location","_size","_angle","viewreset","_reset","_zoomAnimated","zoomanim","_animateZoom","load","_onImageLoad","_initImage","addInteractiveTarget","removeInteractiveTarget","loaded","Date","_updateOpacity","image","nextFrame","fade","now","setOpacity","cancelAnimFrame","_fadeFrame","requestAnimFrame","maxNext","layerEl","_href","local","_imageContainer","_mapmlTileContainer","_initialize","validProjection","getHref","titleIsReadOnly","_titleIsReadOnly","setName","newName","_title","getName","_properties","_validProjection","_mapmlvectors","_imageLayer","layerGroup","_staticTileLayer","_attachSkipButtons","_calculateBounds","mapExtents","forEach","zoomMax","zoomMin","_templatedLayer","noLayer","_templateVars","projectionMatch","getProjection","_onZoomAnim","toZoom","getMinZoom","getMaxZoom","zoomout","zoomin","getAttribution","attribution","getBase","baseURI","addExtentToLayerControl","contents","_propertiesGroupAnatomy","mapprojection","extentProj","extents","attributes","isMatch","getProjectionFrom","Array","from","label","determineLayerProjection","selectedAlternate","selectMatchingAlternateProjection","_styles","styleLinks","stylesControl","stylesControlSummary","changeStyle","stop","j","styleOption","styleOptionInput","styleOptionLabel","checked","getAlternateStyles","licenseLink","licenseTitle","licenseUrl","attText","legendLink","_legendUrl","attributionControl","addAttribution","parseLicenseAndLegend","textContent","trim","Element","setZoomInOrOutLinks","newTiles","nt","importNode","processTiles","processFeatures","resolvedURL","headMeta","bodyElements","elements","baseURL","copyRemoteContentToShadowRoot","_toggleControls","getQueryTemplates","pcrsClick","layerAndExtents","queryTemplate","getElementsByClassName","_eventParents","attachZoomLink","mapExtent","div","mapFocusButton","_sortIndex","previousButton","featureCount","totalFeatures","nextButton","controlFocusButton","currentIndex","inBoundFeatures","_controlContainer","divider","focusFeature","focusEvent","composedPath","isTab","keyCode","shiftPressed","shiftKey","focusMap","stopPropagation","_popupClosed","featureEl","_groupLayer","_featureEl","whenReady","tL","topLeft","gcrs","bR","bottomRight","latLngBounds","latLng","zoomLink","lng","lat","locale","popupZoom","onclick","onkeydown","MouseEvent","zoomTo","getContainer","link","insertBefore","featureIndexOverlayOption","removeHandlers","removeEvent","mapSize","_panel","debugPanel","_grid","debugGrid","_panes","mapPane","_vectors","debugVectors","toolPane","DebugPanel","debug","_infoContainer","_debugContainer","infoContainer","_tileCoord","_tileMatrixCoord","_mapCoord","_tcrsCoord","_pcrsCoord","_gcrsCoord","_updateCoords","_visible","project","pointI","pointJ","trunc","toFixed","DebugGrid","join","outline","DebugVectors","LayerGroup","_mapLayerUpdate","_centerVector","circle","pointToLatLng","radius","_addBounds","colors","boundsArray","boundsTestTag","parentLayer","boundsRect","projectedExtent","weight","fillOpacity","fill","totalBounds","totalLayerBounds","totalBoundsArray","ProjectedExtent","Path","unproject","_locations","locations","_rings","_subtract","_parts","_renderer","_updatePoly","QueryHandler","Handler","addHooks","_queryTopLayer","_queryTopLayerAtMapCenter","removeHooks","_getTopQueryableLayer","l","mapmlLayer","_layer","queryable","event","isFocused","layerPoint","latLngToLayerPoint","latLngToContainerPoint","_query","tcrs2pcrs","tcrs2gcrs","popupOptions","autoPan","maxHeight","tcrsClickLoc","latLngToPoint","tileMatrixClickLoc","tileBounds","Bounds","ceil","fetches","column","longitude","latitude","contenttype","get","Error","mapmldoc","slice","queryMetas","geom","err","message","fetchFeatures","allSettled","f","results","openPopup","_popup","displayFeaturesPopup","ContextMenu","_touchstart","msPointer","pointer","activeIndex","excludedIndices","isRunned","_menuItems","CTXBACK","CTXFWD","CTXRELOAD","CTXFULLSCR","CTXSPACER1","CTXCOPY","CTXPASTE","CTXSPACER2","CTXCNTRLS","CTXDEBUG","CTXVWSRC","_items","cmBack","callback","_goBack","cmForward","_goForward","cmReload","_reload","btnFullScreen","_toggleFullScreen","spacer","cmCopyCoords","_copyCoords","hideOnSelect","submenu","cmCopyMapML","_copyMapML","cmCopyExtent","_copyExtent","cmCopyLocation","_copyLocation","cmPasteLayer","_paste","cmToggleControls","cmToggleDebug","_toggleDebug","cmViewSource","_viewSource","defExtCS","defaultExtCoor","defLocCS","defaultLocCoor","LYRZOOMTO","LYRCOPY","_layerItems","lmZoomToLayer","_zoomToLayer","lmCopyLayer","_copyLayer","_mapMenuVisible","_keyboardEvent","_createItem","_copySubMenu","_clickEvent","CPYMENUMAP","CPYMENUEXTENT","CPYMENULOC","t","_hide","_onKeyDown","touch","contextmenu","_show","mousedown","_updateCS","KeyboardEvent","coord","data","_copyData","_layerClicked","layerElem","getOuterHTML","forward","back","reload","controls","outerHTML","replace","navigator","clipboard","readText","_pasteLayer","viewSource","toggleDebug","directory","_showCopySubMenu","body","execCommand","menu","_copyTile","_copyTileMatrix","_copyMap","_copyTCRS","_copyPCRS","_copyGCRS","click","firstElementChild","caption","h2","pt","pointX","pointY","mapPt","_copyAllCoords","allData","index","_createSeparator","_insertElementAt","_createEventHandler","_onItemMouseOver","_onItemMouseOut","func","_showLocation","containerPointToLayerPoint","layerPointToLatLng","refEl","closest","_showAtPoint","layerList","find","gecko","w","getBoundingClientRect","h","button","activeEl","activeElement","_elementInFocus","_layerMenuTabs","firstChild","_setPosition","anchor","containerSize","_getElementSize","contextmenuAnchor","_leaflet_pos","_sizeChanged","offsetWidth","offsetHeight","_focusOnLayerControl","_setActiveItem","noActiveEl","next","disabled","nextIndex","prevIndex","code","copyEl","menuWidth","submenuWidth","_hideCopySubMenu","srcElement","toggleContextMenuItem","state","setViewFullScreenInnerHTML","btnExitFullScreen","tcrsTopLeft","tcrsBottomRight","tileMatrixTopLeft","tileMatrixBottomRight","minConverted","maxConverted","unprojectedMin","unprojectedMax","tcrs","FALLBACK_PROJECTION","boundsUnit","FALLBACK_CS","defaultMaxZoom","nativeMinZoom","nativeMaxZoom","locInputs","numberOfAxes","boundsFallbackPCRS","isFinite","minPixel","maxPixel","minGCRS","maxGCRS","pixelToPCRSPoint","pointToPCRSPoint","contentArray","stringSplit","prop","containerPoints","pairs","styleElm","ss","stylesheets","linkElm","s","element","array","a","_parseNumber","leafletLayer","justPan","hash","inPlace","window","open","postTraversalSetup","lon","metaKeys","axes","csToAxes","nMin","nMax","mapmlEl","dfLayer","lastElementChild","lastChild","dfPastedLayer","geojson2mapml","JSON","parse","json","table","thead","createTHead","insertRow","th1","th2","createTextNode","tbody","createTBody","hasOwnProperty","th","td","bboxExtent","geometryFunction","jsonType","out","setExtent","bbox","xmlStringLayer","multiPoint","linestring","multilinestring","polygon","multiPolygon","geometrycollection","Infinity","NEGATIVE_INFINITY","clone_feature","curr_feature","featureCaption","p","HTMLElement","_properties2Table","_updateExtent","coordinates","clone_point","clone_coords","clone_linestring","linestring_coordindates","clone_polygon","clone_multipoint","clone_multilinestring","m","geometries","fg","arr","arrayOfArrays","test","tableData","tr","source","dest","pointConv","proj4","_breakArray","_pcrsToGcrs","poly","newArr","conv","propertyFunction","Proj","metas","ex","num","_table2properties","prop0","_geometry2geojson","geoms","n","bound","newZoom","mapCenterTCRS","mapHalf","mapTlNew","mapBrNew","mapTlPCRSNew","mapBrPCRSNew","mapPCRS","zOffset","AttributionButton","Attribution","prefix","disableClickPropagation","_addAttribution","dialog","kbdShortcuts","kbdMovement","kbdPanUp","kbdPanDown","kbdPanLeft","kbdPanRight","btnZoomIn","btnZoomOut","kbdPanIncrement","kbdZoom","kbdFeature","kbdPrevFeature","kbdNextFeature","attribs","_attributions","prefixAndAttribs","btnAttribution","Map","mergeOptions","toggleableAttributionControl","addInitHook","attributionButton","reloadButton","ReloadButton","scaleBar","ScaleBar","_goReload","_reloadButton","_updateDisabled","disable","_disabled","enable","Scale","maxWidth","updateWhenIdle","scaleControl","_scaleControl","_updateOutput","_focusOutput","addEventListener","_pixelsToDistance","px","dpi","devicePixelRatio","_scaleLength","scaleLength","outputFocus","output","scaleLine","distance","metric","FullscreenButton","false","true","_toggleTitle","_click","toggleFullscreen","isFullscreen","include","_isFullscreen","getRootNode","host","pseudoFullscreen","_disablePseudoFullscreen","exitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","_enablePseudoFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","ALLOW_KEYBOARD_INPUT","msRequestFullscreen","_setFullscreen","fullscreen","invalidateSize","_onFullscreenChange","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","fullscreenControl","fullscreenchange","onFullscreenChange","addControl","fullscreenButton","geolocationButton","GeolocationButton","crosshair","Crosshair","Geometry","CustomLocate","Locate","start","locateControl","showPopup","strings","btnLocTrackOff","locateOptions","MutationObserver","mutations","btnLocTrackOn","_marker","btnMyLocTrackOn","permanent","btnLocTrackLastKnown","btnMyLastKnownLocTrackOn","observe","attributeFilter","_isQueryable","_toggleEvents","_isMapFocused","_addOrRemoveCrosshair","_hasQueryableLayer","_addOrRemoveMapOutline","mapContainer","_outline","isLeafletContainer","_convertWrappers","_markup","_convertMarkup","_generateOutlinePoints","isClosed","_isClosed","attachLinkHandler","dragStart","hovered","handleMouse","visited","clientX","clientY","mouseup","onTop","nextLayer","nextElementSibling","eventPhase","Event","BUBBLING_PHASE","sqrt","pow","_handleLink","currentTarget","resolver","mapWidth","clientWidth","substring","mouseout","mouseenter","addedMap","tileOrigin","zoomingTo","origin","pixelRings","_convertRing","rings","subP","subrings","pixelSubrings","pixelOutline","o","parts","sub","interm","points","attr","featureAttributes","tabindex","first","ring","subRings","_coordinateToArrays","cls","class","nodes","childNodes","cur","tempDiv","prev","line","ind","main","subParts","isFirst","parents","span","noSpan","numPair","attrMap","wrapperAttr","unshift","linkTarget","linkType","getPCRSCenter","stampLayer","outlinePath","_createPath","stroke","_updateStyle","entries","_rootGroup","outlineAdded","_removePath","_setPath","geometryToPath","_pointToMarker","_updatePathStyle","isMain","isOutline","lineCap","lineJoin","dashArray","dashOffset","fillColor","fillRule","def","closed","str","len2","firstLayer","_openPopup","_handleFocus","updateInteraction","layerID","addToIndex","part","subPart","vectorMinZoom","vectorMaxZoom","openTooltip","closeTooltip","prevFocus","nextFocus","AnnounceMovement","layeradd","layerremove","announceBounds","dragging","_draggable","dragged","focusAnnouncement","removeEventListener","standard","amZoom","amMaxZoom","_layersMinZoom","amMinZoom","_traversalCall","visible","outOfBoundsPos","prevZoom","_historyIndex","inBoundsPos","pop","amZoomedOut","wasDragged","amDraggedOut","amEastBound","amWestBound","amNorthBound","amSouthBound","whenLayersReady","extentToBounds","FeatureIndex","outBoundFeatures","_mapPCRSBounds","_updateMapBounds","lc","mc","dist","tmp","inbound","sort","b","ac","bc","Options","announceMovement","announceScale","imperial","lcOpacity","amColumn","amRow","dfExtent","fIndexNoFeatures","Keyboard","altKey","metaKey","offset","_panKeys","_panAnim","_inProgress","ctrlKey","panBy","maxBounds","panInsideBounds","_zoomKeys","187","107","61","171","189","109","54","173","setZoom","closeOnEscapeKey","featureIndexOverlay","FeatureIndexOverlay","createLayerControlExtentHTML","extentProperties","extentSettings","extentLabel","svgExtentControlIcon","extentControlPath1","extentControlPath2","extentNameIcon","extentItemControls","opacityControl","extentOpacitySummary","_userInputs","frag","createDocumentFragment","_selectdetails","selectdetails","selectsummary","mapmlInput","selectSummaryLabel","removeExtentButton","extentsettingsButton","extentItemNameSpan","defaultChecked","_layerControlCheckbox","ontouchstart","onmousedown","downEvent","TouchEvent","touches","control","moving","yPos","originalPosition","ontouchmove","onmousemove","moveEvent","abs","pointerEvents","root","elementAt","elementFromPoint","swapControl","nextSibling","ontouchend","onmouseup","newPosition","controlsElems","_extentRootFieldset","_opacityControl","_layerControlLabel","createLayerControlHTML","fieldset","layerItemName","settingsButtonNameIcon","layerItemProperty","layerItemSettings","itemToggleLabel","layerItemControls","opacityControlSummary","svgSettingsControlIcon","settingsControlPath1","settingsControlPath2","extentsFieldset","removeControlButton","disbaled","previousElementSibling","itemSettingControlButton","_layerControl","draggable","_layerItemSettingsHTML","_output","_body","initialFocus","_addOrRemoveFeatureIndex","_checkOverlap","_calculateReticleBounds","wRatio","hRatio","reticleDimension","getComputedStyle","minPoint","maxPoint","popupClosed","featureIndexBounds","noFeaturesMessage","allFeatures","_addToggleKeys","_newContent","direction","newContent","ZoomInput","constructor","validateInput","getValue","HiddenInput","WidthInput","HeightInput","LocationInput","axisCS","_getTiledPixelBounds","tileRange","_pxBoundsToTileRange","_tileZoom","DOMTokenList","#element","#valueSet","#attribute","#domain","initialValue","attribute","domain","hostingElement","domtokenlist","valueSet","val","item","token","oldToken","newToken","supports","toggle","force","thisArg","detectImagePath","getStyle","mime","mapOptions","head","WGS84","CRS","CBMTILE","APSTILE","OSMTILE","EPSG3857","convertPCRSBounds","axisToXY","_convertAndFormatPCRS","_splitCoordinate","_coordsToArray","_gcrsToTileMatrix","mapml2geojson","getBounds","getZoomBounds","_createLayerControlExtentHTML","_createLayerControlHTML","TILE_SIZE"],"mappings":"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"}