"use strict";(self.webpackChunkmapml_viewer_doc=self.webpackChunkmapml_viewer_doc||[]).push([[9013],{3211:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>a,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var n=t(4848),l=t(8453);const r={id:"creating-styles",title:"Cr\xe9ation de styles mvt personnalis\xe9s",slug:"/user-guide/creating-styles"},i=void 0,o={id:"user-guide/creating-styles",title:"Cr\xe9ation de styles mvt personnalis\xe9s",description:"Qu'est-ce qu'un fichier mvt",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/user-guide/creating-styles.md",sourceDirName:"user-guide",slug:"/user-guide/creating-styles",permalink:"/web-map-doc/fr/docs/user-guide/creating-styles",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"creating-styles",title:"Cr\xe9ation de styles mvt personnalis\xe9s",slug:"/user-guide/creating-styles"},sidebar:"sidebar",previous:{title:"Guide de d\xe9marrage rapide MapML",permalink:"/web-map-doc/fr/docs/user-guide/quick-start"},next:{title:"Utilisation des styles mvt",permalink:"/web-map-doc/fr/docs/user-guide/using-styles"}},a={},d=[{value:"Qu&#39;est-ce qu&#39;un fichier mvt",id:"quest-ce-quun-fichier-mvt",level:2},{value:"Que sont les fichiers pmtiles",id:"que-sont-les-fichiers-pmtiles",level:2},{value:"Comment cr\xe9er un module de feuille de style",id:"comment-cr\xe9er-un-module-de-feuille-de-style",level:2},{value:"La structure requise de la \xab feuille de style \xbb de pmtiles",id:"la-structure-requise-de-la--feuille-de-style--de-pmtiles",level:2},{value:"Symboles import\xe9s disponibles \xe0 partir de protomaps-leaflet",id:"symboles-import\xe9s-disponibles-\xe0-partir-de-protomaps-leaflet",level:2}];function c(e){const s={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h2,{id:"quest-ce-quun-fichier-mvt",children:"Qu'est-ce qu'un fichier mvt"}),"\n",(0,n.jsxs)(s.p,{children:["Les fichiers ",(0,n.jsx)(s.a,{href:"https://github.com/mapbox/vector-tile-spec",children:"Mapbox vector tiles (mvt)"})," sont un encodage standard de facto de donn\xe9es cartographiques\noptimis\xe9es pour un rendu sur des \xe9l\xe9ments HTML canvas via JavaScript et/ou des informations de style encod\xe9es bas\xe9es sur JSON.  Les r\xe8gles relatives\naux feuilles de style en cascade ne s'appliquent pas, car le contenu mvt n'est pas expos\xe9 via les API des navigateurs.  Les r\xe8gles de style, bien\nque ",(0,n.jsx)(s.a,{href:"https://glazkov.com/2024/01/16/declarative-vs-imperative/",children:"en quelque sorte d\xe9claratives"}),", sont mises en \u0153uvre dans le script."]}),"\n",(0,n.jsx)(s.h2,{id:"que-sont-les-fichiers-pmtiles",children:"Que sont les fichiers pmtiles"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.a,{href:"https://docs.protomaps.com/pmtiles/",children:"pmtiles"})," est un format d'archivage de tuiles de cartes qui vise \xe0 \xe9viter (en partie) le besoin de serveurs\ncomplexes et des API sp\xe9cifiques au domaine g\xe9ospatiale pour les ressources de tuiles sur le web, afin de permettre aux gens de cr\xe9er leurs\npropres sites de cartes web localis\xe9es sans avoir \xe0 h\xe9berger le monde entier sur leur domaine.  Le format d'archive pmtiles contient des m\xe9tadonn\xe9es\nqui peuvent \xeatre demand\xe9es via des requ\xeates http par plage d'octets, et les requ\xeates ult\xe9rieures pour des tuiles individuelles sont \xe9galement envoy\xe9es\nsous forme de requ\xeates par plage d'octets."]}),"\n",(0,n.jsxs)(s.p,{children:["Les ",(0,n.jsx)(s.a,{href:"../elements/link#type",children:"formats"})," de l'archive de carte pmtiles et mvt  dans le polyfill MapML sont int\xe9gr\xe9s via\n",(0,n.jsx)(s.a,{href:"https://docs.protomaps.com/pmtiles/leaflet",children:"la biblioth\xe8que protomaps-leaflet"}),".  Protomaps-leaflet est con\xe7ue pour prendre en charge\nla grille de tuiles Web Mercator (standard de facto). Cela permet au polyfill MapML d'int\xe9grer le support des sources de donn\xe9es pmtiles\net mvt pour la seule projection ",(0,n.jsx)(s.code,{children:"OSMTILE"}),".  Les \xe9l\xe9ments ",(0,n.jsx)(s.code,{children:"<map-layer>"})," et ",(0,n.jsx)(s.code,{children:"<map-extent>"})," ainsi que le ",(0,n.jsx)(s.code,{children:"<mapml-viewer>"}),"\nne fonctionneront pas (et seront \xab d\xe9sactiv\xe9s \xbb de fa\xe7on permanente) s'ils sont utilis\xe9s avec des valeurs ",(0,n.jsx)(s.code,{children:"<mapml-viewer projection=\xab ANYTHING \xbb...>"}),"\nou ",(0,n.jsx)(s.code,{children:"<map-extent units=\xab ANYTHING \xbb...>"})," autres que ",(0,n.jsx)(s.code,{children:"OSMTILE"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["Avant de poursuivre, nous vous conseillons de lire la documentation ",(0,n.jsx)(s.a,{href:"https://docs.protomaps.com/pmtiles/leaflet#custom-vector-data",children:"protomaps-leaflet"}),"\nsur la personnalisation du style. Une autre source d'information utile sur le style comprend\n",(0,n.jsx)(s.a,{href:"https://github.com/protomaps/protomaps-leaflet/tree/main/examples",children:"les exemples du code source"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["Des exemples pratiques de l'utilisation des th\xe8mes et des styles par ",(0,n.jsx)(s.code,{children:"<mapml-viewer>"})," sont ",(0,n.jsx)(s.a,{href:"https://maps4html.org/experiments/vector-tiles/pmtiles/",children:"disponibles en ligne"}),", avec ",(0,n.jsx)(s.a,{href:"https://github.com/Maps4HTML/experiments/tree/main/vector-tiles/pmtiles",children:"code source"}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"comment-cr\xe9er-un-module-de-feuille-de-style",children:"Comment cr\xe9er un module de feuille de style"}),"\n",(0,n.jsxs)(s.p,{children:["Une feuille de style pmtiles utilis\xe9e dans le polyfill MapML est un fichier source de module JavaScript qui exporte deux symboles, une instance de \xab Map \u201c ",(0,n.jsx)(s.code,{children:"pmtilesRules"}),", et une promesse ",(0,n.jsx)(s.code,{children:"pmtilesRulesReady"}),", qui est r\xe9solue lorsque le \xab Sheet \xbb requis est charg\xe9, selon l'exemple suivant :"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:'const sheet = new protomapsL.Sheet(`\n<html>\n  <body>\n    <svg id="icon_0" width="99px" height="97px" xmlns="http://www.w3.org/2000/svg">\n      <image href="data:image/svg+xml;base64,PHN2ZyBpZD0iaWNvbl82NCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgICAgPGltYWdlIGhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQkFBQUFBUUNBWUFBQUFmOC85aEFBQUFDWEJJV1hNQUFBN0VBQUFPeEFHVkt3NGJBQUFBMlVsRVFWUjRuTldQTVdvQ1lSQ0Z2MElDZ2xZaFZnRUwzZmNyZGlsczBteVJUdkFLa2xaSXdKM2ZpTjE2aGhoeUFCRkVjZ2J2WUtFbmtCUkpiNWtFSlRheXNNdFd5WVBYRFBPOW1RZC9YcjVHSlRkc1Rhb21wdm12TzBZbVB1T1FRcjRQeE5yRXR3L29wQzdITFM1TVRFd3NEdmFPdHdOOERCRGIwenh5eklkMWJoSkQraTFLWHN4T1lJSjN2a0dZM2ozZ1BnRmVqUnRjWnVvK2ROeWVCM2l4Skt0TXZQeUNtMGc4bS9neXNYOXlsRlBoT0tUZ3hZYzVYZ2ZYRkkrVnhKMkpkeE85MUlDQmFFZU83dm44b2M2VkQzak1YT1AvNkFmS0Ywd3dXeU9Oc3dBQUFBQkpSVTVFcmtKZ2dnPT0iIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIvPgogICAgPC9zdmc+" width="99" height="97" />\n    </svg>\n  </body>\n</html>\n`);\nconst pmtilesRules = new Map();\nconst pmtilesRulesReady = sheet.load().then(() => {\n  ...\n  pmtilesRules.set(\n    \'https://maps4html.org/experiments/vector-tiles/pmtiles/spearfish.pmtiles?theme=light\',\n    { theme: { theme: \'light\' } }\n  );\n  ...\n  return pmtilesRules;\n});\nexport { pmtilesRules, pmtilesRulesReady };\n'})}),"\n",(0,n.jsx)(s.admonition,{type:"tip",children:(0,n.jsxs)(s.p,{children:["Les th\xe8mes pr\xe9d\xe9finis que vous pouvez utiliser sont les suivants : ",(0,n.jsx)(s.code,{children:"light"}),", ",(0,n.jsx)(s.code,{children:"dark"}),", ",(0,n.jsx)(s.code,{children:"white"}),", ",(0,n.jsx)(s.code,{children:"grayscale"})," et ",(0,n.jsx)(s.code,{children:"black"}),". Vous devez inclure le nom du\nth\xe8me dans le mod\xe8le d'URL en tant que param\xe8tre (m\xeame s'il n'est pas requis par la ressource pmtiles ou mvt), afin que le mod\xe8le d'URL puisse \xeatre\nrendu unique et distinct des autres cl\xe9s ",(0,n.jsx)(s.code,{children:"pmtilesRules"})," utilisant la m\xeame ressource pmtiles ou mvt."]})}),"\n",(0,n.jsx)(s.h2,{id:"la-structure-requise-de-la--feuille-de-style--de-pmtiles",children:"La structure requise de la \xab feuille de style \xbb de pmtiles"}),"\n",(0,n.jsxs)(s.p,{children:["Le module de feuille de style doit exporter deux symboles : ",(0,n.jsx)(s.code,{children:"pmtilesRulesReady"})," et ",(0,n.jsx)(s.code,{children:"pmtilesRules"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["L'export ",(0,n.jsx)(s.code,{children:"pmtilesRulesReady"})," doit \xeatre une promesse qui signale \xe0 la biblioth\xe8que MapML que l'export pmttilesRules est enti\xe8rement d\xe9fini et pr\xeat pour le rendu.  Si votre feuille de style utilise IconSymbolizer, il peut \xeatre pratique d'effectuer le chargement et le traitement des ressources via la fonction asynchrone Sheet.load(), qui renvoie elle-m\xeame un objet Promise qui peut \xeatre renvoy\xe9 par votre feuille de style en tant que valeur pmtilesRulesReady, comme dans l'exemple ci-dessus. Si votre feuille de style ne n\xe9cessite pas d'ic\xf4nes, il devrait \xeatre possible d'assigner un objet Promise d\xe9j\xe0 r\xe9solue comme valeur de pmtilesRulesReady, via Promise.resolve(), et de la retourner."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"const pmtilesRules = new Map() ;\n// une Map n\xe9cessite une cl\xe9, dans ce cas l'URL absolue de la source de donn\xe9es (mais,\n// peut aussi \xeatre la valeur absolue de l'URL _template_ de la source de donn\xe9es),\n// et un objet \xe0 mapper par la cl\xe9, dans ce cas, un objet avec un membre `theme`\n// dont la valeur est elle-m\xeame un objet avec un membre `theme`.\npmtilesRules.set(\n    'https://maps4html.org/experiments/vector-tiles/pmtiles/spearfish.pmtiles?theme=light',\n    { theme : { theme : 'light' } }\n) ;\nconst pmtilesRulesReady = Promise.resolve() ;\nexport { pmtilesRules, pmtilesRulesReady } ;\n"})}),"\n",(0,n.jsxs)(s.p,{children:["L'export ",(0,n.jsx)(s.code,{children:"pmtilesRules"})," doit \xeatre un ",(0,n.jsx)(s.a,{href:"https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Map",children:"JavaScript Map-type object"}),", structur\xe9 comme suit :"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"doit avoir une cl\xe9 unique de type \xab URL template string \xbb qui sera utilis\xe9e sur le web pour identifier un ensemble de r\xe8gles"}),"\n",(0,n.jsxs)(s.li,{children:["a une valeur d'objet qui a une propri\xe9t\xe9 ",(0,n.jsx)(s.code,{children:"theme"})," ou ",(0,n.jsx)(s.code,{children:"rules"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:["La propri\xe9t\xe9 ",(0,n.jsx)(s.code,{children:"theme"})," doit \xeatre un objet litt\xe9ral, lui-m\xeame avec une propri\xe9t\xe9 ",(0,n.jsx)(s.code,{children:"theme"})," avec une valeur de nom de th\xe8me en cha\xeene : ",(0,n.jsx)(s.code,{children:"{theme:{theme:'grayscale'}}"})]}),"\n",(0,n.jsxs)(s.li,{children:["la propri\xe9t\xe9 ",(0,n.jsx)(s.code,{children:"rules"})," doit \xeatre un objet litt\xe9ral, avec ",(0,n.jsx)(s.code,{children:"PAINT_RULES : [...]"})," et/ou un tableau ",(0,n.jsx)(s.code,{children:"LABEL_RULES : [...]"})," avec des propri\xe9t\xe9s \xe0 valeur de tableau"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"PAINT_RULES"})," et ",(0,n.jsx)(s.code,{children:"LABEL_RULES"})," sont des tableaux d'objets ayant les propri\xe9t\xe9s requises ",(0,n.jsx)(s.code,{children:"dataLayer"})," et ",(0,n.jsx)(s.code,{children:"symbolizer"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"PAINT_RULES"})," et ",(0,n.jsx)(s.code,{children:"LABEL_RULES"})," peuvent avoir des propri\xe9t\xe9s optionnelles telles que ",(0,n.jsx)(s.code,{children:"filter"}),", ",(0,n.jsx)(s.code,{children:"minzoom"}),", ",(0,n.jsx)(s.code,{children:"maxzoom"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"dataLayer"})," est une propri\xe9t\xe9 de type chaine de caract\xe8res qui est le nom d'une couche encod\xe9e dans les donn\xe9es mvt"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"symbolizer"})," est une propri\xe9t\xe9 de type ",(0,n.jsx)(s.code,{children:"Symbolizer"}),"."]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"Voici un exemple de module de feuille de style pmtiles personnalis\xe9 pour un groupe de couches GeoServer localhost 'spearfish' (configur\xe9 avec un cache de tuiles mvt) :"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"class SpearfishSymbolizer {\n  constructor(options) {\n    this.color = options.color;\n    this.shape = options.shape;\n  }\n  draw(context, geom, z, feature) {\n    let pt = geom[0][0];\n    context.fillStyle = this.color;\n    context.strokeStyle = this.color;\n    context.beginPath();\n    if (this.shape === 'circle') {\n      context.arc(pt.x, pt.y, 3, 0, 2 * Math.PI);\n    } else {\n      context.rect(pt.x - 2, pt.y - 2, 4, 4);\n    }\n    context.stroke();\n    context.fill();\n  }\n}\n// la seule autre valeur de cl\xe9 pmtilesRules en plus de `theme` qui est support\xe9e est \n// un objet avec un membre `rules`. La valeur du membre `rules` est un objet \n// qui a deux membres optionnels de type tableau, `PAINT_RULES` et `LABEL_RULES`.\nconst pmtilesRules = new Map();\npmtilesRules.set(\n  'http://localhost:8080/geoserver/gwc/service/wmts/rest/spearfish/OSMTILE/{z}/{y}/{x}?format=application/vnd.mapbox-vector-tile',\n  {\n// PAINT_RULES et LABEL_RULES sont chacun un tableau d'objets dataLayer/symbolizer, \n// avec un membre facultatif `filter` \xe0 valeur de fonction (le filtre est \n// membre du m\xeame objet que celui de l'objet dataLayer et symbolizer, et non pas \n// une propri\xe9t\xe9 de ces objets).\n    rules: {\n      PAINT_RULES: [\n        {\n          dataLayer: 'streams',\n          symbolizer: new protomapsL.LineSymbolizer({ color: 'steelblue', width: 2 })\n        },\n        {\n          dataLayer: 'roads',\n          symbolizer: new protomapsL.LineSymbolizer({ color: 'maroon', width: 2 })\n        },\n        {\n          dataLayer: 'restricted',\n          symbolizer: new protomapsL.PolygonSymbolizer({\n            fill: 'red',\n            opacity: 0.5\n          })\n        },\n        {\n          dataLayer: 'restricted',\n          symbolizer: new protomapsL.LineSymbolizer({ color: 'red', width: 2 })\n        },\n        {\n          dataLayer: 'archsites',\n          symbolizer: new SpearfishSymbolizer({\n            color: 'red',\n            shape: 'square'\n          })\n        },\n        {\n          dataLayer: 'bugsites',\n          symbolizer: new SpearfishSymbolizer({\n            color: 'black',\n            shape: 'circle'\n          })\n        }\n      ],\n      LABEL_RULES: [\n        {\n          dataLayer: 'archsites',\n          symbolizer: new protomapsL.CenteredTextSymbolizer({\n            labelProps: ['str1'],\n            fill:'white',\n            width:2,\n            stroke:'black',\n            font:\"600 16px sans-serif\"\n          }),\n          // notez que filter est une propri\xe9t\xe9 d'une r\xe8gle, et non une option pour un symboliseur\n          filter: (z,f) => { return f.props['str1'].trim().toLowerCase() !== 'no name'; }\n        }\n      ]\n    }\n  }\n);\nexport { pmtilesRules };\n"})}),"\n",(0,n.jsx)(s.h2,{id:"symboles-import\xe9s-disponibles-\xe0-partir-de-protomaps-leaflet",children:"Symboles import\xe9s disponibles \xe0 partir de protomaps-leaflet"}),"\n",(0,n.jsxs)(s.p,{children:["Les importations suivantes de protomaps-leaflet sont disponibles dans l'importation ",(0,n.jsx)(s.code,{children:"protomapsL"}),", pour \xeatre utilis\xe9es par vos feuilles de style :"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"/* \n\n  CenteredSymbolizer,\n  CenteredTextSymbolizer,\n  CircleSymbolizer,\n  FlexSymbolizer,\n  Font,\n  GeomType,\n  GroupSymbolizer,\n  IconSymbolizer,\n  Index,\n  Justify,\n  Labeler,\n  Labelers,\n  LineLabelPlacement,\n  LineLabelSymbolizer,\n  LineSymbolizer,\n  OffsetSymbolizer,\n  OffsetTextSymbolizer,\n  Padding,\n  PmtilesSource,\n  PolygonSymbolizer,\n  Sheet,\n  ShieldSymbolizer,\n  Static,\n  TextPlacements,\n  TextSymbolizer,\n  TileCache,\n  View,\n  ZxySource,\n  arr,\n  covering,\n  createPattern,\n  exp,\n  getZoom,\n  isCcw,\n  isInRing,\n  labelRules,\n  leafletLayer,\n  linear,\n  paint,\n  paintRules,\n  pointInPolygon,\n  pointMinDistToLines,\n  pointMinDistToPoints,\n  sourcesToViews,\n  step,\n  toIndex,\n  transformGeom,\n  wrap\n*/\n"})})]})}function u(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>i,x:()=>o});var n=t(6540);const l={},r=n.createContext(l);function i(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);