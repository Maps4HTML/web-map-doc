"use strict";(self.webpackChunkmapml_viewer_doc=self.webpackChunkmapml_viewer_doc||[]).push([[9013],{3211:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var t=n(4848),r=n(8453);const i={id:"creating-styles",title:"Cr\xe9ation de styles mvt personnalis\xe9s",slug:"/user-guide/creating-styles"},l=void 0,o={id:"user-guide/creating-styles",title:"Cr\xe9ation de styles mvt personnalis\xe9s",description:"Qu'est-ce qu'un fichier mvt",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/user-guide/creating-styles.md",sourceDirName:"user-guide",slug:"/user-guide/creating-styles",permalink:"/web-map-doc/fr/docs/user-guide/creating-styles",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"creating-styles",title:"Cr\xe9ation de styles mvt personnalis\xe9s",slug:"/user-guide/creating-styles"},sidebar:"sidebar",previous:{title:"Guide de d\xe9marrage rapide MapML",permalink:"/web-map-doc/fr/docs/user-guide/quick-start"},next:{title:"Utilisation des styles mvt",permalink:"/web-map-doc/fr/docs/user-guide/using-styles"}},a={},c=[{value:"Qu&#39;est-ce qu&#39;un fichier mvt",id:"quest-ce-quun-fichier-mvt",level:2},{value:"Que sont les fichiers pmtiles",id:"que-sont-les-fichiers-pmtiles",level:2},{value:"Comment cr\xe9er un module de feuille de style",id:"comment-cr\xe9er-un-module-de-feuille-de-style",level:2},{value:"Symboles import\xe9s disponibles \xe0 partir de protomaps-leaflet",id:"symboles-import\xe9s-disponibles-\xe0-partir-de-protomaps-leaflet",level:2}];function d(e){const s={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h2,{id:"quest-ce-quun-fichier-mvt",children:"Qu'est-ce qu'un fichier mvt"}),"\n",(0,t.jsxs)(s.p,{children:["Les fichiers ",(0,t.jsx)(s.a,{href:"https://github.com/mapbox/vector-tile-spec",children:"Mapbox vector tiles (mvt)"})," sont un encodage standard de facto de donn\xe9es cartographiques\noptimis\xe9es pour un rendu sur des \xe9l\xe9ments HTML canvas via JavaScript et/ou des informations de style encod\xe9es bas\xe9es sur JSON.  Les r\xe8gles relatives\naux feuilles de style en cascade ne s'appliquent pas, car le contenu mvt n'est pas expos\xe9 via les API des navigateurs.  Les r\xe8gles de style, bien\nque ",(0,t.jsx)(s.a,{href:"https://glazkov.com/2024/01/16/declarative-vs-imperative/",children:"en quelque sorte d\xe9claratives"}),", sont mises en \u0153uvre dans le script."]}),"\n",(0,t.jsx)(s.h2,{id:"que-sont-les-fichiers-pmtiles",children:"Que sont les fichiers pmtiles"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.a,{href:"https://docs.protomaps.com/pmtiles/",children:"pmtiles"})," est un format d'archivage de tuiles de cartes qui vise \xe0 \xe9viter (en partie) le besoin de serveurs\ncomplexes et des API sp\xe9cifiques au domaine g\xe9ospatiale pour les ressources de tuiles sur le web, afin de permettre aux gens de cr\xe9er leurs\npropres sites de cartes web localis\xe9es sans avoir \xe0 h\xe9berger le monde entier sur leur domaine.  Le format d'archive pmtiles contient des m\xe9tadonn\xe9es\nqui peuvent \xeatre demand\xe9es via des requ\xeates http par plage d'octets, et les requ\xeates ult\xe9rieures pour des tuiles individuelles sont \xe9galement envoy\xe9es\nsous forme de requ\xeates par plage d'octets."]}),"\n",(0,t.jsxs)(s.p,{children:["Les ",(0,t.jsx)(s.a,{href:"../elements/link#type",children:"formats"})," de l'archive de carte pmtiles et mvt  dans le polyfill MapML sont int\xe9gr\xe9s via\n",(0,t.jsx)(s.a,{href:"https://docs.protomaps.com/pmtiles/leaflet",children:"la biblioth\xe8que protomaps-leaflet"}),".  Protomaps-leaflet est con\xe7ue pour prendre en charge\nla grille de tuiles Web Mercator (standard de facto). Cela permet au polyfill MapML d'int\xe9grer le support des sources de donn\xe9es pmtiles\net mvt pour la seule projection ",(0,t.jsx)(s.code,{children:"OSMTILE"}),".  Les \xe9l\xe9ments ",(0,t.jsx)(s.code,{children:"<map-layer>"})," et ",(0,t.jsx)(s.code,{children:"<map-extent>"})," ainsi que le ",(0,t.jsx)(s.code,{children:"<mapml-viewer>"}),"\nne fonctionneront pas (et seront \xab d\xe9sactiv\xe9s \xbb de fa\xe7on permanente) s'ils sont utilis\xe9s avec des valeurs ",(0,t.jsx)(s.code,{children:"<mapml-viewer projection=\xab ANYTHING \xbb...>"}),"\nou ",(0,t.jsx)(s.code,{children:"<map-extent units=\xab ANYTHING \xbb...>"})," autres que ",(0,t.jsx)(s.code,{children:"OSMTILE"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["Avant de poursuivre, nous vous conseillons de lire la documentation ",(0,t.jsx)(s.a,{href:"https://docs.protomaps.com/pmtiles/leaflet#custom-vector-data",children:"protomaps-leaflet"}),"\nsur la personnalisation du style. Une autre source d'information utile sur le style comprend\n",(0,t.jsx)(s.a,{href:"https://github.com/protomaps/protomaps-leaflet/tree/main/examples",children:"les exemples du code source"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["Des exemples pratiques de l'utilisation des th\xe8mes et des styles par ",(0,t.jsx)(s.code,{children:"<mapml-viewer>"})," sont ",(0,t.jsx)(s.a,{href:"https://maps4html.org/experiments/vector-tiles/pmtiles/",children:"disponibles en ligne"}),", avec ",(0,t.jsx)(s.a,{href:"https://github.com/Maps4HTML/experiments/tree/main/vector-tiles/pmtiles",children:"code source"}),"."]}),"\n",(0,t.jsx)(s.h2,{id:"comment-cr\xe9er-un-module-de-feuille-de-style",children:"Comment cr\xe9er un module de feuille de style"}),"\n",(0,t.jsxs)(s.p,{children:["Une feuille de style pmtiles utilis\xe9e dans le polyfill MapML est un fichier source de module JavaScript qui exporte un seul symbole, qui doit \xeatre nomm\xe9 ",(0,t.jsx)(s.code,{children:"pmtilesRules"})," :"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-javascript",children:"const pmtilesRules = new Map();\n...\npmtilesRules.set(\n  'https://maps4html.org/experiments/vector-tiles/pmtiles/spearfish.pmtiles?theme=light',\n  { theme: { theme: 'light' } }\n);\n...\nexport { pmtilesRules };\n"})}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["Les th\xe8mes pr\xe9d\xe9finis que vous pouvez utiliser sont les suivants : ",(0,t.jsx)(s.code,{children:"light"}),", ",(0,t.jsx)(s.code,{children:"dark"}),", ",(0,t.jsx)(s.code,{children:"white"}),", ",(0,t.jsx)(s.code,{children:"grayscale"})," et ",(0,t.jsx)(s.code,{children:"black"}),". Vous devez inclure le nom du\nth\xe8me dans le mod\xe8le d'URL en tant que param\xe8tre (m\xeame s'il n'est pas requis par la ressource pmtiles ou mvt), afin que le mod\xe8le d'URL puisse \xeatre\nrendu unique et distinct des autres cl\xe9s ",(0,t.jsx)(s.code,{children:"pmtilesRules"})," utilisant la m\xeame ressource pmtiles ou mvt."]})}),"\n",(0,t.jsxs)(s.p,{children:["L'export ",(0,t.jsx)(s.code,{children:"pmtilesRules"})," doit \xeatre un ",(0,t.jsx)(s.a,{href:"https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Map",children:"JavaScript Map-type object"}),", structur\xe9 comme suit :"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"doit avoir une cl\xe9 unique de type \xab URL template string \xbb qui sera utilis\xe9e sur le web pour identifier un ensemble de r\xe8gles"}),"\n",(0,t.jsxs)(s.li,{children:["a une valeur d'objet qui a une propri\xe9t\xe9 ",(0,t.jsx)(s.code,{children:"theme"})," ou ",(0,t.jsx)(s.code,{children:"rules"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["La propri\xe9t\xe9 ",(0,t.jsx)(s.code,{children:"theme"})," doit \xeatre un objet litt\xe9ral, lui-m\xeame avec une propri\xe9t\xe9 ",(0,t.jsx)(s.code,{children:"theme"})," avec une valeur de nom de th\xe8me en cha\xeene : ",(0,t.jsx)(s.code,{children:"{theme:{theme:'grayscale'}}"})]}),"\n",(0,t.jsxs)(s.li,{children:["la propri\xe9t\xe9 ",(0,t.jsx)(s.code,{children:"rules"})," doit \xeatre un objet litt\xe9ral, avec ",(0,t.jsx)(s.code,{children:"PAINT_RULES : [...]"})," et/ou un tableau ",(0,t.jsx)(s.code,{children:"LABEL_RULES : [...]"})," avec des propri\xe9t\xe9s \xe0 valeur de tableau"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"PAINT_RULES"})," et ",(0,t.jsx)(s.code,{children:"LABEL_RULES"})," sont des tableaux d'objets ayant les propri\xe9t\xe9s requises ",(0,t.jsx)(s.code,{children:"dataLayer"})," et ",(0,t.jsx)(s.code,{children:"symbolizer"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"PAINT_RULES"})," et ",(0,t.jsx)(s.code,{children:"LABEL_RULES"})," peuvent avoir des propri\xe9t\xe9s optionnelles telles que ",(0,t.jsx)(s.code,{children:"filter"}),", ",(0,t.jsx)(s.code,{children:"minzoom"}),", ",(0,t.jsx)(s.code,{children:"maxzoom"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"dataLayer"})," est une propri\xe9t\xe9 de type chaine de caract\xe8res qui est le nom d'une couche encod\xe9e dans les donn\xe9es mvt"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"symbolizer"})," est une propri\xe9t\xe9 de type ",(0,t.jsx)(s.code,{children:"Symbolizer"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Voici un exemple de module de feuille de style pmtiles personnalis\xe9 pour un groupe de couches GeoServer localhost 'spearfish' (configur\xe9 avec un cache de tuiles mvt) :"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-javascript",children:"class SpearfishSymbolizer {\n  constructor(options) {\n    this.color = options.color;\n    this.shape = options.shape;\n  }\n  draw(context, geom, z, feature) {\n    let pt = geom[0][0];\n    context.fillStyle = this.color;\n    context.strokeStyle = this.color;\n    context.beginPath();\n    if (this.shape === 'circle') {\n      context.arc(pt.x, pt.y, 3, 0, 2 * Math.PI);\n    } else {\n      context.rect(pt.x - 2, pt.y - 2, 4, 4);\n    }\n    context.stroke();\n    context.fill();\n  }\n}\nconst pmtilesRules = new Map();\npmtilesRules.set(\n  'http://localhost:8080/geoserver/gwc/service/wmts/rest/spearfish/OSMTILE/{z}/{y}/{x}?format=application/vnd.mapbox-vector-tile',\n  {\n    rules: {\n      PAINT_RULES: [\n        {\n          dataLayer: 'streams',\n          symbolizer: new M.protomapsL.LineSymbolizer({ color: 'steelblue', width: 2 })\n        },\n        {\n          dataLayer: 'roads',\n          symbolizer: new M.protomapsL.LineSymbolizer({ color: 'maroon', width: 2 })\n        },\n        {\n          dataLayer: 'restricted',\n          symbolizer: new M.protomapsL.PolygonSymbolizer({\n            fill: 'red',\n            opacity: 0.5\n          })\n        },\n        {\n          dataLayer: 'restricted',\n          symbolizer: new M.protomapsL.LineSymbolizer({ color: 'red', width: 2 })\n        },\n        {\n          dataLayer: 'archsites',\n          symbolizer: new SpearfishSymbolizer({\n            color: 'red',\n            shape: 'square'\n          })\n        },\n        {\n          dataLayer: 'bugsites',\n          symbolizer: new SpearfishSymbolizer({\n            color: 'black',\n            shape: 'circle'\n          })\n        }\n      ],\n      LABEL_RULES: [\n        {\n          dataLayer: 'archsites',\n          symbolizer: new M.protomapsL.CenteredTextSymbolizer({\n            labelProps: ['str1'],\n            fill:'white',\n            width:2,\n            stroke:'black',\n            font:\"600 16px sans-serif\"\n          }),\n          // notez que filter est une propri\xe9t\xe9 d'une r\xe8gle, et non une option pour un symboliseur\n          filter: (z,f) => { return f.props['str1'].trim().toLowerCase() !== 'no name'; }\n        }\n      ]\n    }\n  }\n);\nexport { pmtilesRules };\n"})}),"\n",(0,t.jsx)(s.h2,{id:"symboles-import\xe9s-disponibles-\xe0-partir-de-protomaps-leaflet",children:"Symboles import\xe9s disponibles \xe0 partir de protomaps-leaflet"}),"\n",(0,t.jsxs)(s.p,{children:["Les importations suivantes de protomaps-leaflet sont disponibles sur la variable globale ",(0,t.jsx)(s.code,{children:"M.protomapsL"}),", par exemple ",(0,t.jsx)(s.code,{children:"M.protomapsL.CenteredSymbolizer"}),", pour \xeatre utilis\xe9es par vos feuilles de style :"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-javascript",children:"/* \n\n  CenteredSymbolizer,\n  CenteredTextSymbolizer,\n  CircleSymbolizer,\n  FlexSymbolizer,\n  Font,\n  GeomType,\n  GroupSymbolizer,\n  IconSymbolizer,\n  Index,\n  Justify,\n  Labeler,\n  Labelers,\n  LineLabelPlacement,\n  LineLabelSymbolizer,\n  LineSymbolizer,\n  OffsetSymbolizer,\n  OffsetTextSymbolizer,\n  Padding,\n  PmtilesSource,\n  PolygonSymbolizer,\n  Sheet,\n  ShieldSymbolizer,\n  Static,\n  TextPlacements,\n  TextSymbolizer,\n  TileCache,\n  View,\n  ZxySource,\n  arr,\n  covering,\n  createPattern,\n  exp,\n  getZoom,\n  isCcw,\n  isInRing,\n  labelRules,\n  leafletLayer,\n  linear,\n  paint,\n  paintRules,\n  pointInPolygon,\n  pointMinDistToLines,\n  pointMinDistToPoints,\n  sourcesToViews,\n  step,\n  toIndex,\n  transformGeom,\n  wrap\n*/\n"})})]})}function p(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>o});var t=n(6540);const r={},i=t.createContext(r);function l(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);