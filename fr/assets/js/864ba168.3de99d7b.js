"use strict";(self.webpackChunkmapml_viewer_doc=self.webpackChunkmapml_viewer_doc||[]).push([[5025],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,v=d["".concat(l,".").concat(m)]||d[m]||c[m]||i;return n?r.createElement(v,a(a({ref:t},u),{},{components:n})):r.createElement(v,a({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,a[1]=s;for(var p=2;p<i;p++)a[p]=n[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6954:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(7462),o=(n(7294),n(3905));const i={id:"custom-projections",title:"API de projections personnalis\xe9es",slug:"/api/custom-projections"},a=void 0,s={unversionedId:"api/custom-projections",id:"api/custom-projections",title:"API de projections personnalis\xe9es",description:"Introduction",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/api/custom-projections.md",sourceDirName:"api",slug:"/api/custom-projections",permalink:"/web-map-doc/fr/docs/api/custom-projections",draft:!1,tags:[],version:"current",frontMatter:{id:"custom-projections",title:"API de projections personnalis\xe9es",slug:"/api/custom-projections"},sidebar:"sidebar",previous:{title:"HTMLLayerElement",permalink:"/web-map-doc/fr/docs/api/layer-api"},next:{title:"API de rendu personnalis\xe9",permalink:"/web-map-doc/fr/docs/api/custom-rendering"}},l={},p=[{value:"Introduction",id:"introduction",level:2},{value:"D\xe9tails",id:"d\xe9tails",level:3}],u={toc:p};function c(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"MapML d\xe9finit quelques projections CRS (Syst\xe8me de r\xe9f\xe9rence des coordonn\xe9es) int\xe9gr\xe9es en pav\xe9s, dont la projection Web Mercator (OSMTILE), la projection pseudo-plate carr\xe9e (WGS84) et la grille de pav\xe9s de base du Canada (CBMTILE). "),(0,o.kt)("p",null,"L\u2019\xe9l\xe9ment personnalis\xe9 ",(0,o.kt)("inlineCode",{parentName:"p"},"<mapml-viewer>")," fournit l\u2019interface de programmation d\u2019applications (API) personnalis\xe9e des projections, qui vous permet de cr\xe9er vos propres projections et de les utiliser dans l\u2019\xe9l\xe9ment ",(0,o.kt)("inlineCode",{parentName:"p"},"<mapml-viewer>"),', d\xe9fini avec la syntaxe "proj4" \xe9tendue du langage JSON et prise en charge par la biblioth\xe8que proj4js.'),(0,o.kt)("p",null,"Exemple :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<!doctype html>\n<html lang="en">\n<head>\n  <meta charset="utf-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1">\n  <title>Example Custom Projection</title>\n  <script type="module" src="web-map/mapml-viewer.js"><\/script>\n  <script type="module">\n    let customProjectionDefinition = `{\n      "projection": "ATLAS_POLAR_MAP",\n      "proj4string" : "+proj=aeqd +lat_0=90 +lon_0=-90 +x_0=0 +y_0=0 +ellps=sphere +units=m +no_defs +type=crs",\n      "origin" : [-20015200,20015200],\n      "resolutions" :  [33073,16536.5,8268.246,4134.123,2067.061,1033.531,516.765],\n      "bounds" : [[4979939,-4846977],[-5139071,3980038]],\n      "tilesize" : 256\n      }`;\n    let map = document.querySelector("mapml-viewer");\n    let cProjection = map.defineCustomProjection(customProjectionDefinition);    \n    map.projection = cProjection;\n  <\/script>\n</head>\n<body>\n  <mapml-viewer projection="ATLAS_POLAR_MAP" zoom="2" lat="83.48919" lon="-87.7687" controls>\n    <layer- label="Carte polaire murale de l\u2019Atlas du Canada" checked>\n    <map-link rel="license" title="Plateforme g\xe9ospatiale f\xe9d\xe9rale canadienne" href="https://geoappext.nrcan.gc.ca/arcgis/rest/services/FGP/NCR_RCN/MapServer/"></map-link>\n      <map-extent units="ATLAS_POLAR_MAP">\n        <map-input type="zoom" name="z" min="0" max="6" value="6" ></map-input>\n        <map-input type="location" name="x" axis="column" units="tilematrix" min="116" max="186"></map-input>\n        <map-input type="location" name="y" axis="row" units="tilematrix" min="125" max="184"></map-input>\n        <map-link rel="tile" tref="https://geoappext.nrcan.gc.ca/arcgis/rest/services/FGP/NCR_RCN/MapServer/tile/{z}/{y}/{x}/"></map-link>\n        <map-link rel="tile" tref="https://geoappext.nrcan.gc.ca/arcgis/rest/services/FGP/NCR_RCN_A/MapServer/tile/{z}/{y}/{x}/"></map-link>\n      </map-extent>\n    </layer->\n  </mapml-viewer>\n</body>\n</html>\n')),(0,o.kt)("h3",{id:"d\xe9tails"},"D\xe9tails"),(0,o.kt)("p",null,"Nous n\u2019examinerons pas l\u2019\xe9l\xe9ment ",(0,o.kt)("inlineCode",{parentName:"p"},"<mapml-viewer>")," lui-m\xeame ici, sauf pour dire que l\u2019attribut ",(0,o.kt)("inlineCode",{parentName:"p"},"projection")," de la carte doit avoir la m\xeame valeur que le membre ",(0,o.kt)("inlineCode",{parentName:"p"},"projection")," de l\u2019objet JSON que vous transmettez \xe0 la m\xe9thode ",(0,o.kt)("inlineCode",{parentName:"p"},"defineCustomProjection")," de l\u2019API personnalis\xe9e des projections, et que chaque \xe9l\xe9ment ",(0,o.kt)("inlineCode",{parentName:"p"},"<layer->")," pr\xe9sent dans la carte doit comporter une d\xe9claration et \xeatre programm\xe9 dans ce syst\xe8me de coordonn\xe9es pour s\u2019afficher correctement."),(0,o.kt)("p",null,"L\u2019API personnalis\xe9e des projections est fournie par l\u2019\xe9l\xe9ment ",(0,o.kt)("inlineCode",{parentName:"p"},"<mapml-viewer>"),". Dans un navigateur, elle peut \xeatre d\xe9finie sur l\u2019objet de fen\xeatre. Toutefois, parce que des \xe9l\xe9ments personnalis\xe9s utilisent des modules ES6, il est pratique de la placer sur l\u2019\xe9l\xe9ment de mappage qui l\u2019utilise."),(0,o.kt)("p",null,"Pour que l\u2019appel de la m\xe9thode ",(0,o.kt)("inlineCode",{parentName:"p"},"defineCustomProjection")," r\xe9ussisse, vous devez coder la m\xe9thode de projection et les param\xe8tres de projection sous la forme de membres d\u2019une cha\xeene JSON. La marche \xe0 suivre pour ce faire n\u2019est pas toujours simple, mais diverses ressources peuvent vous faciliter la vie, comme ",(0,o.kt)("a",{parentName:"p",href:"https://spatialreference.org"},"https://spatialreference.org")," o\xf9 vous pouvez obtenir la version proj4 de pratiquement n\u2019importe quelle d\xe9finition SRC."),(0,o.kt)("p",null,'N\u2019oubliez pas de mettre le nom du membre entre guillemets, suivi d\u2019un deux-points. Par exemple, "projection": "NOM_DE_MA_PROJECTION". Les valeurs comportant une cha\xeene sont \xe9galement ins\xe9r\xe9es dans des guillemets, et les nombres et tableaux suivent la ',"[syntaxe JSON]"," normale (",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/fr/docs/Learn/JavaScript/Objects/JSON"},"https://developer.mozilla.org/fr/docs/Learn/JavaScript/Objects/JSON"),")."),(0,o.kt)("p",null,"La d\xe9finition d\u2019une projection personnalis\xe9e requiert plusieurs membres."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"projection"),' - Nom (cha\xeene de caract\xe8res) donn\xe9 \xe0 votre projection. Nous recommandons d\u2019utiliser uniquement des majuscules pour mettre en \xe9vidence le nom des projections. Vous ne pouvez pas mettre un deux-points (":") dans le nom, car ceci cr\xe9erait une confusion avec celui des listes de codes URI EPSG: ou ogc:. En effet, nous d\xe9finissons ici une projection CRS qui comporte des param\xe8tres propres au mappage en ligne, dont nous parlerons plus loin.'),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"proj4string")," - Cette cha\xeene \xe9tant trait\xe9e par ",(0,o.kt)("a",{parentName:"li",href:"http://proj4js.org/"},"proj4js"),", il faut fournir les param\xe8tres d\u2019une m\xe9thode de projection prise en charge par cette biblioth\xe8que et dans un format compatible avec celle-ci."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"origin")," - Tableau \xe0 deux nombres qui repr\xe9sentent l\u2019origine de la grille de pav\xe9s en coordonn\xe9es du syst\xe8me de coordonn\xe9es projet\xe9es, dont les unit\xe9s sont habituellement des m\xe8tres. L\u2019origine se trouve toujours dans le coin sup\xe9rieur gauche de la grille de pav\xe9s, et les num\xe9ros de colonnes et de rang\xe9es augmentent de fa\xe7on s\xe9quentielle, respectivement vers la droite et vers le bas, comme le pr\xe9voit la norme du service Web des pav\xe9s cartographiques (SWPC).  "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"resolutions")," - Tableau de nombres, tri\xe9s selon leur taille en m\xe8tres en ordre d\xe9croissant, des dimensions \xab r\xe9elles \xbb d\u2019un pixel carr\xe9. La r\xe9solution est calcul\xe9e sur la base d\u2019une taille de pixel nominale \xe9tablie \xe0 0,28 mm, telle que d\xe9finie par la norme SWPC. PRENEZ NOTE QUE LES SERVICES DE PAV\xc9S DE L\u2019ENVIRONMENTAL SYSTEMS RESEARCH INSTITUTE (ESRI) NE SE SERVENT HABITUELLEMENT PAS DE CETTE VALEUR PARCE QU\u2019ILS UTILISENT UNE TAILLE NOMINALE DE 96 POINTS PAR POUCES (PPP) (r\xe9glable). Puisque l\u2019\xe9chelle varie dans l\u2019\xe9tendue de tout syst\xe8me de coordonn\xe9es projet\xe9es, la r\xe9solution en pixels n\u2019est habituellement valide que l\xe0 o\xf9 les dimensions sont limit\xe9es, par exemple le long de l\u2019\xe9quateur dans la projection Web Mercator. Les endroits o\xf9 la r\xe9solution en pixels est valide changent en fonction de la m\xe9thode et des param\xe8tres de la projection. Si vous voulez utiliser votre projection personnalis\xe9e avec un service de pav\xe9s existants, l\u2019ensemble de r\xe9solutions doit correspondre \xe0 celui des pav\xe9s dans un cache."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"bounds")," - Tableau compos\xe9 de deux tableaux de paires de coordonn\xe9es, qui d\xe9finit une zone de d\xe9limitation autour d\u2019une partie du syst\xe8me de r\xe9f\xe9rence des coordonn\xe9es projet\xe9es, habituellement en m\xe8tres. Les requ\xeates doivent \xeatre valides, la latitude et la longitude \xe9tant d\xe9finies \xe0 l\u2019int\xe9rieur de ces limites. Les requ\xeates visant des cartes, des pav\xe9s et des transformations de coordonn\xe9es qui d\xe9passent ces limites ne seront pas ex\xe9cut\xe9es pour \xe9liminer le trafic redondant et les erreurs.  "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"tilesize")," - Les pav\xe9s sont toujours carr\xe9s et ont habituellement 256 pixels d\u2019ar\xeate, mais vous pouvez ajuster cette dimension par un nombre entier. Les nombres 256, 512, 1024, 2048 ou 4096 devraient tous fonctionner.")))}c.isMDXComponent=!0}}]);