{"version":3,"file":"map-select.js","sources":["../src/map-select.js"],"sourcesContent":["export class MapSelect extends HTMLElement {\n  static get observedAttributes() {\n    return ['name', 'id'];\n  }\n  get name() {\n    return this.getAttribute('name');\n  }\n  set name(val) {\n    this.setAttribute('name', val);\n  }\n  get id() {\n    return this.getAttribute('id');\n  }\n  set id(val) {\n    this.setAttribute('id', val);\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    switch (name) {\n      case 'name':\n        if (oldValue !== newValue) {\n          // handle side effects\n        }\n        break;\n      case 'id':\n        if (oldValue !== newValue) {\n          // handle side effects\n        }\n        break;\n    }\n  }\n  constructor() {\n    // Always call super first in constructor\n    super();\n  }\n  connectedCallback() {\n    this._extentEl = this.parentElement;\n    // TODO make the layer redraw after map-select change event\n    // origin of this block was in _initTemplateVars from map-extent, which was\n    // originally part of MapMLLayer...\n    //\n    // use a throwaway div to parse the input from MapML into HTML\n    this._createLayerControlForSelect();\n  }\n  disconnectedCallback() {}\n  _createLayerControlForSelect() {\n    // cut-pasted from createLayerControlForExtent. TODO Re-write appropriately\n    // don't add it again if it is referenced > once\n    // generate a <details><summary></summary><select...></details>\n    this.htmlselect = this.transcribe();\n    var selectdetails = L.DomUtil.create(\n        'details',\n        'mapml-layer-item-details mapml-control-layers'\n      ),\n      selectsummary = L.DomUtil.create('summary'),\n      selectSummaryLabel = L.DomUtil.create('label');\n    selectSummaryLabel.innerText = this.getAttribute('name');\n    selectSummaryLabel.setAttribute('for', this.getAttribute('id'));\n    selectsummary.appendChild(selectSummaryLabel);\n    selectdetails.appendChild(selectsummary);\n    selectdetails.appendChild(this.htmlselect);\n    this.selectdetails = selectdetails;\n    // this goes into the layer control, so add a listener to trigger map\n    // or layer redraw with newly selected value\n    const drawLayers = function () {\n      this.parentElement._extentLayer.redraw();\n    }.bind(this);\n    this.htmlselect.addEventListener('change', drawLayers);\n  }\n  transcribe() {\n    var select = document.createElement('select');\n    var elementAttrNames = this.getAttributeNames();\n\n    for (let i = 0; i < elementAttrNames.length; i++) {\n      select.setAttribute(\n        elementAttrNames[i],\n        this.getAttribute(elementAttrNames[i])\n      );\n    }\n\n    var options = this.children;\n\n    for (let i = 0; i < options.length; i++) {\n      var option = document.createElement('option');\n      var optionAttrNames = options[i].getAttributeNames();\n\n      for (let j = 0; j < optionAttrNames.length; j++) {\n        option.setAttribute(\n          optionAttrNames[j],\n          options[i].getAttribute(optionAttrNames[j])\n        );\n      }\n\n      option.innerHTML = options[i].innerHTML;\n      select.appendChild(option);\n    }\n    return select;\n  }\n  whenReady() {\n    return new Promise((resolve, reject) => {\n      let interval, failureTimer;\n      if (this.selectdetails) {\n        resolve();\n      } else {\n        let selectElement = this;\n        interval = setInterval(testForSelect, 300, selectElement);\n        failureTimer = setTimeout(selectNotDefined, 10000);\n      }\n      function testForSelect(selectElement) {\n        if (selectElement.selectdetails) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          resolve();\n        } else if (!selectElement.isConnected) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          reject('map-select was disconnected while waiting to be ready');\n        }\n      }\n      function selectNotDefined() {\n        clearInterval(interval);\n        clearTimeout(failureTimer);\n        reject('Timeout reached waiting for map-select to be ready');\n      }\n    });\n  }\n}\n"],"names":["MapSelect","HTMLElement","observedAttributes","name","this","getAttribute","val","setAttribute","id","attributeChangedCallback","oldValue","newValue","constructor","super","connectedCallback","_extentEl","parentElement","_createLayerControlForSelect","disconnectedCallback","htmlselect","transcribe","selectdetails","L","DomUtil","create","selectsummary","selectSummaryLabel","innerText","appendChild","drawLayers","_extentLayer","redraw","bind","addEventListener","select","document","createElement","elementAttrNames","getAttributeNames","let","i","length","options","children","option","optionAttrNames","j","innerHTML","whenReady","Promise","resolve","reject","interval","failureTimer","setInterval","selectElement","clearInterval","clearTimeout","isConnected","setTimeout"],"mappings":";;MAAaA,kBAAkBC,YAC7BC,gCACE,MAAO,CAAC,OAAQ,MAElBC,WACE,OAAOC,KAAKC,aAAa,QAE3BF,SAASG,GACPF,KAAKG,aAAa,OAAQD,GAE5BE,SACE,OAAOJ,KAAKC,aAAa,MAE3BG,OAAOF,GACLF,KAAKG,aAAa,KAAMD,GAG1BG,yBAAyBN,EAAMO,EAAUC,GAC/BR,EAaVS,cAEEC,QAEFC,oBACEV,KAAKW,UAAYX,KAAKY,cAMtBZ,KAAKa,+BAEPC,wBACAD,+BAIEb,KAAKe,WAAaf,KAAKgB,aACvB,IAAIC,EAAgBC,EAAEC,QAAQC,OAC1B,UACA,iDAEFC,EAAgBH,EAAEC,QAAQC,OAAO,WACjCE,EAAqBJ,EAAEC,QAAQC,OAAO,SACxCE,EAAmBC,UAAYvB,KAAKC,aAAa,QACjDqB,EAAmBnB,aAAa,MAAOH,KAAKC,aAAa,OACzDoB,EAAcG,YAAYF,GAC1BL,EAAcO,YAAYH,GAC1BJ,EAAcO,YAAYxB,KAAKe,YAC/Bf,KAAKiB,cAAgBA,EAGfQ,EAAa,WACjBzB,KAAKY,cAAcc,aAAaC,UAChCC,KAAK5B,MACPA,KAAKe,WAAWc,iBAAiB,SAAUJ,GAE7CT,aACE,IAAIc,EAASC,SAASC,cAAc,UAChCC,EAAmBjC,KAAKkC,oBAE5B,IAAKC,IAAIC,EAAI,EAAGA,EAAIH,EAAiBI,OAAQD,IAC3CN,EAAO3B,aACL8B,EAAiBG,GACjBpC,KAAKC,aAAagC,EAAiBG,KAIvC,IAAIE,EAAUtC,KAAKuC,SAEnB,IAAKJ,IAAIC,EAAI,EAAGA,EAAIE,EAAQD,OAAQD,IAAK,CACvC,IAAII,EAAST,SAASC,cAAc,UAChCS,EAAkBH,EAAQF,GAAGF,oBAEjC,IAAKC,IAAIO,EAAI,EAAGA,EAAID,EAAgBJ,OAAQK,IAC1CF,EAAOrC,aACLsC,EAAgBC,GAChBJ,EAAQF,GAAGnC,aAAawC,EAAgBC,KAI5CF,EAAOG,UAAYL,EAAQF,GAAGO,UAC9Bb,EAAON,YAAYgB,GAErB,OAAOV,EAETc,YACE,OAAO,IAAIC,QAAQ,CAACC,EAASC,KAC3BZ,IAAIa,EAAUC,EACVjD,KAAKiB,cACP6B,KAGAE,EAAWE,YAGb,SAAuBC,GACjBA,EAAclC,eAChBmC,cAAcJ,GACdK,aAAaJ,GACbH,KACUK,EAAcG,cACxBF,cAAcJ,GACdK,aAAaJ,GACbF,EAAO,2DAX6B,IADlB/C,MAEpBiD,EAAeM,WAajB,WACEH,cAAcJ,GACdK,aAAaJ,GACbF,EAAO,uDAhBqC,gBA1GvCnD"}