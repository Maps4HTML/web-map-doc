/*! @maps4html/web-map-custom-element 27-09-2023 */

!function(){"use strict";function t(t){return new o(t)}function e(t,e){return new i(t,e)}var o=L.GridLayer.extend({initialize:function(t){this.zoomBounds=this._getZoomBounds(t.tileContainer,t.maxZoomBound),L.extend(t,this.zoomBounds),L.setOptions(this,t),this._groups=this._groupTiles(this.options.tileContainer.getElementsByTagName("map-tile")),this._bounds=this._getLayerBounds(this._groups,this.options.projection),this.layerBounds=this._bounds[Object.keys(this._bounds)[0]];for(var e of Object.keys(this._bounds))this.layerBounds.extend(this._bounds[e].min),this.layerBounds.extend(this._bounds[e].max)},onAdd:function(t){this._map=t,L.GridLayer.prototype.onAdd.call(this,this._map),this._handleMoveEnd()},getEvents:function(){let t=L.GridLayer.prototype.getEvents.call(this,this._map);return this._parentOnMoveEnd=t.moveend,t.moveend=this._handleMoveEnd,t.move=()=>{},t},_handleMoveEnd:function(t){var e=this._map.getZoom();let o=e;o=o>this.options.maxNativeZoom?this.options.maxNativeZoom:o,o=o<this.options.minNativeZoom?this.options.minNativeZoom:o,this.isVisible=e<=this.zoomBounds.maxZoom&&e>=this.zoomBounds.minZoom&&this._bounds[o]&&this._bounds[o].overlaps(M.pixelToPCRSBounds(this._map.getPixelBounds(),this._map.getZoom(),this._map.options.projection)),this.isVisible&&this._parentOnMoveEnd()},_isValidTile(t){return this._groups[this._tileCoordsToKey(t)]},createTile:function(t){let o=this._groups[this._tileCoordsToKey(t)]||[],i=document.createElement("map-tile"),n=this.getTileSize();i.setAttribute("col",t.x),i.setAttribute("row",t.y),i.setAttribute("zoom",t.z);for(let e=0;e<o.length;e++){let t=document.createElement("img");t.width=n.x,t.height=n.y,t.alt="",t.setAttribute("role","presentation"),t.src=o[e].src,i.appendChild(t)}return i},_getLayerBounds:function(t,e){let o={},i=M[e].options.crs.tile.bounds.max.x;for(var n in t){let t=n.split(":"),e={};e.x=+t[0]*i,e.y=+t[1]*i,e.z=+t[2],t[2]in o?(o[t[2]].extend(L.point(e.x,e.y)),o[t[2]].extend(L.point(e.x+i,e.y+i))):o[t[2]]=L.bounds(L.point(e.x,e.y),L.point(e.x+i,e.y+i))}for(var a in o){var r=+a;o[a]=M.pixelToPCRSBounds(o[a],r,e)}return o},_getZoomBounds:function(t,e){if(!t)return null;let o=M._metaContentToObject(t.getElementsByTagName("map-tiles")[0].getAttribute("zoom")),i={},n=t.getElementsByTagName("map-tile");i.nativeZoom=+o.value||0,i.maxNativeZoom=0,i.minNativeZoom=e;for(let e=0;e<n.length;e++){let t=+n[e].getAttribute("zoom");n[e].getAttribute("zoom")||(t=i.nativeZoom),i.minNativeZoom=Math.min(i.minNativeZoom,t),i.maxNativeZoom=Math.max(i.maxNativeZoom,t)}return i.minZoom=i.minNativeZoom-2<=0?0:i.minNativeZoom-2,i.maxZoom=e,o.min&&(i.minZoom=+o.min<i.minNativeZoom-2?i.minNativeZoom-2:+o.min),o.max&&(i.maxZoom=+o.max),i},_groupTiles:function(o){let i={};for(let e=0;e<o.length;e++){let t={};t.row=+o[e].getAttribute("row"),t.col=+o[e].getAttribute("col"),t.zoom=+o[e].getAttribute("zoom")||this.options.nativeZoom,t.src=o[e].getAttribute("src");var n=t.col+":"+t.row+":"+t.zoom;n in i?i[n].push(t):i[n]=[t]}return i}}),i=L.Control.Layers.extend({options:{autoZIndex:!1,sortLayers:!0,sortFunction:function(t,e){return t.options.zIndex<e.options.zIndex?-1:t.options.zIndex>e.options.zIndex?1:0}},initialize:function(t,e){for(var o in L.setOptions(this,e),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[o],o,!0)},onAdd:function(){return this._initLayout(),this._map.on("validate",this._validateInput,this),L.DomEvent.on(this.options.mapEl,"layerchange",this._validateInput,this),L.DomEvent.on(this._container.getElementsByTagName("a")[0],"keydown",this._focusFirstLayer,this._container),L.DomEvent.on(this._container,"contextmenu",this._preventDefaultContextMenu,this),this._update(),this._layers.length<1&&!this._map._showControls?this._container.setAttribute("hidden",""):this._map._showControls=!0,this._container},onRemove:function(t){t.off("validate",this._validateInput,this),L.DomEvent.off(this._container.getElementsByTagName("a")[0],"keydown",this._focusFirstLayer,this._container);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addOrUpdateOverlay:function(t,e){for(var o=!1,i=0;i<this._layers.length;i++)if(this._layers[i].layer===t){o=!0,this._layers[i].name=e;break}return o||this.addOverlay(t,e),0<this._layers.length&&(this._container.removeAttribute("hidden"),this._map._showControls=!0),this._map?this._update():this},removeLayer:function(t){L.Control.Layers.prototype.removeLayer.call(this,t),0===this._layers.length&&this._container.setAttribute("hidden","")},_validateInput:function(t){for(let i=0;i<this._layers.length;i++)if(this._layers[i].input.labels[0]){let t=this._layers[i].input.labels[0].getElementsByTagName("span"),e=this._layers[i].input.labels[0].getElementsByTagName("input");if(e[0].checked=this._layers[i].layer._layerEl.checked,this._layers[i].layer._layerEl.disabled&&this._layers[i].layer._layerEl.checked?(e[0].closest("fieldset").disabled=!0,t[0].style.fontStyle="italic"):(e[0].closest("fieldset").disabled=!1,t[0].style.fontStyle="normal"),this._layers[i].layer._properties&&this._layers[i].layer._properties._mapExtents)for(let o=0;o<this._layers[i].layer._properties._mapExtents.length;o++){let t=this._layers[i].layer._properties._mapExtents[o].extentAnatomy,e=t.getElementsByClassName("mapml-layer-item-name")[0];this._layers[i].layer._properties._mapExtents[o].disabled&&this._layers[i].layer._properties._mapExtents[o].checked?(e.style.fontStyle="italic",t.disabled=!0):(e.style.fontStyle="normal",t.disabled=!1)}}},_focusFirstLayer:function(t){var e;"Enter"!==t.key||"leaflet-control-layers leaflet-control leaflet-control-layers-expanded"!==this.className||(e=this.children[1].children[2].children[0].children[0].children[0].children[0])&&setTimeout(()=>e.focus(),0)},_withinZoomBounds:function(t,e){return e.min<=t&&t<=e.max},_addItem:function(t){var e=t.layer.getLayerUserControlsHTML();return t.input=e.querySelector("input.leaflet-control-layers-selector"),this._layerControlInputs.push(t.input),t.input.layerId=L.stamp(t.layer),L.DomEvent.on(t.input,"click",this._onInputClick,this),this._overlaysList.appendChild(e),e},collapse:function(t){return"SELECT"===t.target.tagName||t.relatedTarget&&t.relatedTarget.parentElement&&("mapml-contextmenu mapml-layer-menu"===t.relatedTarget.className||"mapml-contextmenu mapml-layer-menu"===t.relatedTarget.parentElement.className)||this._map&&"block"===this._map.contextMenu._layerMenu.style.display||(L.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),"touch"===t.originalEvent?.pointerType&&(this._container._isExpanded=!1)),this},_preventDefaultContextMenu:function(t){var e=this._map.mouseEventToLatLng(t),o=this._map.mouseEventToContainerPoint(t);t.preventDefault(),this._container._isExpanded||"touch"!==t.pointerType?this._map.fire("contextmenu",{originalEvent:t,containerPoint:o,latlng:e}):this._container._isExpanded=!0}});const k="OSMTILE",d="TILEMATRIX",P="mapmltemplatedtileplaceholder";function n(t,e){return new c(t,e)}function a(t,e){return new h(t,e)}function r(t,e){return new _(t,e)}function s(t,e){return new y(t,e)}function l(t,e){return new f(t,e)}function m(t,e,o,i,n,a){return new g(t,e,o,i,n,a)}function p(t,e,o,i){return t||e?new b(t,e,o,i):null}function u(){return new x}var c=L.FeatureGroup.extend({initialize:function(t,e){var o;L.setOptions(this,e),this.options.static&&(this._container=L.DomUtil.create("div","leaflet-layer",this.options.pane),L.DomUtil.addClass(this._container,"leaflet-pane mapml-vector-container"),L.setOptions(this.options.renderer,{pane:this._container})),this._layers={},this.options.query?(this._mapmlFeatures=t.features||t,this.isVisible=!0,o=M.getNativeVariables(t),this.options.nativeZoom=o.zoom,this.options.nativeCS=o.cs):t?(o=M.getNativeVariables(t),this.addData(t,o.cs,o.zoom)):(this.isVisible=!1,this.options._leafletLayer&&(this._features={},this._staticFeature=!0))},onAdd:function(t){this._map=t,L.FeatureGroup.prototype.onAdd.call(this,t),this._staticFeature&&(this._resetFeatures(),this.options._leafletLayer._map._addZoomLimit(this)),this._mapmlFeatures&&t.on("featurepagination",this.showPaginationFeature,this)},onRemove:function(t){this._mapmlFeatures&&(t.off("featurepagination",this.showPaginationFeature,this),delete this._mapmlFeatures,L.DomUtil.remove(this._container)),L.FeatureGroup.prototype.onRemove.call(this,t),this._map.featureIndex.cleanIndex()},removeLayer:function(t){L.FeatureGroup.prototype.removeLayer.call(this,t),delete this._layers[t._leaflet_id]},getEvents:function(){return this._staticFeature?{moveend:this._handleMoveEnd,zoomend:this._handleZoomEnd}:{}},showPaginationFeature:function(o){if(this.options.query&&this._mapmlFeatures[o.i]){let e=this._mapmlFeatures[o.i];if("featurepagination"===o.type?e._extentEl.shadowRoot.querySelector("map-feature")?.remove():e._extentEl.shadowRoot.replaceChildren(),this.clearLayers(),e._featureGroup=this.addData(e,this.options.nativeCS,this.options.nativeZoom),o.meta)for(let t=0;t<o.meta.length;t++)e._extentEl.shadowRoot.appendChild(o.meta[t]);e._extentEl.shadowRoot.appendChild(e),o.popup._navigationBar.querySelector("p").innerText=o.i+1+"/"+this.options._leafletLayer._totalFeatureCount,o.popup._content.querySelector("iframe").setAttribute("sandbox","allow-same-origin allow-forms"),o.popup._content.querySelector("iframe").srcdoc=e.querySelector("map-properties").innerHTML,this._map.fire("attachZoomLink",{i:o.i,currFeature:e}),this._map.once("popupclose",function(t){this.shadowRoot.innerHTML=""},e._extentEl)}},_handleMoveEnd:function(){var t=this._map.getZoom(),e=!!this.zoomBounds&&(t<=this.zoomBounds.maxZoom&&t>=this.zoomBounds.minZoom);this.isVisible=e&&this._layers&&this.layerBounds&&this.layerBounds.overlaps(M.pixelToPCRSBounds(this._map.getPixelBounds(),t,this._map.options.projection)),this._removeCSS()},_handleZoomEnd:function(t){this.zoomBounds&&this._resetFeatures()},_resetFeatures:function(){this._map&&this._map.featureIndex.cleanIndex();let i=this._map||this.options._leafletLayer._map;if(this._features)for(var n in this._features)for(let o=0;o<this._features[n].length;o++){let e=this._features[n][o],t=e._checkRender(i.getZoom(),this.zoomBounds.minZoom,this.zoomBounds.maxZoom);if(t){if(!i.hasLayer(e)&&!e._map){this.addLayer(e);let t=e.defaultOptions.group.parentNode.querySelector(`span[id="${e._leaflet_id}"]`);t.replaceWith(e.defaultOptions.group)}}else{let t=document.createElement("span");t.id=e._leaflet_id,e.defaultOptions.group.insertAdjacentElement("beforebegin",t),this.removeLayer(e)}}},_setZoomTransform:function(t,e){var o=this._map.getZoomScale(this._map.getZoom(),e),t=t.multiplyBy(o).subtract(this._map._getNewPixelOrigin(t,this._map.getZoom())).round();any3d?L.setTransform(this._layers[e],t,o):L.setPosition(this._layers[e],t)},addData:function(i,n,a){i&&(this.isVisible=!0);var t,e,o,r=i.nodeType===Node.DOCUMENT_NODE||"LAYER-"===i.nodeName?i.getElementsByTagName("map-feature"):null;if((i.nodeType===Node.DOCUMENT_NODE?i.querySelector("map-link[rel=stylesheet],map-style"):null)&&(s=i.querySelector("map-base")&&i.querySelector("map-base").hasAttribute("href")?new URL(i.querySelector("map-base").getAttribute("href")).href:i.URL,M._parseStylesheetAsHTML(i,s,this._container)),r){for(t=0,e=r.length;t<e;t++)(o=r[t]).getElementsByTagName("map-geometry").length&&o.getElementsByTagName("map-coordinates").length&&(i.nodeType===Node.DOCUMENT_NODE?(o._DOMnode||(o._DOMnode=o.cloneNode(!0)),o._DOMnode._featureGroup=this.addData(o._DOMnode,n,a)):o._featureGroup=this.addData(o,n,a));return this}var s=this.options;if(!s.filter||s.filter(i)){i.classList.length&&(s.className=i.classList.value);let t=i.getAttribute("zoom")||a,e=i.querySelector("map-featurecaption");e=e?e.innerHTML:"Feature",i.querySelector("map-properties")&&(s.properties=document.createElement("div"),s.properties.classList.add("mapml-popup-content"),s.properties.insertAdjacentHTML("afterbegin",i.querySelector("map-properties").innerHTML));let o=this.geometryToLayer(i,s,n,+t,e);if(o)return!o.options.color&&i.hasAttribute("class")&&(o.options.className=i.getAttribute("class")),o.defaultOptions=o.options,this.resetStyle(o),s.onEachFeature&&o.bindTooltip(e,{interactive:!0,sticky:!0}),this._staticFeature?(s=i.getAttribute("zoom")||a)in this._features?this._features[s].push(o):this._features[s]=[o]:this.addLayer(o),"MAP-FEATURE"===i.tagName.toUpperCase()&&(i._groupEl=o.options.group),o}},resetStyle:function(t){var e=this.options.style;e&&(L.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(e){this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)},_removeCSS:function(){var e=this._container.querySelectorAll("link[rel=stylesheet],style");for(let t=0;t<e.length;t++)this._container.removeChild(e[t])},geometryToLayer:function(o,i,t,n,a){let r="MAP-FEATURE"===o.tagName.toUpperCase()?o.getElementsByTagName("map-geometry")[0]:o,s=r?.getAttribute("cs")||t,l=[],m=L.SVG.create("g"),p=Object.assign({},i);if(r){for(var u of r.querySelectorAll("map-polygon, map-linestring, map-multilinestring, map-point, map-multipoint"))l.push(M.path(u,Object.assign(p,{nativeCS:s,nativeZoom:n,projection:this.options.projection,featureID:o.id,group:m,wrappers:this._getGeometryParents(u.parentElement),featureLayer:this,_leafletLayer:this.options._leafletLayer})));let t={group:m,mapmlFeature:o,featureID:o.id,accessibleTitle:a,onEachFeature:i.onEachFeature,properties:i.properties,_leafletLayer:this.options._leafletLayer},e=r.querySelector("map-multipolygon")||r.querySelector("map-geometrycollection");return e&&(t.wrappers=this._getGeometryParents(e.parentElement)),M.geometry(l,t)}},_getGeometryParents:function(t,e=[]){return t&&"MAP-GEOMETRY"!==t.tagName.toUpperCase()?"MAP-MULTIPOLYGON"===t.tagName.toUpperCase()||"MAP-GEOMETRYCOLLECTION"===t.tagName.toUpperCase()?this._getGeometryParents(t.parentElement,e):this._getGeometryParents(t.parentElement,e.concat([t])):e}}),h=L.TileLayer.extend({initialize:function(t,e){var o=M._extractInputBounds(t);this.zoomBounds=o.zoomBounds,this.extentBounds=o.bounds,this.isVisible=!0,L.extend(e,this.zoomBounds),e.tms=t.tms,delete e.opacity,L.setOptions(this,e),this._setUpTileTemplateVars(t),this._template=t,this._initContainer(),L.TileLayer.prototype.initialize.call(this,t.template,L.extend(e,{pane:this._container}))},onAdd:function(){this._map._addZoomLimit(this),L.TileLayer.prototype.onAdd.call(this,this._map),this._handleMoveEnd()},getEvents:function(){let t=L.TileLayer.prototype.getEvents.call(this,this._map);return this._parentOnMoveEnd=t.moveend,t.moveend=this._handleMoveEnd,t},_initContainer:function(){this._container||(this._container=L.DomUtil.create("div","leaflet-layer",this.options.pane),L.DomUtil.addClass(this._container,"mapml-templated-tile-container"),this._updateZIndex())},_handleMoveEnd:function(t){var e=this._map.getZoom(),o=M.pixelToPCRSBounds(this._map.getPixelBounds(),e,this._map.options.projection);this.isVisible=e<=this.options.maxZoom&&e>=this.options.minZoom&&this.extentBounds.overlaps(o),this.isVisible&&this._parentOnMoveEnd()},createTile:function(e){let o=document.createElement("DIV"),i=this.getTileSize();if(L.DomUtil.addClass(o,"mapml-tile-group"),L.DomUtil.addClass(o,"leaflet-tile"),this._template.linkEl.dispatchEvent(new CustomEvent("tileloadstart",{detail:{x:e.x,y:e.y,zoom:e.z,appendTile:t=>{o.appendChild(t)}}})),this._template.type.startsWith("image/")){let t=L.TileLayer.prototype.createTile.call(this,e,function(){});t.width=i.x,t.height=i.y,o.appendChild(t)}else this._url.includes(P)||this._fetchTile(e,o);return o},_mapmlTileReady:function(t){L.DomUtil.addClass(t,"leaflet-tile-loaded")},getPane:function(){return this.options.pane},_fetchTile:function(e,o){fetch(this.getTileUrl(e),{redirect:"follow"}).then(function(t){return 200<=t.status&&t.status<300?Promise.resolve(t):(console.log("Looks like there was a problem. Status Code: "+t.status),Promise.reject(t))}).then(function(t){return t.text()}).then(t=>{return(new DOMParser).parseFromString(t,"application/xml")}).then(t=>{this._createFeatures(t,e,o),this._mapmlTileReady(o)}).catch(t=>{console.log("Error Creating Tile")})},_createFeatures:function(t,e,o){var i;t.querySelector("map-link[rel=stylesheet],map-style")&&(i=t.querySelector("map-base")&&t.querySelector("map-base").hasAttribute("href")?new URL(t.querySelector("map-base").getAttribute("href")).href:t.URL,M._parseStylesheetAsHTML(t,i,o));let n=L.SVG.create("svg"),a=L.SVG.create("g"),r=this._map.options.crs.options.crs.tile.bounds.max.x,s=e.x*r,l=e.y*r;var m,p=M.featureLayer(t,{projection:this._map.options.projection,static:!1,layerBounds:this.extentBounds,zoomBounds:this.zoomBounds,interactive:!1});for(m in p._layers)for(var u in p._layers[m]._layers){let t=p._layers[m]._layers[u];M.FeatureRenderer.prototype._initPath(t,!1),t._project(this._map,L.point([s,l]),e.z),M.FeatureRenderer.prototype._addPath(t,a,!1),M.FeatureRenderer.prototype._updateFeature(t)}n.setAttribute("width",r.toString()),n.setAttribute("height",r.toString()),n.appendChild(a),o.appendChild(n)},getTileUrl:function(t){if(t.z>=this._template.tilematrix.bounds.length||!this._template.tilematrix.bounds[t.z].contains(t))return"";var e,o={},i=this._template.linkEl,n=i.zoomInput;for(e in o[this._template.tilematrix.col.name]=t.x,o[this._template.tilematrix.row.name]=t.y,n&&i.hasAttribute("tref")&&i.getAttribute("tref").includes(`{${n.getAttribute("name")}}`)&&(o[this._template.zoom.name]=this._getZoomForUrl()),o[this._template.pcrs.easting.left]=this._tileMatrixToPCRSPosition(t,"top-left").x,o[this._template.pcrs.easting.right]=this._tileMatrixToPCRSPosition(t,"top-right").x,o[this._template.pcrs.northing.top]=this._tileMatrixToPCRSPosition(t,"top-left").y,o[this._template.pcrs.northing.bottom]=this._tileMatrixToPCRSPosition(t,"bottom-left").y,this._template.tile)["row","col","zoom","left","right","top","bottom"].indexOf(e)<0&&(o[e]=this._template.tile[e]);return this._map&&!this._map.options.crs.infinite&&(t=this._globalTileRange.max.y-t.y,this.options.tms&&(o[this._template.tilematrix.row.name]=t)),o.r=this.options.detectRetina&&L.Browser.retina&&0<this.options.maxZoom?"@2x":"",L.Util.template(this._url,o)},_tileMatrixToPCRSPosition:function(t,e){var o=this._map.options.crs,i=this.getTileSize(),n=t.scaleBy(i),a=n.add(i),i=n.add(Math.floor(i/2)),r=o.transformation.untransform(n,o.scale(t.z)),s=o.transformation.untransform(a,o.scale(t.z)),l=o.transformation.untransform(i,o.scale(t.z)),m=null;switch(e){case"top-left":m=r;break;case"bottom-left":m=new L.Point(r.x,s.y);break;case"center-left":m=new L.Point(r.x,l.y);break;case"top-right":m=new L.Point(s.x,r.y);break;case"bottom-right":m=s;break;case"center-right":m=new L.Point(s.x,l.y);break;case"top-center":m=new L.Point(l.x,r.y);break;case"bottom-center":m=new L.Point(l.x,s.y);break;case"center":m=l}return m},_setUpTileTemplateVars:function(t){t.tile={};for(var e,o,i,n,a,r=t.values,s=this.options.crs.options,l=0;l<t.values.length;l++){var m=r[l].getAttribute("type"),p=r[l].getAttribute("units"),u=r[l].getAttribute("axis"),c=r[l].getAttribute("name"),h=r[l].getAttribute("position"),d="map-select"===r[l].tagName.toLowerCase(),_=r[l].getAttribute("value"),y=r[l].getAttribute("min"),f=r[l].getAttribute("max");if("location"===m&&"tilematrix"===p)switch(u){case"column":a={name:c,min:s.crs.tilematrix.horizontal.min,max:s.crs.tilematrix.horizontal.max(s.resolutions.length-1)},isNaN(Number.parseFloat(y))||(a.min=Number.parseFloat(y)),isNaN(Number.parseFloat(f))||(a.max=Number.parseFloat(f));break;case"row":n={name:c,min:s.crs.tilematrix.vertical.min,max:s.crs.tilematrix.vertical.max(s.resolutions.length-1)},isNaN(Number.parseFloat(y))||(n.min=Number.parseFloat(y)),isNaN(Number.parseFloat(f))||(n.max=Number.parseFloat(f));break;case"longitude":case"easting":o=o||{min:s.crs.pcrs.horizontal.min,max:s.crs.pcrs.horizontal.max},isNaN(Number.parseFloat(y))||(o.min=Number.parseFloat(y)),isNaN(Number.parseFloat(f))||(o.max=Number.parseFloat(f)),h&&(h.match(/.*?-left/i)?o.left=c:h.match(/.*?-right/i)&&(o.right=c));break;case"latitude":case"northing":i=i||{min:s.crs.pcrs.vertical.min,max:s.crs.pcrs.vertical.max},isNaN(Number.parseFloat(y))||(i.min=Number.parseFloat(y)),isNaN(Number.parseFloat(f))||(i.max=Number.parseFloat(f)),h&&(h.match(/top-.*?/i)?i.top=c:h.match(/bottom-.*?/i)&&(i.bottom=c))}else if(m&&"zoom"===m.toLowerCase())e={name:c,min:0,max:s.resolutions.length,value:s.resolutions.length},!isNaN(Number.parseInt(_,10))&&Number.parseInt(_,10)>=e.min&&Number.parseInt(_,10)<=e.max?e.value=Number.parseInt(_,10):e.value=e.max,!isNaN(Number.parseInt(y,10))&&Number.parseInt(y,10)>=e.min&&Number.parseInt(y,10)<=e.max&&(e.min=Number.parseInt(y,10)),!isNaN(Number.parseInt(f,10))&&Number.parseInt(f,10)>=e.min&&Number.parseInt(f,10)<=e.max&&(e.max=Number.parseInt(f,10)),t.zoom=e;else if(d){const T=r[l].htmlselect;t.tile[c]=function(){return T.value}}else{const I=r[l];t.tile[c]=function(){return I.getAttribute("value")}}}function g(t,e){return b.transform(t,v(e)).divideBy(x).floor()}var b=this.options.crs.transformation,x=this.options.crs.options.crs.tile.bounds.max.x,v=L.bind(this.options.crs.scale,this.options.crs);o&&i?(t.pcrs={},t.pcrs.bounds=L.bounds([o.min,i.min],[o.max,i.max]),t.pcrs.easting=o,t.pcrs.northing=i):a&&n&&!isNaN(e.value)?(t.pcrs||(t.pcrs={},t.pcrs.easting="",t.pcrs.northing=""),t.pcrs.bounds=M.boundsToPCRSBounds(L.bounds(L.point([a.min,n.min]),L.point([a.max,n.max])),e.value,this.options.crs,M.axisToCS("column")),t.tilematrix={},t.tilematrix.col=a,t.tilematrix.row=n):console.log("Unable to determine bounds for tile template: "+t.template),t.tilematrix||(t.tilematrix={},t.tilematrix.col={},t.tilematrix.row={}),t.tilematrix.bounds=[];for(var E=t.pcrs.bounds,C=t.zoom?t.zoom.min:0,A=t.zoom?t.zoom.max:s.resolutions.length,S=0;S<=A;S++)t.tilematrix.bounds[S]=C<=S?L.bounds(g(E.min,S),g(E.max,S)):L.bounds(L.point([-1,-1]),L.point([-1,-1]))},_clampZoom:function(t){var e=L.GridLayer.prototype._clampZoom.call(this,t);return this._template.step>this.zoomBounds.maxNativeZoom&&(this._template.step=this.zoomBounds.maxNativeZoom),t!==e?t=e:t%this._template.step!=0&&(t=Math.floor(t/this._template.step)*this._template.step),t}}),_=L.Layer.extend({initialize:function(t,e){this._templates=t,L.setOptions(this,e),this._container=L.DomUtil.create("div","leaflet-layer",e.pane),this._container.style.opacity=this.options.opacity,L.DomUtil.addClass(this._container,"mapml-templatedlayer-container");for(var o,i=0;i<t.length;i++)"tile"===t[i].rel?(this.setZIndex(e.extentZIndex),this._templates[i].layer=M.templatedTileLayer(t[i],L.Util.extend(e,{errorTileUrl:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",zIndex:e.extentZIndex,pane:this._container}))):"image"===t[i].rel?(this.setZIndex(e.extentZIndex),this._templates[i].layer=M.templatedImageLayer(t[i],L.Util.extend(e,{zIndex:e.extentZIndex,pane:this._container}))):"features"===t[i].rel?(this.setZIndex(e.extentZIndex),this._templates[i].layer=M.templatedFeaturesLayer(t[i],L.Util.extend(e,{zIndex:e.extentZIndex,pane:this._container}))):"query"===t[i].rel&&(this.hasSetBoundsHandler=!0,this._queries||(this._queries=[]),o=M._extractInputBounds(t[i]),t[i].extentBounds=o.bounds,t[i].zoomBounds=o.zoomBounds,t[i]._extentEl=this.options.extentEl,this._queries.push(L.extend(t[i],this._setupQueryVars(t[i]))))},getEvents:function(){return{zoomstart:this._onZoomStart}},redraw:function(){this.closePopup();for(var t=0;t<this._templates.length;t++)"tile"!==this._templates[t].rel&&"image"!==this._templates[t].rel&&"features"!==this._templates[t].rel||this._templates[t].layer.redraw()},_onZoomStart:function(){this.closePopup()},_setupQueryVars:function(t){for(var e={query:{}},o=t.values,i=0;i<t.values.length;i++){var n=o[i].getAttribute("type"),a=o[i].getAttribute("units"),r=o[i].getAttribute("axis"),s=o[i].getAttribute("name"),l=o[i].getAttribute("position"),m=o[i].getAttribute("rel"),p="map-select"===o[i].tagName.toLowerCase();if("width"===n)e.query.width=s;else if("height"===n)e.query.height=s;else if("location"===n)switch(r){case"x":case"y":case"column":case"row":e.query[r]=s;break;case"longitude":case"easting":l?l.match(/.*?-left/i)?"pixel"===m?e.query.pixelleft=s:"tile"===m?e.query.tileleft=s:e.query.mapleft=s:l.match(/.*?-right/i)&&("pixel"===m?e.query.pixelright=s:"tile"===m?e.query.tileright=s:e.query.mapright=s):e.query[r]=s;break;case"latitude":case"northing":l?l.match(/top-.*?/i)?"pixel"===m?e.query.pixeltop=s:"tile"===m?e.query.tiletop=s:e.query.maptop=s:l.match(/bottom-.*?/i)&&("pixel"===m?e.query.pixelbottom=s:"tile"===m?e.query.tilebottom=s:e.query.mapbottom=s):e.query[r]=s;break;case"i":"tile"===a?e.query.tilei=s:e.query.mapi=s;break;case"j":"tile"===a?e.query.tilej=s:e.query.mapj=s}else if("zoom"===n)e.query.zoom=s;else if(p){const u=o[i].htmlselect;e.query[s]=function(){return u.value}}else{const c=o[i];e.query[s]=function(){return c.getAttribute("value")}}}return e.query.title=t.title,e},reset:function(t,e){if(t&&this._map){var o=this._map&&this._map.hasLayer(this),i=this._templates;delete this._queries,this._map.off("click",null,this),this._templates=t;for(var n=0;n<t.length;n++)"tile"===t[n].rel?this._templates[n].layer=M.templatedTileLayer(t[n],L.Util.extend(this.options,{errorTileUrl:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",zIndex:e,pane:this._container})):"image"===t[n].rel?this._templates[n].layer=M.templatedImageLayer(t[n],L.Util.extend(this.options,{zIndex:e,pane:this._container})):"features"===t[n].rel?this._templates[n].layer=M.templatedFeaturesLayer(t[n],L.Util.extend(this.options,{zIndex:e,pane:this._container})):"query"===t[n].rel&&(this._queries||(this._queries=[]),this._queries.push(L.extend(t[n],this._setupQueryVars(t[n])))),o&&this.onAdd(this._map);for(n=0;n<i.length;n++)this._map.hasLayer(i[n].layer)&&this._map.removeLayer(i[n].layer)}},onAdd:function(t){for(var e=0;e<this._templates.length;e++)"query"!==this._templates[e].rel&&t.addLayer(this._templates[e].layer)},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},onRemove:function(t){L.DomUtil.remove(this._container);for(var e=0;e<this._templates.length;e++)"query"!==this._templates[e].rel&&t.removeLayer(this._templates[e].layer)},_previousFeature:function(t){0<=this._count+-1&&(this._count--,this._map.fire("featurepagination",{i:this._count,popup:this}))},_nextFeature:function(t){this._count+1<this._source._totalFeatureCount&&(this._count++,this._map.fire("featurepagination",{i:this._count,popup:this}))},changeOpacity:function(t){this._container.style.opacity=t}}),y=L.Layer.extend({initialize:function(t,e){var o=M._extractInputBounds(t);this.zoomBounds=o.zoomBounds,this.extentBounds=o.bounds,this.isVisible=!0,this._template=t,this._extentEl=e.extentEl,this._container=L.DomUtil.create("div","leaflet-layer",e.pane),L.extend(e,this.zoomBounds),L.DomUtil.addClass(this._container,"mapml-features-container"),delete e.opacity,L.setOptions(this,L.extend(e,this._setUpFeaturesTemplateVars(t)))},getEvents:function(){return{moveend:this._onMoveEnd}},onAdd:function(){this._map._addZoomLimit(this);var t=this.options.opacity||1,e=this._container,o=this._map;this._features||(this._features=M.featureLayer(null,{renderer:M.featureRenderer(),pane:e,layerBounds:this.extentBounds,zoomBounds:this.zoomBounds,opacity:t,projection:o.options.projection,static:!0,onEachFeature:function(t,e){var o=document.createElement("div");o.classList.add("mapml-popup-content"),o.insertAdjacentHTML("afterbegin",t.innerHTML),e.bindPopup(o,{autoClose:!1,minWidth:108})}})),o.fire("moveend")},redraw:function(){this._onMoveEnd()},_removeCSS:function(){var o=this._container.querySelectorAll("link[rel=stylesheet],style");for(let e=0;e<o.length;e++){let t=o[e].parentNode;t.removeChild(o[e])}},_onMoveEnd:function(){var t=this._map.options.mapEl._history,e=t[t.length-1],o=t[t.length-2]??e,i=this._template.step,t=this._map.getZoom();let n=t;if("1"!==i&&(t+1)%i==0&&e.zoom===o.zoom-1||e.zoom===o.zoom||Math.floor(t/i)*i!=Math.floor(o.zoom/i)*i)n=Math.floor(t/i)*i;else if(t%this._template.step!=0)return;var a,r,s,l,m,p,u,c,o=this._map.getPixelBounds(this._map.getCenter(),n),i=this._getfeaturesUrl(n,o);i!==this._url&&(o=M.pixelToPCRSBounds(this._map.getPixelBounds(),t,this._map.options.projection),this.isVisible=t<=this.zoomBounds.maxZoom&&t>=this.zoomBounds.minZoom&&this.extentBounds.overlaps(o),this._features.clearLayers(),this._extentEl.shadowRoot&&(this._extentEl.shadowRoot.innerHTML=""),this._removeCSS(),this.isVisible||n!==t?(r=new Headers({Accept:"text/mapml;q=0.9,application/geo+json;q=0.8"}),s=new DOMParser,l=this._features,m=this._extentEl,p=this._map,c=function(i,n){return fetch(i,{redirect:"follow",headers:r}).then(function(t){return t.text()}).then(function(t){a=s.parseFromString(t,"application/xml");var e=new URL(a.querySelector("map-base")?a.querySelector("map-base").getAttribute("href"):i).href;i=(i=a.querySelector("map-link[rel=next]")?a.querySelector("map-link[rel=next]").getAttribute("href"):null)?new URL(i,e).href:null;var o,t=m._nativeZoom=a.querySelector("map-meta[name=zoom]")&&+M._metaContentToObject(a.querySelector("map-meta[name=zoom]").getAttribute("content")).value||0,e=m._nativeCS=a.querySelector("map-meta[name=cs]")&&M._metaContentToObject(a.querySelector("map-meta[name=cs]").getAttribute("content")).content||"GCRS";l.addData(a,e,t);for(o of a.querySelector("map-body").children)m.shadowRoot.append(o._DOMnode),o._DOMnode._extentEl=m;if(i&&--n)return c(i,n)})},(u=this)._url=i,c(i,10).then(function(){p.addLayer(l),p.fire("templatedfeatureslayeradd"),M.TemplatedFeaturesLayer.prototype._updateTabIndex(u)}).catch(function(t){console.log(t)})):this._url="")},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateTabIndex:function(t){var o,i=t||this;for(o in i._features._layers){let e=i._features._layers[o];if(e._path&&("M0 0"!==e._path.getAttribute("d")?e._path.setAttribute("tabindex",0):e._path.removeAttribute("tabindex"),0===e._path.childElementCount)){let t=document.createElement("title");t.innerText="Feature",e._path.appendChild(t)}}},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},onRemove:function(){this._map.removeLayer(this._features)},_getfeaturesUrl:function(t,e){void 0===t&&(t=this._map.getZoom()),void 0===e&&(e=this._map.getPixelBounds());var o,i={};for(o in this.options.feature.zoom&&(i[this.options.feature.zoom]=t),this.options.feature.width&&(i[this.options.feature.width]=this._map.getSize().x),this.options.feature.height&&(i[this.options.feature.height]=this._map.getSize().y),this.options.feature.bottom&&(i[this.options.feature.bottom]=this._TCRSToPCRS(e.max,t).y),this.options.feature.left&&(i[this.options.feature.left]=this._TCRSToPCRS(e.min,t).x),this.options.feature.top&&(i[this.options.feature.top]=this._TCRSToPCRS(e.min,t).y),this.options.feature.right&&(i[this.options.feature.right]=this._TCRSToPCRS(e.max,t).x),this.options.feature)["width","height","left","right","top","bottom","zoom"].indexOf(o)<0&&(i[o]=this.options.feature[o]);return L.Util.template(this._template.template,i)},_TCRSToPCRS:function(t,e){var o=this._map.options.crs;return o.transformation.untransform(t,o.scale(e))},_setUpFeaturesTemplateVars:function(t){var e={feature:{}},o=t.values;e.feature.hidden=[];for(var i=0;i<o.length;i++){var n=o[i].getAttribute("type"),a=o[i].getAttribute("units"),r=o[i].getAttribute("axis"),s=o[i].getAttribute("name"),l=o[i].getAttribute("position"),m=(o[i].getAttribute("value"),"map-select"===o[i].tagName.toLowerCase());if("width"===n)e.feature.width=s;else if("height"===n)e.feature.height=s;else if("zoom"===n)e.feature.zoom=s;else if("location"!==n||"pcrs"!==a&&"gcrs"!==a)if(m){const p=o[i].htmlselect;e.feature[s]=function(){return p.value}}else{const u=o[i];e.feature[s]=function(){return u.getAttribute("value")}}else switch(r){case"x":case"longitude":case"easting":l&&(l.match(/.*?-left/i)?e.feature.left=s:l.match(/.*?-right/i)&&(e.feature.right=s));break;case"y":case"latitude":case"northing":l&&(l.match(/top-.*?/i)?e.feature.top=s:l.match(/bottom-.*?/i)&&(e.feature.bottom=s))}}return e}}),f=L.Layer.extend({initialize:function(t,e){this._template=t,this._container=L.DomUtil.create("div","leaflet-layer",e.pane),L.DomUtil.addClass(this._container,"mapml-image-container");var o=M._extractInputBounds(t);this.zoomBounds=o.zoomBounds,this.extentBounds=o.bounds,this.isVisible=!0,delete e.opacity,L.extend(e,this.zoomBounds),L.setOptions(this,L.extend(e,this._setUpExtentTemplateVars(t)))},getEvents:function(){return{moveend:this._onMoveEnd,zoomstart:this._clearLayer}},onAdd:function(){this._map._addZoomLimit(this),this.setZIndex(this.options.zIndex),this._onAdd()},redraw:function(){this._onMoveEnd()},_clearLayer:function(){var e=this._container.querySelectorAll("img");for(let t=0;t<e.length;t++)this._container.removeChild(e[t])},_addImage:function(t,e,o){let i=this._map,n=this._imageOverlay;t=this.getImageUrl(t,e),e=i.getSize();this._imageOverlay=M.imageLayer(t,o,e,0,this._container),this._imageOverlay._step=this._template.step,this._imageOverlay.addTo(i),n&&(this._imageOverlay._overlayToRemove=n._url,this._imageOverlay.on("load error",function(){i.removeLayer(n)}))},_scaleImage:function(o,i){let n=this;setTimeout(function(){var t=n._template.step,e=Math.floor(i/t)*t,t=n._map.getZoomScale(i,e),e=o.min.multiplyBy(t).subtract(n._map._getNewPixelOrigin(n._map.getCenter(),i)).round();L.DomUtil.setTransform(n._imageOverlay._image,e,t)})},_onAdd:function(){var t=this._map.getZoom();let e=t;var o=this._template.step;t%o!=0&&(e=Math.floor(t/o)*o);var i=this._map.getPixelBounds(this._map.getCenter(),e);this._pixelOrigins={},this._pixelOrigins[e]=i.min;o=this._map.getPixelBounds().min.subtract(this._map.getPixelOrigin());this._addImage(i,e,o),t!==e&&this._scaleImage(i,t)},_onMoveEnd:function(t){var e=this._map.getZoom(),o=this._map.options.mapEl._history,i=o[o.length-1];let n=o[o.length-2];n=n||i;var a,r=this._template.step,o=Math.floor(e/r)*r;let s=this._map.getPixelBounds(this._map.getCenter(),o);"1"!==r&&(e+1)%r==0&&i.zoom===n.zoom-1?(this._addImage(s,o,L.point(0,0)),this._scaleImage(s,e)):t&&e%r!=0?(this._imageOverlay._overlayToRemove=this._imageOverlay._url,i.zoom!==n.zoom?(this._addImage(s,o,L.point(0,0)),this._pixelOrigins[o]=s.min,this._scaleImage(s,e)):(a=this._pixelOrigins[o],a=s.min.subtract(a),this.getImageUrl(s,o)!==this._imageOverlay._url&&(this._addImage(s,o,a),this._scaleImage(s,e)))):(o=M.pixelToPCRSBounds(this._map.getPixelBounds(),e,this._map.options.projection),this.isVisible=e<=this.zoomBounds.maxZoom&&e>=this.zoomBounds.minZoom&&this.extentBounds.overlaps(o),this.isVisible?(o=(a=this._map).getPixelBounds().min.subtract(a.getPixelOrigin()),this._addImage(a.getPixelBounds(),e,o),this._pixelOrigins[e]=a.getPixelOrigin()):this._clearLayer())},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},onRemove:function(t){this._clearLayer(),t._removeZoomLimit(this),this._container=null},getImageUrl:function(t,e){var o,i={};for(o in i[this.options.extent.width]=this._map.getSize().x,i[this.options.extent.height]=this._map.getSize().y,i[this.options.extent.bottom]=this._TCRSToPCRS(t.max,e).y,i[this.options.extent.left]=this._TCRSToPCRS(t.min,e).x,i[this.options.extent.top]=this._TCRSToPCRS(t.min,e).y,i[this.options.extent.right]=this._TCRSToPCRS(t.max,e).x,this.options.extent)["width","height","left","right","top","bottom"].indexOf(o)<0&&(i[o]=this.options.extent[o]);return L.Util.template(this._template.template,i)},_TCRSToPCRS:function(t,e){var o=this._map.options.crs;return o.transformation.untransform(t,o.scale(e))},_setUpExtentTemplateVars:function(t){for(var e={extent:{}},o=t.values,i=0;i<t.values.length;i++){var n=o[i].getAttribute("type"),a=o[i].getAttribute("units"),r=o[i].getAttribute("axis"),s=o[i].getAttribute("name"),l=o[i].getAttribute("position"),m="map-select"===o[i].tagName.toLowerCase();if("width"===n)e.extent.width=s;else if("height"===n)e.extent.height=s;else if("location"!==n||"pcrs"!==a&&"gcrs"!==a)if(m){const p=o[i].htmlselect;e.extent[s]=function(){return p.value}}else{const u=o[i];e.extent[s]=function(){return u.getAttribute("value")}}else switch(r){case"longitude":case"easting":l&&(l.match(/.*?-left/i)?e.extent.left=s:l.match(/.*?-right/i)&&(e.extent.right=s));break;case"latitude":case"northing":l&&(l.match(/top-.*?/i)?e.extent.top=s:l.match(/bottom-.*?/i)&&(e.extent.bottom=s))}}return e}}),g=L.ImageOverlay.extend({initialize:function(t,e,o,i,n,a){this._container=n,this._url=t,this._location=e,this._size=L.point(o),this._angle=i,L.setOptions(this,a)},getEvents:function(){var t={viewreset:this._reset};return this._zoomAnimated&&this._step<=1&&(t.zoomanim=this._animateZoom),t},onAdd:function(){this.on({load:this._onImageLoad}),this._image||this._initImage(),this.options.interactive&&(L.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this._container.appendChild(this._image),this._reset()},onRemove:function(){L.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},_onImageLoad:function(){this._image&&(this._image.loaded=+new Date,this._updateOpacity())},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),t=this._map.getPixelOrigin().add(this._location).multiplyBy(e).subtract(this._map._getNewPixelOrigin(t.center,t.zoom)).round();L.Browser.any3d?L.DomUtil.setTransform(this._image,t,e):L.DomUtil.setPosition(this._image,t)},_reset:function(t){var e=this._image,o=this._location,i=this._size;t&&1<this._step&&(void 0===this._overlayToRemove||this._url===this._overlayToRemove)||(L.DomUtil.setPosition(e,o),e.style.width=i.x+"px",e.style.height=i.y+"px")},_updateOpacity:function(){var t,e,o;this._map&&(o=+new Date,t=!1,e=this._image,o=Math.min(1,(o-e.loaded)/200),L.DomUtil.setOpacity(e,o),(t=o<1?!0:t)&&(L.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=L.Util.requestAnimFrame(this._updateOpacity,this)),L.DomUtil.addClass(e,"leaflet-image-loaded"))}}),b=L.Layer.extend({options:{maxNext:10,zIndex:0,maxZoom:25,opacity:"1.0"},initialize:function(t,e,o,i){t&&(this._href=t),t=!!(this._layerEl=e).querySelector("map-feature,map-tile,map-extent"),this._content=t?e:o,L.setOptions(this,i),this._container=L.DomUtil.create("div","leaflet-layer"),this.changeOpacity(this.options.opacity),L.DomUtil.addClass(this._container,"mapml-layer"),this._imageContainer=L.DomUtil.create("div","leaflet-layer",this._container),L.DomUtil.addClass(this._imageContainer,"mapml-image-container"),this._mapmlTileContainer=L.DomUtil.create("div","mapml-tile-container",this._container),this._initialize(t?e:o),this.on("attached",this._validateExtent,this),this.validProjection=!0},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getHref:function(){return this._href??""},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_removeExtents:function(e){if(this._properties._mapExtents)for(let t=0;t<this._properties._mapExtents.length;t++)this._properties._mapExtents[t].templatedLayer&&e.removeLayer(this._properties._mapExtents[t].templatedLayer);this._properties._queries&&delete this._properties._queries},_changeOpacity:function(t){t&&t.target&&0<=t.target.value&&t.target.value<=1&&this.changeOpacity(t.target.value)},changeOpacity:function(t){this._container.style.opacity=t,this._layerEl._opacity=t,this.opacityEl&&(this.opacityEl.value=t)},_changeExtentOpacity:function(t){t&&t.target&&0<=t.target.value&&t.target.value<=1&&(this.templatedLayer.changeOpacity(t.target.value),this._templateVars.opacity=t.target.value)},_changeExtent:function(t,e){t.target.checked?(e.checked=!0,this._layerEl.checked&&(e.templatedLayer=M.templatedLayer(e._templateVars,{pane:this._container,opacity:e._templateVars.opacity,_leafletLayer:this,crs:e.crs,extentZIndex:e.extentZIndex,extentEl:e._DOMnode||e}).addTo(this._map),e.templatedLayer.setZIndex(),this._setLayerElExtent())):(L.DomEvent.stopPropagation(t),e.checked=!1,this._layerEl.checked&&this._map.removeLayer(e.templatedLayer),this._setLayerElExtent())},titleIsReadOnly(){return!!this._titleIsReadOnly},setName(t){this.titleIsReadOnly()||(this._title=t,this._mapmlLayerItem.querySelector(".mapml-layer-item-name").innerHTML=t)},getName(){return this._title},onAdd:function(o){if(!this._properties||this._validProjection(o)){this._map=o,this._mapmlvectors&&o.addLayer(this._mapmlvectors),this._imageLayer||(this._imageLayer=L.layerGroup()),o.addLayer(this._imageLayer),this._staticTileLayer&&o.addLayer(this._staticTileLayer);const t=function(){if(this._properties&&this._properties._mapExtents)for(let t=0;t<this._properties._mapExtents.length;t++){var e;this._properties._mapExtents[t]._templateVars&&this._properties._mapExtents[t].checked&&(this._properties._mapExtents[t].extentZIndex||(this._properties._mapExtents[t].extentZIndex=t),this._templatedLayer=M.templatedLayer(this._properties._mapExtents[t]._templateVars,{pane:this._container,opacity:this._properties._mapExtents[t]._templateVars.opacity,_leafletLayer:this,crs:this._properties.crs,extentZIndex:this._properties._mapExtents[t].extentZIndex,extentEl:this._properties._mapExtents[t]._DOMnode||this._properties._mapExtents[t]}).addTo(o),this._properties._mapExtents[t].templatedLayer=this._templatedLayer,this._templatedLayer._queries&&(this._properties._queries||(this._properties._queries=[]),this._properties._queries=this._properties._queries.concat(this._templatedLayer._queries))),this._properties._mapExtents[t].hasAttribute("opacity")&&(e=this._properties._mapExtents[t].getAttribute("opacity"),this._properties._mapExtents[t].templatedLayer.changeOpacity(e))}}.bind(this);this._properties&&this._properties._mapExtents&&this._properties._mapExtents[0]._templateVars&&t(),this._setLayerElExtent(),this.setZIndex(this.options.zIndex),this.getPane().appendChild(this._container),setTimeout(()=>{o.fire("checkdisabled")},0),o.on("popupopen",this._attachSkipButtons,this)}else this.validProjection=!1},_validProjection:function(e){let o=!1;if(this._properties&&this._properties._mapExtents)for(let t=0;t<this._properties._mapExtents.length;t++)if(this._properties._mapExtents[t]._templateVars)for(var i of this._properties._mapExtents[t]._templateVars)if(!i.projectionMatch&&i.projection!==e.options.projection){o=!0;break}return!(o||this.getProjection()!==e.options.projection)},_setLayerElExtent:function(){let i,n,a,r,s,e={minZoom:0,maxZoom:0,maxNativeZoom:0,minNativeZoom:0};["_staticTileLayer","_imageLayer","_mapmlvectors","_templatedLayer"].forEach(t=>{if(this[t])if("_templatedLayer"===t){for(let e=0;e<this._properties._mapExtents.length;e++)for(let t=0;t<this._properties._mapExtents[e]._templateVars.length;t++){var o=M._extractInputBounds(this._properties._mapExtents[e]._templateVars[t]);this._properties._mapExtents[e]._templateVars[t].tempExtentBounds=o.bounds,this._properties._mapExtents[e]._templateVars[t].extentZoomBounds=o.zoomBounds}for(let e=0;e<this._properties._mapExtents.length;e++)if(this._properties._mapExtents[e].checked)for(let t=0;t<this._properties._mapExtents[e]._templateVars.length;t++)s=i?(i.extend(this._properties._mapExtents[e]._templateVars[t].tempExtentBounds.min),i.extend(this._properties._mapExtents[e]._templateVars[t].tempExtentBounds.max),n=Math.max(n,this._properties._mapExtents[e]._templateVars[t].extentZoomBounds.maxZoom),a=Math.min(a,this._properties._mapExtents[e]._templateVars[t].extentZoomBounds.minZoom),r=Math.max(r,this._properties._mapExtents[e]._templateVars[t].extentZoomBounds.maxNativeZoom),Math.min(s,this._properties._mapExtents[e]._templateVars[t].extentZoomBounds.minNativeZoom)):(i=this._properties._mapExtents[e]._templateVars[t].tempExtentBounds,n=this._properties._mapExtents[e]._templateVars[t].extentZoomBounds.maxZoom,a=this._properties._mapExtents[e]._templateVars[t].extentZoomBounds.minZoom,r=this._properties._mapExtents[e]._templateVars[t].extentZoomBounds.maxNativeZoom,this._properties._mapExtents[e]._templateVars[t].extentZoomBounds.minNativeZoom);e.minZoom=a,e.maxZoom=n,e.minNativeZoom=s,e.maxNativeZoom=r,this._properties.zoomBounds=e,this._properties.layerBounds=i;for(let t=0;t<this._properties._mapExtents.length;t++)this._properties._mapExtents[t].templatedLayer.layerBounds=i,this._properties._mapExtents[t].templatedLayer.zoomBounds=e}else"_staticTileLayer"===t||"_imageLayer"===t?this[t].layerBounds&&(i?(i.extend(this[t].layerBounds.min),i.extend(this[t].layerBounds.max)):(i=this[t].layerBounds,e=this[t].zoomBounds)):"_mapmlvectors"===t&&0!==Object.keys(this[t]._layers).length&&this[t].layerBounds&&(i?(i.extend(this[t].layerBounds.min),i.extend(this[t].layerBounds.max)):(i=this[t].layerBounds,e=this[t].zoomBounds))}),i&&(this._layerEl.extent=Object.assign(M._convertAndFormatPCRS(i,this._properties.crs,this._properties.projection),{zoom:e}))},addTo:function(t){return t.addLayer(this),this},getEvents:function(){return{zoomanim:this._onZoomAnim}},redraw:function(){if(this._properties._mapExtents)for(let t=0;t<this._properties._mapExtents.length;t++)this._properties._mapExtents[t].templatedLayer&&this._properties._mapExtents[t].templatedLayer.redraw()},_onZoomAnim:function(t){if(this._map){var t=t.zoom,e=this._properties&&this._properties._mapExtents?this._properties._mapExtents[0].querySelector("map-input[type=zoom]"):null,o=e&&e.hasAttribute("min")?parseInt(e.getAttribute("min")):this._map.getMinZoom(),i=e&&e.hasAttribute("max")?parseInt(e.getAttribute("max")):this._map.getMaxZoom();if(e)for(let t=1;t<this._properties._mapExtents.length;t++)(e=this._properties._mapExtents[t].querySelector("map-input[type=zoom]"))&&e.hasAttribute("min")&&(o=Math.min(parseInt(e.getAttribute("min")),o)),e&&e.hasAttribute("max")&&(i=Math.max(parseInt(e.getAttribute("max")),i));t<o&&this._properties.zoomout||i<t&&this._properties.zoomin;o<=t&&t<=i||(this._properties.zoomin&&i<t?(this._href=this._properties.zoomin,this._layerEl.src=this._properties.zoomin,this.href=this._properties.zoomin,this._layerEl.src=this._properties.zoomin):this._properties.zoomout&&t<o&&(this._href=this._properties.zoomout,this.href=this._properties.zoomout,this._layerEl.src=this._properties.zoomout)),this._templatedLayer}},onRemove:function(t){L.DomUtil.remove(this._container),this._staticTileLayer&&t.removeLayer(this._staticTileLayer),this._mapmlvectors&&t.removeLayer(this._mapmlvectors),this._imageLayer&&t.removeLayer(this._imageLayer),this._properties&&this._properties._mapExtents&&this._removeExtents(t),t.fire("checkdisabled"),t.off("popupopen",this._attachSkipButtons)},getAttribution:function(){return this.options.attribution},getLayerUserControlsHTML:function(){return this._mapmlLayerItem||this._createLayerControlHTML()},_createLayerControlHTML:function(){if(!this._mapmlLayerItem){var i=L.DomUtil.create("fieldset","mapml-layer-item"),e=L.DomUtil.create("input"),n=L.DomUtil.create("span","mapml-layer-item-name"),a=L.DomUtil.create("span"),r=L.DomUtil.create("div","mapml-layer-item-properties",i),s=L.DomUtil.create("div","mapml-layer-item-settings",i),l=L.DomUtil.create("label","mapml-layer-item-toggle",r),m=L.DomUtil.create("div","mapml-layer-item-controls",r),p=L.DomUtil.create("details","mapml-layer-item-opacity mapml-control-layers",s),u=L.DomUtil.create("input"),c=L.DomUtil.create("summary"),h=L.SVG.create("svg"),d=L.SVG.create("path"),r=L.SVG.create("path"),_=L.DomUtil.create("fieldset","mapml-layer-grouped-extents"),y=this._layerEl.parentNode;this.opacityEl=u,this._mapmlLayerItem=i,h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("height","22"),h.setAttribute("width","22"),h.setAttribute("fill","currentColor"),d.setAttribute("d","M0 0h24v24H0z"),d.setAttribute("fill","none"),r.setAttribute("d","M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"),h.appendChild(d),h.appendChild(r),s.hidden=!0,a.setAttribute("aria-hidden",!0);let t=L.DomUtil.create("button","mapml-layer-item-remove-control",m);t.type="button",t.title="Remove Layer",t.innerHTML="<span aria-hidden='true'>&#10005;</span>",t.classList.add("mapml-button"),L.DomEvent.on(t,"click",L.DomEvent.stop),L.DomEvent.on(t,"click",t=>{let e=0,o,i;if(i=("MAPML-VIEWER"===y.tagName?y:y.querySelector(".mapml-web-map")).shadowRoot,t.target.closest("fieldset").nextElementSibling&&!t.target.closest("fieldset").nextElementSibling.disbaled)for(o=t.target.closest("fieldset").previousElementSibling;o;)e+=2,o=o.previousElementSibling;else o="link";y.removeChild(t.target.closest("fieldset").querySelector("span").layer._layerEl),o=o?i.querySelector(".leaflet-control-attribution").firstElementChild:o=i.querySelectorAll("input")[e],o.focus()},this);let o=L.DomUtil.create("button","mapml-layer-item-settings-control",m);if(o.type="button",o.title="Layer Settings",o.setAttribute("aria-expanded",!1),o.classList.add("mapml-button"),L.DomEvent.on(o,"click",t=>{let e=this._layerEl._layerControl._container;e._isExpanded||"touch"!==t.pointerType?!0===s.hidden?(o.setAttribute("aria-expanded",!0),s.hidden=!1):(o.setAttribute("aria-expanded",!1),s.hidden=!0):e._isExpanded=!0},this),e.defaultChecked=!!this._map,e.type="checkbox",e.setAttribute("class","leaflet-control-layers-selector"),(n.layer=this)._legendUrl?((m=document.createElement("a")).text=" "+this._title,m.href=this._legendUrl,m.target="_blank",m.draggable=!1,n.appendChild(m)):n.innerHTML=this._title,n.id="mapml-layer-item-name-{"+L.stamp(n)+"}",c.innerText="Opacity",c.id="mapml-layer-item-opacity-"+L.stamp(c),p.appendChild(c),p.appendChild(u),u.setAttribute("type","range"),u.setAttribute("min","0"),u.setAttribute("max","1.0"),u.setAttribute("value",this._container.style.opacity||"1.0"),u.setAttribute("step","0.1"),u.setAttribute("aria-labelledby",c.id),u.value=this._container.style.opacity||"1.0",i.setAttribute("aria-grabbed","false"),i.setAttribute("aria-labelledby",n.id),i.ontouchstart=i.onmousedown=e=>{if("label"===e.target.parentElement.tagName.toLowerCase()&&"input"!==e.target.tagName.toLowerCase()||"label"===e.target.tagName.toLowerCase()){e=e instanceof TouchEvent?e.touches[0]:e;let s=i,l=i.parentNode,t=!1,m=e.clientY;document.body.ontouchmove=document.body.onmousemove=a=>{a.preventDefault();var r=(a=a instanceof TouchEvent?a.touches[0]:a).clientY-m;if(t=5<Math.abs(r)||t,!(l&&!t||l&&l.childElementCount<=1||l.getBoundingClientRect().top>s.getBoundingClientRect().bottom||l.getBoundingClientRect().bottom<s.getBoundingClientRect().top)){l.classList.add("mapml-draggable"),s.style.transform="translateY("+r+"px)",s.style.pointerEvents="none";let t=a.clientX,e=a.clientY,o=("MAPML-VIEWER"===y.tagName?y:y.querySelector(".mapml-web-map")).shadowRoot,i=o.elementFromPoint(t,e),n=i&&i.closest("fieldset")?i.closest("fieldset"):s;n=Math.abs(r)<=n.offsetHeight?s:n,s.setAttribute("aria-grabbed","true"),s.setAttribute("aria-dropeffect","move"),n&&l===n.parentNode&&(n=n!==s.nextSibling?n:n.nextSibling,s!==n&&(m=a.clientY,s.style.transform=null),l.insertBefore(s,n))}},document.body.ontouchend=document.body.onmouseup=()=>{s.setAttribute("aria-grabbed","false"),s.removeAttribute("aria-dropeffect"),s.style.pointerEvents=null,s.style.transform=null;let t=l.children,o=1;for(var e of t){let t=e.querySelector("span").layer._layerEl;t.setAttribute("data-moving",""),y.insertAdjacentElement("beforeend",t),t.removeAttribute("data-moving")}var i=y.querySelectorAll("layer-");for(let e=0;e<i.length;e++){let t=i[e]._layer;t.options.zIndex!==o&&t.setZIndex(o),o++}l.classList.remove("mapml-draggable"),document.body.ontouchmove=document.body.onmousemove=document.body.onmouseup=null}}},L.DomEvent.on(u,"change",this._changeOpacity,this),l.appendChild(e),l.appendChild(n),o.appendChild(a),a.appendChild(h),this._styles&&s.appendChild(this._styles),this._userInputs){var f=document.createDocumentFragment(),g=this._properties._templateVars;if(g)for(var b=0;b<g.length;b++)for(var x=g[b],v=0;v<x.values.length;v++){var M,E,C=x.values[v],A="#"+C.getAttribute("id");"map-select"!==C.tagName.toLowerCase()||f.querySelector(A)||(M=L.DomUtil.create("details","mapml-layer-item-time mapml-control-layers",f),E=L.DomUtil.create("summary"),(A=L.DomUtil.create("label")).innerText=C.getAttribute("name"),A.setAttribute("for",C.getAttribute("id")),E.appendChild(A),M.appendChild(E),M.appendChild(C.htmlselect))}s.appendChild(f)}if(this._properties&&this._properties._mapExtents){var S=!0;this._layerItemSettingsHTML=s,(this._propertiesGroupAnatomy=_).setAttribute("aria-label","Sublayers");for(let t=0;t<this._properties._mapExtents.length;t++)_.appendChild(this._properties._mapExtents[t].extentAnatomy),this._properties._mapExtents[t].hidden||(S=!1);S||s.appendChild(_)}}return this._mapmlLayerItem},_initialize:function(t){var I;(this._href||t)&&function(l,t){var m=new URL(l.querySelector("map-base")?l.querySelector("map-base").getAttribute("href"):t?l.baseURI:I._href,I._href).href;function i(o){var i=L.DomUtil.create("fieldset","mapml-layer-extent"),t=L.DomUtil.create("div","mapml-layer-item-properties",i),e=L.DomUtil.create("div","mapml-layer-item-settings",i),n=L.DomUtil.create("label","mapml-layer-item-toggle",t),a=L.DomUtil.create("input"),r=L.SVG.create("svg"),s=L.SVG.create("path"),l=L.SVG.create("path"),m=L.DomUtil.create("span"),p=L.DomUtil.create("div","mapml-layer-item-controls",t),u=L.DomUtil.create("details","mapml-layer-item-opacity",e),t=L.DomUtil.create("summary","",u),c=this._layerEl.parentNode,h=this._layerEl,u=L.DomUtil.create("input","",u);e.hidden=!0,i.setAttribute("aria-grabbed","false"),o.hasAttribute("label")||(i.setAttribute("hidden",""),o.hidden=!0),r.setAttribute("viewBox","0 0 24 24"),r.setAttribute("height","22"),r.setAttribute("width","22"),s.setAttribute("d","M0 0h24v24H0z"),s.setAttribute("fill","none"),l.setAttribute("d","M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"),r.appendChild(s),r.appendChild(l);let d=L.DomUtil.create("button","mapml-layer-item-remove-control",p);d.type="button",d.title="Remove Sub Layer",d.innerHTML="<span aria-hidden='true'>&#10005;</span>",d.classList.add("mapml-button"),L.DomEvent.on(d,"click",L.DomEvent.stop),L.DomEvent.on(d,"click",t=>{let e=!0;t.target.checked=!1,o.removed=!0,o.checked=!1,this._layerEl.checked&&this._changeExtent(t,o),o.extentAnatomy.parentNode.removeChild(o.extentAnatomy);for(let t=0;t<this._properties._mapExtents.length;t++)this._properties._mapExtents[t].removed||(e=!1);e&&this._layerItemSettingsHTML.removeChild(this._propertiesGroupAnatomy)},this);let _=L.DomUtil.create("button","mapml-layer-item-settings-control",p);_.type="button",_.title="Extent Settings",_.setAttribute("aria-expanded",!1),_.classList.add("mapml-button"),L.DomEvent.on(_,"click",t=>{!0===e.hidden?(_.setAttribute("aria-expanded",!0),e.hidden=!1):(_.setAttribute("aria-expanded",!1),e.hidden=!0)},this),m.setAttribute("aria-hidden",!0),n.appendChild(a),_.appendChild(m),m.appendChild(r),t.innerText="Opacity",t.id="mapml-layer-item-opacity-"+L.stamp(t),u.setAttribute("type","range"),u.setAttribute("min","0"),u.setAttribute("max","1.0"),u.setAttribute("step","0.1"),u.setAttribute("aria-labelledby","mapml-layer-item-opacity-"+L.stamp(t));t=o.hasAttribute("opacity")?o.getAttribute("opacity"):"1.0";o._templateVars.opacity=t,u.setAttribute("value",t),u.value=t,L.DomEvent.on(u,"change",this._changeExtentOpacity,o);n=L.DomUtil.create("span","mapml-layer-item-name",n);return a.defaultChecked=!!o,o.checked=a.defaultChecked,a.type="checkbox",n.innerHTML=o.getAttribute("label"),L.DomEvent.on(a,"change",t=>{this._changeExtent(t,o)}),n.id="mapml-extent-item-name-{"+L.stamp(n)+"}",i.setAttribute("aria-labelledby",n.id),n.extent=o,i.ontouchstart=i.onmousedown=e=>{if("label"===e.target.parentElement.tagName.toLowerCase()&&"input"!==e.target.tagName.toLowerCase()||"label"===e.target.tagName.toLowerCase()){e.stopPropagation(),e=e instanceof TouchEvent?e.touches[0]:e;let s=i,l=i.parentNode,t=!1,m=e.clientY;document.body.ontouchmove=document.body.onmousemove=a=>{a.preventDefault();var r=(a=a instanceof TouchEvent?a.touches[0]:a).clientY-m;if(t=5<Math.abs(r)||t,!(l&&!t||l&&l.childElementCount<=1||l.getBoundingClientRect().top>s.getBoundingClientRect().bottom||l.getBoundingClientRect().bottom<s.getBoundingClientRect().top)){l.classList.add("mapml-draggable"),s.style.transform="translateY("+r+"px)",s.style.pointerEvents="none";let t=a.clientX,e=a.clientY,o=("MAPML-VIEWER"===c.tagName?c:c.querySelector(".mapml-web-map")).shadowRoot,i=o.elementFromPoint(t,e),n=i&&i.closest("fieldset")?i.closest("fieldset"):s;n=Math.abs(r)<=n.offsetHeight?s:n,s.setAttribute("aria-grabbed","true"),s.setAttribute("aria-dropeffect","move"),n&&l===n.parentNode&&(n=n!==s.nextSibling?n:n.nextSibling,s!==n&&(m=a.clientY,s.style.transform=null),l.insertBefore(s,n))}},document.body.ontouchend=document.body.onmouseup=()=>{s.setAttribute("aria-grabbed","false"),s.removeAttribute("aria-dropeffect"),s.style.pointerEvents=null,s.style.transform=null;let t=l.children,e=0;for(var o of t){let t=o.querySelector("span").extent;t.setAttribute("data-moving",""),h.insertAdjacentElement("beforeend",t),t.removeAttribute("data-moving"),t.extentZIndex=e,t.templatedLayer.setZIndex(e),e++}l.classList.remove("mapml-draggable"),document.body.ontouchmove=document.body.onmousemove=document.body.ontouchend=document.body.onmouseup=null}}},i}function n(e,i,n,t,o,a){var r=[],s=e.querySelectorAll("map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]"),l=new RegExp("(?:{)(.*?)(?:})","g"),m=e.querySelector('map-input[type="zoom" i]'),p=!1,u={zoom:0};if(i){let t=M._metaContentToObject(i.getAttribute("content")),e;u.zoom=t.zoom||u.zoom;let o=Object.keys(t);for(let t=0;t<o.length;t++)if(!o[t].includes("zoom")){e=M.axisToCS(o[t].split("-")[2]);break}var c=M.csToAxes(e);u.bounds=M.boundsToPCRSBounds(L.bounds(L.point(+t["top-left-"+c[0]],+t["top-left-"+c[1]]),L.point(+t["bottom-right-"+c[0]],+t["bottom-right-"+c[1]])),u.zoom,n,e)}else{c=M[n]||M.OSMTILE;u.bounds=c.options.crs.pcrs.bounds}for(var h=0;h<s.length;h++){var d=s[h],_=d.getAttribute("tref");if(d.zoomInput=m,!_){var y,_=P;for(y of t.querySelectorAll("map-input"))_+=`{${y.getAttribute("name")}}`}for(var f=d.hasAttribute("title")?d.getAttribute("title"):"Query this layer",g=_.match(l),b=d.hasAttribute("rel")&&"tile"!==d.getAttribute("rel").toLowerCase()?d.getAttribute("rel").toLowerCase():"tile",x=d.hasAttribute("type")?d.getAttribute("type").toLowerCase():"image/*",v=[],E=d&&d.hasAttribute("tms"),C=t.querySelector("map-meta[name=zoom]")?M._metaContentToObject(t.querySelector("map-meta[name=zoom]").getAttribute("content")):void 0;null!==(T=l.exec(_));){var A,S=T[1],T=e.querySelector("map-input[name="+S+"],map-select[name="+S+"]");if(!T){console.log("input with name="+S+" not found for template variable of same name");break}!T.hasAttribute("type")||"location"!==T.getAttribute("type")||T.hasAttribute("min")&&T.hasAttribute("max")||!T.hasAttribute("axis")||["i","j"].includes(T.getAttribute("axis").toLowerCase())||(m&&_.includes(`{${m.getAttribute("name")}}`)&&m.setAttribute("value",u.zoom),A=T.getAttribute("axis"),S=M.convertPCRSBounds(u.bounds,u.zoom,n,M.axisToCS(A)),T.setAttribute("min",S.min[M.axisToXY(A)]),T.setAttribute("max",S.max[M.axisToXY(A)])),v.push(T),p=p||T.hasAttribute("type")&&"zoom"===T.getAttribute("type").toLowerCase(),"map-select"===T.tagName.toLowerCase()&&((A=document.createElement("div")).insertAdjacentHTML("afterbegin",T.outerHTML),T.htmlselect=A.querySelector("map-select"),T.htmlselect=function(e){var o=document.createElement("select"),i=e.getAttributeNames();for(let t=0;t<i.length;t++)o.setAttribute(i[t],e.getAttribute(i[t]));var n=e.children;for(let e=0;e<n.length;e++){var a=document.createElement("option"),r=n[e].getAttributeNames();for(let t=0;t<r.length;t++)a.setAttribute(r[t],n[e].getAttribute(r[t]));a.innerHTML=n[e].innerHTML,o.appendChild(a)}return o}(T.htmlselect),L.DomEvent.on(T.htmlselect,"change",I.redraw,I),I._userInputs||(I._userInputs=[]),I._userInputs.push(T.htmlselect))}if(_&&g.length===v.length||_===P){"query"===b&&(I.queryable=!0),!p&&m&&v.push(m);let t=m?m.getAttribute("step"):1;t&&"0"!==t&&!isNaN(t)||(t=1),r.push({template:decodeURI(new URL(_,o)),linkEl:d,title:f,rel:b,type:x,values:v,zoomBounds:C,extentPCRSFallback:{bounds:u.bounds},projectionMatch:a,projection:e.getAttribute("units")||k,tms:E,step:t})}}return r}I._properties={},function(){let t=I.options.mapprojection;l.querySelector("map-meta[name=projection][content]")?t=M._metaContentToObject(l.querySelector("map-meta[name=projection]").getAttribute("content")).content||t:l.querySelector("map-extent[units]")?t=(e=>{var o=e[0].attributes.units.value;let i=!0;for(let t=0;t<e.length;t++)o!==e[t].attributes.units.value&&(i=!1);return i?o:null})(Array.from(l.querySelectorAll("map-extent[units]")))||t:console.log(`A projection was not assigned to the '${I._layerEl.label}' Layer. Please specify a projection for that layer using a map-meta element. See more here - https://maps4html.org/web-map-doc/docs/elements/meta/`),I._properties.projection=t,I._properties.projection===I.options.mapprojection&&(I._properties.crs=M[I._properties.projection])}(),function(){let t=I._properties.projection!==I.options.mapprojection&&l.querySelector("map-head map-link[rel=alternate][projection="+I.options.mapprojection+"][href]");try{if(t){var e=new URL(t.getAttribute("href"),m).href;return I._layerEl.dispatchEvent(new CustomEvent("changeprojection",{detail:{href:e}})),!0}if(I._properties.projection!==I.options.mapprojection&&1===I._layerEl.parentElement.layers.length)return I._layerEl.parentElement.projection=I._properties.projection,!0}catch(t){}return!1}()||(I._properties.crs&&function(){let e=I._properties.projection===I.options.mapprojection,o=l.querySelectorAll("map-extent[units]");if(0!==o.length){I._properties._mapExtents=[],I._properties._templateVars=[];for(let t=0;t<o.length;t++)o[t].querySelector("map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]")&&(o[t]._templateVars=n.call(I,o[t],l.querySelector("map-meta[name=extent]"),I._properties.projection,l,m,e),o[t].extentAnatomy=i.call(I,o[t]),I._properties._mapExtents.push(o[t]),I._properties._templateVars=I._properties._templateVars.concat(o[t]._templateVars))}}(),I._styles=function(){var t=l.querySelectorAll('map-link[rel=style],map-link[rel="self style"],map-link[rel="style self"]');if(1<t.length){var e=document.createElement("details"),o=document.createElement("summary");o.innerText="Style",e.appendChild(o);for(var i=function(t){L.DomEvent.stop(t),I._layerEl.dispatchEvent(new CustomEvent("changestyle",{detail:{src:t.target.getAttribute("data-href")}}))},n=0;n<t.length;n++){var a=document.createElement("div"),r=a.appendChild(document.createElement("input"));r.setAttribute("type","radio"),r.setAttribute("id","rad-"+L.stamp(r)),r.setAttribute("name","styles-"+I._title),r.setAttribute("value",t[n].getAttribute("title")),r.setAttribute("data-href",new URL(t[n].getAttribute("href"),m).href);var s=a.appendChild(document.createElement("label"));s.setAttribute("for","rad-"+L.stamp(r)),s.innerText=t[n].getAttribute("title"),"style self"!==t[n].getAttribute("rel")&&"self style"!==t[n].getAttribute("rel")||(r.checked=!0),e.appendChild(a),L.DomUtil.addClass(e,"mapml-layer-item-style mapml-control-layers"),L.DomEvent.on(r,"click",i,I)}return e}}(),function(){var t=l.querySelector("map-link[rel=license]");t&&(e=t.getAttribute("title"),t=t.getAttribute("href"),e='<a href="'+t+'" title="'+e+'">'+e+"</a>");L.setOptions(I,{attribution:e});var e=l.querySelector("map-link[rel=legend]");e&&(I._legendUrl=e.getAttribute("href"));I._map&&I._map.hasLayer(I)&&I._map.attributionControl.addAttribution(I.getAttribution())}(),function(){l.querySelector("map-title")?(I._title=l.querySelector("map-title").textContent.trim(),I._titleIsReadOnly=!0):l instanceof Element&&l.hasAttribute("label")&&(I._title=l.getAttribute("label").trim());I._createLayerControlHTML()}(),function(){var t=l.querySelector("map-link[rel=zoomin]"),e=l.querySelector("map-link[rel=zoomout]");t&&(I._properties.zoomin=new URL(t.getAttribute("href"),m).href);e&&(I._properties.zoomout=new URL(e.getAttribute("href"),m).href)}(),I._properties.crs&&function(){if(l.querySelector("map-tile")){var t=document.createElement("map-tiles"),e=l.querySelector("map-meta[name=zoom][content]")||l.querySelector("map-input[type=zoom][value]");t.setAttribute("zoom",e&&e.getAttribute("content")||e&&e.getAttribute("value")||"0");for(var o=l.getElementsByTagName("map-tile"),i=0;i<o.length;i++)t.appendChild(document.importNode(o[i],!0));I._mapmlTileContainer.appendChild(t),I._staticTileLayer=M.staticTileLayer({pane:I._container,_leafletLayer:I,projection:I._properties.projection,className:"mapml-static-tile-layer",tileContainer:I._mapmlTileContainer,maxZoomBound:I._properties.crs.options.resolutions.length-1,tileSize:I._properties.crs.options.crs.tile.bounds.max.x})}}(),function(){var t=M.getNativeVariables(I._content);I._mapmlvectors=M.featureLayer(null,{renderer:M.featureRenderer(),pane:I._container,opacity:I.options.opacity,projection:I._properties.projection,native:t,_leafletLayer:I,static:!0,onEachFeature:function(t,e){var o;t&&((o=document.createElement("div")).classList.add("mapml-popup-content"),o.insertAdjacentHTML("afterbegin",t.innerHTML),e.bindPopup(o,{autoClose:!1,minWidth:165}))}})}(),M._parseStylesheetAsHTML(l,m,I._container),I._validateExtent(),function(){if(!t){let t=I._layerEl.shadowRoot;var e=l.children[0].children[1].children;if(e){var o,i,n=l.children[0].children[0].querySelector("map-base")?.getAttribute("href");for(o of e){let e=o.cloneNode(!0);if(o._DOMnode=e,"map-link"===e.nodeName){let t=e.getAttribute("href")||e.getAttribute("tref");!t||0!==t.indexOf("http://")&&0!==t.indexOf("https://")||(i=n+t,e.hasAttribute("href")?e.setAttribute("href",i):e.setAttribute("tref",i))}t.appendChild(e)}}}}(),I._layerEl.parentElement&&I._layerEl.parentElement._toggleControls())}.call(I=this,t,!this._href)},_validateExtent:function(){if(this._properties&&this._map){var e,o=this._properties._mapExtents||[this._properties];for(let t=0;t<o.length;t++){if(!o[t].querySelector)return;o[t].querySelector('[type=zoom][min=""], [type=zoom][max=""]')&&((e=o[t].querySelector("[type=zoom]")).setAttribute("min",this._map.getMinZoom()),e.setAttribute("max",this._map.getMaxZoom())),(e=o[t].hasAttribute("units")?o[t].getAttribute("units"):null)&&M[e]?this._properties._mapExtents?this._properties._mapExtents[t].crs=M[e]:this._properties.crs=M[e]:this._properties._mapExtents?this._properties._mapExtents[t].crs=M.OSMTILE:this._properties.crs=M.OSMTILE}}},getProjection:function(){if(this._properties)return this._properties.projection},getQueryTemplates:function(o){if(this._properties&&this._properties._queries){var i=[];if(this._layerEl.checked&&!this._layerEl.hidden&&this._mapmlLayerItem){var e=this._mapmlLayerItem.querySelectorAll(".mapml-layer-item-name");for(let t=0;t<e.length;t++)if(e[t].extent||1===this._properties._mapExtents.length){var n=e[t].extent||this._properties._mapExtents[0];for(let t=0;t<n._templateVars.length;t++)if(n.checked){var a=n._templateVars[t];for(let e=0;e<this._properties._queries.length;e++){let t=this._properties._queries[e];a===t&&t.extentBounds.contains(o)&&i.push(t)}}}return i}}},_attachSkipButtons:function(t){let n=t.popup,a=t.target,e,r,o=n._container.getElementsByClassName("mapml-popup-content")[0];n._container.setAttribute("role","dialog"),o.setAttribute("tabindex","-1"),o.setAttribute("role","document"),n._count=0,n._source._eventParents?(e=n._source._eventParents[Object.keys(n._source._eventParents)[0]],r=n._source.group,_.call(n)):(e=n._source._templatedLayer,a.on("attachZoomLink",_,n)),n._container.querySelector('nav[class="mapml-focus-buttons"]')&&(L.DomUtil.remove(n._container.querySelector('nav[class="mapml-focus-buttons"]')),L.DomUtil.remove(n._container.querySelector("hr")));var i=L.DomUtil.create("nav","mapml-focus-buttons");let s=L.DomUtil.create("button","mapml-popup-button",i);s.type="button",s.title="Focus Map",s.innerHTML="<span aria-hidden='true'>|&#10094;</span>",L.DomEvent.on(s,"click",t=>{L.DomEvent.stop(t),a.featureIndex._sortIndex(),a.closePopup(),a._container.focus()},n);let l=L.DomUtil.create("button","mapml-popup-button",i);l.type="button",l.title="Previous Feature",l.innerHTML="<span aria-hidden='true'>&#10094;</span>",L.DomEvent.on(l,"click",e._previousFeature,n);let m=L.DomUtil.create("p","mapml-feature-count",i),p=this._totalFeatureCount||1;m.innerText=n._count+1+"/"+p;let u=L.DomUtil.create("button","mapml-popup-button",i);u.type="button",u.title="Next Feature",u.innerHTML="<span aria-hidden='true'>&#10095;</span>",L.DomEvent.on(u,"click",e._nextFeature,n);let c=L.DomUtil.create("button","mapml-popup-button",i);c.type="button",c.title="Focus Controls",c.innerHTML="<span aria-hidden='true'>&#10095;|</span>",L.DomEvent.on(c,"click",t=>{a.featureIndex._sortIndex(),a.featureIndex.currentIndex=a.featureIndex.inBoundFeatures.length-1,a.featureIndex.inBoundFeatures[0].path.setAttribute("tabindex",-1),a.featureIndex.inBoundFeatures[a.featureIndex.currentIndex].path.setAttribute("tabindex",0),L.DomEvent.stop(t),a.closePopup(),a._controlContainer.querySelector("A:not([hidden])").focus()},n);t=L.DomUtil.create("hr","mapml-popup-divider");function h(t){let e=t.originalEvent.path||t.originalEvent.composedPath();var o=9===t.originalEvent.keyCode,i=t.originalEvent.shiftKey;(e[0].classList.contains("leaflet-popup-close-button")&&o&&!i||27===t.originalEvent.keyCode||e[0].classList.contains("leaflet-popup-close-button")&&13===t.originalEvent.keyCode||e[0].classList.contains("mapml-popup-content")&&o&&i||e[0]===n._content.querySelector("a")&&o&&i)&&setTimeout(()=>{a.closePopup(n),r.focus(),L.DomEvent.stop(t)},0)}function d(t){let e=t.originalEvent.path||t.originalEvent.composedPath();var o=9===t.originalEvent.keyCode,i=t.originalEvent.shiftKey;13===t.originalEvent.keyCode&&e[0].classList.contains("leaflet-popup-close-button")||27===t.originalEvent.keyCode?(L.DomEvent.stopPropagation(t),a.closePopup(n),a._container.focus(),27!==t.originalEvent.keyCode&&(a._popupClosed=!0)):o&&e[0].classList.contains("leaflet-popup-close-button")?a.closePopup(n):(e[0].classList.contains("mapml-popup-content")&&o&&i||e[0]===n._content.querySelector("a")&&o&&i)&&(a.closePopup(n),setTimeout(()=>{L.DomEvent.stop(t),a._container.focus()},0))}function _(t){let n=this._content,a=t?t.currFeature:this._source._groupLayer._featureEl;n.querySelector("a.mapml-zoom-link")&&n.querySelector("a.mapml-zoom-link").remove(),a.querySelector("map-geometry")&&a.whenReady().then(()=>{var t=a.extent.topLeft.gcrs,e=a.extent.bottomRight.gcrs,e=L.latLngBounds(L.latLng(t.horizontal,t.vertical),L.latLng(e.horizontal,e.vertical)).getCenter(!0);let o=document.createElement("a");o.href=`#${a.getMaxZoom()},${e.lng},`+e.lat,o.innerHTML=""+M.options.locale.popupZoom,o.className="mapml-zoom-link",o.onclick=o.onkeydown=function(t){(t instanceof MouseEvent||13===t.keyCode)&&(t.preventDefault(),a.zoomTo(),a._map.closePopup(),a._map.getContainer().focus())};let i=n.querySelector(".mapml-zoom-link");i&&i.remove(),n.insertBefore(o,n.querySelector("hr.mapml-popup-divider"))})}n._navigationBar=i,n._content.appendChild(t),n._content.appendChild(i),o.focus(),r&&!M.options.featureIndexOverlayOption?(r.setAttribute("aria-expanded","true"),a.on("keydown",h)):a.on("keydown",d),a.on("popupclose",function t(e){e.popup===n&&(a.off("keydown",h),a.off("keydown",d),a.off("popupopen",_),a.off("popupclose",t),r&&r.setAttribute("aria-expanded","false"))})}}),x=L.Layer.extend({onAdd:function(t){var e=t.getSize();(400<e.x||300<e.y)&&(this._container=L.DomUtil.create("table","mapml-debug",t._container),this._panel=E({className:"mapml-debug-panel",pane:this._container}),t.addLayer(this._panel)),this._grid=A({className:"mapml-debug-grid",pane:t._panes.mapPane,zIndex:400,tileSize:t.options.crs.options.crs.tile.bounds.max.x}),t.addLayer(this._grid),this._vectors=T({className:"mapml-debug-vectors",pane:t._panes.mapPane,toolPane:this._container}),t.addLayer(this._vectors)},onRemove:function(t){t.removeLayer(this._grid),t.removeLayer(this._vectors),this._panel&&(t.removeLayer(this._panel),L.DomUtil.remove(this._container))}}),v=L.Layer.extend({initialize:function(t){L.setOptions(this,t)},onAdd:function(t){this._title=L.DomUtil.create("caption","mapml-debug-banner",this.options.pane),this._title.innerHTML="Debug mode",t.debug={},t.debug._infoContainer=this._debugContainer=L.DomUtil.create("tbody","mapml-debug-panel",this.options.pane);var e=t.debug._infoContainer;t.debug._tileCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._tileMatrixCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._mapCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._tcrsCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._pcrsCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._gcrsCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),this._map.on("mousemove",this._updateCoords)},onRemove:function(){L.DomUtil.remove(this._title),this._debugContainer&&(L.DomUtil.remove(this._debugContainer),this._map.off("mousemove",this._updateCoords))},_updateCoords:function(s){if(!this.contextMenu._visible){let t=this.options.mapEl,e=t._map.project(s.latlng),o=t._map.options.crs.scale(+t.zoom),i=t._map.options.crs.transformation.untransform(e,o),n=t._map.options.crs.options.crs.tile.bounds.max.x,a=e.x%n,r=e.y%n;a<0&&(a+=n),r<0&&(r+=n),this.debug._tileCoord.innerHTML=`
      <th scope="row">tile: </th>
      <td>i: ${Math.trunc(a)}, </td>
      <td>j: ${Math.trunc(r)}</td>
      `,this.debug._mapCoord.innerHTML=`
      <th scope="row">map: </th>
      <td>i: ${Math.trunc(s.containerPoint.x)}, </td>
      <td>j: ${Math.trunc(s.containerPoint.y)}</td>
      `,this.debug._gcrsCoord.innerHTML=`
      <th scope="row">gcrs: </th>
      <td>lon: ${s.latlng.lng.toFixed(6)}, </td>
      <td>lat: ${s.latlng.lat.toFixed(6)}</td>
      `,this.debug._tcrsCoord.innerHTML=`
      <th scope="row">tcrs: </th>
      <td>x: ${Math.trunc(e.x)}, </td>
      <td>y: ${Math.trunc(e.y)}</td>
      `,this.debug._tileMatrixCoord.innerHTML=`
      <th scope="row">tilematrix: </th>
      <td>column: ${Math.trunc(e.x/n)}, </td>
      <td>row: ${Math.trunc(e.y/n)}</td>
      `,this.debug._pcrsCoord.innerHTML=`
      <th scope="row">pcrs: </th>
      <td>easting: ${i.x.toFixed(2)}, </td>
      <td>northing: ${i.y.toFixed(2)}</td>
      `}}}),E=function(t){return new v(t)},C=L.GridLayer.extend({initialize:function(t){L.setOptions(this,t),L.GridLayer.prototype.initialize.call(this,this._map)},createTile:function(t){let e=L.DomUtil.create("div","mapml-debug-tile");return e.setAttribute("col",t.x),e.setAttribute("row",t.y),e.setAttribute("zoom",t.z),e.innerHTML=["col: "+t.x,"row: "+t.y,"zoom: "+t.z].join(", "),e.style.outline="1px dashed red",e}}),A=function(t){return new C(t)},S=L.LayerGroup.extend({initialize:function(t){L.setOptions(this,t),L.LayerGroup.prototype.initialize.call(this,this._map,t)},onAdd:function(t){t.on("overlayremove",this._mapLayerUpdate,this),t.on("overlayadd",this._mapLayerUpdate,this);var e=t.options.crs.transformation.transform(L.point(0,0),t.options.crs.scale(0));this._centerVector=L.circle(t.options.crs.pointToLatLng(e,0),{radius:250}),this._centerVector.bindTooltip("Projection Center"),this._addBounds(t)},onRemove:function(t){this.clearLayers()},_addBounds:function(t){let e=Object.keys(t._layers),o=t._layers,i=["#FF5733","#8DFF33","#3397FF","#E433FF","#F3FF33"],n=0;this.addLayer(this._centerVector);for(var a of e)if(o[a].layerBounds||o[a].extentBounds){let t;t=o[a].layerBounds?[o[a].layerBounds.min,L.point(o[a].layerBounds.max.x,o[a].layerBounds.min.y),o[a].layerBounds.max,L.point(o[a].layerBounds.min.x,o[a].layerBounds.max.y)]:[o[a].extentBounds.min,L.point(o[a].extentBounds.max.x,o[a].extentBounds.min.y),o[a].extentBounds.max,L.point(o[a].extentBounds.min.x,o[a].extentBounds.max.y)];let e=w(t,{color:i[n%i.length],weight:2,opacity:1,fillOpacity:.01,fill:!0});o[a].options._leafletLayer&&e.bindTooltip(o[a].options._leafletLayer._title,{sticky:!0}),this.addLayer(e),n++}t.totalLayerBounds&&(t=[t.totalLayerBounds.min,L.point(t.totalLayerBounds.max.x,t.totalLayerBounds.min.y),t.totalLayerBounds.max,L.point(t.totalLayerBounds.min.x,t.totalLayerBounds.max.y)],t=w(t,{color:"#808080",weight:5,opacity:.5,fill:!1}),this.addLayer(t))},_mapLayerUpdate:function(t){this.clearLayers(),this._addBounds(t.target)}}),T=function(t){return new S(t)},I=L.Path.extend({getCenter:function(t){let e=this._map.options.crs;return e.unproject(L.bounds(this._locations).getCenter())},options:{className:"mapml-debug-extent"},initialize:function(t,e){this._locations=t,L.setOptions(this,e)},_project:function(){this._rings=[];let e=this._map.options.crs.scale(this._map.getZoom()),o=this._map;for(let t=0;t<this._locations.length;t++){var i=o.options.crs.transformation.transform(this._locations[t],e);this._rings.push(L.point(i.x,i.y)._subtract(o.getPixelOrigin()))}this._parts=[this._rings]},_update:function(){this._map&&this._renderer._updatePoly(this,!0)}}),w=function(t,e){return new I(t,e)},z=L.Handler.extend({addHooks:function(){L.setOptions(this,{mapEl:this._map.options.mapEl}),L.DomEvent.on(this._map,"click",this._queryTopLayer,this),L.DomEvent.on(this._map,"keypress",this._queryTopLayerAtMapCenter,this)},removeHooks:function(){L.DomEvent.off(this._map,"click",this._queryTopLayer,this),L.DomEvent.on(this._map,"keypress",this._queryTopLayerAtMapCenter,this)},_getTopQueryableLayer:function(){for(var t=this.options.mapEl.layers,e=t.length-1;0<=e;e--){var o=t[e]._layer;if(t[e].checked&&o&&o.queryable)return o}},_queryTopLayerAtMapCenter:function(t){setTimeout(()=>{!this._map.isFocused||this._map._popupClosed||" "!==t.originalEvent.key&&13!=+t.originalEvent.keyCode?delete this._map._popupClosed:this._map.fire("click",{latlng:this._map.getCenter(),layerPoint:this._map.latLngToLayerPoint(this._map.getCenter()),containerPoint:this._map.latLngToContainerPoint(this._map.getCenter())})},0)},_queryTopLayer:function(t){var e=this._getTopQueryableLayer();e&&(e._mapmlFeatures&&delete e._mapmlFeatures,this._query(t,e))},_query(a,r){function e(t){return n.transformation.untransform(t,n.scale(i))}function o(t){return n.unproject(n.transformation.untransform(t,n.scale(i)),i)}var i=a.target.getZoom(),s=this._map,n=r._properties.crs,l=s.options.crs.options.crs.tile.bounds.max.x,m=r._container,p={autoClose:!1,autoPan:!0,maxHeight:.5*s.getSize().y-50},u=n.latLngToPoint(a.latlng,i),c=u.divideBy(l).floor(),h=new L.Bounds(u.divideBy(l).floor().multiplyBy(l),u.divideBy(l).ceil().multiplyBy(l)),t=this._map.project(a.latlng),d=this._map.options.crs.scale(this._map.getZoom()),_=this._map.options.crs.transformation.untransform(t,d),y=r.getQueryTemplates(_);let f=[];for(let t=0;t<y.length;t++){var g,b={},x=y[t];for(g in b[x.query.tilei]=u.x.toFixed()-c.x*l,b[x.query.tilej]=u.y.toFixed()-c.y*l,b[x.query.mapi]=s.getSize().divideBy(2).x.toFixed(),b[x.query.mapj]=s.getSize().divideBy(2).y.toFixed(),b[x.query.pixelleft]=n.pointToLatLng(u,i).lng,b[x.query.pixeltop]=n.pointToLatLng(u,i).lat,b[x.query.pixelright]=n.pointToLatLng(u.add([1,1]),i).lng,b[x.query.pixelbottom]=n.pointToLatLng(u.add([1,1]),i).lat,b[x.query.column]=c.x,b[x.query.row]=c.y,b[x.query.x]=u.x.toFixed(),b[x.query.y]=u.y.toFixed(),b[x.query.easting]=e(u).x,b[x.query.northing]=e(u).y,b[x.query.longitude]=o(u).lng,b[x.query.latitude]=o(u).lat,b[x.query.zoom]=i,b[x.query.width]=s.getSize().x,b[x.query.height]=s.getSize().y,b[x.query.mapbottom]=e(u.add(s.getSize().divideBy(2))).y,b[x.query.mapleft]=e(u.subtract(s.getSize().divideBy(2))).x,b[x.query.maptop]=e(u.subtract(s.getSize().divideBy(2))).y,b[x.query.mapright]=e(u.add(s.getSize().divideBy(2))).x,b[x.query.tilebottom]=e(h.max).y,b[x.query.tileleft]=e(h.min).x,b[x.query.tiletop]=e(h.min).y,b[x.query.tileright]=e(h.max).x,x.query)["mapi","mapj","tilei","tilej","row","col","x","y","easting","northing","longitude","latitude","width","height","zoom","mapleft","mapright",",maptop","mapbottom","tileleft","tileright","tiletop","tilebottom","pixeltop","pixelbottom","pixelleft","pixelright"].indexOf(g)<0&&(b[g]=x.query[g]);x.extentBounds.contains(_)&&f.push(function(i,t){const n=new DOMParser;return fetch(L.Util.template(i.template,t),{redirect:"follow"}).then(e=>{if(200<=e.status&&e.status<300)return e.text().then(t=>({contenttype:e.headers.get("Content-Type"),text:t}));throw new Error(e.status)}).then(e=>{let o=[];if(e.contenttype.startsWith("text/mapml")){let t=n.parseFromString(e.text,"application/xml");o=Array.prototype.slice.call(t.querySelectorAll("map-feature")),r.queryMetas=Array.prototype.slice.call(t.querySelectorAll("map-meta[name=cs], map-meta[name=zoom], map-meta[name=projection]"))}else{var t="<map-geometry cs='gcrs'><map-point><map-coordinates>"+a.latlng.lng+" "+a.latlng.lat+"</map-coordinates></map-point></map-geometry>",t=n.parseFromString("<map-feature><map-properties>"+e.text+"</map-properties>"+t+"</map-feature>","text/html").querySelector("map-feature");o.push(t)}return{features:o,template:i}}).catch(t=>{console.log("Looks like there was a problem. Status: "+t.message)})}(x,b))}Promise.allSettled(f).then(t=>{r._mapmlFeatures=[];for(var e of t)if("fulfilled"===e.status){for(var o of e.value.features)o._extentEl=e.value.template._extentEl;r._mapmlFeatures=r._mapmlFeatures.concat(e.value.features)}0<r._mapmlFeatures.length&&function(i,n){if(0!==i.length){let t=M.featureLayer(i,{renderer:M.featureRenderer(),pane:m,projection:s.options.projection,_leafletLayer:r,query:!0,static:!0});t.addTo(s);let e=L.DomUtil.create("div","mapml-popup-content"),o=L.DomUtil.create("iframe");o.style="border: none",o.srcdoc=i[0].querySelector("map-feature map-properties").innerHTML,o.setAttribute("sandbox","allow-same-origin allow-forms"),e.appendChild(o),r._totalFeatureCount=i.length,r.bindPopup(e,p).openPopup(n),r.on("popupclose",function(){s.removeLayer(t)}),t.showPaginationFeature({i:0,popup:r._popup,meta:r.queryMetas})}}(r._mapmlFeatures,a.latlng)})}}),N=L.Handler.extend({_touchstart:L.Browser.msPointer?"MSPointerDown":L.Browser.pointer?"pointerdown":"touchstart",initialize:function(t){L.Handler.prototype.initialize.call(this,t),this.activeIndex=0,this.excludedIndices=[4,7],this.isRunned=!1,this._menuItems={};this._menuItems.CTXBACK=0,this._menuItems.CTXFWD=1,this._menuItems.CTXRELOAD=2,this._menuItems.CTXFULLSCR=3,this._menuItems.CTXSPACER1=4,this._menuItems.CTXCOPY=5,this._menuItems.CTXPASTE=6,this._menuItems.CTXSPACER2=7,this._menuItems.CTXCNTRLS=8,this._menuItems.CTXDEBUG=9,this._menuItems.CTXVWSRC=10,this._items=[{text:M.options.locale.cmBack+" (<kbd>Alt+Left Arrow</kbd>)",callback:this._goBack},{text:M.options.locale.cmForward+" (<kbd>Alt+Right Arrow</kbd>)",callback:this._goForward},{text:M.options.locale.cmReload+" (<kbd>Ctrl+R</kbd>)",callback:this._reload},{text:M.options.locale.btnFullScreen+" (<kbd>F</kbd>)",callback:this._toggleFullScreen},{spacer:"-"},{text:M.options.locale.cmCopyCoords+" (<kbd>C</kbd>)<span></span>",callback:this._copyCoords,hideOnSelect:!1,popup:!0,submenu:[{text:M.options.locale.cmCopyMapML,callback:this._copyMapML},{text:M.options.locale.cmCopyExtent,callback:this._copyExtent},{text:M.options.locale.cmCopyLocation,callback:this._copyLocation}]},{text:M.options.locale.cmPasteLayer+" (<kbd>P</kbd>)",callback:this._paste},{spacer:"-"},{text:M.options.locale.cmToggleControls+" (<kbd>T</kbd>)",callback:this._toggleControls},{text:M.options.locale.cmToggleDebug+" (<kbd>D</kbd>)",callback:this._toggleDebug},{text:M.options.locale.cmViewSource+" (<kbd>V</kbd>)",callback:this._viewSource}],this.defExtCS=M.options.defaultExtCoor,this.defLocCS=M.options.defaultLocCoor;this._menuItems.LYRZOOMTO=0,this._menuItems.LYRCOPY=1,this._layerItems=[{text:M.options.locale.lmZoomToLayer+" (<kbd>Z</kbd>)",callback:this._zoomToLayer},{text:M.options.locale.lmCopyLayer+" (<kbd>L</kbd>)",callback:this._copyLayer}],this._mapMenuVisible=!1,this._keyboardEvent=!1,this._container=L.DomUtil.create("div","mapml-contextmenu",t.getContainer()),this._container.setAttribute("hidden",""),this._items[0].el=this._createItem(this._container,this._items[0]),this._items[1].el=this._createItem(this._container,this._items[1]),this._items[2].el=this._createItem(this._container,this._items[2]),this._items[3].el=this._createItem(this._container,this._items[3]),this._items[4].el=this._createItem(this._container,this._items[4]),this._items[5].el=this._createItem(this._container,this._items[5]),this._copySubMenu=L.DomUtil.create("div","mapml-contextmenu mapml-submenu",this._container),this._copySubMenu.id="mapml-copy-submenu",this._copySubMenu.setAttribute("hidden",""),this._clickEvent=null;this._menuItems.CPYMENUMAP=0,this._menuItems.CPYMENUEXTENT=1,this._menuItems.CPYMENULOC=2,this._createItem(this._copySubMenu,this._items[5].submenu[0],0),this._createItem(this._copySubMenu,this._items[5].submenu[1],1),this._createItem(this._copySubMenu,this._items[5].submenu[2],2),this._items[6].el=this._createItem(this._container,this._items[6]),this._items[7].el=this._createItem(this._container,this._items[7]),this._items[8].el=this._createItem(this._container,this._items[8]),this._items[9].el=this._createItem(this._container,this._items[9]),this._items[10].el=this._createItem(this._container,this._items[10]),this._layerMenu=L.DomUtil.create("div","mapml-contextmenu mapml-layer-menu",t.getContainer()),this._layerMenu.setAttribute("hidden",""),this._createItem(this._layerMenu,this._layerItems[0]),this._createItem(this._layerMenu,this._layerItems[1]),L.DomEvent.on(this._container,"click",L.DomEvent.stop).on(this._container,"mousedown",L.DomEvent.stop).on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"contextmenu",L.DomEvent.stop).on(this._layerMenu,"click",L.DomEvent.stop).on(this._layerMenu,"mousedown",L.DomEvent.stop).on(this._layerMenu,"dblclick",L.DomEvent.stop).on(this._layerMenu,"contextmenu",L.DomEvent.stop),this.t=document.createElement("template"),this.t.innerHTML=`<map-feature zoom="">
        <map-featurecaption></map-featurecaption>
        <map-properties>
            <h2></h2>
            <div style="text-align:center"></div>
        </map-properties>
        <map-geometry cs="">
          <map-point>
            <map-coordinates></map-coordinates>
          </map-point>
        </map-geometry>
      </map-feature>`},addHooks:function(){var t=this._map.getContainer();L.DomEvent.on(t,"mouseleave",this._hide,this).on(document,"keydown",this._onKeyDown,this),L.Browser.touch&&L.DomEvent.on(document,this._touchstart,this._hide,this),this._map.on({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},removeHooks:function(){var t=this._map.getContainer();L.DomEvent.off(t,"mouseleave",this._hide,this).off(document,"keydown",this._onKeyDown,this),L.Browser.touch&&L.DomEvent.off(document,this._touchstart,this._hide,this),this._map.off({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},_updateCS:function(){this.defExtCS===M.options.defaultExtCoor&&this.defLocCS===M.options.defaultLocCoor||(this.defExtCS=M.options.defaultExtCoor,this.defLocCS=M.options.defaultLocCoor)},_copyExtent:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu,o=e.defExtCS?e.defExtCS.toLowerCase():"pcrs",i=(t instanceof KeyboardEvent?this:this.options.mapEl).extent.topLeft[o],n=(t instanceof KeyboardEvent?this:this.options.mapEl).extent.bottomRight[o],a="";"pcrs"===o?a=`<map-meta name="extent" content="top-left-easting=${Math.round(i.horizontal)}, top-left-northing=${Math.round(i.vertical)}, bottom-right-easting=${Math.round(n.horizontal)}, bottom-right-northing=${Math.round(n.vertical)}"></map-meta>`:"gcrs"===o?a=`<map-meta name="extent" content="top-left-longitude=${i.horizontal}, top-left-latitude=${i.vertical}, bottom-right-longitude=${n.horizontal}, bottom-right-latitude=${n.vertical}"></map-meta>`:"tcrs"===o?a=`<map-meta name="extent" content="top-left-x=${i[0].horizontal}, top-left-y=${i[0].vertical}, bottom-right-x=${n[n.length-1].horizontal}, bottom-right-y=${n[n.length-1].vertical}"></map-meta>`:"tilematrix"===o?a=`<map-meta name="extent" content="top-left-column=${i[0].horizontal}, top-left-row=${i[0].vertical}, bottom-right-column=${n[n.length-1].horizontal}, bottom-right-row=${n[n.length-1].vertical}"></map-meta>`:console.log("not support"),e._copyData(a)},_zoomToLayer:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu;e._layerClicked.layer._layerEl.zoomTo()},_copyLayer:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu,o=e._layerClicked.layer._layerEl;e._copyData(o.getOuterHTML())},_goForward:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.forward()},_goBack:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.back()},_reload:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.reload()},_toggleFullScreen:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e._toggleFullScreen()},_toggleControls:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.controls?e.controls=!1:e.controls=!0},_copyMapML:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu,o=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e._copyData(o.outerHTML.replace(/<div class="mapml-web-map">.*?<\/div>|<style>\[is="web-map"].*?<\/style>|<style>mapml-viewer.*?<\/style>/gm,""))},_paste:function(t){(t instanceof KeyboardEvent?this._map:this).contextMenu;let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;navigator.clipboard.readText().then(t=>{M._pasteLayer(e,t)})},_viewSource:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.viewSource()},_toggleDebug:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.toggleDebug()},_copyCoords:function(t){let e=this.contextMenu||this;e._showCopySubMenu(t)},_copyData:function(t){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)},_copyLocation:function(t){const e=this.contextMenu;switch(e.defLocCS.toLowerCase()){case"tile":e._copyTile.call(this,t);break;case"tilematrix":e._copyTileMatrix.call(this,t);break;case"map":e._copyMap.call(this,t);break;case"tcrs":e._copyTCRS.call(this,t);break;case"pcrs":e._copyPCRS.call(this,t);break;default:e._copyGCRS.call(this,t)}},_copyGCRS:function(t){let e=this.options.mapEl,o=this.contextMenu._clickEvent,i=e.projection,n=this.contextMenu.t.content.firstElementChild.cloneNode(!0),a=n.querySelector("map-featurecaption"),r=n.querySelector("h2"),s=n.querySelector("div"),l=n.querySelector("map-geometry"),m=n.querySelector("map-coordinates");n.setAttribute("zoom",e.zoom),l.setAttribute("cs","gcrs"),a.textContent=`Copied ${i} gcrs location`,r.textContent=`Copied ${i} gcrs location`,s.textContent=o.latlng.lng.toFixed(6)+" "+o.latlng.lat.toFixed(6),m.textContent=o.latlng.lng.toFixed(6)+" "+o.latlng.lat.toFixed(6),this.contextMenu._copyData(n.outerHTML)},_copyTCRS:function(t){let e=this.options.mapEl,o=this.contextMenu._clickEvent,i=e._map.project(o.latlng),n=i.x.toFixed(),a=i.y.toFixed(),r=e.projection,s=this.contextMenu.t.content.firstElementChild.cloneNode(!0),l=s.querySelector("map-featurecaption"),m=s.querySelector("h2"),p=s.querySelector("div"),u=s.querySelector("map-geometry"),c=s.querySelector("map-coordinates");s.setAttribute("zoom",e.zoom),u.setAttribute("cs","tcrs"),l.textContent=`Copied ${r} tcrs location`,m.textContent=`Copied ${r} tcrs location`,p.textContent=n+" "+a,c.textContent=n+" "+a,this.contextMenu._copyData(s.outerHTML)},_copyTileMatrix:function(t){let e=this.options.mapEl,o=this.contextMenu._clickEvent,i=e._map.project(o.latlng),n=e._map.options.crs.options.crs.tile.bounds.max.x,a=e.projection,r=this.contextMenu.t.content.firstElementChild.cloneNode(!0),s=r.querySelector("map-featurecaption"),l=r.querySelector("h2"),m=r.querySelector("div"),p=r.querySelector("map-geometry"),u=r.querySelector("map-coordinates");r.setAttribute("zoom",e.zoom),p.setAttribute("cs","gcrs"),s.textContent=`Copied ${a} tilematrix location (not implemented yet)`,l.textContent=`Copied ${a} tilematrix location (not implemented yet)`,m.textContent=Math.trunc(i.x/n)+" "+Math.trunc(i.y/n),u.textContent=o.latlng.lng.toFixed(6)+" "+o.latlng.lat.toFixed(6),this.contextMenu._copyData(r.outerHTML)},_copyPCRS:function(t){let e=this.options.mapEl,o=this.contextMenu._clickEvent,i=e._map.project(o.latlng),n=e._map.options.crs.scale(+e.zoom),a=e._map.options.crs.transformation.untransform(i,n).round(),r=e.projection,s=this.contextMenu.t.content.firstElementChild.cloneNode(!0),l=s.querySelector("map-featurecaption"),m=s.querySelector("h2"),p=s.querySelector("div"),u=s.querySelector("map-geometry"),c=s.querySelector("map-coordinates");s.setAttribute("zoom",e.zoom),u.setAttribute("cs","pcrs"),l.textContent=`Copied ${r} pcrs location`,m.textContent=`Copied ${r} pcrs location`,p.textContent=a.x+" "+a.y,c.textContent=a.x+" "+a.y,this.contextMenu._copyData(s.outerHTML)},_copyTile:function(t){let e=this.options.mapEl,o=this.contextMenu._clickEvent,i=e._map.project(o.latlng),n=e._map.options.crs.options.crs.tile.bounds.max.x,a=i.x%n,r=i.y%n,s=L.point(a,r).trunc(),l=e.projection,m=this.contextMenu.t.content.firstElementChild.cloneNode(!0),p=m.querySelector("map-featurecaption"),u=m.querySelector("h2"),c=m.querySelector("div"),h=m.querySelector("map-geometry"),d=m.querySelector("map-coordinates");s.x<0&&(s.x+=n),s.y<0&&(s.y+=n),m.setAttribute("zoom",e.zoom),h.setAttribute("cs","gcrs"),p.textContent=`Copied ${l} tile location (not implemented yet)`,u.textContent=`Copied ${l} tile location (not implemented yet)`,c.textContent=s.x+" "+s.y,d.textContent=o.latlng.lng.toFixed(6)+" "+o.latlng.lat.toFixed(6),this.contextMenu._copyData(m.outerHTML)},_copyMap:function(t){let e=this.options.mapEl,o=this.contextMenu._clickEvent,i=o.containerPoint.trunc(),n=e.projection,a=this.contextMenu.t.content.firstElementChild.cloneNode(!0),r=a.querySelector("map-featurecaption"),s=a.querySelector("h2"),l=a.querySelector("div"),m=a.querySelector("map-geometry"),p=a.querySelector("map-coordinates");a.setAttribute("zoom",e.zoom),m.setAttribute("cs","gcrs"),r.textContent=`Copied ${n} map location (not implemented yet)`,s.textContent=`Copied ${n} map location (not implemented yet)`,l.textContent=i.x+" "+i.y,p.textContent=o.latlng.lng.toFixed(6)+" "+o.latlng.lat.toFixed(6),this.contextMenu._copyData(a.outerHTML)},_copyAllCoords:function(t){let e=this.options.mapEl,o=this.contextMenu._clickEvent,i=e._map.project(o.latlng),n=e._map.options.crs.options.crs.tile.bounds.max.x,a=i.x%n,r=i.y%n,s=e._map.options.crs.scale(+e.zoom),l=e._map.options.crs.transformation.untransform(i,s);var m=`z:${e.zoom}
`;m+=`tile: i:${Math.trunc(a)}, j:${Math.trunc(r)}
`,m+=`tilematrix: column:${Math.trunc(i.x/n)}, row:${Math.trunc(i.y/n)}
`,m+=`map: i:${Math.trunc(o.containerPoint.x)}, j:${Math.trunc(o.containerPoint.y)}
`,m+=`tcrs: x:${Math.trunc(i.x)}, y:${Math.trunc(i.y)}
`,m+=`pcrs: easting:${l.x.toFixed(2)}, northing:${l.y.toFixed(2)}
`,m+=`gcrs: lon :${o.latlng.lng.toFixed(6)}, lat:`+o.latlng.lat.toFixed(6),this.contextMenu._copyData(m)},_createItem:function(t,e,o){if(e.spacer)return this._createSeparator(t,o);t=this._insertElementAt("button","mapml-contextmenu-item",t,o),o=this._createEventHandler(t,e.callback,e.context,e.hideOnSelect);return t.innerHTML=""+e.text,t.setAttribute("type","button"),t.classList.add("mapml-button"),e.popup&&(t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","mapml-copy-submenu")),L.DomEvent.on(t,"mouseover",this._onItemMouseOver,this).on(t,"mouseout",this._onItemMouseOut,this).on(t,"mousedown",L.DomEvent.stopPropagation).on(t,"click",o),L.Browser.touch&&L.DomEvent.on(t,this._touchstart,L.DomEvent.stopPropagation),L.Browser.pointer||L.DomEvent.on(t,"click",this._onItemMouseOut,this),{id:L.Util.stamp(t),el:t,callback:o}},_createSeparator:function(t,e){e=this._insertElementAt("div","mapml-contextmenu-separator",t,e);return{id:L.Util.stamp(e),el:e}},_createEventHandler:function(s,l,m,p){let u=this;return p=void 0===p||p,function(t){let e=u._map,o=u._showLocation.containerPoint,i=e.containerPointToLayerPoint(o),n=e.layerPointToLatLng(i),a=u._showLocation.relatedTarget,r={containerPoint:o,layerPoint:i,latlng:n,relatedTarget:a};p&&u._hide(),l&&l.call(m||e,r),u._map.fire("contextmenu.select",{contextmenu:u,el:s})}},_insertElementAt:function(t,e,o,i){let n,a=document.createElement(t);return a.className=e,void 0!==i&&(n=o.children[i]),n?o.insertBefore(a,n):o.appendChild(a),a},_show:function(e){if(!e.originalEvent.target.closest(".mapml-vector-container")){this._mapMenuVisible&&this._hide();let t=(this._clickEvent=e).originalEvent.target;if(t.closest("fieldset")){if(t=t.closest("fieldset"),t=("mapml-layer-extent"===t.className?t.closest("fieldset").parentNode.parentNode.parentNode:t).querySelector("span"),!t.layer.validProjection)return;this._layerClicked=t,this._layerMenu.removeAttribute("hidden"),this._showAtPoint(e.containerPoint,e,this._layerMenu)}else if(t.classList.contains("leaflet-container")||t.classList.contains("mapml-debug-extent")||"path"===t.tagName){var o=this._map.options.mapEl.layers;this._layerClicked=Array.from(o).find(t=>t.checked);let t=e.containerPoint;L.Browser.gecko&&(t=(i=this._map.getContainer(),o=i.getBoundingClientRect().width,i=i.getBoundingClientRect().height,{x:Number.parseInt(o/2),y:Number.parseInt(i/2)})),this._container.removeAttribute("hidden"),this._showAtPoint(t,e,this._container),this._updateCS()}var i;0!==e.originalEvent.button&&-1!==e.originalEvent.button||(this._keyboardEvent=!0,this._layerClicked.className.includes("mapml-layer-item")?(e=document.activeElement,this._elementInFocus=e.shadowRoot.activeElement,this._layerMenuTabs=1,this._layerMenu.firstChild.focus()):this._container.querySelectorAll("button:not([disabled])")[0].focus())}},_showAtPoint:function(t,e,o){var i;this._items.length&&(i=L.extend(e||{},{contextmenu:this}),this._showLocation={containerPoint:t},e&&e.relatedTarget&&(this._showLocation.relatedTarget=e.relatedTarget),this._setPosition(t,o),this._mapMenuVisible||(o.removeAttribute("hidden"),this._mapMenuVisible=!0),this._map.fire("contextmenu.show",i))},_hide:function(){this._mapMenuVisible&&(this._mapMenuVisible=!1,this._container.setAttribute("hidden",""),this._copySubMenu.setAttribute("hidden",""),this._layerMenu.setAttribute("hidden",""),this._map.fire("contextmenu.hide",{contextmenu:this}),setTimeout(()=>this._map._container.focus(),0),this.activeIndex=0,this.isRunned=!1)},_setPosition:function(t,e){var o,i=this._map.getSize(),n=this._getElementSize(e);this._map.options.contextmenuAnchor&&(o=L.point(this._map.options.contextmenuAnchor),t=t.add(o)),(e._leaflet_pos=t).x+n.x>i.x?(e.style.left="auto",e.style.right=Math.min(Math.max(i.x-t.x,0),i.x-n.x-1)+"px"):(e.style.left=Math.max(t.x,0)+"px",e.style.right="auto"),t.y+n.y>i.y?(e.style.top="auto",e.style.bottom=Math.min(Math.max(i.y-t.y,0),i.y-n.y-1)+"px"):(e.style.top=Math.max(t.y,0)+"px",e.style.bottom="auto")},_getElementSize:function(t){let e=this._size;return e&&!this._sizeChanged||(e={},t.style.left="-999999px",t.style.right="auto",e.x=t.offsetWidth,e.y=t.offsetHeight,t.style.left="auto",this._sizeChanged=!1),e},_focusOnLayerControl:function(){this._mapMenuVisible=!1,delete this._layerMenuTabs,this._layerMenu.setAttribute("hidden",""),(this._elementInFocus||this._layerClicked.parentElement.firstChild).focus(),delete this._elementInFocus},_setActiveItem:function(o){if(null===document.activeElement.shadowRoot&&!0===this.noActiveEl&&(this.noActiveEl=!1,this._items[9].el.el.focus()),document.activeElement.shadowRoot.activeElement.innerHTML===this._items[o].el.el.innerHTML){let t=o+1;for(;this._items[t].el.el.disabled;)t++,t>=this._items.length&&(t=0);this._setActiveItem(t)}else if(this.excludedIndices.includes(o)){let t=o+1,e=o-1;for(;this.excludedIndices.includes(t)||this._items[t].el.el.disabled;)t++,t>=this._items.length&&(t=0);for(;this.excludedIndices.includes(e)||this._items[e].el.el.disabled;)e--,e<0&&(e=this._items.length-1);this.activeIndex<o?this._setActiveItem(t):this._setActiveItem(e)}else this._items[o].el.el.focus(),this.activeIndex=o},_onKeyDown:function(t){if(this._mapMenuVisible&&"Shift"!==t.key){if("Enter"!==t.code&&"Tab"!==t.code&&!t.code.startsWith("Arrow")||t.preventDefault(),"ArrowUp"===t.code||t.shiftKey&&"Tab"===t.code)if(this._copySubMenu.hasAttribute("hidden")||null!==document.activeElement.shadowRoot&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML)if(this._copySubMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML)if(this._copySubMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML)if(this._layerMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML)if(this._layerMenu.hasAttribute("hidden"))if(0<this.activeIndex){let t=this.activeIndex-1;for(;this._items[t].el.el.disabled;)t--,t<0&&(t=this._items.length-1);this._setActiveItem(t)}else this._setActiveItem(this._items.length-1);else this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();else this._layerMenu.children[this._menuItems.LYRCOPY].focus();else this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();else this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();else this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();else if("ArrowDown"===t.code||"Tab"===t.code)if(this._copySubMenu.hasAttribute("hidden")||null!==document.activeElement.shadowRoot&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML)if(this._copySubMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML)if(this._copySubMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML)if(this._layerMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML)if(this._layerMenu.hasAttribute("hidden"))if(this.activeIndex<this._items.length-1)if(this.isRunned||0!==this.activeIndex||this._items[this.activeIndex].el.el.disabled){let t=this.activeIndex+1;for(;this._items[t].el.el.disabled;)t++,t>=this._items.length&&(t=0);this._setActiveItem(t)}else this._setActiveItem(0),this.isRunned=!0;else{let t=0;for(;this._items[t].el.el.disabled;)t++,t>=this._items.length&&(t=0);this._setActiveItem(t)}else this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();else this._layerMenu.children[this._menuItems.LYRCOPY].focus();else this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();else this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();else this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();else if("ArrowRight"===t.code)null!==document.activeElement.shadowRoot&&document.activeElement.shadowRoot.activeElement.innerHTML===this._items[this._menuItems.CTXCOPY].el.el.innerHTML&&this._copySubMenu.hasAttribute("hidden")?(this._showCopySubMenu(),this._copySubMenu.children[0].focus()):document.activeElement.shadowRoot.activeElement.innerHTML!==this._items[this._menuItems.CTXCOPY].el.el.innerHTML||this._copySubMenu.hasAttribute("hidden")||this._copySubMenu.children[0].focus();else if("ArrowLeft"===t.code)this._copySubMenu.hasAttribute("hidden")||null===document.activeElement.shadowRoot||document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML||(this._copySubMenu.setAttribute("hidden",""),this._setActiveItem(this._menuItems.CTXCOPY));else if("Escape"===t.code){if(this._layerMenuTabs)return L.DomEvent.stop(t),void this._focusOnLayerControl();null===document.activeElement.shadowRoot||this._copySubMenu.hasAttribute("hidden")?this._hide():document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML||(this._copySubMenu.setAttribute("hidden",""),this._setActiveItem(this._menuItems.CTXCOPY))}else"KeyC"!==t.code&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._items[this._menuItems.CTXCOPY].el.el.innerHTML&&this._hide();switch(t.code){case"Enter":document.activeElement.shadowRoot.activeElement.innerHTML===this._items[this._menuItems.CTXCOPY].el.el.innerHTML?(this._copyCoords({latlng:this._map.getCenter()}),this._copySubMenu.firstChild.focus()):this._map._container.parentNode.activeElement.parentNode.classList.contains("mapml-contextmenu")&&this._map._container.parentNode.activeElement.click();break;case"Space":this._map._container.parentNode.activeElement.parentNode.classList.contains("mapml-contextmenu")&&this._map._container.parentNode.activeElement.click();break;case"KeyC":this._copyCoords({latlng:this._map.getCenter()}),this._copySubMenu.firstChild.focus();break;case"KeyD":this._toggleDebug(t);break;case"KeyM":this._copyMapML(t);break;case"KeyL":this._layerClicked.className.includes("mapml-layer-item")&&this._copyLayer(t);break;case"KeyF":this._toggleFullScreen(t);break;case"KeyP":this._paste(t);break;case"KeyT":this._toggleControls(t);break;case"KeyV":this._viewSource(t);break;case"KeyZ":this._layerClicked.className.includes("mapml-layer-item")&&this._zoomToLayer(t)}}},_showCopySubMenu:function(t){let e=this._map.getSize(),o=this._clickEvent,i=this._copySubMenu,n=this._items[5].el.el;n.setAttribute("aria-expanded","true"),i.removeAttribute("hidden");var a=this._container.offsetWidth,r=(this._container.offsetHeight,i.offsetWidth);o.containerPoint.x+a+r>e.x?(i.style.left="auto",i.style.right=a+"px"):(i.style.left=a+"px",i.style.right="auto"),i.style.top="78px",i.style.bottom="auto"},_hideCopySubMenu:function(t){if(t.relatedTarget&&t.relatedTarget.parentElement&&!t.relatedTarget.parentElement.classList.contains("mapml-submenu")&&!t.relatedTarget.classList.contains("mapml-submenu")){let t=this._copySubMenu,e=this._items[4].el.el;e.setAttribute("aria-expanded","false"),t.setAttribute("hidden",""),this.noActiveEl=!0}},_onItemMouseOver:function(t){L.DomUtil.addClass(t.target||t.srcElement,"over"),t.srcElement.innerText===M.options.locale.cmCopyCoords+" (C)"&&this._showCopySubMenu(t)},_onItemMouseOut:function(t){L.DomUtil.removeClass(t.target||t.srcElement,"over"),this._hideCopySubMenu(t)},toggleContextMenuItem:function(t,e){t=t.toUpperCase(),"disabled"===e?"CONTROLS"===t?this._items[8].el.el.disabled=!0:"BACK"===t?this._items[0].el.el.disabled=!0:"FORWARD"===t?this._items[1].el.el.disabled=!0:"RELOAD"===t&&(this._items[2].el.el.disabled=!0):"enabled"===e&&("CONTROLS"===t?this._items[8].el.el.disabled=!1:"BACK"===t?this._items[0].el.el.disabled=!1:"FORWARD"===t?this._items[1].el.el.disabled=!1:"RELOAD"===t&&(this._items[2].el.el.disabled=!1))},setViewFullScreenInnerHTML:function(t){"view"===t?this._map.contextMenu._items[3].el.el.innerHTML=M.options.locale.btnFullScreen+" (<kbd>F</kbd>)":"exit"===t&&(this._map.contextMenu._items[3].el.el.innerHTML=M.options.locale.btnExitFullScreen+" (<kbd>F</kbd>)")}}),B=function(e,o,t){if(!e||!o)return{};let i=[],n=[],a=[],r=[],s=o.options.crs.tile.bounds.max.y;for(let t=0;t<o.options.resolutions.length;t++){var l=o.scale(t),m=o.transformation.transform(e.min,l),l=o.transformation.transform(e.max,l);i.push({horizontal:m.x,vertical:l.y}),n.push({horizontal:l.x,vertical:m.y}),a.push({horizontal:i[t].horizontal/s,vertical:i[t].vertical/s}),r.push({horizontal:n[t].horizontal/s,vertical:n[t].vertical/s})}var p=o.unproject(e.min),u=o.unproject(e.max),u={topLeft:{horizontal:p.lng,vertical:u.lat},bottomRight:{horizontal:u.lng,vertical:p.lat}},p={topLeft:{horizontal:e.min.x,vertical:e.max.y},bottomRight:{horizontal:e.max.x,vertical:e.min.y}};let c={topLeft:{tcrs:i,tilematrix:a,gcrs:u.topLeft,pcrs:p.topLeft},bottomRight:{tcrs:n,tilematrix:r,gcrs:u.bottomRight,pcrs:p.bottomRight}};return t&&(c.projection=t),c},O=function(p){if(p){let e=p.values,t=p.projection||k,o=0,i=d,n=this[t].options.crs.tilematrix.bounds(0),a=this[t].options.resolutions.length-1,r=0,s=a,l=!1,m=0;for(let t=0;t<e.length;t++)switch(e[t].getAttribute("type")){case"zoom":r=+(e[t].hasAttribute("min")&&!isNaN(+e[t].getAttribute("min"))?e[t].getAttribute("min"):0),s=+(e[t].hasAttribute("max")&&!isNaN(+e[t].getAttribute("max"))?e[t].getAttribute("max"):a),o=+e[t].getAttribute("value");break;case"location":if(!e[t].getAttribute("max")||!e[t].getAttribute("min"))continue;var u=+e[t].getAttribute("max"),c=+e[t].getAttribute("min");switch(e[t].getAttribute("axis").toLowerCase()){case"x":case"longitude":case"column":case"easting":i=M.axisToCS(e[t].getAttribute("axis").toLowerCase()),n.min.x=c,n.max.x=u,m++;break;case"y":case"latitude":case"row":case"northing":i=M.axisToCS(e[t].getAttribute("axis").toLowerCase()),n.min.y=c,n.max.y=u,m++}}2<=m&&(l=!0);var h={minZoom:p.zoomBounds?.min&&!isNaN(+p.zoomBounds.min)?+p.zoomBounds.min:0,maxZoom:p.zoomBounds?.max&&!isNaN(+p.zoomBounds.max)?+p.zoomBounds.max:a,minNativeZoom:r,maxNativeZoom:s};return n=!l&&p.extentPCRSFallback&&p.extentPCRSFallback.bounds?p.extentPCRSFallback.bounds:l?this.boundsToPCRSBounds(n,o,t,i):this[t].options.crs.pcrs.bounds,{zoomBounds:h,bounds:n}}},F=function(t){try{switch(t.toLowerCase()){case"row":case"column":return"TILEMATRIX";case"i":case"j":return["MAP","TILE"];case"x":case"y":return"TCRS";case"latitude":case"longitude":return"GCRS";case"northing":case"easting":return"PCRS";default:return d}}catch(t){return}},R=function(t){try{switch(t.toLowerCase()){case"tilematrix":return["column","row"];case"map":case"tile":return["i","j"];case"tcrs":return["x","y"];case"gcrs":return["longitude","latitude"];case"pcrs":return["easting","northing"]}}catch(t){return}},q=function(t){try{switch(t.toLowerCase()){case"i":case"column":case"longitude":case"x":case"easting":return"x";case"row":case"j":case"latitude":case"y":case"northing":return"y";default:return}}catch(t){return}},D=function(t,e,o,i){if(t&&(e||0===e)&&Number.isFinite(+e)&&o&&i)switch(o="string"==typeof o?M[o]:o,i.toUpperCase()){case"PCRS":return t;case"TCRS":case"TILEMATRIX":var n=o.transformation.transform(t.min,o.scale(+e)),a=o.transformation.transform(t.max,o.scale(+e));if("TCRS"===i.toUpperCase())return L.bounds(n,a);var r=o.options.crs.tile.bounds.max.x;return L.bounds(L.point(n.x/r,n.y/r),L.point(a.x/r,a.y/r));case"GCRS":a=o.unproject(t.min),r=o.unproject(t.max);return L.bounds(L.point(a.lng,a.lat),L.point(r.lng,r.lat));default:return}},U=function(t,e,o,i){if(t&&(e||0===e)&&Number.isFinite(+e)&&i&&o){var n=(o="string"==typeof o?M[o]:o).options.crs.tile.bounds.max.x;switch(i.toUpperCase()){case"TILEMATRIX":return M.pixelToPCRSPoint(L.point(t.x*n,t.y*n),e,o);case"PCRS":return t;case"TCRS":return M.pixelToPCRSPoint(t,e,o);case"GCRS":return o.project(L.latLng(t.y,t.x));default:return}}},Z=function(t,e,o){if(t&&(e||0===e)&&Number.isFinite(+e)&&o)return(o="string"==typeof o?M[o]:o).transformation.untransform(t,o.scale(e))},j=function(t,e,o,i){if(t&&t.max&&t.min&&(e||0===e)&&Number.isFinite(+e)&&o&&i)return o="string"==typeof o?M[o]:o,L.bounds(M.pointToPCRSPoint(t.min,e,o,i),M.pointToPCRSPoint(t.max,e,o,i))},H=function(t,e,o){if(t&&t.max&&t.min&&(e||0===e)&&Number.isFinite(+e)&&o)return o="string"==typeof o?M[o]:o,L.bounds(M.pixelToPCRSPoint(t.min,e,o),M.pixelToPCRSPoint(t.max,e,o))},G=function(t){if(!t||t instanceof Object)return{};let e=t.split(/\s+/).join(""),o={},i=e.split(",");for(let t=0;t<i.length;t++){var n=i[t].split("=");2===n.length&&(o[n[0]]=n[1])}return""!==o&&1===i[0].split("=").length&&(o.content=i[0]),o},V=function(t){for(var e=1,o=[],i=t.split(",");e<i.length;e+=2)o.push([parseInt(i[e-1]),parseInt(i[e])]);return o},$=function(t,e,o){if(o instanceof Element&&t&&t.querySelector("map-link[rel=stylesheet],map-style")){if(e instanceof Element)e=e.getAttribute("href")?e.getAttribute("href"):document.URL;else if(!e||""===e||e instanceof Object)return;for(var i,n,a=[],r=t.querySelectorAll("map-link[rel=stylesheet],map-style"),s=0;s<r.length;s++)"MAP-LINK"===r[s].nodeName.toUpperCase()?(i=r[s].hasAttribute("href")?new URL(r[s].getAttribute("href"),e).href:null)&&(o.querySelector("link[href='"+i+"']")||((n=document.createElement("link")).setAttribute("href",i),n.setAttribute("rel","stylesheet"),a.push(n))):((n=document.createElement("style")).textContent=r[s].textContent,a.push(n));for(var l=a.length-1;0<=l;l--)o.insertAdjacentElement("afterbegin",a[l])}},Y=function(t,e,o){var i=[];t.split(/\s+/gim).forEach(M._parseNumber,i),this.push(i)},W=function(t,e,o){this.push(parseFloat(t))},K=function(o,t){let i,n=!1,e,a=t._map,r;if("text/html"===o.type&&"_blank"!==o.target)o.target="_top";else if("text/html"!==o.type&&o.url.includes("#")){let t=o.url.split("#"),e=t[1].split(",");i={z:e[0]||0,lng:e[1]||0,lat:e[2]||0},n=!t[0],["/",".","#"].includes(o.url[0])&&(o.target="_self")}if(n)i&&!o.inPlace&&n&&(t._map.options.mapEl.zoomTo(+i.lat,+i.lng,+i.z),r&&(e.opacity=r),a.getContainer().focus());else switch(e=document.createElement("layer-"),e.setAttribute("src",o.url),e.setAttribute("checked",""),o.target){case"_blank":"text/html"===o.type?window.open(o.url):(l(),a.options.mapEl.appendChild(e));break;case"_parent":l();for(var s of a.options.mapEl.querySelectorAll("layer-"))s._layer!==t&&a.options.mapEl.removeChild(s);a.options.mapEl.appendChild(e),a.options.mapEl.removeChild(t._layerEl);break;case"_top":window.location.href=o.url;break;default:l(),r=t._layerEl.opacity,t._layerEl.insertAdjacentElement("beforebegin",e),a.options.mapEl.removeChild(t._layerEl)}function l(){var t;!o.inPlace&&i&&(t=i,a.options.mapEl.lat=+t.lat,a.options.mapEl.lon=+t.lng,a.options.mapEl.zoom=+t.z),e.whenReady().then(()=>{e.extent||e._layer._setLayerElExtent(),!o.inPlace&&i?e.parentElement.zoomTo(+i.lat,+i.lng,+i.z):o.inPlace||e.zoomTo(),r&&(e.opacity=r),a.getContainer().focus()})}},X=function(t){if(!t)return null;let o=d,i=t.querySelector("map-meta[name=projection]")&&M._metaContentToObject(t.querySelector("map-meta[name=projection]").getAttribute("content")).content.toUpperCase()||k;try{var n=t.querySelector("map-meta[name=extent]")&&M._metaContentToObject(t.querySelector("map-meta[name=extent]").getAttribute("content")),a=n.zoom||0;let e=Object.keys(n);for(let t=0;t<e.length;t++)if(!e[t].includes("zoom")){o=M.axisToCS(e[t].split("-")[2]);break}var r=M.csToAxes(o);return M.boundsToPCRSBounds(L.bounds(L.point(+n["top-left-"+r[0]],+n["top-left-"+r[1]]),L.point(+n["bottom-right-"+r[0]],+n["bottom-right-"+r[1]])),a,i,o)}catch(t){return M.boundsToPCRSBounds(M[i].options.crs.tilematrix.bounds(0),0,i,o)}},Q=function(t,o){if(!t)return null;let i=100,n=0,a=t.querySelectorAll("map-feature"),e,r;for(let e=0;e<a.length;e++){let t=+a[e].getAttribute("zoom");a[e].getAttribute("zoom")||(t=o),n=Math.max(n,t),i=Math.min(i,t)}try{r=M._metaContentToObject(t.querySelector("map-meta[name=projection]").getAttribute("content")).content,e=M._metaContentToObject(t.querySelector("map-meta[name=zoom]").getAttribute("content"))}catch(t){return{minZoom:0,maxZoom:M[r||k].options.resolutions.length-1,minNativeZoom:i,maxNativeZoom:n}}return{minZoom:+e.min,maxZoom:+e.max,minNativeZoom:i,maxNativeZoom:n}},J=function(e){let o,i;if(e.length&&e[0].parentElement.parentElement&&"mapml-"===e[0].parentElement.parentElement.tagName){let t=e[0].parentElement.parentElement;o=t.querySelector&&t.querySelector("map-meta[name=zoom]")&&+M._metaContentToObject(t.querySelector("map-meta[name=zoom]").getAttribute("content")).value||0,i=t.querySelector&&t.querySelector("map-meta[name=cs]")&&M._metaContentToObject(t.querySelector("map-meta[name=cs]").getAttribute("content")).content||"GCRS"}else o=e.querySelector&&e.querySelector("map-meta[name=zoom]")&&+M._metaContentToObject(e.querySelector("map-meta[name=zoom]").getAttribute("content")).value||0,i=e.querySelector&&e.querySelector("map-meta[name=cs]")&&M._metaContentToObject(e.querySelector("map-meta[name=cs]").getAttribute("content")).content||"GCRS";return{zoom:o,cs:i}},tt=function(t){var e=t._map.project(t._map.getCenter()),t=t._map.options.crs.options.crs.tile.bounds.max.y;return[Math.trunc(e.x/t),Math.trunc(e.y/t)]},et=function(e,o){try{new URL(o);let t='<layer- src="'+o+'" label="'+M.options.locale.dfLayer+'" checked=""></layer->';e.insertAdjacentHTML("beforeend",t),e.lastElementChild.whenReady().catch(()=>{e&&e.removeChild(e.lastChild),t=null})}catch(t){if("<layer-"===(o=o.replace(/(<!--.*?-->)|(<!--[\S\s]+?-->)|(<!--[\S\s]*?$)/g,"").trim()).slice(0,7)&&"</layer->"===o.slice(-9))e.insertAdjacentHTML("beforeend",o);else if("<map-feature"===o.slice(0,12)&&"</map-feature>"===o.slice(-14)){var i=`<layer- label="${M.options.locale.dfPastedLayer}" checked>
                       <map-meta name='projection' content='${e.projection}'></map-meta>`+o+"</layer->";e.insertAdjacentHTML("beforeend",i)}else try{e.geojson2mapml(JSON.parse(o))}catch{console.log("Invalid Input!")}}},ot=function(i){let t=document.createElement("table"),e=t.createTHead(),o=e.insertRow(),n=document.createElement("th"),a=document.createElement("th");n.appendChild(document.createTextNode("Property name")),a.appendChild(document.createTextNode("Property value")),n.setAttribute("role","columnheader"),a.setAttribute("role","columnheader"),n.setAttribute("scope","col"),a.setAttribute("scope","col"),o.appendChild(n),o.appendChild(a);let r=t.createTBody();for(var s in i)if(i.hasOwnProperty(s)){let t=r.insertRow(),e=document.createElement("th"),o=document.createElement("td");e.appendChild(document.createTextNode(s)),o.appendChild(document.createTextNode(i[s])),e.setAttribute("scope","row"),o.setAttribute("itemprop",s),t.appendChild(e),t.appendChild(o)}return t},it=function(t,e,o){return t==={}||(t[0]=Math.min(e,t[0]),t[1]=Math.min(o,t[1]),t[2]=Math.max(e,t[2]),t[3]=Math.max(o,t[3])),t},nt=function(m,p={},u=null,c={}){p=Object.assign({},{label:null,projection:"OSMTILE",caption:null,properties:null,geometryFunction:null},p);var h=(m="string"==typeof m?JSON.parse(m):m).type.toUpperCase();let d="",t=!1,e=new DOMParser;null===u&&(m.bbox||(t=!0),a="<layer- label='' checked><map-meta name='projection' content='"+p.projection+"'></map-meta><map-meta name='cs' content='gcrs'></map-meta></layer->",u=e.parseFromString(a,"text/html"),null!==p.label?u.querySelector("layer-").setAttribute("label",p.label):m.name?u.querySelector("layer-").setAttribute("label",m.name):m.title?u.querySelector("layer-").setAttribute("label",m.title):u.querySelector("layer-").setAttribute("label",M.options.locale.dfLayer));let _="<map-point></map-point>";_=e.parseFromString("<map-point></map-point>","text/html");let y="<map-multipoint><map-coordinates></map-coordinates></map-multipoint>";y=e.parseFromString("<map-multipoint><map-coordinates></map-coordinates></map-multipoint>","text/html");let f="<map-linestring><map-coordinates></map-coordinates></map-linestring>";f=e.parseFromString("<map-linestring><map-coordinates></map-coordinates></map-linestring>","text/html");let g="<map-multilinestring></map-multilinestring>";g=e.parseFromString("<map-multilinestring></map-multilinestring>","text/html");let b="<map-polygon></map-polygon>";b=e.parseFromString("<map-polygon></map-polygon>","text/html");let x="<map-multipolygon></map-multipolygon>";x=e.parseFromString("<map-multipolygon></map-multipolygon>","text/html");let L="<map-geometrycollection></map-geometrycollection>";L=e.parseFromString("<map-geometrycollection></map-geometrycollection>","text/html");let n="<map-feature><map-featurecaption></map-featurecaption><map-geometry></map-geometry><map-properties></map-properties></map-feature>";n=e.parseFromString("<map-feature><map-featurecaption></map-featurecaption><map-geometry></map-geometry><map-properties></map-properties></map-feature>","text/html");let v="<map-coordinates></map-coordinates>";if(v=e.parseFromString("<map-coordinates></map-coordinates>","text/html"),"FEATURECOLLECTION"===h){m.bbox?u.querySelector("layer-").insertAdjacentHTML("afterbegin","<map-meta name='extent' content='top-left-longitude="+m.bbox[0]+", top-left-latitude="+m.bbox[1]+", bottom-right-longitude="+m.bbox[2]+",bottom-right-latitude="+m.bbox[3]+"'></map-meta>"):c=[1/0,1/0,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];var o=m.features;for(let t=0;t<o.length;t++)M.geojson2mapml(o[t],p,u,c)}else if("FEATURE"===h){let t=n.cloneNode(!0),e=t.querySelector("map-feature");m.bbox?u.querySelector("layer-").insertAdjacentHTML("afterbegin","<map-meta name='extent' content='top-left-longitude="+m.bbox[0]+", top-left-latitude="+m.bbox[1]+", bottom-right-longitude="+m.bbox[2]+",bottom-right-latitude="+m.bbox[3]+"'></map-meta>"):"object"==typeof c&&void 0===c.length&&(c=[1/0,1/0,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]);let o=u.querySelector("layer-").getAttribute("label");"function"==typeof p.caption?o=p.caption(m):"string"==typeof p.caption?(o=m.properties[p.caption],void 0===o&&(o=p.caption)):m.id&&(o=m.id),e.querySelector("map-featurecaption").innerHTML=o;let i;"function"==typeof p.properties?(i=p.properties(m),i instanceof Element||(i=!1,console.error("options.properties function returns a string instead of an HTMLElement."))):i="string"==typeof p.properties?(e.querySelector("map-properties").insertAdjacentHTML("beforeend",p.properties),!1):p.properties instanceof HTMLElement?p.properties:M._properties2Table(m.properties),i&&e.querySelector("map-properties").appendChild(i);var a=M.geojson2mapml(m.geometry,p,u,c);"function"==typeof p.geometryFunction?e.querySelector("map-geometry").appendChild(p.geometryFunction(a,m)):e.querySelector("map-geometry").appendChild(a),u.querySelector("layer-").appendChild(e)}else if(["POINT","LINESTRING","POLYGON","MULTIPOINT","MULTILINESTRING","MULTIPOLYGON","GEOMETRYCOLLECTION"].includes(h))switch(h){case"POINT":c=M._updateExtent(c,m.coordinates[0],m.coordinates[1]),d=m.coordinates[0]+" "+m.coordinates[1];let t=_.cloneNode(!0);t=t.querySelector("map-point");let e=v.cloneNode(!0);return e=e.querySelector("map-coordinates"),e.innerHTML=d,t.appendChild(e),t;case"LINESTRING":let o=f.cloneNode(!0),i=o.querySelector("map-coordinates");d="";for(let t=0;t<m.coordinates.length;t++)c=M._updateExtent(c,m.coordinates[t][0],m.coordinates[t][1]),d=d+m.coordinates[t][0]+" "+m.coordinates[t][1]+" ";return i.innerHTML=d,o.querySelector("map-linestring");case"POLYGON":let n=b.cloneNode(!0);n=n.querySelector("map-polygon");for(let o=0;o<m.coordinates.length;o++){let e="",t=v.cloneNode(!0);t=t.querySelector("map-coordinates");for(let t=0;t<m.coordinates[o].length;t++)c=M._updateExtent(c,m.coordinates[o][t][0],m.coordinates[o][t][1]),e=e+m.coordinates[o][t][0]+" "+m.coordinates[o][t][1]+" ";t.innerHTML=e,n.appendChild(t)}return n;case"MULTIPOINT":d="";let a=y.cloneNode(!0);a=a.querySelector("map-multipoint");for(let t=0;t<m.coordinates.length;t++)c=M._updateExtent(c,m.coordinates[t][0],m.coordinates[t][1]),d=d+m.coordinates[t][0]+" "+m.coordinates[t][1]+" ";return a.querySelector("map-coordinates").innerHTML=d,a;case"MULTILINESTRING":let r=g.cloneNode(!0);r=r.querySelector("map-multilinestring");for(let o=0;o<m.coordinates.length;o++){let e="",t=v.cloneNode(!0);t=t.querySelector("map-coordinates");for(let t=0;t<m.coordinates[o].length;t++)c=M._updateExtent(c,m.coordinates[o][t][0],m.coordinates[o][t][1]),e=e+m.coordinates[o][t][0]+" "+m.coordinates[o][t][1]+" ";t.innerHTML=e,r.appendChild(t)}return r;case"MULTIPOLYGON":let s=x.cloneNode(!0);s=s.querySelector("map-multiPolygon");for(let n=0;n<m.coordinates.length;n++){let i=b.cloneNode(!0);i=i.querySelector("map-polygon");for(let o=0;o<m.coordinates[n].length;o++){let e="",t=v.cloneNode(!0);t=t.querySelector("map-coordinates");for(let t=0;t<m.coordinates[n][o].length;t++)c=M._updateExtent(c,m.coordinates[n][o][t][0],m.coordinates[n][o][t][1]),e=e+m.coordinates[n][o][t][0]+" "+m.coordinates[n][o][t][1]+" ";t.innerHTML=e,i.appendChild(t)}s.appendChild(i)}return s;case"GEOMETRYCOLLECTION":let l=L.cloneNode(!0);l=l.querySelector("map-geometrycollection");for(let t=0;t<m.geometries.length;t++){var E=M.geojson2mapml(m.geometries[t],p,u,c);l.appendChild(E)}return l}return t&&u.querySelector("layer-").insertAdjacentHTML("afterbegin","<map-meta name='extent' content='top-left-longitude="+c[0]+", top-left-latitude="+c[1]+", bottom-right-longitude="+c[2]+",bottom-right-latitude="+c[3]+"'></map-meta>"),u.querySelector("layer-")},at=function(e){let o=[];e=e.filter(t=>!/[^\d.-]/g.test(t)).filter(t=>t);for(let t=0;t<e.length;t+=2)o.push(e.slice(t,t+2).map(Number));return o},rt=function(t){null!==t.querySelector("thead")&&t.querySelector("thead").remove();let e={};return t.querySelectorAll("tr").forEach(t=>{t=t.querySelectorAll("th, td");e[t[0].innerHTML]=t[1].innerHTML}),e},st=function(t,n,a,r){for(;"MAP-SPAN"===t.nodeName.toUpperCase()||"MAP-A"===t.nodeName.toUpperCase();)t=t.firstElementChild;let s=t.nodeName,l={},m;switch(s.toUpperCase()){case"MAP-POINT":var p;l.type="Point",r?(p=proj4.transform(n,a,t.querySelector("map-coordinates").innerHTML.split(/[<>\ ]/g).map(Number)),l.coordinates=[p.x,p.y]):l.coordinates=t.querySelector("map-coordinates").innerHTML.split(/[<>\ ]/g).map(Number);break;case"MAP-LINESTRING":l.type="LineString",m=t.querySelector("map-coordinates").innerHTML.split(/[<>\ ]/g),m=M._breakArray(m),r&&(m=M._pcrsToGcrs(m,n,a)),l.coordinates=m;break;case"MAP-POLYGON":l.type="Polygon",l.coordinates=[];let e=0;t.querySelectorAll("map-coordinates").forEach(t=>{t=t.innerHTML.split(/[<>\ ]/g),t=M._breakArray(t),r&&(t=M._pcrsToGcrs(t,n,a)),l.coordinates[e]=t,e++});break;case"MAP-MULTIPOINT":l.type="MultiPoint",m=M._breakArray(t.querySelector("map-coordinates").innerHTML.split(/[<>\ ]/g)),r&&(m=M._pcrsToGcrs(m,n,a)),l.coordinates=m;break;case"MAP-MULTILINESTRING":l.type="MultiLineString",l.coordinates=[];let o=0;t.querySelectorAll("map-coordinates").forEach(t=>{t=t.innerHTML.split(/[<>\ ]/g),t=M._breakArray(t),r&&(t=M._pcrsToGcrs(t,n,a)),l.coordinates[o]=t,o++});break;case"MAP-MULTIPOLYGON":l.type="MultiPolygon",l.coordinates=[];let i=0;t.querySelectorAll("map-polygon").forEach(t=>{let e=0;l.coordinates.push([]),t.querySelectorAll("map-coordinates").forEach(t=>{t=t.innerHTML.split(/[<>\ ]/g),t=M._breakArray(t),r&&(t=M._pcrsToGcrs(t,n,a)),l.coordinates[i].push([]),l.coordinates[i][e]=t,e++}),i++})}return l},lt=function(e,o,i){let n=[];for(let t=0;t<e.length;t++){var a=[(a=proj4.transform(o,i,e[t])).x,a.y];n.push(a)}return n},mt=function(t,i={}){i=Object.assign({},{propertyFunction:null,transform:!0},i);let n={type:"FeatureCollection"};n.title=t.getAttribute("label"),n.features=[];let a=null,r=null;i.transform&&(a=new proj4.Proj(t.parentElement._map.options.crs.code),r=new proj4.Proj("EPSG:4326"),"EPSG:3857"!==t.parentElement._map.options.crs.code&&"EPSG:4326"!==t.parentElement._map.options.crs.code||(i.transform=!1));let e=t.querySelectorAll("map-meta");e.forEach(e=>{if("extent"===e.getAttribute("name")){let t=e.getAttribute("content"),o=t.split(","),i={};for(let e=0;e<o.length;e++){let t=o[e].split("=");t[0]=t[0].trim(),t[1]=parseFloat(t[1]),i[t[0]]=t[1]}n.bbox=[i["top-left-longitude"],i["top-left-latitude"],i["bottom-right-longitude"],i["bottom-right-latitude"]]}});let o=t.querySelectorAll("map-feature"),s=0;return o.forEach(t=>{var e;n.features[s]={type:"Feature"},n.features[s].geometry={},n.features[s].properties={},t.querySelector("map-properties")?"function"==typeof i.propertyFunction?(e=i.propertyFunction(t.querySelector("map-properties")),n.features[s].properties=e):null!==t.querySelector("map-properties").querySelector("table")?(e=t.querySelector("map-properties").querySelector("table").cloneNode(!0),e=M._table2properties(e),n.features[s].properties=e):n.features[s].properties={prop0:t.querySelector("map-properties").innerHTML.replace(/(<([^>]+)>)/gi,"")}:n.features[s].properties=null;let o=t.querySelector("map-geometry").firstElementChild;for(;"MAP-SPAN"===o.nodeName.toUpperCase()||"MAP-A"===o.nodeName.toUpperCase();)o=o.firstElementChild;"MAP-GEOMETRYCOLLECTION"!==o.nodeName.toUpperCase()?n.features[s].geometry=M._geometry2geojson(o,a,r,i.transform):(n.features[s].geometry.type="GeometryCollection",n.features[s].geometry.geometries=[],t=o.children,Array.from(t).forEach(t=>{var e=t.nodeName.toUpperCase();"MAP-SPAN"===e||"MAP-A"===e?([...(t=t.cloneNode(!0)).querySelectorAll("map-a, map-span")].forEach(t=>t.replaceWith(...t.children)),Array.from(t.children).forEach(t=>{t=M._geometry2geojson(t,a,r,i.transform),n.features[s].geometry.geometries.push(t)})):(t=M._geometry2geojson(t,a,r,i.transform),n.features[s].geometry.geometries.push(t))})),s++}),n},pt=function(a,r,s,l){if(a){let t=r.getZoom(),e=r.options.crs.scale(t),o=r.options.crs.transformation.transform(a.getCenter(!0),e);var m=r.getSize().divideBy(2),p=o.subtract(m).round(),u=o.add(m).round(),c=M.pixelToPCRSPoint(p,t,r.options.projection),h=M.pixelToPCRSPoint(u,t,r.options.projection);let i=L.bounds(c,h),n=i.contains(a)?1:-1;for(;-1==n&&!i.contains(a)&&t-1>=s||1==n&&i.contains(a)&&t+1<=l;)t+=n,e=r.options.crs.scale(t),o=r.options.crs.transformation.transform(a.getCenter(!0),e),p=o.subtract(m).round(),u=o.add(m).round(),c=M.pixelToPCRSPoint(p,t,r.options.projection),h=M.pixelToPCRSPoint(u,t,r.options.projection),i=L.bounds(c,h);return 1==n&&0<=t-1&&(t!==l||!i.contains(a))&&t--,t}},ut=L.Control.Attribution.extend({options:{prefix:'<img src="https://www.w3.org/community/src/templates/wordpress/StoryTeller/favicon.ico" style="position: relative; top: 5px" alt="W3C Community and Business Groups logo"> <a href="https://www.w3.org/community/maps4html/">Maps for HTML Community Group</a> | <img src="data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTIiIGhlaWdodD0iOCI+PHBhdGggZmlsbD0iIzRDN0JFMSIgZD0iTTAgMGgxMnY0SDB6Ii8+PHBhdGggZmlsbD0iI0ZGRDUwMCIgZD0iTTAgNGgxMnYzSDB6Ii8+PHBhdGggZmlsbD0iI0UwQkMwMCIgZD0iTTAgN2gxMnYxSDB6Ii8+PC9zdmc+" style="padding-right: 0.3em;" alt="Slava Ukraini"> <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> '},onAdd:function(t){for(var e in(t.attributionControl=this)._container=L.DomUtil.create("details","leaflet-control-attribution"),L.DomEvent.disableClickPropagation(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());this._update(),t.on("layeradd",this._addAttribution,this);let o=document.createElement("dialog");return o.setAttribute("class","shortcuts-dialog"),o.setAttribute("autofocus",""),o.onclick=function(t){t.stopPropagation()},o.innerHTML=`<b>${M.options.locale.kbdShortcuts} </b><button aria-label="Close" onclick='this.parentElement.close()'>X</button>`+`<ul><b>${M.options.locale.kbdMovement}</b><li><kbd>&#8593</kbd> ${M.options.locale.kbdPanUp}</li><li><kbd>&#8595</kbd> ${M.options.locale.kbdPanDown}</li><li><kbd>&#8592</kbd> ${M.options.locale.kbdPanLeft}</li><li><kbd>&#8594</kbd> ${M.options.locale.kbdPanRight}</li><li><kbd>+</kbd> ${M.options.locale.btnZoomIn}</li><li><kbd>-</kbd> ${M.options.locale.btnZoomOut}</li><li><kbd>shift</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 3x ${M.options.locale.kbdPanIncrement}</li><li><kbd>ctrl</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 0.2x ${M.options.locale.kbdPanIncrement}</li><li><kbd>shift</kbd> + <kbd>+/-</kbd> ${M.options.locale.kbdZoom}</li></ul>`+`<ul><b>${M.options.locale.kbdFeature}</b><li><kbd>&#8592/&#8593</kbd> ${M.options.locale.kbdPrevFeature}</li><li><kbd>&#8594/&#8595</kbd> ${M.options.locale.kbdNextFeature}</li></ul>`,t._container.appendChild(o),this._container},_update:function(){if(this._map){var t,e=[];for(t in this._attributions)this._attributions[t]&&e.push(t);var o=[];this.options.prefix&&o.push(this.options.prefix),e.length&&o.push(e.join(", ")),this._container.innerHTML='<summary><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></svg></summary><div class="mapml-attribution-container">'+`<button onclick="this.closest('.leaflet-container').querySelector('.shortcuts-dialog').showModal()" class="shortcuts-button mapml-button">${M.options.locale.kbdShortcuts}</button> | `+o.join(' <span aria-hidden="true">|</span> ')+"</div>",this._container.setAttribute("role","group"),this._container.setAttribute("aria-label",""+M.options.locale.btnAttribution)}}});L.Map.mergeOptions({attributionControl:!1,toggleableAttributionControl:!0}),L.Map.addInitHook(function(){this.options.toggleableAttributionControl&&(new ut).addTo(this)});function ct(t){return new ut(t)}function ht(t){return new _t(t)}function dt(t){return new yt(t)}var _t=L.Control.extend({options:{position:"topleft"},onAdd:function(t){var e=L.DomUtil.create("div","mapml-reload-button leaflet-bar");let o=L.DomUtil.create("button","mapml-reload-button",e);return o.innerHTML="<span aria-hidden='true'>&#x021BA</span>",o.title=M.options.locale.cmReload,o.setAttribute("type","button"),o.classList.add("mapml-button"),o.setAttribute("aria-label","Reload"),L.DomEvent.disableClickPropagation(o),L.DomEvent.on(o,"click",L.DomEvent.stop),L.DomEvent.on(o,"click",this._goReload,this),this._reloadButton=o,this._updateDisabled(),t.on("moveend",this._updateDisabled,this),e},onRemove:function(t){t.off("moveend",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_goReload:function(t){!this._disabled&&1<this._map.options.mapEl._history.length&&this._map.options.mapEl.reload()},_updateDisabled:function(){setTimeout(()=>{L.DomUtil.removeClass(this._reloadButton,"leaflet-disabled"),this._reloadButton.setAttribute("aria-disabled","false"),this._map&&(this._disabled||this._map.options.mapEl._history.length<=1)&&(L.DomUtil.addClass(this._reloadButton,"leaflet-disabled"),this._reloadButton.setAttribute("aria-disabled","true"))},0)}}),yt=L.Control.Scale.extend({options:{maxWidth:100,updateWhenIdle:!0,position:"bottomleft"},onAdd:function(t){t._container.insertAdjacentHTML("beforeend","<output role='status' aria-live='polite' aria-atomic='true' class='mapml-screen-reader-output-scale'></output>"),this._container=L.DomUtil.create("div","mapml-control-scale");var e=L.Control.Scale.prototype.onAdd.call(this,t);return this._container.appendChild(e),this._container.setAttribute("tabindex",0),this._scaleControl=this,setTimeout(()=>{this._updateOutput(),this._focusOutput()},0),t.on("zoomend moveend",this._updateOutput,this),this._map._container.addEventListener("focus",()=>this._focusOutput()),this._container},onRemove:function(t){t.off("zoomend moveend",this._updateOutput,this)},getContainer:function(){return this._container},_pixelsToDistance:function(t,e){var o=96*window.devicePixelRatio;return"metric"===e?t/o*2.54:t/o},_scaleLength:function(t){let e=t.getAttribute("style");return parseInt(e.match(/width:\s*(\d+)px/)[1])},_focusOutput:function(){setTimeout(()=>{let t=this._map._container.querySelector(".mapml-screen-reader-output-scale");t.textContent="",setTimeout(()=>{t.textContent=this._container.getAttribute("aria-label")},100)},0)},_updateOutput:function(){let t="",e=this._scaleControl.getContainer().getElementsByClassName("leaflet-control-scale-line")[0];var o;t=this.options.metric?(o=parseFloat(this._pixelsToDistance(this._scaleLength(e),"metric").toFixed(1)),t=o+" centimeters to "+e.textContent.trim(),t=t.replace(/(\d+)\s*m\b/g,"$1 meters"),t.replace(/ km/g," kilometers")):(o=parseFloat(this._pixelsToDistance(this._scaleLength(e),"imperial").toFixed(1)),t=o+" inches to "+e.textContent.trim(),t=t.replace(/ft/g,"feet"),t.replace(/mi/g,"miles")),this._container.setAttribute("aria-label",t),this._map._container.querySelector(".mapml-screen-reader-output-scale").textContent=t}}),ft=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(t){var e=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",e),this.link.href="#",this.link.setAttribute("role","button"),this._map=t,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),e},onRemove:function(t){t.off("fullscreenchange",this._toggleTitle,this)},_click:function(t){L.DomEvent.stopPropagation(t),L.DomEvent.preventDefault(t),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(t){var e=this.getContainer().getRootNode().host,e="DIV"===e.nodeName?e.parentElement:e;this.isFullscreen()?t&&t.pseudoFullscreen?this._disablePseudoFullscreen(e):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(e):t&&t.pseudoFullscreen?this._enablePseudoFullscreen(e):e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen?e.msRequestFullscreen():this._enablePseudoFullscreen(e),this.getContainer().focus()},_enablePseudoFullscreen:function(t){L.DomUtil.addClass(t,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(t){L.DomUtil.removeClass(t,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(t){this._isFullscreen=t;var e=this.getContainer().getRootNode().host;t?L.DomUtil.addClass(e,"mapml-fullscreen-on"):L.DomUtil.removeClass(e,"mapml-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(t){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,o=this.getContainer().getRootNode().host,o="DIV"===o.nodeName?o.parentElement:o;e!==o||this._isFullscreen?e!==o&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange")):(this._setFullscreen(!0),this.fire("fullscreenchange"))}}),L.Map.mergeOptions({fullscreenControl:!1}),L.Map.addInitHook(function(){var t,e;this.options.fullscreenControl&&(this.fullscreenControl=new ft(this.options.fullscreenControl),this.addControl(this.fullscreenControl)),"onfullscreenchange"in document?t="fullscreenchange":"onmozfullscreenchange"in document?t="mozfullscreenchange":"onwebkitfullscreenchange"in document?t="webkitfullscreenchange":"onmsfullscreenchange"in document&&(t="MSFullscreenChange"),t&&(e=L.bind(this._onFullscreenChange,this),this.whenReady(function(){L.DomEvent.on(document,t,e)}),this.on("unload",function(){L.DomEvent.off(document,t,e)}))});function gt(t){return new ft(t)}function bt(t){return new Et(t)}function xt(t){return new Ct(t)}function Lt(t,e){return new At(t,e)}function vt(t){return new St(t)}function Mt(t,e){return new Tt(t,e)}var Et=L.Control.extend({options:{position:"bottomright"},onAdd:function(t){L.Control.CustomLocate=L.Control.Locate.extend({start:function(){L.Control.Locate.prototype.start.call(this),t.getContainer().focus()},stop:function(){L.Control.Locate.prototype.stop.call(this),t.getContainer().focus()}}),this.locateControl=new L.Control.CustomLocate({showPopup:!1,strings:{title:M.options.locale.btnLocTrackOff},position:this.options.position,locateOptions:{maxZoom:16}}).addTo(t);var e=this.locateControl._container,o=this.locateControl;return new MutationObserver(function(t){e.classList.contains("active")&&e.classList.contains("following")?(e.firstChild.title=M.options.locale.btnLocTrackOn,o._marker.bindTooltip(M.options.locale.btnMyLocTrackOn,{permanent:!0})):e.classList.contains("active")?(e.firstChild.title=M.options.locale.btnLocTrackLastKnown,o._marker.bindTooltip(M.options.locale.btnMyLastKnownLocTrackOn)):e.firstChild.title=M.options.locale.btnLocTrackOff}).observe(e,{attributes:!0,attributeFilter:["class"]}),e},stop:function(){return this.locateControl.stop()}}),Ct=L.Layer.extend({onAdd:function(t){this._container=L.DomUtil.create("div","mapml-crosshair",t._container),this._container.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 100 100"><g stroke="#fff" stroke-linecap="round" stroke-linejoin="round"><circle cx="50.028" cy="50.219" r="3.923" stroke-width="2" color="currentColor" overflow="visible"/><path stroke-width="3" d="M4.973 54.424h31.768a4.204 4.204 0 1 0 0-8.409H4.973A4.203 4.203 0 0 0 .77 50.22a4.203 4.203 0 0 0 4.204 4.205z" color="currentColor" overflow="visible"/><path stroke-width="3" d="M54.232 5.165a4.204 4.204 0 1 0-8.408 0v31.767a4.204 4.204 0 1 0 8.408 0V5.165z"/><path stroke-width="3" d="M99.288 50.22a4.204 4.204 0 0 0-4.204-4.205H63.317a4.204 4.204 0 1 0 0 8.409h31.767a4.205 4.205 0 0 0 4.204-4.205zM45.823 95.274a4.204 4.204 0 1 0 8.409 0V63.506a4.204 4.204 0 1 0-8.409 0v31.768z" color="currentColor" overflow="visible"/></g></svg>',t.isFocused=!1,this._isQueryable=!1,t.on("layerchange layeradd layerremove overlayremove",this._toggleEvents,this),t.on("popupopen",this._isMapFocused,this),L.DomEvent.on(t._container,"keydown keyup mousedown",this._isMapFocused,this),this._addOrRemoveCrosshair()},onRemove:function(t){t.off("layerchange layeradd layerremove overlayremove",this._toggleEvents),t.off("popupopen",this._isMapFocused),L.DomEvent.off(t._container,"keydown keyup mousedown",this._isMapFocused)},_toggleEvents:function(){this._hasQueryableLayer()?this._map.on("viewreset move moveend",this._addOrRemoveCrosshair,this):this._map.off("viewreset move moveend",this._addOrRemoveCrosshair,this),this._addOrRemoveCrosshair()},_addOrRemoveCrosshair:function(t){this._hasQueryableLayer()?this._container.removeAttribute("hidden"):this._container.setAttribute("hidden","")},_addOrRemoveMapOutline:function(t){var e=this._map._container;this._map.isFocused&&!this._outline?this._outline=L.DomUtil.create("div","mapml-outline",e):!this._map.isFocused&&this._outline&&(L.DomUtil.remove(this._outline),delete this._outline)},_hasQueryableLayer:function(){var t=this._map.options.mapEl.layers;if(this._map.isFocused)for(var e of t)if(e.checked&&e._layer.queryable)return!0;return!1},_isMapFocused:function(t){var e;this._map._container.parentNode.activeElement?((e=this._map._container.parentNode.activeElement.classList.contains("leaflet-container"))&&["keydown"].includes(t.type)&&t.shiftKey&&9===t.keyCode?this._map.isFocused=!1:this._map.isFocused=e&&["keyup","keydown"].includes(t.type),this._map.isFocused&&this._map.fire("mapkeyboardfocused"),this._addOrRemoveMapOutline(),this._addOrRemoveCrosshair()):this._map.isFocused=!1}}),At=L.Path.extend({initialize:function(t,e){this.type=t.tagName.toUpperCase(),"MAP-POINT"!==this.type&&"MAP-MULTIPOINT"!==this.type||(e.fillOpacity=1),0<e.wrappers.length&&(e=Object.assign(this._convertWrappers(e.wrappers),e)),L.setOptions(this,e),this.group=this.options.group,this.options.interactive=this.options.link||this.options.properties&&this.options.onEachFeature,this._parts=[],this._markup=t,this.options.zoom=t.getAttribute("zoom")||this.options.nativeZoom,this._convertMarkup(),(t.querySelector("map-span")||t.querySelector("map-a"))&&this._generateOutlinePoints(),this.isClosed=this._isClosed()},attachLinkHandler:function(i,n,a){let r,o=document.createElement("div"),s=document.createElement("p"),l=!1;function t(t){o.parentElement&&(l=!1,this._map.getContainer().removeChild(o))}o.classList.add("mapml-link-preview"),o.appendChild(s),i.classList.add("map-a"),n.visited&&i.classList.add("map-a-visited"),i.mousedown=t=>r={x:t.clientX,y:t.clientY},L.DomEvent.on(i,"mousedown",i.mousedown,this),i.mouseup=o=>{if(0===o.button){let t=!0,e=this.options._leafletLayer._layerEl.nextElementSibling;for(;e&&t;)e.tagName&&"LAYER-"===e.tagName.toUpperCase()&&(t=!(e.checked&&e._layer&&e._layer.queryable)),e=e.nextElementSibling;t&&r&&o.eventPhase!==Event.BUBBLING_PHASE&&Math.sqrt(Math.pow(r.x-o.clientX,2)+Math.pow(r.y-o.clientY,2))<=5&&(n.visited=!0,i.setAttribute("stroke","#6c00a2"),i.classList.add("map-a-visited"),M._handleLink(n,a))}},L.DomEvent.on(i,"mouseup",i.mouseup,this),L.DomEvent.on(i,"keypress",t=>{L.DomEvent.stop(t),13!==t.keyCode&&32!==t.keyCode||(n.visited=!0,i.setAttribute("stroke","#6c00a2"),i.classList.add("map-a-visited"),M._handleLink(n,a))},this),L.DomEvent.on(i,"mouseenter keyup",t=>{if(t.target===t.currentTarget){l=!0;let t=document.createElement("a"),e=this._map.getContainer().clientWidth;for(t.href=n.url,s.innerHTML=t.href,this._map.getContainer().appendChild(o);s.clientWidth>e/2;)s.innerHTML=s.innerHTML.substring(0,s.innerHTML.length-5)+"...";setTimeout(()=>{l&&(s.innerHTML=t.href)},1e3)}},this),L.DomEvent.on(i,"mouseout keydown mousedown",t=>{t.target===t.currentTarget&&o.parentElement&&(l=!1,this._map.getContainer().removeChild(o))},this),a.on("add",function(){L.DomEvent.on(this._map.getContainer(),"mouseout mouseenter click",t,this)},a),a.on("remove",function(){L.DomEvent.off(this._map.getContainer(),{mouseout:t,mouseenter:t,click:t})},a)},_project:function(t,e=void 0,o=void 0){let i=t||this._map,n=e||i.getPixelOrigin(),a=void 0===o?i.getZoom():o;for(var r of this._parts){r.pixelRings=this._convertRing(r.rings,i,n,a);for(var s of r.subrings)s.pixelSubrings=this._convertRing([s],i,n,a)}if(this._outline){this.pixelOutline=[];for(var l of this._outline)this.pixelOutline=this.pixelOutline.concat(this._convertRing(l,i,n,a))}},_convertRing:function(t,e,o,i){let n=e.options.crs.scale(i),a=[];for(var r of t){let t=[];for(var s of r.points){s=e.options.crs.transformation.transform(s,n);t.push(L.point(s.x,s.y)._subtract(o).round())}a.push(t)}return a},_update:function(){this._map&&this._renderer._updateFeature(this)},_convertWrappers:function(o){if(o&&0!==o.length){let t="",e={};for(var i of o)if("MAP-A"!==i.tagName.toUpperCase()&&i.className)t+=i.className+" ";else if(!e.link&&i.getAttribute("href")){let t={};t.url=i.getAttribute("href"),i.hasAttribute("target")&&(t.target=i.getAttribute("target")),i.hasAttribute("type")&&(t.type=i.getAttribute("type")),i.hasAttribute("inplace")&&(t.inPlace=!0),e.link=t}return e.className=(t+" "+this.options.className).trim(),e}},_convertMarkup:function(){if(this._markup){var i,e=this._markup.attributes;this.featureAttributes={},this.options.link&&"MAP-A"===this._markup.parentElement.tagName.toUpperCase()&&"MAP-GEOMETRY"!==this._markup.parentElement.parentElement.tagName.toUpperCase()&&(this.featureAttributes.tabindex="0");for(let t=0;t<e.length;t++)this.featureAttributes[e[t].name]=e[t].value;let o=!0;for(i of this._markup.querySelectorAll("map-coordinates")){let t=[],e=[];if(this._coordinateToArrays(i,t,e,this.options.className),o||"MAP-POLYGON"!==this.type)if("MAP-MULTIPOINT"===this.type)for(var n of t[0].points.concat(e))this._parts.push({rings:[{points:[n]}],subrings:[],cls:(`${n.cls||""} `+(this.options.className||"")).trim()});else this._parts.push({rings:t,subrings:e,cls:(`${this.featureAttributes.class||""} `+(this.options.className||"")).trim()});else this._parts[0].rings.push(t[0]),0<e.length&&(this._parts[0].subrings=this._parts[0].subrings.concat(e));o=!1}}},_generateOutlinePoints:function(){if("MAP-MULTIPOINT"!==this.type&&"MAP-POINT"!==this.type&&"MAP-LINESTRING"!==this.type&&"MAP-MULTILINESTRING"!==this.type){this._outline=[];for(var t of this._markup.querySelectorAll("map-coordinates")){let o=t.childNodes,i=0,n=document.createElement("div");o.length;for(let t=0;t<o.length;t++)0===o[t].textContent.trim().length&&o[t].remove();for(var a of o){var r,s=[];if(!a.tagName){let t="",e=((i-1)%o.length+o.length)%o.length;o[e].tagName&&(r=o[e].textContent.trim().split(/\s+/),t+=`${r[r.length-2]} ${r[r.length-1]} `),t+=a.textContent,e=((i+1)%o.length+o.length)%o.length,o[e].tagName&&(a=o[e].textContent.trim().split(/\s+/),t+=`${a[0]} ${a[1]} `),n.innerHTML=t,this._coordinateToArrays(n,s,[],!0,this.featureAttributes.class||this.options.className),this._outline.push(s)}i++}}}},_coordinateToArrays:function(i,t,n,e=!0,a=void 0,r=[]){for(var o of i.children)this._coordinateToArrays(o,t,n,!1,o.getAttribute("class"),r.concat([o]));let s=i.textContent.replace(/(<([^>]+)>)/gi,""),l=s.match(/(\S+\s+\S+)/gim),m=[],p;for(var u of l){var c=[];u.split(/\s+/gim).forEach(M._parseNumber,c);c=M.pointToPCRSPoint(L.point(c),this.options.zoom,this.options.projection,this.options.nativeCS);m.push(c),p=p?p.extend(c):L.bounds(c,c)}if(this._bounds?(this._bounds.extend(p.min),this._bounds.extend(p.max)):this._bounds=p,e)t.push({points:m});else{let e={},o=i.attributes,t=this._convertWrappers(r);t.link&&(e.tabindex="0");for(let t=0;t<o.length;t++)"class"!==o[t].name&&(e[o[t].name]=o[t].value);n.unshift({points:m,center:p.getCenter(),cls:(`${a||""} `+(t.className||"")).trim(),attr:e,link:t.link,linkTarget:t.linkTarget,linkType:t.linkType})}},_isClosed:function(){switch(this.type){case"MAP-POLYGON":case"MAP-MULTIPOLYGON":case"MAP-POINT":case"MAP-MULTIPOINT":return!0;default:return!1}},getCenter:function(){return this._bounds?this._map.options.crs.unproject(this._bounds.getCenter()):null},getPCRSCenter:function(){return this._bounds.getCenter()}}),St=L.SVG.extend({_initContainer:function(){L.SVG.prototype._initContainer.call(this),this._container.setAttribute("role","none presentation")},_initPath:function(e,t=!0){if(e._outline){let t=L.SVG.create("path");e.options.className&&L.DomUtil.addClass(t,e.featureAttributes.class||e.options.className),L.DomUtil.addClass(t,"mapml-feature-outline"),t.style.fill="none",e.outlinePath=t}for(var o of e._parts){if(o.rings&&(this._createPath(o,e.options.className,e.featureAttributes["aria-label"],e.options.interactive,e.featureAttributes),e.outlinePath&&(o.path.style.stroke="none")),o.subrings)for(var i of o.subrings)this._createPath(i,e.options.className,i.attr["aria-label"],void 0!==i.link,i.attr);this._updateStyle(e)}t&&(t=L.stamp(e),this._layers[t]=e)},_createPath:function(t,e,o,i=!1,n=void 0){let a=L.SVG.create("path");if(t.path=a,n)for(var[r,s]of Object.entries(n))"id"!==r&&"tabindex"!==r&&a.setAttribute(r,s);else o&&a.setAttribute("aria-label",o);(t.cls||e)&&L.DomUtil.addClass(a,t.cls||e),i&&L.DomUtil.addClass(a,"leaflet-interactive")},_addPath:function(t,e=void 0,o=!0){this._rootGroup||e||this._initContainer();let i=e||this._rootGroup,n=!1;o&&t.addInteractiveTarget(t.group);for(var a of t._parts){a.path&&t.group.appendChild(a.path),o&&(t.options.link&&t.attachLinkHandler(a.path,t.options.link,t.options._leafletLayer),t.addInteractiveTarget(a.path)),!n&&t.pixelOutline&&(t.group.appendChild(t.outlinePath),n=!0);for(var r of a.subrings)r.path&&(r.link&&(t.attachLinkHandler(r.path,r.link,t.options._leafletLayer),t.addInteractiveTarget(r.path)),t.group.appendChild(r.path))}i.appendChild(t.group)},_removePath:function(t){for(var e of t._parts){e.path&&(t.removeInteractiveTarget(e.path),L.DomUtil.remove(e.path));for(var o of e.subrings)o.path&&L.DomUtil.remove(o.path)}t.outlinePath&&L.DomUtil.remove(t.outlinePath),t.removeInteractiveTarget(t.group),L.DomUtil.remove(t.group),delete this._layers[L.stamp(t)]},_updateFeature:function(t){t.pixelOutline&&this._setPath(t.outlinePath,this.geometryToPath(t.pixelOutline,!1));for(var e of t._parts){this._setPath(e.path,this.geometryToPath(e.pixelRings,t.isClosed));for(var o of e.subrings)this._setPath(o.path,this.geometryToPath(o.pixelSubrings,!1))}},_pointToMarker:function(t){return`M${t.x} ${t.y} L${t.x-12.5} ${t.y-30} C${t.x-12.5} ${t.y-50}, ${t.x+12.5} ${t.y-50}, ${t.x+12.5} ${t.y-30} L${t.x} ${t.y}z`},_updateStyle:function(t){this._updatePathStyle(t.outlinePath,t,!1,!0);for(var e of t._parts){e.path&&this._updatePathStyle(e.path,t,!0);for(var o of e.subrings)o.path&&this._updatePathStyle(o.path,t)}},_updatePathStyle:function(t,e,o=!1,i=!1){var n,a;t&&e&&(n=e.options,a=e.isClosed,n.stroke&&(!a||i)||o&&!e.outlinePath?(t.setAttribute("stroke",n.color),t.setAttribute("stroke-opacity",n.opacity),t.setAttribute("stroke-width",n.weight),t.setAttribute("stroke-linecap",n.lineCap),t.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?t.setAttribute("stroke-dasharray",n.dashArray):t.removeAttribute("stroke-dasharray"),n.dashOffset?t.setAttribute("stroke-dashoffset",n.dashOffset):t.removeAttribute("stroke-dashoffset"),n.link&&(t.setAttribute("stroke",n.link.visited?"#6c00a2":"#0000EE"),t.setAttribute("stroke-opacity","1"),t.setAttribute("stroke-width","1px"),t.setAttribute("stroke-dasharray","none"))):t.setAttribute("stroke","none"),a&&!i?n.fill?t.setAttribute("fill",n.color):(t.setAttribute("fill",n.fillColor||n.color),t.setAttribute("fill-opacity",n.fillOpacity),t.setAttribute("fill-rule",n.fillRule||"evenodd")):t.setAttribute("fill","none"))},_setPath:function(t,e){t.setAttribute("d",e)},geometryToPath:function(t,e){let o="",i,n,a,r,s,l;for(i=0,a=t.length;i<a;i++){if(1===(s=t[i]).length)return this._pointToMarker(s[0]);for(n=0,r=s.length;n<r;n++)l=s[n],o+=(n?"L":"M")+l.x+" "+l.y;o+=e?"z":""}return o||"M0 0"}}),Tt=L.FeatureGroup.extend({initialize:function(t,e){var o;e.wrappers&&0<e.wrappers.length&&(e=Object.assign(M.Path.prototype._convertWrappers(e.wrappers),e)),L.LayerGroup.prototype.initialize.call(this,t,e),this._featureEl=this.options.mapmlFeature,(this.options.onEachFeature&&this.options.properties||this.options.link)&&(L.DomUtil.addClass(this.options.group,"leaflet-interactive"),e=t[Object.keys(t)[0]],1===t.length&&e.options.link&&(this.options.link=e.options.link),this.options.link?(M.Path.prototype.attachLinkHandler.call(this,this.options.group,this.options.link,this.options._leafletLayer),this.options.group.setAttribute("role","link")):(this.options.group.setAttribute("aria-expanded","false"),this.options.group.setAttribute("role","button"),this.options.onEachFeature(this.options.properties,this),this.off("click",this._openPopup))),L.DomEvent.on(this.options.group,"keyup keydown",this._handleFocus,this),this.options.group.setAttribute("aria-label",this.options.accessibleTitle),this.options.featureID&&this.options.group.setAttribute("data-fid",this.options.featureID);for(o of t)o._groupLayer=this},onAdd:function(t){L.LayerGroup.prototype.onAdd.call(this,t),this.updateInteraction()},updateInteraction:function(){let e=this._map||this.options._leafletLayer._map;for(var o in(this.options.onEachFeature||this.options.link)&&e.featureIndex.addToIndex(this,this.getPCRSCenter(),this.options.group),this._layers){let t=this._layers[o];for(var i of t._parts){t.featureAttributes&&t.featureAttributes.tabindex&&e.featureIndex.addToIndex(t,t.getPCRSCenter(),i.path);for(var n of i.subrings)n.attr&&n.attr.tabindex&&e.featureIndex.addToIndex(t,n.center,n.path)}}},_checkRender:function(t,e,o){var i=this._featureEl.getAttribute("min"),n=this._featureEl.getAttribute("max");return!(o<t||t<e)&&(null===i&&null===n||!(null!==i&&t<+i||null!==n&&+n<t))},_handleFocus:function(t){if([9,16,27,37,38,39,40].includes(t.keyCode)&&"keydown"===t.type){var e=this._map.featureIndex.currentIndex;if(37===t.keyCode||38===t.keyCode)L.DomEvent.stop(t),this._map.featureIndex.inBoundFeatures[e].path.setAttribute("tabindex",-1),0===e?(this._map.featureIndex.inBoundFeatures[this._map.featureIndex.inBoundFeatures.length-1].path.focus(),this._map.featureIndex.currentIndex=this._map.featureIndex.inBoundFeatures.length-1):(this._map.featureIndex.inBoundFeatures[e-1].path.focus(),this._map.featureIndex.currentIndex--);else if(39===t.keyCode||40===t.keyCode)L.DomEvent.stop(t),this._map.featureIndex.inBoundFeatures[e].path.setAttribute("tabindex",-1),e===this._map.featureIndex.inBoundFeatures.length-1?(this._map.featureIndex.inBoundFeatures[0].path.focus(),this._map.featureIndex.currentIndex=0):(this._map.featureIndex.inBoundFeatures[e+1].path.focus(),this._map.featureIndex.currentIndex++);else if(27===t.keyCode){if("g"!==(this._map.options.mapEl.shadowRoot||this._map.options.mapEl.querySelector(".mapml-web-map").shadowRoot).activeElement.nodeName)return;this._map._container.focus()}else if(9===t.keyCode){let t=this;setTimeout(function(){t._map.featureIndex.inBoundFeatures[0].path.setAttribute("tabindex",0)},0)}}else[9,16,13,27,37,38,39,40,49,50,51,52,53,54,55].includes(t.keyCode)||(this._map.featureIndex.currentIndex=0,this._map.featureIndex.inBoundFeatures[0].path.focus());"G"===t.target.tagName.toUpperCase()&&([9,13,16,37,38,39,40,49,50,51,52,53,54,55,27].includes(t.keyCode)&&"keyup"===t.type?this.openTooltip():13===t.keyCode||32===t.keyCode?(this.closeTooltip(),!this.options.link&&this.options.onEachFeature&&(L.DomEvent.stop(t),this.openPopup())):this.closeTooltip())},addLayer:function(t){!t.options.link&&t.options.interactive&&this.options.onEachFeature(this.options.properties,t),L.FeatureGroup.prototype.addLayer.call(this,t)},_previousFeature:function(t){L.DomEvent.stop(t),this._map.featureIndex.currentIndex=Math.max(this._map.featureIndex.currentIndex-1,0);let e=this._map.featureIndex.inBoundFeatures[this._map.featureIndex.currentIndex];e.path.focus(),this._map.closePopup()},_nextFeature:function(t){L.DomEvent.stop(t),this._map.featureIndex.currentIndex=Math.min(this._map.featureIndex.currentIndex+1,this._map.featureIndex.inBoundFeatures.length-1);let e=this._map.featureIndex.inBoundFeatures[this._map.featureIndex.currentIndex];e.path.focus(),this._map.closePopup()},getPCRSCenter:function(){let e;for(var o in this._layers){let t=this._layers[o];e?e.extend(t.getPCRSCenter()):e=L.bounds(t.getPCRSCenter(),t.getPCRSCenter())}return e.getCenter()}}),It=L.Handler.extend({addHooks:function(){this._map.on({layeradd:this.totalBounds,layerremove:this.totalBounds}),this._map.options.mapEl.addEventListener("map-moveend",this.announceBounds),this._map.dragging._draggable.addEventListener("dragstart",this.dragged),this._map.options.mapEl.addEventListener("mapfocused",this.focusAnnouncement)},removeHooks:function(){this._map.off({layeradd:this.totalBounds,layerremove:this.totalBounds}),this._map.options.mapEl.removeEventListener("map-moveend",this.announceBounds),this._map.dragging._draggable.removeEventListener("dragstart",this.dragged),this._map.options.mapEl.removeEventListener("mapfocused",this.focusAnnouncement)},focusAnnouncement:function(){let i=this;setTimeout(function(){let t=(i.querySelector(".mapml-web-map")?i.querySelector(".mapml-web-map"):i).shadowRoot.querySelector(".leaflet-container");var e=i._map.getZoom();M._gcrsToTileMatrix(i);let o=M.options.locale.amZoom+" "+e;e===i._map._layersMaxZoom?o=M.options.locale.amMaxZoom+" "+o:e===i._map._layersMinZoom&&(o=M.options.locale.amMinZoom+" "+o),t.setAttribute("aria-roledescription","region "+o),setTimeout(function(){t.removeAttribute("aria-roledescription")},2e3)},0)},announceBounds:function(){if(!(0<this._traversalCall)){var o=this._map.getZoom(),i=M.pixelToPCRSBounds(this._map.getPixelBounds(),o,this._map.options.projection);let t=!0;this._map.totalLayerBounds&&(t=o<=this._map._layersMaxZoom&&o>=this._map._layersMinZoom&&this._map.totalLayerBounds.overlaps(i));let e=(this.querySelector(".mapml-web-map")?this.querySelector(".mapml-web-map"):this).shadowRoot.querySelector(".mapml-screen-reader-output");M._gcrsToTileMatrix(this);var n,i=M.options.locale.amZoom+" "+o;t?(n=(this._history[this._historyIndex-1]?this._history[this._historyIndex-1]:this._history[this._historyIndex]).zoom,o===this._map._layersMaxZoom&&o!==n?e.innerText=M.options.locale.amMaxZoom+" "+i:o===this._map._layersMinZoom&&o!==n?e.innerText=M.options.locale.amMinZoom+" "+i:e.innerText=i):(n=this._history[this._historyIndex],i=this._history[this._historyIndex-1],this.back(),this._history.pop(),n.zoom!==i.zoom?e.innerText=M.options.locale.amZoomedOut:this._map.dragging._draggable.wasDragged?e.innerText=M.options.locale.amDraggedOut:n.x>i.x?e.innerText=M.options.locale.amEastBound:n.x<i.x?e.innerText=M.options.locale.amWestBound:n.y<i.y?e.innerText=M.options.locale.amNorthBound:n.y>i.y&&(e.innerText=M.options.locale.amSouthBound)),this._map.dragging._draggable.wasDragged=!1}},totalBounds:function(){let t=Object.keys(this._layers),o=L.bounds();t.forEach(t=>{var e;this._layers[t].layerBounds&&(o||(e=this._layers[t].layerBounds.getCenter(),o=L.bounds(e,e)),o.extend(this._layers[t].layerBounds.min),o.extend(this._layers[t].layerBounds.max))}),this.totalLayerBounds=o},dragged:function(){this.wasDragged=!0}}),kt=L.Handler.extend({initialize:function(t){L.Handler.prototype.initialize.call(this,t),this.inBoundFeatures=[],this.outBoundFeatures=[],this.currentIndex=0,this._mapPCRSBounds=M.pixelToPCRSBounds(t.getPixelBounds(),t.getZoom(),t.options.projection)},addHooks:function(){this._map.on("mapkeyboardfocused",this._updateMapBounds,this),this._map.on("mapkeyboardfocused",this._sortIndex,this)},removeHooks:function(){this._map.off("mapkeyboardfocused",this._updateMapBounds),this._map.off("mapkeyboardfocused",this._sortIndex)},addToIndex:function(t,e,o){var i=this._mapPCRSBounds.getCenter(),i=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2));let n=this._mapPCRSBounds.contains(e)?this.inBoundFeatures:this.outBoundFeatures;i={path:o,layer:t,center:e,dist:i};o.setAttribute("tabindex",-1),n.push(i);for(let t=n.length-1;0<t&&n[t].dist<n[t-1].dist;t--){var a=n[t];n[t]=n[t-1],n[t-1]=a}this._mapPCRSBounds.contains(e)?this.inBoundFeatures=n:this.outBoundFeatures=n},cleanIndex:function(){this.currentIndex=0,this.inBoundFeatures=this.inBoundFeatures.filter(t=>{var e=this._mapPCRSBounds.contains(t.center);return t.path.setAttribute("tabindex",-1),t.layer._map&&!e&&this.outBoundFeatures.push(t),t.layer._map&&e}),this.outBoundFeatures=this.outBoundFeatures.filter(t=>{var e=this._mapPCRSBounds.contains(t.center);return t.path.setAttribute("tabindex",-1),t.layer._map&&e&&this.inBoundFeatures.push(t),t.layer._map&&!e})},_sortIndex:function(){if(this.cleanIndex(),0!==this.inBoundFeatures.length){let n=this._mapPCRSBounds.getCenter();this.inBoundFeatures.sort(function(t,e){var o=t.center,i=e.center;return t.dist=Math.sqrt(Math.pow(o.x-n.x,2)+Math.pow(o.y-n.y,2)),e.dist=Math.sqrt(Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2)),t.dist-e.dist}),this.inBoundFeatures[0].path.setAttribute("tabindex",0)}},_updateMapBounds:function(t){this._mapPCRSBounds=M.pixelToPCRSBounds(this._map.getPixelBounds(),this._map.getZoom(),this._map.options.projection)}}),Pt={featureIndexOverlayOption:!1,announceMovement:!1,announceScale:{metric:!0,imperial:!1},defaultExtCoor:"pcrs",defaultLocCoor:"gcrs",locale:{cmBack:"Back",cmForward:"Forward",cmReload:"Reload",cmToggleControls:"Toggle Controls",cmCopyCoords:"Copy",cmCopyMapML:"Map",cmCopyExtent:"Extent",cmCopyLocation:"Location",cmToggleDebug:"Toggle Debug Mode",cmPasteLayer:"Paste",cmViewSource:"View Map Source",lmZoomToLayer:"Zoom To Layer",lmCopyLayer:"Copy Layer",lcOpacity:"Opacity",btnAttribution:"Map data attribution",btnZoomIn:"Zoom in",btnZoomOut:"Zoom out",btnFullScreen:"View Fullscreen",btnExitFullScreen:"Exit Fullscreen",btnLocTrackOn:"Show my location - location tracking on",btnMyLocTrackOn:"My current location, shown on map",btnLocTrackOff:"Show my location - location tracking off",btnLocTrackLastKnown:"Show my location - last known location shown",btnMyLastKnownLocTrackOn:"My last known location, shown on map",amZoom:"zoom level",amColumn:"column",amRow:"row",amMaxZoom:"At maximum zoom level, zoom in disabled",amMinZoom:"At minimum zoom level, zoom out disabled",amZoomedOut:"Zoomed out of bounds, returning to",amDraggedOut:"Dragged out of bounds, returning to",amEastBound:"Reached east bound, panning east disabled",amWestBound:"Reached west bound, panning west disabled",amNorthBound:"Reached north bound, panning north disabled",amSouthBound:"Reached south bound, panning south disabled",kbdShortcuts:"Keyboard shortcuts",kbdMovement:"Movement keys",kbdFeature:"Feature navigation keys",kbdPanUp:"Pan up",kbdPanDown:"Pan down",kbdPanLeft:"Pan left",kbdPanRight:"Pan right",kbdPanIncrement:"pan increment",kbdZoom:"Zoom in/out 3 levels",kbdPrevFeature:"Previous feature",kbdNextFeature:"Next feature",dfLayer:"Layer",popupZoom:"Zoom to here",dfPastedLayer:"Pasted layer",fIndexNoFeatures:"No features found"}};L.Map.Keyboard.include({_onKeyDown:function(t){if(!t.altKey&&!t.metaKey){var e,o=t.keyCode,i=this._map;if(o in this._panKeys)i._panAnim&&i._panAnim._inProgress||(e=this._panKeys[o],t.shiftKey&&(e=L.point(e).multiplyBy(3)),t.ctrlKey&&(e=L.point(e).divideBy(5)),i.panBy(e),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds));else if(o in this._zoomKeys)(o in{187:187,107:107,61:61,171:171}&&i._layersMaxZoom!==i.getZoom()||o in{189:189,109:109,54:54,173:173}&&i._layersMinZoom!==i.getZoom())&&i.setZoom(i.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[o]);else{if(27!==o||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}L.DomEvent.stop(t)}}});function wt(t){return new Bt(t)}var zt,Nt,Bt=L.Layer.extend({onAdd:function(t){this._container=L.DomUtil.create("div","mapml-feature-index-box",t._container),this._container.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 100 100"><path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M0 0h100v100H0z" color="#000" overflow="visible"/></svg>',this._output=L.DomUtil.create("output","mapml-feature-index",t._container),this._output.setAttribute("role","status"),this._output.setAttribute("aria-live","polite"),this._output.setAttribute("aria-atomic","true"),this._body=L.DomUtil.create("span","mapml-feature-index-content",this._output),this._body.index=0,this._output.initialFocus=!1,t.on("focus blur popupclose",this._addOrRemoveFeatureIndex,this),t.on("moveend focus templatedfeatureslayeradd",this._checkOverlap,this),t.on("keydown",this._onKeyDown,this),this._addOrRemoveFeatureIndex()},_calculateReticleBounds:function(){let t=this._map.getPixelBounds();var e=t.getCenter(),o=Math.abs(t.min.x-t.max.x)/this._map.options.mapEl.width,i=Math.abs(t.min.y-t.max.y)/this._map.options.mapEl.height;let n=getComputedStyle(this._container).width.replace(/[^\d.]/g,"");"%"===getComputedStyle(this._container).width.slice(-1)&&(n=n*this._map.options.mapEl.width/100);var a=o*n/2,o=i*n/2,i=L.point(e.x-a,e.y+o),o=L.point(e.x+a,e.y-o),o=L.bounds(i,o);return M.pixelToPCRSBounds(o,this._map.getZoom(),this._map.options.projection)},_checkOverlap:function(t){if("focus"===t.type&&(this._output.initialFocus=!0),this._output.initialFocus)if(this._output.popupClosed)this._output.popupClosed=!1;else{this._map.fire("mapkeyboardfocused");let n=this._calculateReticleBounds(),a=this._map.featureIndex.inBoundFeatures,r=1,t=Object.keys(a),s=this._body,e=document.createElement("span");e.innerHTML=M.options.locale.fIndexNoFeatures,s.innerHTML="",s.index=0,s.allFeatures=[],t.forEach(t=>{let e=a[t].layer;var o=a[t].layer._layers;let i=L.bounds();if(o){let t=Object.keys(o);t.forEach(t=>{i=i||L.bounds(e._layers[t]._bounds.min,e._layers[t]._bounds.max),i.extend(e._layers[t]._bounds.min),i.extend(e._layers[t]._bounds.max)})}else e._bounds&&(i=L.bounds(e._bounds.min,e._bounds.max));n.overlaps(i)&&(t=a[t].path.getAttribute("aria-label"),r<8&&s.appendChild(this._updateOutput(t,r,r)),r%7!=0&&1!==r||s.allFeatures.push([]),s.allFeatures[Math.floor((r-1)/7)].push({label:t,index:r,layer:e}),s.allFeatures[1]&&1===s.allFeatures[1].length&&s.appendChild(this._updateOutput("More results",0,9)),r+=1)}),this._addToggleKeys(),1===r&&s.appendChild(e)}},_updateOutput:function(t,e,o){let i=document.createElement("span");return i.setAttribute("data-index",e),i.innerHTML=`<kbd>${o}</kbd>`+" "+t+"<span>, </span>",i},_addToggleKeys:function(){let e=this._body.allFeatures;for(let t=0;t<e.length;t++){if(0===e[t].length)return;e[t-1]&&e[t].push({label:"Previous results"}),e[t+1]&&0<e[t+1].length&&e[t].push({label:"More results"})}},_onKeyDown:function(e){var t=this._body,o=e.originalEvent.keyCode;if(49<=o&&o<=55){if(t.allFeatures[t.index]){e=t.allFeatures[t.index][o-49];if(e){let t=e.layer;t&&(this._map.featureIndex.currentIndex=e.index-1,t._popup?(this._map.closePopup(),t.openPopup()):t.options.group.focus())}}}else 56===o?this._newContent(t,-1):57===o&&this._newContent(t,1)},_newContent:function(o,t){var e=o.firstChild.getAttribute("data-index"),i=o.allFeatures[Math.floor((e-1)/7+t)];if(i&&0<i.length){o.innerHTML="",o.index+=t;for(let e=0;e<i.length;e++){var n=i[e],a=n.index||0;let t=e+1;"More results"===n.label&&(t=9),"Previous results"===n.label&&(t=8),o.appendChild(this._updateOutput(n.label,a,t))}}},_addOrRemoveFeatureIndex:function(t){if(this._output.initialFocus){if(this._output.hasAttribute("aria-hidden")){let t=this;setTimeout(function(){t._output.removeAttribute("aria-hidden")},100)}}else this._output.setAttribute("aria-hidden","true");t&&"popupclose"===t.type?(this._output.setAttribute("aria-hidden","true"),this._output.popupClosed=!0):t&&"focus"===t.type?(this._container.removeAttribute("hidden"),this._output.classList.remove("mapml-screen-reader-output")):t&&t.target._popup?this._container.setAttribute("hidden",""):t&&"blur"===t.type?(this._container.setAttribute("hidden",""),this._output.classList.add("mapml-screen-reader-output"),this._output.initialFocus=!1,this._addOrRemoveFeatureIndex()):(this._container.setAttribute("hidden",""),this._output.classList.add("mapml-screen-reader-output"))}});zt=window,Nt={},zt.M=Nt,function(){Nt.detectImagePath=function(t){var e=L.DomUtil.create("div","leaflet-default-icon-path",t),o=L.DomUtil.getStyle(e,"background-image")||L.DomUtil.getStyle(e,"backgroundImage");return t.removeChild(e),o=null===o||0!==o.indexOf("url")?"":o.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")},Nt.mime="text/mapml";var t=zt.document.head.querySelector("map-options");Nt.options=Pt,t&&(Nt.options=Object.assign(Nt.options,JSON.parse(t.innerHTML))),Nt.WGS84=new L.Proj.CRS("EPSG:4326","+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ",{origin:[-180,90],bounds:L.bounds([[-180,-90],[180,90]]),resolutions:[.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.0003433227539062,.0001716613769531,858306884766e-16,429153442383e-16,214576721191e-16,107288360596e-16,53644180298e-16,26822090149e-16,13411045074e-16,6.705522537e-7,3.352761269e-7],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>Math.round(Nt.WGS84.options.bounds.getSize().x/Nt.WGS84.options.resolutions[t])},vertical:{name:"y",min:0,max:t=>Math.round(Nt.WGS84.options.bounds.getSize().y/Nt.WGS84.options.resolutions[t])},bounds:t=>L.bounds([Nt.WGS84.options.crs.tcrs.horizontal.min,Nt.WGS84.options.crs.tcrs.vertical.min],[Nt.WGS84.options.crs.tcrs.horizontal.max(t),Nt.WGS84.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"longitude",get min(){return Nt.WGS84.options.crs.gcrs.horizontal.min},get max(){return Nt.WGS84.options.crs.gcrs.horizontal.max}},vertical:{name:"latitude",get min(){return Nt.WGS84.options.crs.gcrs.vertical.min},get max(){return Nt.WGS84.options.crs.gcrs.vertical.max}},get bounds(){return Nt.WGS84.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-180,max:180},vertical:{name:"latitude",min:-90,max:90},get bounds(){return L.latLngBounds([Nt.WGS84.options.crs.gcrs.vertical.min,Nt.WGS84.options.crs.gcrs.horizontal.min],[Nt.WGS84.options.crs.gcrs.vertical.max,Nt.WGS84.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([Nt.WGS84.options.crs.tile.horizontal.min,Nt.WGS84.options.crs.tile.vertical.min],[Nt.WGS84.options.crs.tile.horizontal.max,Nt.WGS84.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>Math.round(Nt.WGS84.options.crs.tcrs.horizontal.max(t)/Nt.WGS84.options.crs.tile.bounds.getSize().x)},vertical:{name:"row",min:0,max:t=>Math.round(Nt.WGS84.options.crs.tcrs.vertical.max(t)/Nt.WGS84.options.crs.tile.bounds.getSize().y)},bounds:t=>L.bounds([Nt.WGS84.options.crs.tilematrix.horizontal.min,Nt.WGS84.options.crs.tilematrix.vertical.min],[Nt.WGS84.options.crs.tilematrix.horizontal.max(t),Nt.WGS84.options.crs.tilematrix.vertical.max(t)])}}}),Nt.CBMTILE=new L.Proj.CRS("EPSG:3978","+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",{origin:[-34655800,3931e4],bounds:L.bounds([[-34655800,-39e6],[1e7,3931e4]]),resolutions:[38364.660062653464,22489.62831258996,13229.193125052918,7937.5158750317505,4630.2175937685215,2645.8386250105837,1587.5031750063501,926.0435187537042,529.1677250021168,317.50063500127004,185.20870375074085,111.12522225044451,66.1459656252646,38.36466006265346,22.48962831258996,13.229193125052918,7.9375158750317505,4.6302175937685215,2.6458386250105836,1.5875031750063502,.9260435187537043,.5291677250021167,.31750063500127,.18520870375074083,.11112522225044451,.06614596562526459],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>Math.round(Nt.CBMTILE.options.bounds.getSize().x/Nt.CBMTILE.options.resolutions[t])},vertical:{name:"y",min:0,max:t=>Math.round(Nt.CBMTILE.options.bounds.getSize().y/Nt.CBMTILE.options.resolutions[t])},bounds:t=>L.bounds([Nt.CBMTILE.options.crs.tcrs.horizontal.min,Nt.CBMTILE.options.crs.tcrs.vertical.min],[Nt.CBMTILE.options.crs.tcrs.horizontal.max(t),Nt.CBMTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return Nt.CBMTILE.options.bounds.min.x},get max(){return Nt.CBMTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return Nt.CBMTILE.options.bounds.min.y},get max(){return Nt.CBMTILE.options.bounds.max.y}},get bounds(){return Nt.CBMTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-141.01,max:-47.74},vertical:{name:"latitude",min:40.04,max:86.46},get bounds(){return L.latLngBounds([Nt.CBMTILE.options.crs.gcrs.vertical.min,Nt.CBMTILE.options.crs.gcrs.horizontal.min],[Nt.CBMTILE.options.crs.gcrs.vertical.max,Nt.CBMTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([Nt.CBMTILE.options.crs.tile.horizontal.min,Nt.CBMTILE.options.crs.tile.vertical.min],[Nt.CBMTILE.options.crs.tile.horizontal.max,Nt.CBMTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>Math.round(Nt.CBMTILE.options.crs.tcrs.horizontal.max(t)/Nt.CBMTILE.options.crs.tile.bounds.getSize().x)},vertical:{name:"row",min:0,max:t=>Math.round(Nt.CBMTILE.options.crs.tcrs.vertical.max(t)/Nt.CBMTILE.options.crs.tile.bounds.getSize().y)},bounds:t=>L.bounds([0,0],[Nt.CBMTILE.options.crs.tilematrix.horizontal.max(t),Nt.CBMTILE.options.crs.tilematrix.vertical.max(t)])}}}),Nt.APSTILE=new L.Proj.CRS("EPSG:5936","+proj=stere +lat_0=90 +lat_ts=50 +lon_0=-150 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m +no_defs",{origin:[-28567784.109255,32567784.109255],bounds:L.bounds([[-28567784.109254867,-28567784.109254755],[32567784.109255023,32567784.10925506]]),resolutions:[238810.813354,119405.406677,59702.7033384999,29851.3516692501,14925.675834625,7462.83791731252,3731.41895865639,1865.70947932806,932.854739664032,466.427369832148,233.213684916074,116.606842458037,58.3034212288862,29.1517106145754,14.5758553072877,7.28792765351156,3.64396382688807,1.82198191331174,.910990956788164,.45549547826179],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>Math.round(Nt.APSTILE.options.bounds.getSize().x/Nt.APSTILE.options.resolutions[t])},vertical:{name:"y",min:0,max:t=>Math.round(Nt.APSTILE.options.bounds.getSize().y/Nt.APSTILE.options.resolutions[t])},bounds:t=>L.bounds([Nt.APSTILE.options.crs.tcrs.horizontal.min,Nt.APSTILE.options.crs.tcrs.vertical.min],[Nt.APSTILE.options.crs.tcrs.horizontal.max(t),Nt.APSTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return Nt.APSTILE.options.bounds.min.x},get max(){return Nt.APSTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return Nt.APSTILE.options.bounds.min.y},get max(){return Nt.APSTILE.options.bounds.max.y}},get bounds(){return Nt.APSTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-180,max:180},vertical:{name:"latitude",min:60,max:90},get bounds(){return L.latLngBounds([Nt.APSTILE.options.crs.gcrs.vertical.min,Nt.APSTILE.options.crs.gcrs.horizontal.min],[Nt.APSTILE.options.crs.gcrs.vertical.max,Nt.APSTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([Nt.APSTILE.options.crs.tile.horizontal.min,Nt.APSTILE.options.crs.tile.vertical.min],[Nt.APSTILE.options.crs.tile.horizontal.max,Nt.APSTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>Math.round(Nt.APSTILE.options.crs.tcrs.horizontal.max(t)/Nt.APSTILE.options.crs.tile.bounds.getSize().x)},vertical:{name:"row",min:0,max:t=>Math.round(Nt.APSTILE.options.crs.tcrs.vertical.max(t)/Nt.APSTILE.options.crs.tile.bounds.getSize().y)},bounds:t=>L.bounds([0,0],[Nt.APSTILE.options.crs.tilematrix.horizontal.max(t),Nt.APSTILE.options.crs.tilematrix.vertical.max(t)])}}}),Nt.OSMTILE=L.CRS.EPSG3857,L.setOptions(Nt.OSMTILE,{origin:[-20037508.342787,20037508.342787],bounds:L.bounds([[-20037508.342787,-20037508.342787],[20037508.342787,20037508.342787]]),resolutions:[156543.0339,78271.51695,39135.758475,19567.8792375,9783.93961875,4891.969809375,2445.9849046875,1222.9924523438,611.49622617188,305.74811308594,152.87405654297,76.437028271484,38.218514135742,19.109257067871,9.5546285339355,4.7773142669678,2.3886571334839,1.1943285667419,.59716428337097,.29858214168549,.14929107084274,.074645535421371,.03732276771068573,.018661383855342866,.009330691927671433],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>Math.round(Nt.OSMTILE.options.bounds.getSize().x/Nt.OSMTILE.options.resolutions[t])},vertical:{name:"y",min:0,max:t=>Math.round(Nt.OSMTILE.options.bounds.getSize().y/Nt.OSMTILE.options.resolutions[t])},bounds:t=>L.bounds([Nt.OSMTILE.options.crs.tcrs.horizontal.min,Nt.OSMTILE.options.crs.tcrs.vertical.min],[Nt.OSMTILE.options.crs.tcrs.horizontal.max(t),Nt.OSMTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return Nt.OSMTILE.options.bounds.min.x},get max(){return Nt.OSMTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return Nt.OSMTILE.options.bounds.min.y},get max(){return Nt.OSMTILE.options.bounds.max.y}},get bounds(){return Nt.OSMTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",get min(){return Nt.OSMTILE.unproject(Nt.OSMTILE.options.bounds.min).lng},get max(){return Nt.OSMTILE.unproject(Nt.OSMTILE.options.bounds.max).lng}},vertical:{name:"latitude",get min(){return Nt.OSMTILE.unproject(Nt.OSMTILE.options.bounds.min).lat},get max(){return Nt.OSMTILE.unproject(Nt.OSMTILE.options.bounds.max).lat}},get bounds(){return L.latLngBounds([Nt.OSMTILE.options.crs.gcrs.vertical.min,Nt.OSMTILE.options.crs.gcrs.horizontal.min],[Nt.OSMTILE.options.crs.gcrs.vertical.max,Nt.OSMTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([Nt.OSMTILE.options.crs.tile.horizontal.min,Nt.OSMTILE.options.crs.tile.vertical.min],[Nt.OSMTILE.options.crs.tile.horizontal.max,Nt.OSMTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>Math.round(Nt.OSMTILE.options.crs.tcrs.horizontal.max(t)/Nt.OSMTILE.options.crs.tile.bounds.getSize().x)},vertical:{name:"row",min:0,max:t=>Math.round(Nt.OSMTILE.options.crs.tcrs.vertical.max(t)/Nt.OSMTILE.options.crs.tile.bounds.getSize().y)},bounds:t=>L.bounds([0,0],[Nt.OSMTILE.options.crs.tilematrix.horizontal.max(t),Nt.OSMTILE.options.crs.tilematrix.vertical.max(t)])}}})}(),Nt._handleLink=K,Nt.convertPCRSBounds=D,Nt.axisToXY=q,Nt.csToAxes=R,Nt._convertAndFormatPCRS=B,Nt.axisToCS=F,Nt._parseNumber=W,Nt._extractInputBounds=O,Nt._splitCoordinate=Y,Nt.boundsToPCRSBounds=j,Nt.pixelToPCRSBounds=H,Nt._metaContentToObject=G,Nt._coordsToArray=V,Nt._parseStylesheetAsHTML=$,Nt.pointToPCRSPoint=U,Nt.pixelToPCRSPoint=Z,Nt._gcrsToTileMatrix=tt,Nt._pasteLayer=et,Nt._properties2Table=ot,Nt._updateExtent=it,Nt.geojson2mapml=nt,Nt._breakArray=at,Nt._table2properties=rt,Nt._geometry2geojson=st,Nt._pcrsToGcrs=lt,Nt.mapml2geojson=mt,Nt.getMaxZoom=pt,Nt.getBounds=X,Nt.getZoomBounds=Q,Nt.getNativeVariables=J,Nt.QueryHandler=z,Nt.ContextMenu=N,Nt.AnnounceMovement=It,Nt.FeatureIndex=kt,L.Map.addInitHook("addHandler","query",Nt.QueryHandler),L.Map.addInitHook("addHandler","contextMenu",Nt.ContextMenu),L.Map.addInitHook("addHandler","announceMovement",Nt.AnnounceMovement),L.Map.addInitHook("addHandler","featureIndex",Nt.FeatureIndex),Nt.MapMLLayer=b,Nt.mapMLLayer=p,Nt.ImageLayer=g,Nt.imageLayer=m,Nt.TemplatedImageLayer=f,Nt.templatedImageLayer=l,Nt.TemplatedFeaturesLayer=y,Nt.templatedFeaturesLayer=s,Nt.TemplatedLayer=_,Nt.templatedLayer=r,Nt.TemplatedTileLayer=h,Nt.templatedTileLayer=a,Nt.FeatureLayer=c,Nt.featureLayer=n,Nt.LayerControl=i,Nt.layerControl=e,Nt.AttributionButton=ut,Nt.attributionButton=ct,Nt.ReloadButton=_t,Nt.reloadButton=ht,Nt.ScaleBar=yt,Nt.scaleBar=dt,Nt.FullscreenButton=ft,Nt.fullscreenButton=gt,Nt.geolocationButton=bt,Nt.StaticTileLayer=o,Nt.staticTileLayer=t,Nt.DebugOverlay=x,Nt.debugOverlay=u,Nt.Crosshair=Ct,Nt.crosshair=xt,Nt.FeatureIndexOverlay=Bt,Nt.featureIndexOverlay=wt,Nt.Path=At,Nt.path=Lt,Nt.FeatureRenderer=St,Nt.featureRenderer=vt,Nt.Geometry=Tt,Nt.geometry=Mt}();
//# sourceMappingURL=mapml.js.map