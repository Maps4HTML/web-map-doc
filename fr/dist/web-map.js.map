{"version":3,"file":"web-map.js","sources":["../src/web-map.js"],"sourcesContent":["import './leaflet.js';  // a lightly modified version of Leaflet for use as browser module\nimport './mapml.js';       // refactored URI usage, replaced with URL standard\nimport DOMTokenList from './DOMTokenList.js';\nimport { MapLayer } from './layer.js';\nimport { MapArea } from './map-area.js';\nimport { MapCaption } from './map-caption.js';\n\nexport class WebMap extends HTMLMapElement {\n  static get observedAttributes() {\n    return ['lat', 'lon', 'zoom', 'projection', 'width', 'height', 'controls', 'static', 'controlslist'];\n  }\n  // see comments below regarding attributeChangedCallback vs. getter/setter\n  // usage.  Effectively, the user of the element must use the property, not\n  // the getAttribute/setAttribute/removeAttribute DOM API, because the latter\n  // calls don't result in the getter/setter being called (so you have to use\n  // the getter/setter directly)\n  get controls() {\n    return this.hasAttribute('controls');\n  }\n  set controls(value) {\n    const hasControls = Boolean(value);\n    if (hasControls) {\n      this.setAttribute('controls','');\n    } else {\n      this.removeAttribute('controls');\n    }\n  }\n  get controlsList() {\n    return this._controlsList;\n  }\n  set controlsList(value) {\n    this._controlsList.value = value;\n    this.setAttribute('controlslist', value);\n  }\n  get width() {\n    return (window.getComputedStyle(this).width).replace('px','');\n  }\n  set width(val) {\n    //img.height or img.width setters change or add the corresponding attributes\n    this.setAttribute(\"width\", val);\n  }\n  get height() {\n    return (window.getComputedStyle(this).height).replace('px','');\n  }\n  set height(val) {\n    //img.height or img.width setters change or add the corresponding attributes\n    this.setAttribute(\"height\", val);\n  }\n  get lat() {\n    return this.hasAttribute(\"lat\") ? this.getAttribute(\"lat\") : \"0\";\n  }\n  set lat(val) {\n    if (val) {\n      this.setAttribute(\"lat\", val);\n    }\n  }\n  get lon() {\n    return this.hasAttribute(\"lon\") ? this.getAttribute(\"lon\") : \"0\";\n  }\n  set lon(val) {\n    if (val) {\n      this.setAttribute(\"lon\", val);\n    }\n  }\n  get projection() {\n    return this.hasAttribute(\"projection\") ? this.getAttribute(\"projection\") : \"OSMTILE\";\n  }\n  set projection(val) {\n    if(val && M[val]){\n      this.setAttribute('projection', val);\n      if (this._map && this._map.options.projection !== val){\n        this._map.options.crs = M[val];\n        this._map.options.projection = val;\n        for(let layer of this.querySelectorAll(\"layer-\")){\n          layer.removeAttribute(\"disabled\");\n          let reAttach = this.removeChild(layer);\n          this.appendChild(reAttach);\n        }\n        if(this._debug) for(let i = 0; i<2;i++) this.toggleDebug();\n      } else this.dispatchEvent(new CustomEvent('createmap'));\n    } else throw new Error(\"Undefined Projection\");\n  }\n  get zoom() {\n    return this.hasAttribute(\"zoom\") ? this.getAttribute(\"zoom\") : 0;\n  }\n  set zoom(val) {\n    var parsedVal = parseInt(val,10);\n    if (!isNaN(parsedVal) && (parsedVal >= 0 && parsedVal <= 25)) {\n      this.setAttribute('zoom', parsedVal);\n    }\n  }\n  get layers() {\n    return this.getElementsByTagName('layer-');\n  }\n  get areas() {\n    return this.getElementsByTagName('area');\n  }\n\n  get extent(){\n    let map = this._map,\n      pcrsBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        map.getZoom(),\n        map.options.projection);\n    let formattedExtent = M._convertAndFormatPCRS(pcrsBounds, map);\n    if(map.getMaxZoom() !== Infinity){\n      formattedExtent.zoom = {\n        minZoom:map.getMinZoom(),\n        maxZoom:map.getMaxZoom()\n      };\n    }\n    return (formattedExtent);\n  }\n  get static() {\n    return this.hasAttribute('static');\n  }\n  set static(value) {\n    const isStatic = Boolean(value);\n    if (isStatic)\n      this.setAttribute('static', '');\n    else\n      this.removeAttribute('static');\n  }\n\n  constructor() {\n    // Always call super first in constructor\n    super();\n    this._source = this.outerHTML;\n    // create an array to track the history of the map and the current index\n    this._history = [];\n    this._historyIndex = -1;\n    this._traversalCall = false;\n  }\n  connectedCallback() {\n\n    this._createShadowRoot();\n\n    this._controlsList = new DOMTokenList(\n      this.getAttribute(\"controlslist\"),\n      this, \"controlslist\", \n      [\"noreload\",\"nofullscreen\",\"nozoom\",\"nolayer\",\"noscale\",\"geolocation\"]\n    );\n    \n    // the dimension attributes win, if they're there. A map does not\n    // have an intrinsic size, unlike an image or video, and so must\n    // have a defined width and height.\n    var s = window.getComputedStyle(this),\n      wpx = s.width, hpx=s.height,\n      w = this.hasAttribute(\"width\") ? this.getAttribute(\"width\") : parseInt(wpx.replace('px','')),\n      h = this.hasAttribute(\"height\") ? this.getAttribute(\"height\") : parseInt(hpx.replace('px',''));\n    this._changeWidth(w);\n    this._changeHeight(h);\n\n\n    // wait for createmap event before creating leaflet map\n    // this allows a safeguard for the case where loading a custom TCRS takes \n    // longer than loading mapml-viewer.js/web-map.js\n    // the REASON we need a synchronous event listener (see comment below)\n    // is because the mapml-viewer element has / can have a size of 0 up until after\n    // something that happens between this point and the event handler executing\n    // perhaps a browser rendering cycle??\n    this.addEventListener('createmap', this._createMap);\n\n    let custom = !([\"CBMTILE\",\"APSTILE\",\"OSMTILE\",\"WGS84\"].includes(this.projection));\n    if (!custom) {\t\n      // this is worth a read, because dispatchEvent is synchronous\n      // https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent\n      // In particular:\n      //   \"All applicable event handlers are called and return before dispatchEvent() returns.\"\n      this.dispatchEvent(new CustomEvent('createmap'));\n    }\n    this._toggleStatic();\n    \n    /*\n      1. only deletes aria-label when the last (only remaining) map caption is removed\n      2. only deletes aria-label if the aria-label was defined by the map caption element itself\n    */\n\n    let mapcaption = this.querySelector('map-caption');\n\n    if (mapcaption !== null) {\n      setTimeout(() => {\n        let ariaupdate = this.getAttribute('aria-label');\n\n        if (ariaupdate === mapcaption.innerHTML) {\n          this.mapCaptionObserver = new MutationObserver((m) => {\n            let mapcaptionupdate = this.querySelector('map-caption');\n            if (mapcaptionupdate !== mapcaption) {\n              this.removeAttribute('aria-label');\n            }     \n          });\n          this.mapCaptionObserver.observe(this, {\n            childList: true\n          });\n        }\n      }, 0);\n    }\n  }\n  _createShadowRoot() {\n    let tmpl = document.createElement('template');\n    tmpl.innerHTML = `<link rel=\"stylesheet\" href=\"${new URL(\"mapml.css\", import.meta.url).href}\">`; // jshint ignore:line\n\n    const rootDiv = document.createElement('div');\n    rootDiv.classList.add('mapml-web-map');\n\n    let shadowRoot = rootDiv.attachShadow({mode: 'open'});\n    this._container = document.createElement('div');\n\n    let output = \"<output role='status' aria-live='polite' aria-atomic='true' class='mapml-screen-reader-output'></output>\";\n    this._container.insertAdjacentHTML(\"beforeend\", output);\n\n    // Set default styles for the map element.\n    let mapDefaultCSS = document.createElement('style');\n    mapDefaultCSS.innerHTML =\n    `[is=\"web-map\"] {` +\n    `all: initial;` + // Reset properties inheritable from html/body, as some inherited styles may cause unexpected issues with the map element's components (https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/140).\n    `contain: layout size;` + // Contain layout and size calculations within the map element.\n    `display: inline-block;` + // This together with dimension properties is required so that Leaflet isn't working with a height=0 box by default.\n    `height: 150px;` + // Provide a \"default object size\" (https://github.com/Maps4HTML/HTML-Map-Element/issues/31).\n    `width: 300px;` +\n    `border-width: 2px;` + // Set a default border for contrast, similar to UA default for iframes.\n    `border-style: inset;` +\n    `box-sizing: inherit;` + // https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/350#issuecomment-888361985\n    `}` +\n    `[is=\"web-map\"][frameborder=\"0\"] {` +\n    `border-width: 0;` +\n    `}` +\n    `[is=\"web-map\"][hidden] {` +\n    `display: none!important;` +\n    `}` +\n    `[is=\"web-map\"] .mapml-web-map {` +\n    `display: contents;` + // This div doesn't have to participate in layout by generating its own box.\n    `}`;\n\n    let shadowRootCSS = document.createElement('style');\n    shadowRootCSS.innerHTML =\n    `:host .leaflet-control-container {` +\n    `visibility: hidden!important;` + // Visibility hack to improve percieved performance (mitigate FOUC) â€“ visibility is unset in mapml.css! (https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/154).\n    `}`;\n\n    // Hide all (light DOM) children of the map element except for the\n    // `<area>` and `<div class=\"mapml-web-map\">` (shadow root host) elements.\n    let hideElementsCSS = document.createElement('style');\n    hideElementsCSS.innerHTML =\n    `[is=\"web-map\"] > :not(area):not(.mapml-web-map) {` +\n    `display: none!important;` +\n    `}`;\n    this.appendChild(hideElementsCSS);\n\n    shadowRoot.appendChild(shadowRootCSS);\n    shadowRoot.appendChild(tmpl.content.cloneNode(true));\n    shadowRoot.appendChild(this._container);\n    this.appendChild(rootDiv);\n    document.head.insertAdjacentElement('afterbegin', mapDefaultCSS);\n\n  }\n  _createMap() {\n    if (!this._map) {\n      this._map = L.map(this._container, {\n        center: new L.LatLng(this.lat, this.lon),\n        projection: this.projection,\n        query: true,\n        contextMenu: true,\n        announceMovement: M.options.announceMovement,\n        featureIndex: true,\n        mapEl: this,\n        crs: M[this.projection],\n        zoom: this.zoom,\n        zoomControl: false,\n        // because the M.MapMLLayer invokes _tileLayer._onMoveEnd when\n        // the mapml response is received the screen tends to flash.  I'm sure\n        // there is a better configuration than that, but at this moment\n        // I'm not sure how to approach that issue.\n        // See https://github.com/Maps4HTML/MapML-Leaflet-Client/issues/24\n        fadeAnimation: true\n      });\n      this._addToHistory();\n      // the attribution control is not optional\n      M.attributionControl(this);\n\n      this._createControls();\n      this._toggleControls();\n      this._crosshair = M.crosshair().addTo(this._map);\n\n      if(M.options.featureIndexOverlayOption) this._featureIndexOverlay = M.featureIndexOverlay().addTo(this._map);\n\n      if (this.hasAttribute('name')) {\n        var name = this.getAttribute('name');\n        if (name) {\n          this.poster = document.querySelector('img[usemap='+'\"#'+name+'\"]');\n          // firefox has an issue where the attribution control's use of\n          // _container.innerHTML does not work properly if the engine is throwing\n          // exceptions because there are no area element children of the image map\n          // for firefox only, a workaround is to actually remove the image...\n          if (this.poster) {\n            if (L.Browser.gecko) {\n                this.poster.removeAttribute('usemap');\n            }\n            //this.appendChild(this.poster);\n          }\n        }\n      }\n\n      // undisplay the img in the image map, because it's not needed now.\n      // gives a slight FOUC, unless:\n      // 1) the img is pre-styled (https://github.com/Maps4HTML/Web-Map-Custom-Element/blob/80a4a4e372d2ef61bb7cad6a111e17e396b8e908/index-map-area.html#L35)\n      // 2) placed after the map element\n      if (this.poster) {\n        this.poster.setAttribute('hidden', '');\n      }\n\n      // https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/274\n      this.setAttribute('role', 'application');\n      // Make the Leaflet container element programmatically identifiable\n      // (https://github.com/Leaflet/Leaflet/issues/7193).\n      this._container.setAttribute('role', 'region');\n      this._container.setAttribute('aria-label', 'Interactive map');\n\n      this._setUpEvents();\n    }\n  }\n  disconnectedCallback() {\n    //this._removeEvents();\n    delete this._map;\n  }\n  adoptedCallback() {\n//    console.log('Custom map element moved to new page.');\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n//    console.log('Attribute: ' + name + ' changed from: '+ oldValue + ' to: '+newValue);\n    // \"Best practice\": handle side-effects in this callback\n    // https://developers.google.com/web/fundamentals/web-components/best-practices\n    // https://developers.google.com/web/fundamentals/web-components/best-practices#avoid-reentrancy\n    // note that the example is misleading, since the user can't use\n    // setAttribute or removeAttribute to set the property, they need to use\n    // the property directly in their API usage, which kinda sucks\n    /*\n  const hasValue = newValue !== null;\n  switch (name) {\n    case 'checked':\n      // Note the attributeChangedCallback is only handling the *side effects*\n      // of setting the attribute.\n      this.setAttribute('aria-checked', hasValue);\n      break;\n    ...\n  }     */\n    switch(name) {\n      case 'controlslist':\n        if (this._controlsList) {\n          if (this._controlsList.valueSet === false) {\n            this._controlsList.value = newValue;\n          }\n          this._toggleControls();\n        }\n      break;\n      case 'controls':\n        if (oldValue !== null && newValue === null) {\n          this._hideControls();\n        } else if (oldValue === null && newValue !== null) {\n          this._showControls();\n        } \n      break;\n      case 'height': \n        if (oldValue !== newValue) {\n          this._changeHeight(newValue);\n        }\n      break;  \n      case 'width': \n        if (oldValue !== newValue) {\n          this._changeWidth(newValue);\n        }\n      break;  \n      case 'static':\n        this._toggleStatic();\n      break;  \n    }\n  }\n\n  // Creates All map controls and adds them to the map, when created.\n  _createControls() {\n    let mapSize = this._map.getSize().y,\n          totalSize = 0;\n\n    this._layerControl = M.layerControl(null,{\"collapsed\": true, mapEl: this}).addTo(this._map);\n\n    let scaleValue = M.options.announceScale;\n\n    if (scaleValue === \"metric\") {\n      scaleValue = {\"metric\": true, \"imperial\": false};\n    }\n    if (scaleValue === \"imperial\") {\n      scaleValue = {\"metric\": false, \"imperial\": true};\n    }\n\n    if (!this._scaleBar) this._scaleBar = M.scaleBar(scaleValue).addTo(this._map);\n\n    // Only add controls if there is enough top left vertical space\n    if (!this._zoomControl && (totalSize + 93) <= mapSize){\n      totalSize += 93;\n      this._zoomControl = L.control.zoom().addTo(this._map);\n    }\n    if (!this._reloadButton && (totalSize + 49) <= mapSize){\n      totalSize += 49;\n      this._reloadButton = M.reloadButton().addTo(this._map);\n    }\n    if (!this._fullScreenControl && (totalSize + 49) <= mapSize){\n      totalSize += 49;\n      this._fullScreenControl = M.fullscreenButton().addTo(this._map);\n    }\n\n    if (!this._geolocationButton) {\n      this._geolocationButton = M.geolocationButton().addTo(this._map);\n    }\n  }\n\n  // Sets controls by hiding/unhiding them based on the map attribute\n  _toggleControls() {\n    if (this.controls === false) {\n      this._hideControls();\n      this._map.contextMenu.toggleContextMenuItem(\"Controls\", \"disabled\");\n    } else  {\n      this._showControls();\n      this._map.contextMenu.toggleContextMenuItem(\"Controls\", \"enabled\");\n    }\n  }\n\n  _hideControls() {\n    this._setControlsVisibility(\"fullscreen\",true);\n    this._setControlsVisibility(\"layercontrol\",true);\n    this._setControlsVisibility(\"reload\",true);\n    this._setControlsVisibility(\"zoom\",true);\n    this._setControlsVisibility(\"geolocation\",true);\n    this._setControlsVisibility(\"scale\",true);\n  }\n  _showControls() {\n    this._setControlsVisibility(\"fullscreen\",false);\n    this._setControlsVisibility(\"layercontrol\",false);\n    this._setControlsVisibility(\"reload\",false);\n    this._setControlsVisibility(\"zoom\",false);\n    this._setControlsVisibility(\"geolocation\",true);\n    this._setControlsVisibility(\"scale\",false);\n      \n    // prune the controls shown if necessary\n    // this logic could be embedded in _showControls\n    // but would require being able to iterate the domain of supported tokens\n    // for the controlslist\n    if (this._controlsList) {\n      this._controlsList.forEach((value) => {\n        switch(value.toLowerCase()) {\n          case 'nofullscreen':\n            this._setControlsVisibility(\"fullscreen\",true);\n          break;\n          case 'nolayer':\n            this._setControlsVisibility(\"layercontrol\",true);\n          break;\n          case 'noreload':\n            this._setControlsVisibility(\"reload\",true);\n          break;\n          case 'nozoom':\n            this._setControlsVisibility(\"zoom\",true);\n          break;\n          case 'geolocation':\n            this._setControlsVisibility(\"geolocation\",false);\n          break;\n          case 'noscale':\n            this._setControlsVisibility(\"scale\",true);\n          break;\n        }\n      });\n    }\n    if (this._layerControl && this._layerControl._layers.length === 0) {\n      this._layerControl._container.setAttribute(\"hidden\",\"\");\n    }\n  }\n\n  // Sets the control's visibility AND all its childrens visibility,\n  // for the control element based on the Boolean hide parameter\n  _setControlsVisibility(control, hide) {\n    let container;\n    switch(control) {\n      case \"zoom\":\n        if (this._zoomControl) {\n          container = this._zoomControl._container;\n        }\n        break;\n      case \"reload\":\n        if (this._reloadButton) {\n          container = this._reloadButton._container;\n        }\n        break;\n      case \"fullscreen\":\n        if (this._fullScreenControl) {\n          container = this._fullScreenControl._container;\n        }\n        break;\n      case \"layercontrol\":\n        if (this._layerControl) {\n          container = this._layerControl._container;\n        }\n        break;\n      case \"geolocation\":\n        if (this._geolocationButton) {\n          container = this._geolocationButton._container;\n        }\n        break;\n      case \"scale\":\n        if (this._scaleBar) {\n          container = this._scaleBar._container;\n        }\n        break;  \n    }\n    if (container) {\n      if (hide) {\n        // setting the visibility for all the children of the element\n        [ ...container.children].forEach((childEl) => {\n          childEl.setAttribute(\"hidden\",\"\");\n        });\n        container.setAttribute(\"hidden\",\"\");\n      } else {\n        // setting the visibility for all the children of the element\n        [ ...container.children].forEach((childEl) => {\n          childEl.removeAttribute(\"hidden\");\n        });\n        container.removeAttribute(\"hidden\");\n      }\n    }\n  }\n  _toggleStatic(){\n    const isStatic = this.hasAttribute('static');\n    if (this._map) {\n      if (isStatic) {\n        this._map.dragging.disable();\n        this._map.touchZoom.disable();\n        this._map.doubleClickZoom.disable();\n        this._map.scrollWheelZoom.disable();\n        this._map.boxZoom.disable();\n        this._map.keyboard.disable();\n        this._zoomControl.disable();\n      } else {\n        this._map.dragging.enable();\n        this._map.touchZoom.enable();\n        this._map.doubleClickZoom.enable();\n        this._map.scrollWheelZoom.enable();\n        this._map.boxZoom.enable();\n        this._map.keyboard.enable();\n        this._zoomControl.enable();\n      }\n    }\n  }\n\n  _dropHandler(event) {\n    event.preventDefault();\n    let text = event.dataTransfer.getData(\"text\");\n    M._pasteLayer(this, text);\n  }\n  _dragoverHandler(event) {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = \"copy\";\n  }\n  _removeEvents() {\n    if (this._map) {\n      this._map.off();\n      this.removeEventListener(\"drop\", this._dropHandler, false);\n      this.removeEventListener(\"dragover\", this._dragoverHandler, false);\n    }\n  }\n  _setUpEvents() {\n    this.addEventListener(\"drop\", this._dropHandler, false);\n    this.addEventListener(\"dragover\", this._dragoverHandler, false);\n    this.addEventListener(\"change\",\n    function(e) {\n      if(e.target.tagName === \"LAYER-\"){\n        this.dispatchEvent(new CustomEvent(\"layerchange\", {details:{target: this, originalEvent: e}}));\n      }\n    }, false);\n\n    this.parentElement.addEventListener('keyup', function (e) {\n      if(e.keyCode === 9 && document.activeElement.nodeName === \"MAPML-VIEWER\"){\n        document.activeElement.dispatchEvent(new CustomEvent('mapfocused', {detail:\n              {target: this}}));\n      }\n    });\n    // pasting layer-, links and geojson using Ctrl+V \n    this.addEventListener('keydown', function (e) {\n      if(e.keyCode === 86 && e.ctrlKey){\n        navigator.clipboard\n          .readText()\n          .then(\n            (layer) => {\n              M._pasteLayer(this, layer);\n            });\n      // Prevents default spacebar event on all of web-map\n      } else if (e.keyCode === 32 &&\n                 document.activeElement.shadowRoot.activeElement.nodeName !== \"INPUT\") {\n        e.preventDefault();\n        this._map.fire('keypress', {originalEvent: e});\n      }\n    });\n    this.parentElement.addEventListener('mousedown', function (e) {\n      if(document.activeElement.nodeName === \"MAPML-VIEWER\"){\n        document.activeElement.dispatchEvent(new CustomEvent('mapfocused', {detail:\n              {target: this}}));\n      }\n    });\n\n    this._map.on('locationfound',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('maplocationfound', {detail:\n          {latlng: e.latlng,     accuracy: e.accuracy}\n         }));\n      },this);\n    this._map.on('locationerror',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('locationerror', {detail:\n          {error:e.message}\n        }));\n      },this);\n    this._map.on('load',\n      function () {\n        this.dispatchEvent(new CustomEvent('load', {detail: {target: this}}));\n      }, this);\n    this._map.on('preclick',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('preclick', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('click',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('click', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('dblclick',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('dblclick', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('mousemove',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('mousemove', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('mouseover',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('mouseover', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('mouseout',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('mouseout', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('mousedown',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('mousedown', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      },this);\n    this._map.on('mouseup',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('mouseup', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('contextmenu',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('contextmenu', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('movestart',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(new CustomEvent('movestart', {detail:\n          {target: this}}));\n      }, this);\n    this._map.on('move',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(new CustomEvent('move', {detail:\n          {target: this}}));\n      }, this);\n    this._map.on('moveend',\n      function () {\n        this._updateMapCenter();\n        this._addToHistory();\n        this.dispatchEvent(new CustomEvent('moveend', {detail:\n          {target: this}}));\n      }, this);\n    this._map.on('zoomstart',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(new CustomEvent('zoomstart', {detail:\n          {target: this}}));\n      }, this);\n    this._map.on('zoom',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(new CustomEvent('zoom', {detail:\n          {target: this}}));\n      }, this);\n    this._map.on('zoomend',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(new CustomEvent('zoomend', {detail:\n          {target: this}}));\n      }, this);\n    this.addEventListener('fullscreenchange', function(event) {\n      if (document.fullscreenElement === null) {\n        // full-screen mode has been exited\n        this._map.contextMenu.setViewFullScreenInnerHTML('view');\n      } else {\n        this._map.contextMenu.setViewFullScreenInnerHTML('exit');\n      }\n    });\n    this.addEventListener('keydown', function(event) {\n      if (document.activeElement.className === \"mapml-web-map\") {\n        // Check if Ctrl+R is pressed and map is focused\n        if (event.ctrlKey && event.keyCode === 82) {\n          // Prevent default browser behavior\n          event.preventDefault();\n          this.reload();\n        } else if (event.altKey && event.keyCode === 39) {\n          // Prevent default browser behavior\n          event.preventDefault();\n          this.forward();\n        } else if (event.altKey && event.keyCode === 37) {\n          // Prevent default browser behavior\n          event.preventDefault();\n          this.back();\n        }\n      }\n    });   \n  }\n\n  locate(options) { //options: https://leafletjs.com/reference.html#locate-options\n    if (this._geolocationButton) {\n      this._geolocationButton.stop();\n    }\n    if (options) {\n      if (options.zoomTo) {\n        options.setView = options.zoomTo;\n        delete options.zoomTo;\n      }\n      this._map.locate(options);\n    } else {\n      this._map.locate({setView: true, maxZoom: 16});\n    }\n  }\n\n  toggleDebug(){\n    if(this._debug){\n      this._debug.remove();\n      this._debug = undefined;\n    } else {\n      this._debug = M.debugOverlay().addTo(this._map);\n    }\n  }\n  \n  _changeWidth(width) {\n    if (this._container) {\n      this._container.style.width = width+\"px\";\n      document.querySelector('[is=\"web-map\"]').style.width = width+\"px\";\n    }\n    if (this._map) {\n        this._map.invalidateSize(false);\n    }\n  }\n  _changeHeight(height) {\n    if (this._container) {\n      this._container.style.height = height+\"px\";\n      document.querySelector('[is=\"web-map\"]').style.height = height+\"px\";\n    }\n    if (this._map) {\n        this._map.invalidateSize(false);\n    }\n  }\n  zoomTo(lat, lon, zoom) {\n    zoom = Number.isInteger(+zoom) ? +zoom : this.zoom;\n    let location = new L.LatLng(+lat, +lon);\n    this._map.setView(location, zoom);\n    this.zoom = zoom;\n    this.lat = location.lat;\n    this.lon = location.lng;\n  }\n  _updateMapCenter() {\n    // remember to tell Leaflet event handler that 'this' in here refers to\n    //  something other than the map in this case the custom polymer element\n    this.lat = this._map.getCenter().lat;\n    this.lon = this._map.getCenter().lng;\n    this.zoom = this._map.getZoom();\n  }\n\n  /**\n   * Adds to the maps history on moveends\n   * @private\n   */\n  _addToHistory(){\n    if(this._traversalCall > 0) { // this._traversalCall tracks how many consecutive moveends to ignore from history\n      this._traversalCall--;      // this is useful for ignoring moveends corresponding to back, forward and reload\n      return;\n    }\n\n    let mapLocation = this._map.getPixelBounds().getCenter();\n    let location = {\n      zoom: this._map.getZoom(),\n      x:mapLocation.x,\n      y:mapLocation.y,\n    };\n    this._historyIndex++;\n    this._history.splice(this._historyIndex, 0, location);\n    // Remove future history and overwrite it when map pan/zoom while inside history\n    if (this._historyIndex + 1 !== this._history.length) {\n      this._history.length = this._historyIndex + 1;\n    }\n    if (this._historyIndex === 0) {\n      // when at initial state of map, disable back, forward, and reload items\n      this._map.contextMenu.toggleContextMenuItem(\"Back\", \"disabled\"); // back contextmenu item\n      this._map.contextMenu.toggleContextMenuItem(\"Forward\", \"disabled\");// forward contextmenu item\n      this._map.contextMenu.toggleContextMenuItem(\"Reload\", \"disabled\"); // reload contextmenu item\n      this._reloadButton?.disable();\n    } else {\n      this._map.contextMenu.toggleContextMenuItem(\"Back\", \"enabled\"); // back contextmenu item\n      this._map.contextMenu.toggleContextMenuItem(\"Forward\", \"disabled\");// forward contextmenu item\n      this._map.contextMenu.toggleContextMenuItem(\"Reload\", \"enabled\"); // reload contextmenu item\n      this._reloadButton?.enable();\n    }\n  }\n  /**\n   * Allow user to move back in history\n   */\n  back(){\n    let history = this._history;\n    let curr = history[this._historyIndex];\n\n    if(this._historyIndex > 0){\n      this._map.contextMenu.toggleContextMenuItem(\"Forward\", \"enabled\");// forward contextmenu item\n      this._historyIndex--;\n      let prev = history[this._historyIndex];\n      // Disable back, reload contextmenu item when at the end of history\n      if (this._historyIndex === 0) {\n        this._map.contextMenu.toggleContextMenuItem(\"Back\", \"disabled\"); // back contextmenu item\n        this._map.contextMenu.toggleContextMenuItem(\"Reload\", \"disabled\"); // reload contextmenu item\n        this._reloadButton?.disable();\n      }\n\n      if(prev.zoom !== curr.zoom){\n        this._traversalCall = 2;  // allows the next 2 moveends to be ignored from history\n\n        let currScale = this._map.options.crs.scale(curr.zoom); // gets the scale of the current zoom level\n        let prevScale = this._map.options.crs.scale(prev.zoom); // gets the scale of the previous zoom level\n\n        let scale = currScale / prevScale; // used to convert the previous pixel location to be in terms of the current zoom level\n\n        this._map.panBy([((prev.x * scale) - curr.x), ((prev.y * scale) - curr.y)], {animate: false});\n        this._map.setZoom(prev.zoom);\n      } else {\n        this._traversalCall = 1;\n        this._map.panBy([(prev.x - curr.x), (prev.y - curr.y)]);\n      }\n    }\n  }\n\n  /**\n   * Allows user to move forward in history\n   */\n  forward(){\n    let history = this._history;\n    let curr = history[this._historyIndex];\n    if(this._historyIndex < history.length - 1){\n      this._map.contextMenu.toggleContextMenuItem(\"Back\", \"enabled\"); // back contextmenu item\n      this._map.contextMenu.toggleContextMenuItem(\"Reload\", \"enabled\"); // reload contextmenu item\n      this._reloadButton?.enable();\n      this._historyIndex++;\n      let next = history[this._historyIndex];\n      // disable forward contextmenu item, when at the end of forward history\n      if (this._historyIndex + 1 === this._history.length) {\n        this._map.contextMenu.toggleContextMenuItem(\"Forward\", \"disabled\"); // forward contextmenu item\n      }\n\n      if(next.zoom !== curr.zoom){\n        this._traversalCall = 2; // allows the next 2 moveends to be ignored from history\n\n        let currScale = this._map.options.crs.scale(curr.zoom); // gets the scale of the current zoom level\n        let nextScale = this._map.options.crs.scale(next.zoom); // gets the scale of the next zoom level\n\n        let scale = currScale / nextScale; // used to convert the next pixel location to be in terms of the current zoom level\n\n        this._map.panBy([((next.x * scale) - curr.x), ((next.y * scale) - curr.y)], {animate: false});\n        this._map.setZoom(next.zoom);\n      } else {\n        this._traversalCall = 1;\n        this._map.panBy([(next.x - curr.x), (next.y - curr.y)]);\n      }\n    }\n  }\n\n  /**\n   * Allows the user to reload/reset the map's location to it's initial location\n   */\n  reload(){\n    let initialLocation = this._history.shift();\n    let mapLocation = this._map.getPixelBounds().getCenter();\n    let curr = {\n      zoom: this._map.getZoom(),\n      x:mapLocation.x,\n      y:mapLocation.y,\n    };\n\n    this._map.contextMenu.toggleContextMenuItem(\"Back\", \"disabled\"); // back contextmenu item\n    this._map.contextMenu.toggleContextMenuItem(\"Forward\", \"disabled\");// forward contextmenu item\n    this._map.contextMenu.toggleContextMenuItem(\"Reload\", \"disabled\"); // reload contextmenu item\n    this._reloadButton?.disable();\n\n    this._history = [initialLocation];\n    this._historyIndex = 0;\n\n    if(initialLocation.zoom !== curr.zoom) {\n      this._traversalCall = 2; // ignores the next 2 moveend events\n\n      let currScale = this._map.options.crs.scale(curr.zoom); // gets the scale of the current zoom level\n      let initScale = this._map.options.crs.scale(initialLocation.zoom); // gets the scale of the initial location's zoom\n\n      let scale = currScale / initScale;\n\n      this._map.panBy([((initialLocation.x * scale) - curr.x), ((initialLocation.y * scale) - curr.y)], {animate: false});\n      this._map.setZoom(initialLocation.zoom);\n    } else { // if it's on the same zoom level as the initial location, no need to calculate scales\n      this._traversalCall = 1;\n      this._map.panBy([(initialLocation.x- curr.x), (initialLocation.y - curr.y)]);\n    }\n  }\n\n  _toggleFullScreen(){\n    this._map.toggleFullscreen();\n  }\n  \n  viewSource(){\n    let blob = new Blob([this._source],{type:\"text/plain\"}),\n        url = URL.createObjectURL(blob);\n    window.open(url);\n    URL.revokeObjectURL(url);\n  }\n\n  defineCustomProjection(jsonTemplate) {\n    let t = JSON.parse(jsonTemplate);\n    if (t === undefined || !t.proj4string || !t.projection || !t.resolutions || !t.origin || !t.bounds) throw new Error('Incomplete TCRS Definition');\n    if (t.projection.indexOf(\":\") >= 0) throw new Error('\":\" is not permitted in projection name');\n    if (M[t.projection.toUpperCase()]) return t.projection.toUpperCase();\n    let tileSize = [256, 512, 1024, 2048, 4096].includes(t.tilesize)?t.tilesize:256;\n\n    M[t.projection] = new L.Proj.CRS(t.projection, t.proj4string, {\n      origin: t.origin,\n      resolutions: t.resolutions,\n      bounds: L.bounds(t.bounds),\n      crs: {\n        tcrs: {\n          horizontal: {\n            name: \"x\",\n            min: 0, \n            max: zoom => (Math.round(M[t.projection].options.bounds.getSize().x / M[t.projection].options.resolutions[zoom]))\n          },\n          vertical: {\n            name: \"y\",\n            min:0, \n            max: zoom => (Math.round(M[t.projection].options.bounds.getSize().y / M[t.projection].options.resolutions[zoom]))\n          },\n          bounds: zoom => L.bounds([M[t.projection].options.crs.tcrs.horizontal.min,\n            M[t.projection].options.crs.tcrs.vertical.min],\n            [M[t.projection].options.crs.tcrs.horizontal.max(zoom),\n            M[t.projection].options.crs.tcrs.vertical.max(zoom)])\n        },\n        pcrs: {\n          horizontal: {\n            name: \"easting\",\n            get min() {return M[t.projection].options.bounds.min.x;},\n            get max() {return M[t.projection].options.bounds.max.x;}\n          }, \n          vertical: {\n            name: \"northing\", \n            get min() {return M[t.projection].options.bounds.min.y;},\n            get max() {return M[t.projection].options.bounds.max.y;}\n          },\n          get bounds() {return M[t.projection].options.bounds;}\n        }, \n        gcrs: {\n          horizontal: {\n            name: \"longitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            get min() {return M[t.projection].unproject(M.OSMTILE.options.bounds.min).lng;},\n            get max() {return M[t.projection].unproject(M.OSMTILE.options.bounds.max).lng;}\n          }, \n          vertical: {\n            name: \"latitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            get min() {return M[t.projection].unproject(M.OSMTILE.options.bounds.min).lat;},\n            get max() {return M[t.projection].unproject(M.OSMTILE.options.bounds.max).lat;}\n          },\n          get bounds() {return L.latLngBounds(\n                [M[t.projection].options.crs.gcrs.vertical.min,M[t.projection].options.crs.gcrs.horizontal.min],\n                [M[t.projection].options.crs.gcrs.vertical.max,M[t.projection].options.crs.gcrs.horizontal.max]);}\n        },\n        map: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: map => map.getSize().x\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: map => map.getSize().y\n          },\n          bounds: map => L.bounds(L.point([0,0]),map.getSize())\n        },\n        tile: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: tileSize,\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: tileSize,\n          },\n          get bounds() {return L.bounds(\n                    [M[t.projection].options.crs.tile.horizontal.min,M[t.projection].options.crs.tile.vertical.min],\n                    [M[t.projection].options.crs.tile.horizontal.max,M[t.projection].options.crs.tile.vertical.max]);}\n        },\n        tilematrix: {\n          horizontal: {\n            name: \"column\",\n            min: 0,\n            max: zoom => (Math.round(M[t.projection].options.crs.tcrs.horizontal.max(zoom) / M[t.projection].options.crs.tile.bounds.getSize().x))\n          },\n          vertical: {\n            name: \"row\",\n            min: 0,\n            max: zoom => (Math.round(M[t.projection].options.crs.tcrs.vertical.max(zoom) / M[t.projection].options.crs.tile.bounds.getSize().y))\n          },\n          bounds: zoom => L.bounds(\n                   [M[t.projection].options.crs.tilematrix.horizontal.min,\n                   M[t.projection].options.crs.tilematrix.vertical.min],\n                   [M[t.projection].options.crs.tilematrix.horizontal.max(zoom),\n                   M[t.projection].options.crs.tilematrix.vertical.max(zoom)])\n        }\n      },\n    });      //creates crs using L.Proj\n    M[t.projection.toUpperCase()] = M[t.projection]; //adds the projection uppercase to global M\n    return t.projection;\n  }\n\n  geojson2mapml(json, options = {}){\n    if (options.projection === undefined) {\n      options.projection = this.projection;\n    }\n    let geojsonLayer = M.geojson2mapml(json, options);\n    this.appendChild(geojsonLayer);\n    return geojsonLayer;\n  }\n\n  _ready() {\n    if (this.hasAttribute('name')) {\n      var name = this.getAttribute('name');\n      if (name) {\n        this.poster = document.querySelector('img[usemap='+'\"#'+name+'\"]');\n        // firefox has an issue where the attribution control's use of\n        // _container.innerHTML does not work properly if the engine is throwing\n        // exceptions because there are no area element children of the image map\n        // for firefox only, a workaround is to actually remove the image...\n        if (this.poster) {\n          if (L.Browser.gecko) {\n            this.poster.removeAttribute('usemap');\n          }\n          this._container.appendChild(this.poster);\n        }\n      }\n    }\n  }\n}\n// need to provide options { extends: ... }  for custom built-in elements\nwindow.customElements.define('web-map', WebMap,  { extends: 'map' });\nwindow.customElements.define('layer-', MapLayer);\nwindow.customElements.define('map-area', MapArea, {extends: 'area'});\nwindow.customElements.define('map-caption',MapCaption);\n"],"names":["DOMTokenList","MapLayer","MapArea","MapCaption","WebMap","HTMLMapElement","observedAttributes","controls","this","hasAttribute","value","Boolean","setAttribute","removeAttribute","controlsList","_controlsList","width","window","getComputedStyle","replace","val","height","lat","getAttribute","lon","projection","M","Error","_map","options","crs","let","layer","querySelectorAll","reAttach","removeChild","appendChild","_debug","i","toggleDebug","dispatchEvent","CustomEvent","zoom","parsedVal","parseInt","isNaN","layers","getElementsByTagName","areas","extent","map","pcrsBounds","pixelToPCRSBounds","getPixelBounds","getZoom","formattedExtent","_convertAndFormatPCRS","getMaxZoom","Infinity","minZoom","getMinZoom","maxZoom","static","constructor","super","_source","outerHTML","_history","_historyIndex","_traversalCall","connectedCallback","_createShadowRoot","s","wpx","hpx","w","h","_changeWidth","_changeHeight","addEventListener","_createMap","includes","_toggleStatic","mapcaption","querySelector","setTimeout","innerHTML","mapCaptionObserver","MutationObserver","observe","childList","tmpl","document","createElement","URL","import","meta","url","href","rootDiv","classList","add","shadowRoot","attachShadow","mode","_container","insertAdjacentHTML","mapDefaultCSS","shadowRootCSS","hideElementsCSS","content","cloneNode","head","insertAdjacentElement","name","L","center","LatLng","query","contextMenu","announceMovement","featureIndex","mapEl","zoomControl","fadeAnimation","_addToHistory","attributionControl","_createControls","_toggleControls","_crosshair","crosshair","addTo","featureIndexOverlayOption","_featureIndexOverlay","featureIndexOverlay","poster","Browser","gecko","_setUpEvents","disconnectedCallback","adoptedCallback","attributeChangedCallback","oldValue","newValue","valueSet","_hideControls","_showControls","mapSize","getSize","y","totalSize","_layerControl","layerControl","collapsed","scaleValue","announceScale","metric","imperial","_scaleBar","scaleBar","_zoomControl","control","_reloadButton","reloadButton","_fullScreenControl","fullscreenButton","_geolocationButton","geolocationButton","toggleContextMenuItem","_setControlsVisibility","forEach","toLowerCase","_layers","length","hide","container","children","childEl","isStatic","dragging","disable","touchZoom","doubleClickZoom","scrollWheelZoom","boxZoom","keyboard","enable","_dropHandler","event","preventDefault","text","dataTransfer","getData","_pasteLayer","_dragoverHandler","dropEffect","_removeEvents","off","removeEventListener","e","target","tagName","details","originalEvent","parentElement","keyCode","activeElement","nodeName","detail","ctrlKey","navigator","clipboard","readText","then","fire","on","latlng","accuracy","error","message","lng","x","containerPoint","_updateMapCenter","fullscreenElement","setViewFullScreenInnerHTML","className","reload","altKey","forward","back","locate","stop","zoomTo","setView","remove","undefined","debugOverlay","style","invalidateSize","Number","isInteger","location","getCenter","mapLocation","splice","prev","history","curr","scale","panBy","animate","setZoom","next","initialLocation","shift","_toggleFullScreen","toggleFullscreen","viewSource","blob","Blob","type","createObjectURL","open","revokeObjectURL","defineCustomProjection","jsonTemplate","t","JSON","parse","proj4string","resolutions","origin","bounds","indexOf","toUpperCase","tileSize","tilesize","Proj","CRS","tcrs","horizontal","min","max","Math","round","vertical","pcrs","gcrs","unproject","OSMTILE","latLngBounds","point","tile","tilematrix","geojson2mapml","json","geojsonLayer","_ready","customElements","define","extends"],"mappings":"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"}