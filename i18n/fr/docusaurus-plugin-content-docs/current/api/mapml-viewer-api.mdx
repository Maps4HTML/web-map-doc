---
id: mapml-viewer-api
title: "HTMLMapmlViewerElement"
slug: /api/mapml-viewer-api
---

# HTMLMapmlViewerElement

L’interface HTMLMapmlViewerElement représente l’élément `<mapml-viewer>`.

## Propriétés


| Nom de la propriété      	| Description                                          	|
|--------------	|--------------------------------------------------------	|
| [controls](#controls)     	| Active ou désactive les contrôles natifs de la carte. Reproduit l’attribut controls.    	|
| [controlsList](#controlslist) 	| Permet de changer l’ensemble des contrôles natifs. Reproduit l’attribut controlslist. 	|
| [extent](#extent)       	| Retourne l’étendue de la carte affichée. En lecture seule.           	|
| [lat](#lat)          	| Permet d’obtenir la latitude de la carte. Reproduit l’attribut lat. En lecture seule.        	|
| [lon](#lon)          	| Permet d’obtenir la longitude de la carte. Reproduit l’attribut lon. En lecture seule.        	|
| [projection](#projection)   	| Projection de la carte. Reproduit l’attribut projection.       	|
| [zoom](#zoom)   	| Niveau de zoom de la carte. Reproduit l’attribut zoom.      	|

### controls

Pour ajouter des contrôles à la carte :
```js
let map = document.querySelector('mapml-viewer');
map.controls = true; // ou false pour supprimer des contrôles
```

Pour vérifier si les contrôles de la carte sont activés ou désactivés :
```js
let map = document.querySelector('mapml-viewer');
let controlsAdded = map.controls;
```

---

### controlsList

La propriété `controlsList` renvoie une [DomTokenList](https://developer.mozilla.org/fr/docs/Web/API/DOMTokenList)
qui aide l'utilisateur à sélectionner les contrôles à afficher sur l'élément `mapml-viewer` en fonction des [valeurs possibles](../elements/mapml-viewer/#controlslist).

Pour définir l’attribut controlslist :
```js
let map = document.querySelector('mapml-viewer');
map.controlsList.value = "noreload nozoom"; // les valeurs peuvent être noreload | nofullscreen | nozoom | nolayer
map.controlsList.add("nofullscreen"); // peut également être ajouté à l'aide de la méthode 'add'
map.controlsList.toggle("nolayer"); // peut également être basculé à l'aide de la méthode 'toggle.
// Voir toutes les méthodes ici - https://developer.mozilla.org/fr/docs/Web/API/DOMTokenList
```

Pour obtenir la valeur de controlslist :
```js
let map = document.querySelector('mapml-viewer');
let controlsList = map.controlsList.value;
```

---

### extent

Pour obtenir l’étendue de la carte :

```js
let map = document.querySelector('mapml-viewer');
let extent = map.extent;
```
<details>
<summary>Afficher un exemple d’étendue</summary>

```js
/**
*extent = 
*  {
*    {
*      "topLeft": {
*        "tcrs": [
*          {
*            "horizontal": 906.7586206896551,
*            "vertical": 981.7241379310345
*          },
*          ...
*        ],
*        "tilematrix": [
*          {
*            "horizontal": 3.5420258620689653,
*            "vertical": 3.8348599137931036
*          },
*          ...
*        ],
*        "gcrs": {
*          "horizontal": -93.05456518322721,
*          "vertical": 63.783997873304855
*        },
*        "pcrs": {
*          "horizontal": 131686.24163915217,
*          "vertical": 1646487.1729743406
*        }
*      },
*      "bottomRight": {
*        "tcrs": [
*          {
*            "horizontal": 914.9655172413793,
*            "vertical": 1015.5172413793102
*          },
*          ...
*        ],
*        "tilematrix": [
*          {
*            "horizontal": 3.574084051724138,
*            "vertical": 3.9668642241379306
*          },
*          ...
*        ],
*        "gcrs": {
*          "horizontal": -85.62509797700041,
*          "vertical": 52.14641630380798
*        },
*        "pcrs": {
*          "horizontal": 446541.0380154103,
*          "vertical": 350026.2467191592
*        }
*      },
*      "projection": "CBMTILE",
*      "zoom": {
*        "minZoom": 0,
*        "maxZoom": 25
*      }
*    }
*  }
*/
```
</details>

---

### lat

Pour définir la latitude : 

:::caution
[À mettre en œuvre](https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/588), à l’heure actuelle, n’effectue pas de mouvements panoramiques vers les modifications de la carte
:::

```js
let map = document.querySelector('mapml-viewer');
map.lat = 21.4; // rien ne se produit si la valeur n’est pas valide
```

Pour obtenir la latitude :
```js
let map = document.querySelector('mapml-viewer');
let latitude = map.lat;
```

---

### lon

Pour définir la longitude :

:::caution
[À mettre en œuvre](https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/588), à l’heure actuelle, n’effectue pas de mouvements panoramiques vers les modifications de la carte
:::

```js
let map = document.querySelector('mapml-viewer');
map.lon = 21.4; // rien ne se produit si la valeur n’est pas valide
```

Pour obtenir la longitude :
```js
let map = document.querySelector('mapml-viewer');
let longitude = map.lon;
```

---

### projection

Pour fixer ou modifier la projection:

```js
let map = document.querySelector('mapml-viewer');
map.projection = "CBMTILE"; // rien ne se produit si la projection n’est pas valide ou définie
```

Pour obtenir la projection :
```js
let map = document.querySelector('mapml-viewer');
let projection = map.projection;
```

---

### zoom

Pour définir le niveau de zoom :

:::caution
[À mettre en œuvre](https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/588), à l’heure actuelle, n’effectue pas un zoom sur les changements apportés à la carte
:::

```js
let map = document.querySelector('mapml-viewer');
map.zoom = 3; // rien ne se produit si la valeur n’est pas valide
```

Pour obtenir la longitude :
```js
let map = document.querySelector('mapml-viewer');
let zoom = map.zoom;
```

---

## Méthodes

| Méthode                   	| Description                                                        	|
|--------------------------	|----------------------------------------------------------------------	|
| [back()](#back)                   	| Revient à l’état précédent dans l’historique des mouvements de la carte.                         	|
| [forward()](#forward)                	| Passe au mouvement panoramique suivant dans l’historique de la carte.                      	|
| [reload()](#reload)                 	| Efface l’historique des mouvements panoramiques de la carte et retourne à l’emplacement de départ. 	|
| [toggleDebug()](#toggledebug)            	| Active ou désactive le débogage de la carte.                           	|
| [viewSource()](#viewsource)             	| Affiche la source de la carte.                                          	|
| [defineCustomProjection()](../api/custom-projections) 	| Définit une [projection personnalisée](../api/custom-projections) for use by the page.                                       	|
| [zoomTo(lat, lon, zoom)](#zoomtolat-lon-zoom) | Survole la carte ou effectue un mouvement panoramique vers un (nouvel) emplacement et à un autre niveau de zoom.|
| [geojson2mapml(json, options)](#zoomtolat-lon-zoom) | Convertit une caractéristique GeoJSON ou une chaîne ou un objet de collection de caractéristiques en élément MapML `<layer->` contenant un ou plusieurs éléments `<map-feature>`. |


### back()

Pour reculer dans l’historique de la carte :
```js
let map = document.querySelector('mapml-viewer');
map.back();
```

---

### forward()

Pour avancer dans l’historique de la carte :
```js
let map = document.querySelector('mapml-viewer');
map.forward();
```

---

### reload()

Pour effacer l’historique de la carte et retourner à l’emplacement initial :
```js
let map = document.querySelector('mapml-viewer');
map.reload();
```

---

### toggleDebug()

Pour activer ou désactiver le débogage de la carte :
```js
let map = document.querySelector('mapml-viewer');
map.toggleDebug();
```

---

### viewSource()

Pour afficher la source de la carte affichée :
```js
let map = document.querySelector('mapml-viewer');
map.viewSource();
```

---

### zoomTo(lat, lon, zoom)

Pour déplacer le centre de la carte et modifier le niveau de zoom :

```js
var options = {
  enableHighAccuracy: true,
  timeout: 5000,
  maximumAge: 0
};

function success(pos) {
  var crd = pos.coords;

  let map = document.querySelector('mapml-viewer');
  map.zoomTo(crd.latitude,crd.longitude, 17); // zoom codé en dur
  // peut calculer le niveau de zoom en fonction du degré de précision de la position
  console.log(`Plus ou moins ${crd.accuracy} mètres.`);
}

function error(err) {
  console.warn(`ERROR(${err.code}): ${err.message}`);
}

navigator.geolocation.getCurrentPosition(success, error, options);
```

---

### geojson2mapml(json, options)

Convertit une caractéristique GeoJSON ou une chaîne ou un objet de collection de caractéristiques en élément MapML `<layer->` contenant un ou plusieurs éléments `<map-feature>`.

:::tip

Jetez un coup d’œil à [cette application](https://maps4html.org/experiments/api/custom-map-ui/geoname-search-ui.html) au moyen de l’API geojson2mapml!

:::

#### Paramètres


| Paramètre | Description |
|------|---------------------|
| <String&nbsp;\|&nbsp;Object>&nbsp;json | Chaîne ou objet GeoJSON |
| Options &ltObject&gt | Ensemble de paires de clés ou de valeurs qui personnalise la couche de sortie MapML. Toutes les options sont facultatives et décrites ci-après. |

#### Options

&ltObject&gt Ensemble de paires de clés ou de valeurs qui personnalise la couche de sortie MapML. Toutes les options sont facultatives et décrites ci-après.

| Option | Type | Default | Description |
|------|------|---------------|--------|
| `label` | <String\> | `json.name`, `json.title` ou "Layer" | Définit la [label](https://maps4html.org/web-map-doc/docs/layers/layer/#label) de la couche de sortie. |
| `projection` |  <String\> | `OSMTILE` | Définit la [projection](https://maps4html.org/web-map-doc/docs/elements/mapml-viewer/#projection) de la couche de sortie. Les valeurs définies incluent : `OSMTILE`, `CBMTILE`, `WGS84`, and `APSTILE`.|
| `caption` | <String&nbsp;\|&nbsp;Function\> | Utilise la valeur `label` | Fonction qui accepte la caractéristique JSON et retourne une chaîne, OU une chaîne qui est le nom d’une propriété à mapper sur [featurecaption](https://maps4html.org/web-map-doc/docs/elements/feature/#map-featurecaption). Si aucune propriété associée n’est trouvée, la chaîne fournie sert de valeur de la légende de la caractéristique. Voir la section [Utilisation des options de base](#basic-options-usage) pour un exemple. |
| <span id="option-properties">`properties`</span> | <Function&nbsp;\|&nbsp;String&nbsp;\|&nbsp;HTMLElement\> | _Les propriétés seront mappées à un [table](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/table) HTML._ | Précise la façon dont les propriétés sont mappées. <Function\> - Fonction qui accepte un argument – l’objet GeoJSON feature – et qui doit retourner un HTMLElement qui devient l’unique élément-enfant de <properties\>. <String\> - Chaîne qui sera analysée syntaxiquement et utilisée comme unique élément-enfant de `<properties>` avec toutes les caractéristiques. <HTMLElement\> - Élément qui servira d’unique élément- enfant de `<properties>` avec toutes les caractéristiques. Voir la section [utilisation des options de base](#basic-options-usage) pour un exemple.|
| `geometryFunction` | <Function\> | La géométrie _MapML reproduit la valeur géométrique GeoJSON_ | <Function\> Fonction pour modifier les [descendants générés](https://maps4html.org/web-map-doc/docs/elements/geometry/#child-elements) de `<map-geometry>` qui peut ajouter des classes, [hyperlinks](https://maps4html.org/web-map-doc/docs/other-elements/map-a/) et des [spans](https://maps4html.org/web-map-doc/docs/other-elements/span/) à l’instance. Un élément `<map-geometry>` simple est créé par défaut. La fonction accepte deux arguments : l’[élément-enfant généré](https://maps4html.org/web-map-doc/docs/elements/geometry/#child-elements) de `<map-geometry>` et [l’objet de la caractéristique JSON](https://www.rfc-editor.org/rfc/rfc7946#section-3.2) pour retourner un élément-enfant modifié de `<map-geometry>`. Voir la section [Utilisation des options de base](#basic-options-usage) pour un exemple. |

---
## Événements

| Nom de l’événement      	| Description                                          	|
|--------------	|--------------------------------------------------------	|
| layerchange   | Déclenché lorsqu’une couche change de src, habituellement lorsque l’utilisateur clique sur un lien. |
| load          | Déclenché après que le contenu de toutes les couches a été chargé |
| click         | Déclenché lorsque la carte reçoit les événements mousedown et mouseup |
| dblclick      | Déclenché lorsque l’utilisateur double-clique sur la carte ou touche celle-ci |
| mousemove     | Déclenché à répétition lorsque le pointeur de la souris est déplacé sur la carte |
| mouseover     | Déclenché une fois lorsque le pointeur de la souris est placé sur la carte |
| mouseout      | Déclenché une fois lorsque le pointeur de la souris sort de la carte |
| mousedown     | Déclenché lorsque l’utilisateur appuie sur le bouton principal de la souris alors que le pointeur de la souris se trouve sur la carte |
| mouseup       | Déclenché lorsque l’utilisateur relâche le bouton principal de la souris alors que le pointeur de la souris se trouve sur la carte |
| movestart     | Déclenché avant que la carte commence à bouger ou que la fenêtre d’affichage change |
| move          | Déclenché à répétition lorsque la carte bouge                           |
| moveend       | Déclenché lorsque la carte ne bouge plus |
| zoomstart     | Déclenché avant que le niveau de zoom de la carte change |
| zoom          | Déclenché à répétition lorsque le niveau de zoom de la carte change |
| zoomend       | Déclenché après que le niveau de zoom de la carte a changé |
| preclick      | Déclenché avant que l’utilisateur clique sur la carte  |
| contextmenu   | Déclenché lorsque l’utilisateur fait un clic droit sur la carte ou touche celle-ci |

---
## Exemples

### geojson2mapml

#### Utilisation des options de base

Utilisation de chaque option en contexte

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
<TabItem value="label" label="label">

```js title="option d’étiquette geojson2mapml"
geojson2mapml(json, {label: "Centre-ville d’Ottawa"});
```

</TabItem>
<TabItem value="projection" label="projection">

```js title="geojson2mapml projection option"
geojson2mapml(json, {projection: "CBMTILE"});
```

</TabItem>
<TabItem value="caption" label="caption">

```js title="option de légende geojson2mapml – valeur contenant une fonction"
// fonction de légende
geojson2mapml(json, {caption: function(feature) {
    return feature.properties.desc + ", not a Polygon";
    }
});
// valeur de la chaîne de l’option de légende qui renvoie à un nom de propriété
geojson2mapml(json, {caption: "desc"});
```

</TabItem>
<TabItem value="properties" label="properties">

```js title="geojson2mapml properties option - function-valued"
// fonction de propriétés
geojson2mapml(json, {properties: function(feature) {
    let parser = new DOMParser();
    return parser.parseFromString("<h1>" + feature.properties.desc + "propriété de</h1>", "text/html").body.firstChild;
    }
});
// option de propriétés – valeur contenant une chaîne – assurez-vous de nettoyer les chaînes fournies par les utilisateurs
geojson2mapml(json, {properties: "<p>Cette propriété a été ajoutée à l’aide d’une chaîne de propriétés </p>"});
```

</TabItem>
<TabItem value="geometryFunction" label="geometryFunction">

```js title="geojson2mapml geometryFunction option"
let options = {
                geometryFunction: function (g, f) {
                  g.setAttribute("class", f.properties.class);
                  return g;}
              };
geojson2mapml(json, options);
```

</TabItem>
</Tabs>

#### Chaîne d’options
Exemple montrant comment utiliser des chaînes pour définir les options `label`, `projection`, `caption` et `properties`.
```js
let map = document.querySelector('mapml-viewer');
let json = {
    "name": "Nom par défaut",
    "type": "Feature",
    "geometry": {
        "type": "Point",
        "coordinates": [-75.6916809,45.4186964]
    },
    "properties": {"desc": "Ceci est un point"}
};

// GeoJSON à MapML
let output = map.geojson2mapml(json, {label: "Exemple 1", projection: "CBMTILE", caption: "desc", properties: "<h3>Ceci est un en-tête de propriété</h3>"});
```

<details>
<summary>Cliquez pour afficher la sortie HTMLElement</summary>

``` html
<layer- label="Example 1" checked="">
   <map-meta name="projection" content="CBMTILE"></map-meta>
   <map-meta name="cs" content="gcrs"></map-meta>
   <map-feature>
      <map-featurecaption>Ceci est un point</map-featurecaption>
      <map-geometry>
         <map-point>
            <map-coordinates>-75.6916809 45.4186964</map-coordinates>
         </map-point>
      </map-geometry>
      <map-properties>
         <h3>Ceci est un en-tête de propriété</h3>
      </map-properties>
   </map-feature>
</layer->
```

</details> 

#### Fonction d’options
Exemple montrant comment les fonctions peuvent servir à définir les options `caption` et `properties`.
```js
let map = document.querySelector('mapml-viewer');
let json = {
    "name": "Nom par défaut",
    "type": "Feature",
    "geometry": {
        "type": "Point",
        "coordinates": [-75.6916809,45.4186964]
    },
    "properties": {"desc": "Ceci est un point"}
};

// function to set caption
let cap = function c(j) {
  let str = "Ce point se trouve à : (" + j.geometry.coordinates[0] + ", " + j.geometry.coordinates[1] + ").";
  return str;
}

// fonction pour définir des propriétés
let prop = function f(p) {
  let parser = new DOMParser();
  return parser.parseFromString("<h1>" + p.properties.desc + "'s property</h1>", "text/html").body.firstChild;
}

// GeoJSON à MapML
let output = map.geojson2mapml(json, {label: "Exemple 2", caption: cap, properties: prop});
```

<details>
<summary>Cliquez pour afficher la sortie HTMLElement</summary>

``` html
<layer- label="Example 2" checked="">
   <map-meta name="projection" content="OSMTILE"></map-meta>
   <map-meta name="cs" content="gcrs"></map-meta>
   <map-feature>
      <map-featurecaption>Ce point se trouve à : (-75.6916809, 45.4186964).</map-featurecaption>
      <map-geometry>
         <map-point>
            <map-coordinates>-75.6916809 45.4186964</map-coordinates>
         </map-point>
      </map-geometry>
      <map-properties>
         <h1>Ceci est une propriété du point</h1>
      </map-properties>
   </map-feature>
</layer->
```

</details> 

#### Options par défaut
Exemple montrant la sortie par défaut lorsqu’aucune option n’est fournie.
```js
let map = document.querySelector('mapml-viewer');
let json = {
 "title": "Géométrie du point",
 "bbox": [-75.916809, 45.886964, -75.516809, 45.26964],
 "type": "FeatureCollection",
 "features": [{
     "type": "Feature",
     "geometry": {
         "type": "Point",
         "coordinates": [-75.6916809, 45.4186964]
     },
     "properties": {
         "prop0": "Ceci est un point"
     }
 }]
};

// GeoJSON à MapML
let output = map.geojson2mapml(json);
```

<details>
<summary>Cliquez pour afficher la sortie HTMLElement</summary>

``` html
<layer- label="Géométrie du point" checked="">
   <map-meta name="extent" content="top-left-longitude=-75.916809, top-left-latitude=45.886964, bottom-right-longitude=-75.516809,bottom-right-latitude=45.26964"></map-meta>
   <map-meta name="projection" content="OSMTILE"></map-meta>
   <map-meta name="cs" content="gcrs"></map-meta>
   <map-feature>
      <map-featurecaption>Géométrie du point</map-featurecaption>
      <map-geometry>
         <map-point>
            <map-coordinates>-75.6916809 45.4186964</map-coordinates>
         </map-point>
      </map-geometry>
      <map-properties>
         <table>
            <thead>
               <tr>
                  <th role="columnheader" scope="col">Property name</th>
                  <th role="columnheader" scope="col">Property value</th>
               </tr>
            </thead>
            <tbody>
               <tr>
                  <th scope="row">prop0</th>
                  <td itemprop="prop0">This is a Point</td>
               </tr>
            </tbody>
         </table>
      </map-properties>
   </map-feature>
</layer->
```

</details> 

---
