{"version":3,"file":"mapml.js","sources":["mapml.js"],"sourcesContent":["(function () {\n  'use strict';\n\n  var StaticTileLayer = L.GridLayer.extend({\n    initialize: function (options) {\n      this.zoomBounds = this._getZoomBounds(\n        options.tileContainer,\n        options.maxZoomBound\n      );\n      L.extend(options, this.zoomBounds);\n      L.setOptions(this, options);\n      this._groups = this._groupTiles(\n        this.options.tileContainer.getElementsByTagName('map-tile')\n      );\n    },\n\n    onAdd: function () {\n      this._bounds = this._getLayerBounds(\n        this._groups,\n        this._map.options.projection\n      ); //stores meter values of bounds\n      this.layerBounds = this._bounds[Object.keys(this._bounds)[0]];\n      for (let key of Object.keys(this._bounds)) {\n        this.layerBounds.extend(this._bounds[key].min);\n        this.layerBounds.extend(this._bounds[key].max);\n      }\n      L.GridLayer.prototype.onAdd.call(this, this._map);\n      this._handleMoveEnd();\n    },\n\n    getEvents: function () {\n      let events = L.GridLayer.prototype.getEvents.call(this, this._map);\n      this._parentOnMoveEnd = events.moveend;\n      events.moveend = this._handleMoveEnd;\n      events.move = () => {}; //needed to prevent moveend from running\n      return events;\n    },\n\n    //sets the bounds flag of the layer and calls default moveEnd if within bounds\n    //its the zoom level is between the nativeZoom and zoom then it uses the nativeZoom value to get the bound its checking\n    _handleMoveEnd: function (e) {\n      let mapZoom = this._map.getZoom();\n      let zoomLevel = mapZoom;\n      zoomLevel =\n        zoomLevel > this.options.maxNativeZoom\n          ? this.options.maxNativeZoom\n          : zoomLevel;\n      zoomLevel =\n        zoomLevel < this.options.minNativeZoom\n          ? this.options.minNativeZoom\n          : zoomLevel;\n      this.isVisible =\n        mapZoom <= this.zoomBounds.maxZoom &&\n        mapZoom >= this.zoomBounds.minZoom &&\n        this._bounds[zoomLevel] &&\n        this._bounds[zoomLevel].overlaps(\n          M.pixelToPCRSBounds(\n            this._map.getPixelBounds(),\n            this._map.getZoom(),\n            this._map.options.projection\n          )\n        );\n      if (!this.isVisible) return; //onMoveEnd still gets fired even when layer is out of bounds??, most likely need to overrride _onMoveEnd\n      this._parentOnMoveEnd();\n    },\n\n    _isValidTile(coords) {\n      return this._groups[this._tileCoordsToKey(coords)];\n    },\n\n    createTile: function (coords) {\n      let tileGroup = this._groups[this._tileCoordsToKey(coords)] || [],\n        tileElem = document.createElement('map-tile'),\n        tileSize = this.getTileSize();\n      tileElem.setAttribute('col', coords.x);\n      tileElem.setAttribute('row', coords.y);\n      tileElem.setAttribute('zoom', coords.z);\n\n      for (let i = 0; i < tileGroup.length; i++) {\n        let tile = document.createElement('img');\n        tile.width = tileSize.x;\n        tile.height = tileSize.y;\n        tile.alt = '';\n        tile.setAttribute('role', 'presentation');\n        tile.src = tileGroup[i].src;\n        tileElem.appendChild(tile);\n      }\n      return tileElem;\n    },\n\n    _getLayerBounds: function (tileGroups, projection) {\n      let layerBounds = {},\n        tileSize = M[projection].options.crs.tile.bounds.max.x;\n      for (let tile in tileGroups) {\n        let sCoords = tile.split(':'),\n          pixelCoords = {};\n        pixelCoords.x = +sCoords[0] * tileSize;\n        pixelCoords.y = +sCoords[1] * tileSize;\n        pixelCoords.z = +sCoords[2]; //+String same as parseInt(String)\n        if (sCoords[2] in layerBounds) {\n          layerBounds[sCoords[2]].extend(L.point(pixelCoords.x, pixelCoords.y));\n          layerBounds[sCoords[2]].extend(\n            L.point(pixelCoords.x + tileSize, pixelCoords.y + tileSize)\n          );\n        } else {\n          layerBounds[sCoords[2]] = L.bounds(\n            L.point(pixelCoords.x, pixelCoords.y),\n            L.point(pixelCoords.x + tileSize, pixelCoords.y + tileSize)\n          );\n        }\n      }\n      // TODO: optimize by removing 2nd loop, add util function to convert point in pixels to point in pcrs, use that instead then this loop\n      // won't be needed\n      for (let pixelBounds in layerBounds) {\n        let zoom = +pixelBounds;\n        layerBounds[pixelBounds] = M.pixelToPCRSBounds(\n          layerBounds[pixelBounds],\n          zoom,\n          projection\n        );\n      }\n\n      return layerBounds;\n    },\n\n    _getZoomBounds: function (container, maxZoomBound) {\n      if (!container) return null;\n      let meta = M._metaContentToObject(\n          container.getElementsByTagName('map-tiles')[0].getAttribute('zoom')\n        ),\n        zoom = {},\n        tiles = container.getElementsByTagName('map-tile');\n      zoom.nativeZoom = +meta.value || 0;\n      zoom.maxNativeZoom = 0;\n      zoom.minNativeZoom = maxZoomBound;\n      for (let i = 0; i < tiles.length; i++) {\n        let lZoom = +tiles[i].getAttribute('zoom');\n        if (!tiles[i].getAttribute('zoom')) lZoom = zoom.nativeZoom;\n        zoom.minNativeZoom = Math.min(zoom.minNativeZoom, lZoom);\n        zoom.maxNativeZoom = Math.max(zoom.maxNativeZoom, lZoom);\n      }\n\n      //hard coded to only natively zoom out 2 levels, any more and too many tiles are going to be loaded in at one time\n      //lagging the users computer\n      zoom.minZoom = zoom.minNativeZoom - 2 <= 0 ? 0 : zoom.minNativeZoom - 2;\n      zoom.maxZoom = maxZoomBound;\n      if (meta.min)\n        zoom.minZoom =\n          +meta.min < zoom.minNativeZoom - 2 ? zoom.minNativeZoom - 2 : +meta.min;\n      if (meta.max) zoom.maxZoom = +meta.max;\n      return zoom;\n    },\n\n    _groupTiles: function (tiles) {\n      let tileMap = {};\n      for (let i = 0; i < tiles.length; i++) {\n        let tile = {};\n        tile.row = +tiles[i].getAttribute('row');\n        tile.col = +tiles[i].getAttribute('col');\n        tile.zoom = +tiles[i].getAttribute('zoom') || this.options.nativeZoom;\n        tile.src = tiles[i].getAttribute('src');\n        let tileCode = tile.col + ':' + tile.row + ':' + tile.zoom;\n        if (tileCode in tileMap) {\n          tileMap[tileCode].push(tile);\n        } else {\n          tileMap[tileCode] = [tile];\n        }\n      }\n      return tileMap;\n    }\n  });\n\n  var staticTileLayer = function (options) {\n    return new StaticTileLayer(options);\n  };\n\n  var LayerControl = L.Control.Layers.extend({\n    /* removes 'base' layers as a concept */\n    options: {\n      autoZIndex: false,\n      sortLayers: true,\n      sortFunction: function (layerA, layerB) {\n        return layerA.options.zIndex < layerB.options.zIndex\n          ? -1\n          : layerA.options.zIndex > layerB.options.zIndex\n          ? 1\n          : 0;\n      }\n    },\n    initialize: function (overlays, options) {\n      L.setOptions(this, options);\n\n      // the _layers array contains objects like {layer: layer, name: \"name\", overlay: true}\n      // the array index is the id of the layer returned by L.stamp(layer) which I guess is a unique hash\n      this._layerControlInputs = [];\n      this._layers = [];\n      this._lastZIndex = 0;\n      this._handlingClick = false;\n\n      for (var i in overlays) {\n        this._addLayer(overlays[i], i, true);\n      }\n    },\n    onAdd: function () {\n      this._initLayout();\n      this._map.on('validate', this._validateInput, this);\n      L.DomEvent.on(this.options.mapEl, 'layerchange', this._validateInput, this);\n      // Adding event on layer control button\n      L.DomEvent.on(\n        this._container.getElementsByTagName('a')[0],\n        'keydown',\n        this._focusFirstLayer,\n        this._container\n      );\n      L.DomEvent.on(\n        this._container,\n        'contextmenu',\n        this._preventDefaultContextMenu,\n        this\n      );\n      this._update();\n      //this._validateExtents();\n      if (this._layers.length < 1 && !this._map._showControls) {\n        this._container.setAttribute('hidden', '');\n      } else {\n        this._map._showControls = true;\n      }\n      return this._container;\n    },\n    onRemove: function (map) {\n      map.off('validate', this._validateInput, this);\n      L.DomEvent.off(\n        this._container.getElementsByTagName('a')[0],\n        'keydown',\n        this._focusFirstLayer,\n        this._container\n      );\n      // remove layer-registerd event handlers so that if the control is not\n      // on the map it does not generate layer events\n      for (var i = 0; i < this._layers.length; i++) {\n        this._layers[i].layer.off('add remove', this._onLayerChange, this);\n        this._layers[i].layer.off('extentload', this._validateInput, this);\n      }\n    },\n    addOrUpdateOverlay: function (layer, name) {\n      var alreadyThere = false;\n      for (var i = 0; i < this._layers.length; i++) {\n        if (this._layers[i].layer === layer) {\n          alreadyThere = true;\n          this._layers[i].name = name;\n          // replace the controls with updated controls if necessary.\n          break;\n        }\n      }\n      if (!alreadyThere) {\n        this.addOverlay(layer, name);\n      }\n      if (this._layers.length > 0) {\n        this._container.removeAttribute('hidden');\n        this._map._showControls = true;\n      }\n      return this._map ? this._update() : this;\n    },\n    removeLayer: function (layer) {\n      L.Control.Layers.prototype.removeLayer.call(this, layer);\n      if (this._layers.length === 0) {\n        this._container.setAttribute('hidden', '');\n      }\n    },\n    _validateInput: function (e) {\n      for (let i = 0; i < this._layers.length; i++) {\n        if (!this._layers[i].input.labels[0]) continue;\n        let label = this._layers[i].input.labels[0].getElementsByTagName('span'),\n          input = this._layers[i].input.labels[0].getElementsByTagName('input');\n        input[0].checked = this._layers[i].layer._layerEl.checked;\n        if (\n          this._layers[i].layer._layerEl.disabled &&\n          this._layers[i].layer._layerEl.checked\n        ) {\n          input[0].closest('fieldset').disabled = true;\n          label[0].style.fontStyle = 'italic';\n        } else {\n          input[0].closest('fieldset').disabled = false;\n          label[0].style.fontStyle = 'normal';\n        }\n        // check if an extent is disabled and disable it\n        if (\n          this._layers[i].layer._extent &&\n          this._layers[i].layer._extent._mapExtents\n        ) {\n          for (\n            let j = 0;\n            j < this._layers[i].layer._extent._mapExtents.length;\n            j++\n          ) {\n            let input =\n                this._layers[i].layer._extent._mapExtents[j].extentAnatomy,\n              label = input.getElementsByClassName('mapml-layer-item-name')[0];\n            if (\n              this._layers[i].layer._extent._mapExtents[j].disabled &&\n              this._layers[i].layer._extent._mapExtents[j].checked\n            ) {\n              label.style.fontStyle = 'italic';\n              input.disabled = true;\n            } else {\n              label.style.fontStyle = 'normal';\n              input.disabled = false;\n            }\n          }\n        }\n      }\n    },\n\n    // focus the first layer in the layer control when enter is pressed\n    _focusFirstLayer: function (e) {\n      if (\n        e.key === 'Enter' &&\n        this.className ===\n          'leaflet-control-layers leaflet-control leaflet-control-layers-expanded'\n      ) {\n        var elem =\n          this.children[1].children[2].children[0].children[0].children[0]\n            .children[0];\n        if (elem) setTimeout(() => elem.focus(), 0);\n      }\n    },\n\n    _withinZoomBounds: function (zoom, range) {\n      return range.min <= zoom && zoom <= range.max;\n    },\n    _addItem: function (obj) {\n      var layercontrols = obj.layer.getLayerUserControlsHTML();\n      // the input is required by Leaflet...\n      obj.input = layercontrols.querySelector(\n        'input.leaflet-control-layers-selector'\n      );\n\n      this._layerControlInputs.push(obj.input);\n      obj.input.layerId = L.stamp(obj.layer);\n\n      L.DomEvent.on(obj.input, 'click', this._onInputClick, this);\n      // this is necessary because when there are several layers in the\n      // layer control, the response to the last one can be a long time\n      // after the info is first displayed, so we have to go back and\n      // verify the layer element is not disabled and can have an enabled input.\n      obj.layer.on('extentload', this._validateInput, this);\n      this._overlaysList.appendChild(layercontrols);\n      return layercontrols;\n    },\n\n    //overrides collapse and conditionally collapses the panel\n    collapse: function (e) {\n      if (\n        e.target.tagName === 'SELECT' ||\n        (e.relatedTarget &&\n          e.relatedTarget.parentElement &&\n          (e.relatedTarget.className === 'mapml-contextmenu mapml-layer-menu' ||\n            e.relatedTarget.parentElement.className ===\n              'mapml-contextmenu mapml-layer-menu')) ||\n        (this._map && this._map.contextMenu._layerMenu.style.display === 'block')\n      )\n        return this;\n\n      L.DomUtil.removeClass(this._container, 'leaflet-control-layers-expanded');\n      if (e.originalEvent?.pointerType === 'touch') {\n        this._container._isExpanded = false;\n      }\n      return this;\n    },\n    _preventDefaultContextMenu: function (e) {\n      let latlng = this._map.mouseEventToLatLng(e);\n      let containerPoint = this._map.mouseEventToContainerPoint(e);\n      e.preventDefault();\n      // for touch devices, when the layer control is not expanded,\n      // the layer context menu should not show on map\n      if (!this._container._isExpanded && e.pointerType === 'touch') {\n        this._container._isExpanded = true;\n        return;\n      }\n      this._map.fire('contextmenu', {\n        originalEvent: e,\n        containerPoint: containerPoint,\n        latlng: latlng\n      });\n    }\n  });\n  var layerControl = function (layers, options) {\n    return new LayerControl(layers, options);\n  };\n\n  const FALLBACK_PROJECTION = 'OSMTILE';\n  const FALLBACK_CS = 'TILEMATRIX';\n  const BLANK_TT_TREF = 'mapmltemplatedtileplaceholder';\n\n  var FeatureLayer = L.FeatureGroup.extend({\n    /*\n     * M.MapML turns any MapML feature data into a Leaflet layer. Based on L.GeoJSON.\n     */\n    initialize: function (mapml, options) {\n      /*\n          mapml:\n          1. for query: an array of map-feature elements that it fetches\n          2. for static templated feature: null\n          3. for non-templated feature: layer- (with no src) or mapml file (with src)\n        */\n      L.setOptions(this, options);\n      if (this.options.static) {\n        this._container = L.DomUtil.create(\n          'div',\n          'leaflet-layer',\n          this.options.pane\n        );\n        // must have leaflet-pane class because of new/changed rule in leaflet.css\n        // info: https://github.com/Leaflet/Leaflet/pull/4597\n        L.DomUtil.addClass(\n          this._container,\n          'leaflet-pane mapml-vector-container'\n        );\n        L.setOptions(this.options.renderer, { pane: this._container });\n      }\n\n      this._layers = {};\n      if (this.options.query) {\n        this._mapmlFeatures = mapml.features ? mapml.features : mapml;\n        this.isVisible = true;\n        let native = this._getNativeVariables(mapml);\n        this.options.nativeZoom = native.zoom;\n        this.options.nativeCS = native.cs;\n      }\n      if (mapml && !this.options.query) {\n        let native = this._getNativeVariables(mapml);\n        //needed to check if the feature is static or not, since this method is used by templated also\n        if (\n          !mapml.querySelector('map-extent') &&\n          mapml.querySelector('map-feature') &&\n          this.options.static\n        ) {\n          this._features = {};\n          this._staticFeature = true;\n          this.isVisible = true; //placeholder for when this actually gets updated in the future\n          this.zoomBounds = this._getZoomBounds(mapml, native.zoom);\n          this.layerBounds = this._getLayerBounds(mapml);\n          L.extend(this.options, this.zoomBounds);\n        }\n        this.addData(mapml, native.cs, native.zoom);\n        if (this._staticFeature) {\n          this._resetFeatures();\n          this.options._leafletLayer._map._addZoomLimit(this);\n        }\n      }\n    },\n\n    onAdd: function (map) {\n      L.FeatureGroup.prototype.onAdd.call(this, map);\n      if (this._mapmlFeatures)\n        map.on('featurepagination', this.showPaginationFeature, this);\n    },\n\n    onRemove: function (map) {\n      if (this._mapmlFeatures) {\n        map.off('featurepagination', this.showPaginationFeature, this);\n        delete this._mapmlFeatures;\n        L.DomUtil.remove(this._container);\n      }\n      L.FeatureGroup.prototype.onRemove.call(this, map);\n      this._map.featureIndex.cleanIndex();\n    },\n\n    getEvents: function () {\n      if (this._staticFeature) {\n        return {\n          moveend: this._handleMoveEnd,\n          zoomend: this._handleZoomEnd\n        };\n      }\n      return {};\n    },\n\n    // for query\n    showPaginationFeature: function (e) {\n      if (this.options.query && this._mapmlFeatures[e.i]) {\n        let feature = this._mapmlFeatures[e.i];\n        if (e.type === 'featurepagination') {\n          // remove map-feature only (keep meta's) when paginating\n          feature._extentEl.shadowRoot.querySelector('map-feature')?.remove();\n        } else {\n          // empty the map-extent shadowRoot\n          // remove the prev / next one <map-feature> and <map-meta>'s from shadow if there is any\n          feature._extentEl.shadowRoot.replaceChildren();\n        }\n        this.clearLayers();\n        feature._featureGroup = this.addData(\n          feature,\n          this.options.nativeCS,\n          this.options.nativeZoom\n        );\n        // append all map-meta from mapml document\n        if (e.meta) {\n          for (let i = 0; i < e.meta.length; i++) {\n            feature._extentEl.shadowRoot.appendChild(e.meta[i]);\n          }\n        }\n        feature._extentEl.shadowRoot.appendChild(feature);\n        e.popup._navigationBar.querySelector('p').innerText =\n          e.i + 1 + '/' + this.options._leafletLayer._totalFeatureCount;\n        e.popup._content\n          .querySelector('iframe')\n          .setAttribute('sandbox', 'allow-same-origin allow-forms');\n        e.popup._content.querySelector('iframe').srcdoc =\n          feature.querySelector('map-properties').innerHTML;\n        // \"zoom to here\" link need to be re-set for every pagination\n        this._map.fire('attachZoomLink', { i: e.i, currFeature: feature });\n        this._map.once(\n          'popupclose',\n          function (e) {\n            this.shadowRoot.innerHTML = '';\n          },\n          feature._extentEl\n        );\n      }\n    },\n\n    // _getNativeVariables: returns an object with the native zoom and CS,\n    //                     based on the map-metas that are available within\n    //                     the layer or the fallback default values.\n    // _getNativeVariables: mapml-||layer-||null||[map-feature,...] -> {zoom: _, val: _}\n    // mapml can be a mapml- element, layer- element, null, or an array of map-features\n    _getNativeVariables: function (mapml) {\n      let nativeZoom, nativeCS;\n      // when mapml is an array of features provided by the query\n      if (\n        mapml.length &&\n        mapml[0].parentElement.parentElement &&\n        mapml[0].parentElement.parentElement.tagName === 'mapml-'\n      ) {\n        let mapmlEl = mapml[0].parentElement.parentElement;\n        nativeZoom =\n          (mapmlEl.querySelector &&\n            mapmlEl.querySelector('map-meta[name=zoom]') &&\n            +M._metaContentToObject(\n              mapmlEl.querySelector('map-meta[name=zoom]').getAttribute('content')\n            ).value) ||\n          0;\n        nativeCS =\n          (mapmlEl.querySelector &&\n            mapmlEl.querySelector('map-meta[name=cs]') &&\n            M._metaContentToObject(\n              mapmlEl.querySelector('map-meta[name=cs]').getAttribute('content')\n            ).content) ||\n          'GCRS';\n      } else {\n        // when mapml is null or a layer-/mapml- element\n        nativeZoom =\n          (mapml.querySelector &&\n            mapml.querySelector('map-meta[name=zoom]') &&\n            +M._metaContentToObject(\n              mapml.querySelector('map-meta[name=zoom]').getAttribute('content')\n            ).value) ||\n          0;\n        nativeCS =\n          (mapml.querySelector &&\n            mapml.querySelector('map-meta[name=cs]') &&\n            M._metaContentToObject(\n              mapml.querySelector('map-meta[name=cs]').getAttribute('content')\n            ).content) ||\n          'GCRS';\n      }\n      return { zoom: nativeZoom, cs: nativeCS };\n    },\n\n    _handleMoveEnd: function () {\n      let mapZoom = this._map.getZoom(),\n        withinZoom =\n          mapZoom <= this.zoomBounds.maxZoom &&\n          mapZoom >= this.zoomBounds.minZoom;\n      this.isVisible =\n        withinZoom &&\n        this._layers &&\n        this.layerBounds &&\n        this.layerBounds.overlaps(\n          M.pixelToPCRSBounds(\n            this._map.getPixelBounds(),\n            mapZoom,\n            this._map.options.projection\n          )\n        );\n      this._removeCSS();\n    },\n\n    _handleZoomEnd: function (e) {\n      let mapZoom = this._map.getZoom();\n      if (\n        mapZoom > this.zoomBounds.maxZoom ||\n        mapZoom < this.zoomBounds.minZoom\n      ) {\n        this.clearLayers();\n        return;\n      }\n      this._resetFeatures();\n    },\n\n    //sets default if any are missing, better to only replace ones that are missing\n    _getLayerBounds: function (container) {\n      if (!container) return null;\n      let cs = FALLBACK_CS,\n        projection =\n          (container.querySelector('map-meta[name=projection]') &&\n            M._metaContentToObject(\n              container\n                .querySelector('map-meta[name=projection]')\n                .getAttribute('content')\n            ).content.toUpperCase()) ||\n          FALLBACK_PROJECTION;\n      try {\n        let meta =\n          container.querySelector('map-meta[name=extent]') &&\n          M._metaContentToObject(\n            container\n              .querySelector('map-meta[name=extent]')\n              .getAttribute('content')\n          );\n\n        let zoom = meta.zoom || 0;\n\n        let metaKeys = Object.keys(meta);\n        for (let i = 0; i < metaKeys.length; i++) {\n          if (!metaKeys[i].includes('zoom')) {\n            cs = M.axisToCS(metaKeys[i].split('-')[2]);\n            break;\n          }\n        }\n        let axes = M.csToAxes(cs);\n        return M.boundsToPCRSBounds(\n          L.bounds(\n            L.point(+meta[`top-left-${axes[0]}`], +meta[`top-left-${axes[1]}`]),\n            L.point(\n              +meta[`bottom-right-${axes[0]}`],\n              +meta[`bottom-right-${axes[1]}`]\n            )\n          ),\n          zoom,\n          projection,\n          cs\n        );\n      } catch (error) {\n        //if error then by default set the layer to osm and bounds to the entire map view\n        return M.boundsToPCRSBounds(\n          M[projection].options.crs.tilematrix.bounds(0),\n          0,\n          projection,\n          cs\n        );\n      }\n    },\n\n    _resetFeatures: function () {\n      this.clearLayers();\n      // since features are removed and re-added by zoom level, need to clean the feature index before re-adding\n      if (this._map) this._map.featureIndex.cleanIndex();\n      let map = this._map || this.options._leafletLayer._map;\n      if (this._features) {\n        for (let zoom in this._features) {\n          for (let k = 0; k < this._features[zoom].length; k++) {\n            let feature = this._features[zoom][k],\n              checkRender = feature._checkRender(\n                map.getZoom(),\n                this.zoomBounds.minZoom,\n                this.zoomBounds.maxZoom\n              );\n            if (checkRender) {\n              this.addLayer(feature);\n            }\n          }\n        }\n      }\n    },\n\n    _setZoomTransform: function (center, clampZoom) {\n      var scale = this._map.getZoomScale(this._map.getZoom(), clampZoom),\n        translate = center\n          .multiplyBy(scale)\n          .subtract(this._map._getNewPixelOrigin(center, this._map.getZoom()))\n          .round();\n\n      if (any3d) {\n        L.setTransform(this._layers[clampZoom], translate, scale);\n      } else {\n        L.setPosition(this._layers[clampZoom], translate);\n      }\n    },\n\n    _getZoomBounds: function (container, nativeZoom) {\n      if (!container) return null;\n      let nMin = 100,\n        nMax = 0,\n        features = container.querySelectorAll('map-feature'),\n        meta,\n        projection;\n      for (let i = 0; i < features.length; i++) {\n        let lZoom = +features[i].getAttribute('zoom');\n        if (!features[i].getAttribute('zoom')) lZoom = nativeZoom;\n        nMax = Math.max(nMax, lZoom);\n        nMin = Math.min(nMin, lZoom);\n      }\n      try {\n        projection = M._metaContentToObject(\n          container\n            .querySelector('map-meta[name=projection]')\n            .getAttribute('content')\n        ).content;\n        meta = M._metaContentToObject(\n          container.querySelector('map-meta[name=zoom]').getAttribute('content')\n        );\n      } catch (error) {\n        return {\n          minZoom: 0,\n          maxZoom:\n            M[projection || FALLBACK_PROJECTION].options.resolutions.length - 1,\n          minNativeZoom: nMin,\n          maxNativeZoom: nMax\n        };\n      }\n      return {\n        minZoom: +meta.min,\n        maxZoom: +meta.max,\n        minNativeZoom: nMin,\n        maxNativeZoom: nMax\n      };\n    },\n\n    addData: function (mapml, nativeCS, nativeZoom) {\n      var features =\n          mapml.nodeType === Node.DOCUMENT_NODE || mapml.nodeName === 'LAYER-'\n            ? mapml.getElementsByTagName('map-feature')\n            : null,\n        i,\n        len,\n        feature;\n\n      var linkedStylesheets =\n        mapml.nodeType === Node.DOCUMENT_NODE\n          ? mapml.querySelector('map-link[rel=stylesheet],map-style')\n          : null;\n      if (linkedStylesheets) {\n        var base =\n          mapml.querySelector('map-base') &&\n          mapml.querySelector('map-base').hasAttribute('href')\n            ? new URL(mapml.querySelector('map-base').getAttribute('href')).href\n            : mapml.URL;\n        M._parseStylesheetAsHTML(mapml, base, this._container);\n      }\n      if (features) {\n        for (i = 0, len = features.length; i < len; i++) {\n          // Only add this if geometry is set and not null\n          feature = features[i];\n          var geometriesExist =\n            feature.getElementsByTagName('map-geometry').length &&\n            feature.getElementsByTagName('map-coordinates').length;\n          if (geometriesExist) {\n            if (mapml.nodeType === Node.DOCUMENT_NODE) {\n              // if the <map-feature> element has migrated from mapml file,\n              // the featureGroup object should bind with the **CLONED** map-feature element in DOM instead of the feature in mapml\n              if (!feature._DOMnode) feature._DOMnode = feature.cloneNode(true);\n              feature._DOMnode._featureGroup = this.addData(\n                feature._DOMnode,\n                nativeCS,\n                nativeZoom\n              );\n            } else {\n              feature._featureGroup = this.addData(feature, nativeCS, nativeZoom);\n            }\n          }\n        }\n        return this; //if templated this runs\n      }\n\n      //if its a mapml with no more links this runs\n      var options = this.options;\n\n      if (options.filter && !options.filter(mapml)) {\n        return;\n      }\n\n      if (mapml.classList.length) {\n        options.className = mapml.classList.value;\n      }\n      let zoom = mapml.getAttribute('zoom') || nativeZoom,\n        title = mapml.querySelector('map-featurecaption');\n      title = title ? title.innerHTML : 'Feature';\n\n      if (mapml.querySelector('map-properties')) {\n        options.properties = document.createElement('div');\n        options.properties.classList.add('mapml-popup-content');\n        options.properties.insertAdjacentHTML(\n          'afterbegin',\n          mapml.querySelector('map-properties').innerHTML\n        );\n      }\n\n      let layer = this.geometryToLayer(mapml, options, nativeCS, +zoom, title);\n      if (layer) {\n        // if the layer is being used as a query handler output, it will have\n        // a color option set.  Otherwise, copy classes from the feature\n        if (!layer.options.color && mapml.hasAttribute('class')) {\n          layer.options.className = mapml.getAttribute('class');\n        }\n        layer.defaultOptions = layer.options;\n        this.resetStyle(layer);\n\n        if (options.onEachFeature) {\n          layer.bindTooltip(title, { interactive: true, sticky: true });\n        }\n        if (this._staticFeature) {\n          let featureZoom = mapml.getAttribute('zoom') || nativeZoom;\n          if (featureZoom in this._features) {\n            this._features[featureZoom].push(layer);\n          } else {\n            this._features[featureZoom] = [layer];\n          }\n        } else {\n          this.addLayer(layer);\n        }\n        if (mapml.tagName.toUpperCase() === 'MAP-FEATURE') {\n          mapml._groupEl = layer.options.group;\n        }\n        return layer;\n      }\n    },\n\n    resetStyle: function (layer) {\n      var style = this.options.style;\n      if (style) {\n        // reset any custom styles\n        L.Util.extend(layer.options, layer.defaultOptions);\n        this._setLayerStyle(layer, style);\n      }\n    },\n\n    setStyle: function (style) {\n      this.eachLayer(function (layer) {\n        this._setLayerStyle(layer, style);\n      }, this);\n    },\n\n    _setLayerStyle: function (layer, style) {\n      if (typeof style === 'function') {\n        style = style(layer.feature);\n      }\n      if (layer.setStyle) {\n        layer.setStyle(style);\n      }\n    },\n    _removeCSS: function () {\n      let toDelete = this._container.querySelectorAll(\n        'link[rel=stylesheet],style'\n      );\n      for (let i = 0; i < toDelete.length; i++) {\n        this._container.removeChild(toDelete[i]);\n      }\n    },\n    geometryToLayer: function (mapml, vectorOptions, nativeCS, zoom, title) {\n      let geometry =\n          mapml.tagName.toUpperCase() === 'MAP-FEATURE'\n            ? mapml.getElementsByTagName('map-geometry')[0]\n            : mapml,\n        cs = geometry?.getAttribute('cs') || nativeCS,\n        group = [],\n        svgGroup = L.SVG.create('g'),\n        copyOptions = Object.assign({}, vectorOptions);\n      if (geometry) {\n        for (let geo of geometry.querySelectorAll(\n          'map-polygon, map-linestring, map-multilinestring, map-point, map-multipoint'\n        )) {\n          group.push(\n            M.feature(\n              geo,\n              Object.assign(copyOptions, {\n                nativeCS: cs,\n                nativeZoom: zoom,\n                projection: this.options.projection,\n                featureID: mapml.id,\n                group: svgGroup,\n                wrappers: this._getGeometryParents(geo.parentElement),\n                featureLayer: this,\n                _leafletLayer: this.options._leafletLayer\n              })\n            )\n          );\n        }\n        let groupOptions = {\n            group: svgGroup,\n            mapmlFeature: mapml,\n            featureID: mapml.id,\n            accessibleTitle: title,\n            onEachFeature: vectorOptions.onEachFeature,\n            properties: vectorOptions.properties,\n            _leafletLayer: this.options._leafletLayer\n          },\n          collections =\n            geometry.querySelector('map-multipolygon') ||\n            geometry.querySelector('map-geometrycollection');\n        if (collections)\n          groupOptions.wrappers = this._getGeometryParents(\n            collections.parentElement\n          );\n        return M.featureGroup(group, groupOptions);\n      }\n    },\n\n    _getGeometryParents: function (subType, elems = []) {\n      if (subType && subType.tagName.toUpperCase() !== 'MAP-GEOMETRY') {\n        if (\n          subType.tagName.toUpperCase() === 'MAP-MULTIPOLYGON' ||\n          subType.tagName.toUpperCase() === 'MAP-GEOMETRYCOLLECTION'\n        )\n          return this._getGeometryParents(subType.parentElement, elems);\n        return this._getGeometryParents(\n          subType.parentElement,\n          elems.concat([subType])\n        );\n      } else {\n        return elems;\n      }\n    }\n  });\n  var featureLayer = function (mapml, options) {\n    return new FeatureLayer(mapml, options);\n  };\n\n  var TemplatedTileLayer = L.TileLayer.extend({\n    // a TemplateTileLayer is similar to a L.TileLayer except its templates are\n    // defined by the <map-extent><template/></map-extent>\n    // content found in the MapML document.  As such, the client map does not\n    // 'revisit' the server for more MapML content, it simply fills the map extent\n    // with tiles for which it generates requests on demand (as the user pans/zooms/resizes\n    // the map)\n    initialize: function (template, options) {\n      // _setUpTileTemplateVars needs options.crs, not available unless we set\n      // options first...\n      let inputData = M._extractInputBounds(template);\n      this.zoomBounds = inputData.zoomBounds;\n      this.extentBounds = inputData.bounds;\n      this.isVisible = true;\n      L.extend(options, this.zoomBounds);\n      options.tms = template.tms;\n      delete options.opacity;\n      L.setOptions(this, options);\n      this._setUpTileTemplateVars(template);\n\n      this._template = template;\n      this._initContainer();\n      // call the parent constructor with the template tref value, per the\n      // Leaflet tutorial: http://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n      L.TileLayer.prototype.initialize.call(\n        this,\n        template.template,\n        L.extend(options, { pane: this._container })\n      );\n    },\n    onAdd: function () {\n      this._map._addZoomLimit(this);\n      L.TileLayer.prototype.onAdd.call(this, this._map);\n      this._handleMoveEnd();\n    },\n\n    getEvents: function () {\n      let events = L.TileLayer.prototype.getEvents.call(this, this._map);\n      this._parentOnMoveEnd = events.moveend;\n      events.moveend = this._handleMoveEnd;\n      return events;\n    },\n\n    _initContainer: function () {\n      if (this._container) {\n        return;\n      }\n\n      this._container = L.DomUtil.create(\n        'div',\n        'leaflet-layer',\n        this.options.pane\n      );\n      L.DomUtil.addClass(this._container, 'mapml-templated-tile-container');\n      this._updateZIndex();\n    },\n    _handleMoveEnd: function (e) {\n      let mapZoom = this._map.getZoom();\n      let mapBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        mapZoom,\n        this._map.options.projection\n      );\n      this.isVisible =\n        mapZoom <= this.options.maxZoom &&\n        mapZoom >= this.options.minZoom &&\n        this.extentBounds.overlaps(mapBounds);\n      if (!this.isVisible) return;\n      this._parentOnMoveEnd();\n    },\n    createTile: function (coords) {\n      let tileGroup = document.createElement('DIV'),\n        tileSize = this.getTileSize();\n      L.DomUtil.addClass(tileGroup, 'mapml-tile-group');\n      L.DomUtil.addClass(tileGroup, 'leaflet-tile');\n\n      this._template.linkEl.dispatchEvent(\n        new CustomEvent('tileloadstart', {\n          detail: {\n            x: coords.x,\n            y: coords.y,\n            zoom: coords.z,\n            appendTile: (elem) => {\n              tileGroup.appendChild(elem);\n            }\n          }\n        })\n      );\n\n      if (this._template.type.startsWith('image/')) {\n        let tile = L.TileLayer.prototype.createTile.call(\n          this,\n          coords,\n          function () {}\n        );\n        tile.width = tileSize.x;\n        tile.height = tileSize.y;\n        tileGroup.appendChild(tile);\n      } else if (!this._url.includes(BLANK_TT_TREF)) {\n        // tiles of type=\"text/mapml\" will have to fetch content while creating\n        // the tile here, unless there can be a callback associated to the element\n        // that will render the content in the alread-placed tile\n        // var tile = L.DomUtil.create('canvas', 'leaflet-tile');\n        this._fetchTile(coords, tileGroup);\n      }\n      return tileGroup;\n    },\n    _mapmlTileReady: function (tile) {\n      L.DomUtil.addClass(tile, 'leaflet-tile-loaded');\n    },\n    // instead of being child of a pane, the TemplatedTileLayers are 'owned' by the group,\n    // and so are DOM children of the group, not the pane element (the MapMLLayer is\n    // a child of the overlay pane and always has a set of sub-layers)\n    getPane: function () {\n      return this.options.pane;\n    },\n    _fetchTile: function (coords, tile) {\n      fetch(this.getTileUrl(coords), { redirect: 'follow' })\n        .then(function (response) {\n          if (response.status >= 200 && response.status < 300) {\n            return Promise.resolve(response);\n          } else {\n            console.log(\n              'Looks like there was a problem. Status Code: ' + response.status\n            );\n            return Promise.reject(response);\n          }\n        })\n        .then(function (response) {\n          return response.text();\n        })\n        .then((text) => {\n          var parser = new DOMParser();\n          return parser.parseFromString(text, 'application/xml');\n        })\n        .then((mapml) => {\n          this._createFeatures(mapml, coords, tile);\n          this._mapmlTileReady(tile);\n        })\n        .catch((err) => {\n          console.log('Error Creating Tile');\n        });\n    },\n\n    _createFeatures: function (markup, coords, tile) {\n      let stylesheets = markup.querySelector(\n        'map-link[rel=stylesheet],map-style'\n      );\n      if (stylesheets) {\n        let base =\n          markup.querySelector('map-base') &&\n          markup.querySelector('map-base').hasAttribute('href')\n            ? new URL(markup.querySelector('map-base').getAttribute('href')).href\n            : markup.URL;\n        M._parseStylesheetAsHTML(markup, base, tile);\n      }\n\n      let svg = L.SVG.create('svg'),\n        g = L.SVG.create('g'),\n        tileSize = this._map.options.crs.options.crs.tile.bounds.max.x,\n        xOffset = coords.x * tileSize,\n        yOffset = coords.y * tileSize;\n\n      let tileFeatures = M.featureLayer(markup, {\n        projection: this._map.options.projection,\n        static: false,\n        interactive: false\n      });\n\n      for (let groupID in tileFeatures._layers) {\n        for (let featureID in tileFeatures._layers[groupID]._layers) {\n          let layer = tileFeatures._layers[groupID]._layers[featureID];\n          M.FeatureRenderer.prototype._initPath(layer, false);\n          layer._project(this._map, L.point([xOffset, yOffset]), coords.z);\n          M.FeatureRenderer.prototype._addPath(layer, g, false);\n          M.FeatureRenderer.prototype._updateFeature(layer);\n        }\n      }\n      svg.setAttribute('width', tileSize.toString());\n      svg.setAttribute('height', tileSize.toString());\n      svg.appendChild(g);\n      tile.appendChild(svg);\n    },\n\n    getTileUrl: function (coords) {\n      if (\n        coords.z >= this._template.tilematrix.bounds.length ||\n        !this._template.tilematrix.bounds[coords.z].contains(coords)\n      ) {\n        return '';\n      }\n      var obj = {},\n        linkEl = this._template.linkEl,\n        zoomInput = linkEl.zoomInput;\n      obj[this._template.tilematrix.col.name] = coords.x;\n      obj[this._template.tilematrix.row.name] = coords.y;\n      if (\n        zoomInput &&\n        linkEl.hasAttribute('tref') &&\n        linkEl\n          .getAttribute('tref')\n          .includes(`{${zoomInput.getAttribute('name')}}`)\n      ) {\n        obj[this._template.zoom.name] = this._getZoomForUrl();\n      }\n      obj[this._template.pcrs.easting.left] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-left'\n      ).x;\n      obj[this._template.pcrs.easting.right] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-right'\n      ).x;\n      obj[this._template.pcrs.northing.top] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-left'\n      ).y;\n      obj[this._template.pcrs.northing.bottom] = this._tileMatrixToPCRSPosition(\n        coords,\n        'bottom-left'\n      ).y;\n      for (var v in this._template.tile) {\n        if (\n          ['row', 'col', 'zoom', 'left', 'right', 'top', 'bottom'].indexOf(v) < 0\n        ) {\n          obj[v] = this._template.tile[v];\n        }\n      }\n      if (this._map && !this._map.options.crs.infinite) {\n        let invertedY = this._globalTileRange.max.y - coords.y;\n        if (this.options.tms) {\n          obj[this._template.tilematrix.row.name] = invertedY;\n        }\n        //obj[`-${this._template.tilematrix.row.name}`] = invertedY; //leaflet has this but I dont see a use in storing row and -row as it doesnt follow that pattern\n      }\n      obj.r =\n        this.options.detectRetina && L.Browser.retina && this.options.maxZoom > 0\n          ? '@2x'\n          : '';\n      return L.Util.template(this._url, obj);\n    },\n    _tileMatrixToPCRSPosition: function (coords, pos) {\n      // this is a tile:\n      //\n      //   top-left         top-center           top-right\n      //      +------------------+------------------+\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      + center-left    center               + center-right\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      +------------------+------------------+\n      //   bottom-left     bottom-center      bottom-right\n\n      var map = this._map,\n        crs = map.options.crs,\n        tileSize = this.getTileSize(),\n        nwPoint = coords.scaleBy(tileSize),\n        sePoint = nwPoint.add(tileSize),\n        centrePoint = nwPoint.add(Math.floor(tileSize / 2)),\n        nw = crs.transformation.untransform(nwPoint, crs.scale(coords.z)),\n        se = crs.transformation.untransform(sePoint, crs.scale(coords.z)),\n        cen = crs.transformation.untransform(centrePoint, crs.scale(coords.z)),\n        result = null;\n\n      switch (pos) {\n        case 'top-left':\n          result = nw;\n          break;\n        case 'bottom-left':\n          result = new L.Point(nw.x, se.y);\n          break;\n        case 'center-left':\n          result = new L.Point(nw.x, cen.y);\n          break;\n        case 'top-right':\n          result = new L.Point(se.x, nw.y);\n          break;\n        case 'bottom-right':\n          result = se;\n          break;\n        case 'center-right':\n          result = new L.Point(se.x, cen.y);\n          break;\n        case 'top-center':\n          result = new L.Point(cen.x, nw.y);\n          break;\n        case 'bottom-center':\n          result = new L.Point(cen.x, se.y);\n          break;\n        case 'center':\n          result = cen;\n          break;\n      }\n      return result;\n    },\n    _setUpTileTemplateVars: function (template) {\n      // process the inputs associated to template and create an object named\n      // tile with member properties as follows:\n      // {row: 'rowvarname',\n      //  col: 'colvarname',\n      //  left: 'leftvarname',\n      //  right: 'rightvarname',\n      //  top: 'topvarname',\n      //  bottom: 'bottomvarname'}\n      template.tile = {};\n      var inputs = template.values,\n        crs = this.options.crs.options,\n        zoom,\n        east,\n        north,\n        row,\n        col;\n\n      for (var i = 0; i < template.values.length; i++) {\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select',\n          value = inputs[i].getAttribute('value'),\n          min = inputs[i].getAttribute('min'),\n          max = inputs[i].getAttribute('max');\n        if (type === 'location' && units === 'tilematrix') {\n          switch (axis) {\n            case 'column':\n              col = {\n                name: name,\n                min: crs.crs.tilematrix.horizontal.min,\n                max: crs.crs.tilematrix.horizontal.max(crs.resolutions.length - 1)\n              };\n              if (!isNaN(Number.parseFloat(min))) {\n                col.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                col.max = Number.parseFloat(max);\n              }\n              break;\n            case 'row':\n              row = {\n                name: name,\n                min: crs.crs.tilematrix.vertical.min,\n                max: crs.crs.tilematrix.vertical.max(crs.resolutions.length - 1)\n              };\n              if (!isNaN(Number.parseFloat(min))) {\n                row.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                row.max = Number.parseFloat(max);\n              }\n              break;\n            case 'longitude':\n            case 'easting':\n              if (!east) {\n                east = {\n                  min: crs.crs.pcrs.horizontal.min,\n                  max: crs.crs.pcrs.horizontal.max\n                };\n              }\n              if (!isNaN(Number.parseFloat(min))) {\n                east.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                east.max = Number.parseFloat(max);\n              }\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  east.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  east.right = name;\n                }\n              }\n              break;\n            case 'latitude':\n            case 'northing':\n              if (!north) {\n                north = {\n                  min: crs.crs.pcrs.vertical.min,\n                  max: crs.crs.pcrs.vertical.max\n                };\n              }\n              if (!isNaN(Number.parseFloat(min))) {\n                north.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                north.max = Number.parseFloat(max);\n              }\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  north.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  north.bottom = name;\n                }\n              }\n              break;\n            // unsuportted axis value\n          }\n        } else if (type && type.toLowerCase() === 'zoom') {\n          //<input name=\"...\" type=\"zoom\" value=\"0\" min=\"0\" max=\"17\">\n          zoom = {\n            name: name,\n            min: 0,\n            max: crs.resolutions.length,\n            value: crs.resolutions.length\n          };\n          if (\n            !isNaN(Number.parseInt(value, 10)) &&\n            Number.parseInt(value, 10) >= zoom.min &&\n            Number.parseInt(value, 10) <= zoom.max\n          ) {\n            zoom.value = Number.parseInt(value, 10);\n          } else {\n            zoom.value = zoom.max;\n          }\n          if (\n            !isNaN(Number.parseInt(min, 10)) &&\n            Number.parseInt(min, 10) >= zoom.min &&\n            Number.parseInt(min, 10) <= zoom.max\n          ) {\n            zoom.min = Number.parseInt(min, 10);\n          }\n          if (\n            !isNaN(Number.parseInt(max, 10)) &&\n            Number.parseInt(max, 10) >= zoom.min &&\n            Number.parseInt(max, 10) <= zoom.max\n          ) {\n            zoom.max = Number.parseInt(max, 10);\n          }\n          template.zoom = zoom;\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          template.tile[name] = function () {\n            return parsedselect.value;\n          };\n        } else {\n          // needs to be a const otherwise it gets overwritten\n          /*jshint -W104 */\n          const input = inputs[i];\n          template.tile[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      var transformation = this.options.crs.transformation,\n        tileSize = this.options.crs.options.crs.tile.bounds.max.x,\n        scale = L.bind(this.options.crs.scale, this.options.crs),\n        pcrs2tilematrix = function (c, zoom) {\n          return transformation\n            .transform(c, scale(zoom))\n            .divideBy(tileSize)\n            .floor();\n        };\n      if (east && north) {\n        template.pcrs = {};\n        template.pcrs.bounds = L.bounds(\n          [east.min, north.min],\n          [east.max, north.max]\n        );\n        template.pcrs.easting = east;\n        template.pcrs.northing = north;\n      } else if (col && row && !isNaN(zoom.value)) {\n        // convert the tile bounds at this zoom to a pcrs bounds, then\n        // go through the zoom min/max and create a tile-based bounds\n        // at each zoom that applies to the col/row values that constrain what tiles\n        // will be requested so that we don't generate too many 404s\n        if (!template.pcrs) {\n          template.pcrs = {};\n          template.pcrs.easting = '';\n          template.pcrs.northing = '';\n        }\n\n        template.pcrs.bounds = M.boundsToPCRSBounds(\n          L.bounds(L.point([col.min, row.min]), L.point([col.max, row.max])),\n          zoom.value,\n          this.options.crs,\n          M.axisToCS('column')\n        );\n\n        template.tilematrix = {};\n        template.tilematrix.col = col;\n        template.tilematrix.row = row;\n      } else {\n        console.log(\n          'Unable to determine bounds for tile template: ' + template.template\n        );\n      }\n\n      if (!template.tilematrix) {\n        template.tilematrix = {};\n        template.tilematrix.col = {};\n        template.tilematrix.row = {};\n      }\n      template.tilematrix.bounds = [];\n      var pcrsBounds = template.pcrs.bounds;\n      // the template should _always_ have a zoom, because we force it to\n      // by first processing the extent to determine the zoom and if none, adding\n      // one and second by copying that zoom into the set of template variable inputs\n      // even if it is not referenced by one of the template's variable references\n      var zmin = template.zoom ? template.zoom.min : 0,\n        zmax = template.zoom ? template.zoom.max : crs.resolutions.length;\n      for (var z = 0; z <= zmax; z++) {\n        template.tilematrix.bounds[z] =\n          z >= zmin\n            ? L.bounds(\n                pcrs2tilematrix(pcrsBounds.min, z),\n                pcrs2tilematrix(pcrsBounds.max, z)\n              )\n            : L.bounds(L.point([-1, -1]), L.point([-1, -1]));\n      }\n    },\n    _clampZoom: function (zoom) {\n      let clamp = L.GridLayer.prototype._clampZoom.call(this, zoom);\n      if (this._template.step > this.zoomBounds.maxNativeZoom)\n        this._template.step = this.zoomBounds.maxNativeZoom;\n\n      if (zoom !== clamp) {\n        zoom = clamp;\n      } else {\n        if (zoom % this._template.step !== 0) {\n          zoom = Math.floor(zoom / this._template.step) * this._template.step;\n        }\n      }\n      return zoom;\n    }\n  });\n  var templatedTileLayer = function (template, options) {\n    return new TemplatedTileLayer(template, options);\n  };\n\n  var TemplatedLayer = L.Layer.extend({\n    initialize: function (templates, options) {\n      this._templates = templates;\n      L.setOptions(this, options);\n      this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n      this._container.style.opacity = this.options.opacity;\n      L.DomUtil.addClass(this._container, 'mapml-templatedlayer-container');\n\n      for (var i = 0; i < templates.length; i++) {\n        if (templates[i].rel === 'tile') {\n          this.setZIndex(options.extentZIndex);\n          this._templates[i].layer = M.templatedTileLayer(\n            templates[i],\n            L.Util.extend(options, {\n              errorTileUrl:\n                'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==',\n              zIndex: options.extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'image') {\n          this.setZIndex(options.extentZIndex);\n          this._templates[i].layer = M.templatedImageLayer(\n            templates[i],\n            L.Util.extend(options, {\n              zIndex: options.extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'features') {\n          this.setZIndex(options.extentZIndex);\n          this._templates[i].layer = M.templatedFeaturesLayer(\n            templates[i],\n            L.Util.extend(options, {\n              zIndex: options.extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'query') {\n          // add template to array of queryies to be added to map and processed\n          // on click/tap events\n          this.hasSetBoundsHandler = true;\n          if (!this._queries) {\n            this._queries = [];\n          }\n          let inputData = M._extractInputBounds(templates[i]);\n          templates[i].extentBounds = inputData.bounds;\n          templates[i].zoomBounds = inputData.zoomBounds;\n          templates[i]._extentEl = this.options.extentEl;\n          this._queries.push(\n            L.extend(templates[i], this._setupQueryVars(templates[i]))\n          );\n        }\n      }\n    },\n    getEvents: function () {\n      return {\n        zoomstart: this._onZoomStart\n      };\n    },\n    redraw: function () {\n      this.closePopup();\n      for (var i = 0; i < this._templates.length; i++) {\n        if (\n          this._templates[i].rel === 'tile' ||\n          this._templates[i].rel === 'image' ||\n          this._templates[i].rel === 'features'\n        ) {\n          this._templates[i].layer.redraw();\n        }\n      }\n    },\n    _onZoomStart: function () {\n      this.closePopup();\n    },\n\n    _setupQueryVars: function (template) {\n      // process the inputs associated to template and create an object named\n      // query with member properties as follows:\n      // {width: 'widthvarname',\n      //  height: 'heightvarname',\n      //  left: 'leftvarname',\n      //  right: 'rightvarname',\n      //  top: 'topvarname',\n      //  bottom: 'bottomvarname'\n      //  i: 'ivarname'\n      //  j: 'jvarname'}\n      //  x: 'xvarname' x being the tcrs x axis\n      //  y: 'yvarname' y being the tcrs y axis\n      //  z: 'zvarname' zoom\n      //  title: link title\n\n      var queryVarNames = { query: {} },\n        inputs = template.values;\n\n      for (var i = 0; i < template.values.length; i++) {\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          rel = inputs[i].getAttribute('rel'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select';\n        if (type === 'width') {\n          queryVarNames.query.width = name;\n        } else if (type === 'height') {\n          queryVarNames.query.height = name;\n        } else if (type === 'location') {\n          switch (axis) {\n            case 'x':\n            case 'y':\n            case 'column':\n            case 'row':\n              queryVarNames.query[axis] = name;\n              break;\n            case 'longitude':\n            case 'easting':\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixelleft = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tileleft = name;\n                  } else {\n                    queryVarNames.query.mapleft = name;\n                  }\n                } else if (position.match(/.*?-right/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixelright = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tileright = name;\n                  } else {\n                    queryVarNames.query.mapright = name;\n                  }\n                }\n              } else {\n                queryVarNames.query[axis] = name;\n              }\n              break;\n            case 'latitude':\n            case 'northing':\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixeltop = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tiletop = name;\n                  } else {\n                    queryVarNames.query.maptop = name;\n                  }\n                } else if (position.match(/bottom-.*?/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixelbottom = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tilebottom = name;\n                  } else {\n                    queryVarNames.query.mapbottom = name;\n                  }\n                }\n              } else {\n                queryVarNames.query[axis] = name;\n              }\n              break;\n            case 'i':\n              if (units === 'tile') {\n                queryVarNames.query.tilei = name;\n              } else {\n                queryVarNames.query.mapi = name;\n              }\n              break;\n            case 'j':\n              if (units === 'tile') {\n                queryVarNames.query.tilej = name;\n              } else {\n                queryVarNames.query.mapj = name;\n              }\n              break;\n            // unsuportted axis value\n          }\n        } else if (type === 'zoom') {\n          //<input name=\"...\" type=\"zoom\" value=\"0\" min=\"0\" max=\"17\">\n          queryVarNames.query.zoom = name;\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          queryVarNames.query[name] = function () {\n            return parsedselect.value;\n          };\n        } else {\n          /*jshint -W104 */\n          const input = inputs[i];\n          queryVarNames.query[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      queryVarNames.query.title = template.title;\n      return queryVarNames;\n    },\n    reset: function (templates, extentZIndex) {\n      if (!templates) {\n        return;\n      }\n      if (!this._map) {\n        return;\n      }\n      var addToMap = this._map && this._map.hasLayer(this),\n        old_templates = this._templates;\n      delete this._queries;\n      this._map.off('click', null, this);\n\n      this._templates = templates;\n      for (var i = 0; i < templates.length; i++) {\n        if (templates[i].rel === 'tile') {\n          this._templates[i].layer = M.templatedTileLayer(\n            templates[i],\n            L.Util.extend(this.options, {\n              errorTileUrl:\n                'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==',\n              zIndex: extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'image') {\n          this._templates[i].layer = M.templatedImageLayer(\n            templates[i],\n            L.Util.extend(this.options, {\n              zIndex: extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'features') {\n          this._templates[i].layer = M.templatedFeaturesLayer(\n            templates[i],\n            L.Util.extend(this.options, {\n              zIndex: extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'query') {\n          if (!this._queries) {\n            this._queries = [];\n          }\n          this._queries.push(\n            L.extend(templates[i], this._setupQueryVars(templates[i]))\n          );\n        }\n        if (addToMap) {\n          this.onAdd(this._map);\n        }\n      }\n      for (i = 0; i < old_templates.length; i++) {\n        if (this._map.hasLayer(old_templates[i].layer)) {\n          this._map.removeLayer(old_templates[i].layer);\n        }\n      }\n    },\n    onAdd: function (map) {\n      for (var i = 0; i < this._templates.length; i++) {\n        if (this._templates[i].rel !== 'query') {\n          map.addLayer(this._templates[i].layer);\n        }\n      }\n    },\n    //addTo: function(map) {\n    //for(let i = 0; i < this._templates.length; i++){\n    //    this._templates[0].layer.addTo(map);\n    //}\n    //},\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    onRemove: function (map) {\n      L.DomUtil.remove(this._container);\n      for (var i = 0; i < this._templates.length; i++) {\n        if (this._templates[i].rel !== 'query') {\n          map.removeLayer(this._templates[i].layer);\n        }\n      }\n    },\n\n    _previousFeature: function (e) {\n      if (this._count + -1 >= 0) {\n        this._count--;\n        this._map.fire('featurepagination', { i: this._count, popup: this });\n      }\n    },\n\n    _nextFeature: function (e) {\n      if (this._count + 1 < this._source._totalFeatureCount) {\n        this._count++;\n        this._map.fire('featurepagination', { i: this._count, popup: this });\n      }\n    },\n\n    changeOpacity: function (opacity) {\n      this._container.style.opacity = opacity;\n    }\n  });\n  var templatedLayer = function (templates, options) {\n    // templates is an array of template objects\n    // a template object contains the template, plus associated <input> elements\n    // which need to be processed just prior to creating a url from the template\n    // with the values of the inputs\n    return new TemplatedLayer(templates, options);\n  };\n\n  var TemplatedFeaturesLayer = L.Layer.extend({\n    // this and M.ImageLayer could be merged or inherit from a common parent\n    initialize: function (template, options) {\n      let inputData = M._extractInputBounds(template);\n      this.zoomBounds = inputData.zoomBounds;\n      this.extentBounds = inputData.bounds;\n      this.isVisible = true;\n      this._template = template;\n      this._extentEl = options.extentEl;\n      this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n      L.extend(options, this.zoomBounds);\n      L.DomUtil.addClass(this._container, 'mapml-features-container');\n      delete options.opacity;\n      L.setOptions(\n        this,\n        L.extend(options, this._setUpFeaturesTemplateVars(template))\n      );\n    },\n    getEvents: function () {\n      var events = {\n        moveend: this._onMoveEnd\n      };\n      return events;\n    },\n    onAdd: function () {\n      this._map._addZoomLimit(this);\n      var opacity = this.options.opacity || 1,\n        container = this._container,\n        map = this._map;\n      if (!this._features) {\n        this._features = M.featureLayer(null, {\n          // pass the vector layer a renderer of its own, otherwise leaflet\n          // puts everything into the overlayPane\n          renderer: M.featureRenderer(),\n          // pass the vector layer the container for the parent into which\n          // it will append its own container for rendering into\n          pane: container,\n          opacity: opacity,\n          projection: map.options.projection,\n          static: true,\n          onEachFeature: function (properties, geometry) {\n            // need to parse as HTML to preserve semantics and styles\n            var c = document.createElement('div');\n            c.classList.add('mapml-popup-content');\n            c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n            geometry.bindPopup(c, { autoClose: false, minWidth: 108 });\n          }\n        });\n      }\n\n      map.fire('moveend'); // TODO: replace with moveend handler for layer and not entire map\n    },\n    redraw: function () {\n      this._onMoveEnd();\n    },\n\n    _removeCSS: function () {\n      let toDelete = this._container.querySelectorAll(\n        'link[rel=stylesheet],style'\n      );\n      for (let i = 0; i < toDelete.length; i++) {\n        let parent = toDelete[i].parentNode;\n        parent.removeChild(toDelete[i]);\n      }\n    },\n\n    _onMoveEnd: function () {\n      let history = this._map.options.mapEl._history;\n      let current = history[history.length - 1];\n      let previous = history[history.length - 2] ?? current;\n      let step = this._template.step;\n      let mapZoom = this._map.getZoom();\n      let steppedZoom = mapZoom;\n      //If zooming out from one step interval into a lower one or panning, set the stepped zoom\n      if (\n        (step !== '1' &&\n          (mapZoom + 1) % step === 0 &&\n          current.zoom === previous.zoom - 1) ||\n        current.zoom === previous.zoom ||\n        Math.floor(mapZoom / step) * step !==\n          Math.floor(previous.zoom / step) * step\n      ) {\n        steppedZoom = Math.floor(mapZoom / step) * step;\n      }\n      //No request needed if in a step interval (unless panning)\n      else if (mapZoom % this._template.step !== 0) return;\n\n      let scaleBounds = this._map.getPixelBounds(\n        this._map.getCenter(),\n        steppedZoom\n      );\n      let url = this._getfeaturesUrl(steppedZoom, scaleBounds);\n      //No request needed if the current template url is the same as the url to request\n      if (url === this._url) return;\n\n      let mapBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        mapZoom,\n        this._map.options.projection\n      );\n      this.isVisible =\n        mapZoom <= this.zoomBounds.maxZoom &&\n        mapZoom >= this.zoomBounds.minZoom &&\n        this.extentBounds.overlaps(mapBounds);\n\n      this._features.clearLayers();\n      // shadow may has not yet attached to <map-extent> for the first-time rendering\n      if (this._extentEl.shadowRoot) {\n        this._extentEl.shadowRoot.innerHTML = '';\n      }\n      this._removeCSS();\n      //Leave the layers cleared if the layer is not visible\n      if (!this.isVisible && steppedZoom === mapZoom) {\n        this._url = '';\n        return;\n      }\n\n      // TODO add preference with a bit less weight than that for text/mapml; 0.8 for application/geo+json; 0.6\n      var mapml,\n        headers = new Headers({\n          Accept: 'text/mapml;q=0.9,application/geo+json;q=0.8'\n        }),\n        parser = new DOMParser(),\n        features = this._features,\n        extentEl = this._extentEl,\n        map = this._map,\n        context = this,\n        MAX_PAGES = 10,\n        _pullFeatureFeed = function (url, limit) {\n          return fetch(url, { redirect: 'follow', headers: headers })\n            .then(function (response) {\n              return response.text();\n            })\n            .then(function (text) {\n              //TODO wrap this puppy in a try/catch/finally to parse application/geo+json if necessary\n              mapml = parser.parseFromString(text, 'application/xml');\n              var base = new URL(\n                mapml.querySelector('map-base')\n                  ? mapml.querySelector('map-base').getAttribute('href')\n                  : url\n              ).href;\n              url = mapml.querySelector('map-link[rel=next]')\n                ? mapml.querySelector('map-link[rel=next]').getAttribute('href')\n                : null;\n              url = url ? new URL(url, base).href : null;\n              // TODO if the xml parser barfed but the response is application/geo+json, use the parent addData method\n              let nativeZoom = (extentEl._nativeZoom =\n                (mapml.querySelector('map-meta[name=zoom]') &&\n                  +M._metaContentToObject(\n                    mapml\n                      .querySelector('map-meta[name=zoom]')\n                      .getAttribute('content')\n                  ).value) ||\n                0);\n              let nativeCS = (extentEl._nativeCS =\n                (mapml.querySelector('map-meta[name=cs]') &&\n                  M._metaContentToObject(\n                    mapml\n                      .querySelector('map-meta[name=cs]')\n                      .getAttribute('content')\n                  ).content) ||\n                'GCRS');\n              features.addData(mapml, nativeCS, nativeZoom);\n              // \"migrate\" to extent's shadow\n              // make a clone, prevent the elements from being removed from mapml file\n              // same as _attachToLayer() in MapMLLayer.js\n              for (let el of mapml.querySelector('map-body').children) {\n                extentEl.shadowRoot.append(el._DOMnode);\n                el._DOMnode._extentEl = extentEl;\n              }\n              if (url && --limit) {\n                return _pullFeatureFeed(url, limit);\n              }\n            });\n        };\n      this._url = url;\n      _pullFeatureFeed(url, MAX_PAGES)\n        .then(function () {\n          map.addLayer(features);\n          //Fires event for feature index overlay\n          map.fire('templatedfeatureslayeradd');\n          M.TemplatedFeaturesLayer.prototype._updateTabIndex(context);\n        })\n        .catch(function (error) {\n          console.log(error);\n        });\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n      return this;\n    },\n    _updateTabIndex: function (context) {\n      let c = context || this;\n      for (let layerNum in c._features._layers) {\n        let layer = c._features._layers[layerNum];\n        if (layer._path) {\n          if (layer._path.getAttribute('d') !== 'M0 0') {\n            layer._path.setAttribute('tabindex', 0);\n          } else {\n            layer._path.removeAttribute('tabindex');\n          }\n          if (layer._path.childElementCount === 0) {\n            let title = document.createElement('title');\n            title.innerText = 'Feature';\n            layer._path.appendChild(title);\n          }\n        }\n      }\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    onRemove: function () {\n      this._map.removeLayer(this._features);\n    },\n    _getfeaturesUrl: function (zoom, bounds) {\n      if (zoom === undefined) zoom = this._map.getZoom();\n      if (bounds === undefined) bounds = this._map.getPixelBounds();\n      var obj = {};\n      if (this.options.feature.zoom) {\n        obj[this.options.feature.zoom] = zoom;\n      }\n      if (this.options.feature.width) {\n        obj[this.options.feature.width] = this._map.getSize().x;\n      }\n      if (this.options.feature.height) {\n        obj[this.options.feature.height] = this._map.getSize().y;\n      }\n      if (this.options.feature.bottom) {\n        obj[this.options.feature.bottom] = this._TCRSToPCRS(bounds.max, zoom).y;\n      }\n      if (this.options.feature.left) {\n        obj[this.options.feature.left] = this._TCRSToPCRS(bounds.min, zoom).x;\n      }\n      if (this.options.feature.top) {\n        obj[this.options.feature.top] = this._TCRSToPCRS(bounds.min, zoom).y;\n      }\n      if (this.options.feature.right) {\n        obj[this.options.feature.right] = this._TCRSToPCRS(bounds.max, zoom).x;\n      }\n      // hidden and other variables that may be associated\n      for (var v in this.options.feature) {\n        if (\n          ['width', 'height', 'left', 'right', 'top', 'bottom', 'zoom'].indexOf(\n            v\n          ) < 0\n        ) {\n          obj[v] = this.options.feature[v];\n        }\n      }\n      return L.Util.template(this._template.template, obj);\n    },\n    _TCRSToPCRS: function (coords, zoom) {\n      // TCRS pixel point to Projected CRS point (in meters, presumably)\n      var map = this._map,\n        crs = map.options.crs,\n        loc = crs.transformation.untransform(coords, crs.scale(zoom));\n      return loc;\n    },\n    _setUpFeaturesTemplateVars: function (template) {\n      // process the inputs and create an object named \"extent\"\n      // with member properties as follows:\n      // {width: {name: 'widthvarname'}, // value supplied by map if necessary\n      //  height: {name: 'heightvarname'}, // value supplied by map if necessary\n      //  left: {name: 'leftvarname', axis: 'leftaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n      //  right: {name: 'rightvarname', axis: 'rightaxisname'}, // axis name (coordinate system of) drives the value supplied by the map\n      //  top: {name: 'topvarname', axis: 'topaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n      //  bottom: {name: 'bottomvarname', axis: 'bottomaxisname'} // axis name drives (coordinate system of) the value supplied by the map\n      //  zoom: {name: 'zoomvarname'}\n      //  hidden: [{name: name, value: value}]}\n\n      var featuresVarNames = { feature: {} },\n        inputs = template.values;\n      featuresVarNames.feature.hidden = [];\n      for (var i = 0; i < inputs.length; i++) {\n        // this can be removed when the spec removes the deprecated inputs...\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          value = inputs[i].getAttribute('value'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select';\n        if (type === 'width') {\n          featuresVarNames.feature.width = name;\n        } else if (type === 'height') {\n          featuresVarNames.feature.height = name;\n        } else if (type === 'zoom') {\n          featuresVarNames.feature.zoom = name;\n        } else if (\n          type === 'location' &&\n          (units === 'pcrs' || units === 'gcrs')\n        ) {\n          //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting\">\n          switch (axis) {\n            case 'x':\n            case 'longitude':\n            case 'easting':\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  featuresVarNames.feature.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  featuresVarNames.feature.right = name;\n                }\n              }\n              break;\n            case 'y':\n            case 'latitude':\n            case 'northing':\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  featuresVarNames.feature.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  featuresVarNames.feature.bottom = name;\n                }\n              }\n              break;\n          }\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          featuresVarNames.feature[name] = function () {\n            return parsedselect.value;\n          };\n          // projection is deprecated, make it hidden\n        } else {\n          /*jshint -W104 */\n          const input = inputs[i];\n          featuresVarNames.feature[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      return featuresVarNames;\n    }\n  });\n  var templatedFeaturesLayer = function (template, options) {\n    return new TemplatedFeaturesLayer(template, options);\n  };\n\n  var TemplatedImageLayer = L.Layer.extend({\n    initialize: function (template, options) {\n      this._template = template;\n      this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n      L.DomUtil.addClass(this._container, 'mapml-image-container');\n      let inputData = M._extractInputBounds(template);\n      this.zoomBounds = inputData.zoomBounds;\n      this.extentBounds = inputData.bounds;\n      this.isVisible = true;\n      delete options.opacity;\n      L.extend(options, this.zoomBounds);\n      L.setOptions(\n        this,\n        L.extend(options, this._setUpExtentTemplateVars(template))\n      );\n    },\n    getEvents: function () {\n      var events = {\n        moveend: this._onMoveEnd,\n        zoomstart: this._clearLayer\n      };\n      return events;\n    },\n    onAdd: function () {\n      this._map._addZoomLimit(this); //used to set the zoom limit of the map\n      this.setZIndex(this.options.zIndex);\n      this._onAdd();\n    },\n    redraw: function () {\n      this._onMoveEnd();\n    },\n\n    _clearLayer: function () {\n      let containerImages = this._container.querySelectorAll('img');\n      for (let i = 0; i < containerImages.length; i++) {\n        this._container.removeChild(containerImages[i]);\n      }\n    },\n\n    _addImage: function (bounds, zoom, loc) {\n      let map = this._map;\n      let overlayToRemove = this._imageOverlay;\n      let src = this.getImageUrl(bounds, zoom);\n      let size = map.getSize();\n      this._imageOverlay = M.imageLayer(src, loc, size, 0, this._container);\n      this._imageOverlay._step = this._template.step;\n      this._imageOverlay.addTo(map);\n      if (overlayToRemove) {\n        this._imageOverlay._overlayToRemove = overlayToRemove._url;\n        this._imageOverlay.on('load error', function () {\n          map.removeLayer(overlayToRemove);\n        });\n      }\n    },\n\n    _scaleImage: function (bounds, zoom) {\n      let obj = this;\n      setTimeout(function () {\n        let step = obj._template.step;\n        let steppedZoom = Math.floor(zoom / step) * step;\n        let scale = obj._map.getZoomScale(zoom, steppedZoom);\n        let translate = bounds.min\n          .multiplyBy(scale)\n          .subtract(obj._map._getNewPixelOrigin(obj._map.getCenter(), zoom))\n          .round();\n        L.DomUtil.setTransform(obj._imageOverlay._image, translate, scale);\n      });\n    },\n\n    _onAdd: function () {\n      let zoom = this._map.getZoom();\n      let steppedZoom = zoom;\n      let step = this._template.step;\n\n      if (zoom % step !== 0) steppedZoom = Math.floor(zoom / step) * step;\n      let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n      this._pixelOrigins = {};\n      this._pixelOrigins[steppedZoom] = bounds.min;\n      // if the map is panned before the new image layer is added,\n      // the location that the layer should be added to is no longer (0,0) but need to be calculated\n      let loc = this._map\n        .getPixelBounds()\n        .min.subtract(this._map.getPixelOrigin());\n      this._addImage(bounds, steppedZoom, loc);\n      if (zoom !== steppedZoom) {\n        this._scaleImage(bounds, zoom);\n      }\n    },\n\n    _onMoveEnd: function (e) {\n      let mapZoom = this._map.getZoom();\n      let history = this._map.options.mapEl._history;\n      let current = history[history.length - 1];\n      let previous = history[history.length - 2];\n      if (!previous) previous = current;\n      let step = this._template.step;\n      let steppedZoom = Math.floor(mapZoom / step) * step;\n      let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n      //Zooming from one step increment into a lower one\n      if (\n        step !== '1' &&\n        (mapZoom + 1) % step === 0 &&\n        current.zoom === previous.zoom - 1\n      ) {\n        this._addImage(bounds, steppedZoom, L.point(0, 0));\n        this._scaleImage(bounds, mapZoom);\n        //Zooming or panning within a step increment\n      } else if (e && mapZoom % step !== 0) {\n        this._imageOverlay._overlayToRemove = this._imageOverlay._url;\n        if (current.zoom !== previous.zoom) {\n          //Zoomed from within one step increment into another\n          this._addImage(bounds, steppedZoom, L.point(0, 0));\n          this._pixelOrigins[steppedZoom] = bounds.min;\n          this._scaleImage(bounds, mapZoom);\n        } else {\n          // Panning within a step increment\n          let pixelOrigin = this._pixelOrigins[steppedZoom];\n          let loc = bounds.min.subtract(pixelOrigin);\n          if (this.getImageUrl(bounds, steppedZoom) === this._imageOverlay._url)\n            return;\n          this._addImage(bounds, steppedZoom, loc);\n          this._scaleImage(bounds, mapZoom);\n        }\n        // Zooming from one step decrement into a higher one\n        // OR panning when mapZoom % step === 0\n      } else {\n        let mapBounds = M.pixelToPCRSBounds(\n          this._map.getPixelBounds(),\n          mapZoom,\n          this._map.options.projection\n        );\n        this.isVisible =\n          mapZoom <= this.zoomBounds.maxZoom &&\n          mapZoom >= this.zoomBounds.minZoom &&\n          this.extentBounds.overlaps(mapBounds);\n        if (!this.isVisible) {\n          this._clearLayer();\n          return;\n        }\n        var map = this._map,\n          loc = map.getPixelBounds().min.subtract(map.getPixelOrigin());\n        this._addImage(map.getPixelBounds(), mapZoom, loc);\n        this._pixelOrigins[mapZoom] = map.getPixelOrigin();\n      }\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    onRemove: function (map) {\n      this._clearLayer();\n      map._removeZoomLimit(this);\n      this._container = null;\n    },\n    getImageUrl: function (pixelBounds, zoom) {\n      var obj = {};\n      obj[this.options.extent.width] = this._map.getSize().x;\n      obj[this.options.extent.height] = this._map.getSize().y;\n      obj[this.options.extent.bottom] = this._TCRSToPCRS(pixelBounds.max, zoom).y;\n      obj[this.options.extent.left] = this._TCRSToPCRS(pixelBounds.min, zoom).x;\n      obj[this.options.extent.top] = this._TCRSToPCRS(pixelBounds.min, zoom).y;\n      obj[this.options.extent.right] = this._TCRSToPCRS(pixelBounds.max, zoom).x;\n      // hidden and other variables that may be associated\n      for (var v in this.options.extent) {\n        if (\n          ['width', 'height', 'left', 'right', 'top', 'bottom'].indexOf(v) < 0\n        ) {\n          obj[v] = this.options.extent[v];\n        }\n      }\n      return L.Util.template(this._template.template, obj);\n    },\n    _TCRSToPCRS: function (coords, zoom) {\n      // TCRS pixel point to Projected CRS point (in meters, presumably)\n      var map = this._map,\n        crs = map.options.crs,\n        loc = crs.transformation.untransform(coords, crs.scale(zoom));\n      return loc;\n    },\n    _setUpExtentTemplateVars: function (template) {\n      // process the inputs associated to template and create an object named\n      // extent with member properties as follows:\n      // {width: 'widthvarname',\n      //  height: 'heightvarname',\n      //  left: 'leftvarname',\n      //  right: 'rightvarname',\n      //  top: 'topvarname',\n      //  bottom: 'bottomvarname'}\n\n      var extentVarNames = { extent: {} },\n        inputs = template.values;\n\n      for (var i = 0; i < template.values.length; i++) {\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select';\n        if (type === 'width') {\n          extentVarNames.extent.width = name;\n        } else if (type === 'height') {\n          extentVarNames.extent.height = name;\n        } else if (\n          type === 'location' &&\n          (units === 'pcrs' || units === 'gcrs')\n        ) {\n          //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting|latitude|longitude\">\n          switch (axis) {\n            case 'longitude':\n            case 'easting':\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  extentVarNames.extent.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  extentVarNames.extent.right = name;\n                }\n              }\n              break;\n            case 'latitude':\n            case 'northing':\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  extentVarNames.extent.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  extentVarNames.extent.bottom = name;\n                }\n              }\n              break;\n          }\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          extentVarNames.extent[name] = function () {\n            return parsedselect.value;\n          };\n        } else {\n          /*jshint -W104 */\n          const input = inputs[i];\n          extentVarNames.extent[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      return extentVarNames;\n    }\n  });\n  var templatedImageLayer = function (template, options) {\n    return new TemplatedImageLayer(template, options);\n  };\n\n  var ImageLayer = L.ImageOverlay.extend({\n    initialize: function (url, location, size, angle, container, options) {\n      // (String, Point, Point, Number, Element, Object)\n      this._container = container;\n      this._url = url;\n      // instead of calculating where the image goes, put it at 0,0\n      //this._location = L.point(location);\n      // the location for WMS requests will be the upper left hand\n      // corner of the map.  When the map is initialized, that is 0,0,\n      // but as the user pans, of course the\n      this._location = location;\n      this._size = L.point(size);\n      this._angle = angle;\n\n      L.setOptions(this, options);\n    },\n    getEvents: function () {\n      var events = {\n        viewreset: this._reset\n      };\n\n      if (this._zoomAnimated && this._step <= 1) {\n        events.zoomanim = this._animateZoom;\n      }\n\n      return events;\n    },\n    onAdd: function () {\n      this.on({\n        load: this._onImageLoad\n      });\n\n      if (!this._image) {\n        this._initImage();\n      }\n\n      if (this.options.interactive) {\n        L.DomUtil.addClass(this._image, 'leaflet-interactive');\n        this.addInteractiveTarget(this._image);\n      }\n\n      this._container.appendChild(this._image);\n      this._reset();\n    },\n    onRemove: function () {\n      L.DomUtil.remove(this._image);\n      if (this.options.interactive) {\n        this.removeInteractiveTarget(this._image);\n      }\n    },\n    _onImageLoad: function () {\n      if (!this._image) {\n        return;\n      }\n      this._image.loaded = +new Date();\n      this._updateOpacity();\n    },\n    _animateZoom: function (e) {\n      var scale = this._map.getZoomScale(e.zoom),\n        translate = this._map\n          .getPixelOrigin()\n          .add(this._location)\n          .multiplyBy(scale)\n          .subtract(this._map._getNewPixelOrigin(e.center, e.zoom))\n          .round();\n\n      if (L.Browser.any3d) {\n        L.DomUtil.setTransform(this._image, translate, scale);\n      } else {\n        L.DomUtil.setPosition(this._image, translate);\n      }\n    },\n    _reset: function (e) {\n      var image = this._image,\n        location = this._location,\n        size = this._size;\n      // TBD use the angle to establish the image rotation in CSS\n\n      if (\n        e &&\n        this._step > 1 &&\n        (this._overlayToRemove === undefined ||\n          this._url === this._overlayToRemove)\n      ) {\n        return;\n      }\n      L.DomUtil.setPosition(image, location);\n\n      image.style.width = size.x + 'px';\n      image.style.height = size.y + 'px';\n    },\n    _updateOpacity: function () {\n      if (!this._map) {\n        return;\n      }\n\n      //L.DomUtil.setOpacity(this._image, this.options.opacity);\n\n      var now = +new Date(),\n        nextFrame = false;\n\n      var image = this._image;\n\n      var fade = Math.min(1, (now - image.loaded) / 200);\n\n      L.DomUtil.setOpacity(image, fade);\n      if (fade < 1) {\n        nextFrame = true;\n      }\n      if (nextFrame) {\n        L.Util.cancelAnimFrame(this._fadeFrame);\n        this._fadeFrame = L.Util.requestAnimFrame(this._updateOpacity, this);\n      }\n      L.DomUtil.addClass(image, 'leaflet-image-loaded');\n    }\n  });\n  var imageLayer = function (\n    url,\n    location,\n    size,\n    angle,\n    container,\n    options\n  ) {\n    return new ImageLayer(url, location, size, angle, container, options);\n  };\n\n  var MapMLLayer = L.Layer.extend({\n    // zIndex has to be set, for the case where the layer is added to the\n    // map before the layercontrol is used to control it (where autoZindex is used)\n    // e.g. in the raw MapML-Leaflet-Client index.html page.\n    options: {\n      maxNext: 10,\n      zIndex: 0,\n      maxZoom: 25,\n      opacity: '1.0'\n    },\n    // initialize is executed before the layer is added to a map\n    initialize: function (href, content, options) {\n      // in the custom element, the attribute is actually 'src'\n      // the _href version is the URL received from layer-@src\n      var mapml;\n      if (href) {\n        this._href = href;\n      }\n      if (content) {\n        this._layerEl = content;\n        mapml = content.querySelector('map-feature,map-tile,map-extent')\n          ? true\n          : false;\n        if (!href && mapml) {\n          this._content = content;\n        }\n      }\n      L.setOptions(this, options);\n      this._container = L.DomUtil.create('div', 'leaflet-layer');\n      this.changeOpacity(this.options.opacity);\n      L.DomUtil.addClass(this._container, 'mapml-layer');\n      this._imageContainer = L.DomUtil.create(\n        'div',\n        'leaflet-layer',\n        this._container\n      );\n      L.DomUtil.addClass(this._imageContainer, 'mapml-image-container');\n\n      // this layer 'owns' a mapmlTileLayer, which is a subclass of L.GridLayer\n      // it 'passes' what tiles to load via the content of this._mapmlTileContainer\n      this._mapmlTileContainer = L.DomUtil.create(\n        'div',\n        'mapml-tile-container',\n        this._container\n      );\n      // hit the service to determine what its extent might be\n      // OR use the extent of the content provided\n\n      if (!mapml && content && content.hasAttribute('label'))\n        this._title = content.getAttribute('label');\n      this._initialize(mapml ? content : null);\n\n      // a default extent can't be correctly set without the map to provide\n      // its bounds , projection, zoom range etc, so if that stuff's not\n      // established by metadata in the content, we should use map properties\n      // to set the extent, but the map won't be available until the <layer>\n      // element is attached to the <map> element, wait for that to happen.\n      this.on('attached', this._validateExtent, this);\n      // weirdness.  options is actually undefined here, despite the hardcoded\n      // options above. If you use this.options, you see the options defined\n      // above.  Not going to change this, but failing to understand ATM.\n      // may revisit some time.\n      this.validProjection = true;\n\n      // _mapmlLayerItem is set to the root element representing this layer\n      // in the layer control, iff the layer is not 'hidden'\n      this._mapmlLayerItem = {};\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    getHref: function () {\n      return this._href ?? '';\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    // remove all the extents before removing the layer from the map\n    _removeExtents: function (map) {\n      if (this._extent._mapExtents) {\n        for (let i = 0; i < this._extent._mapExtents.length; i++) {\n          if (this._extent._mapExtents[i].templatedLayer) {\n            map.removeLayer(this._extent._mapExtents[i].templatedLayer);\n          }\n        }\n      }\n      if (this._extent._queries) {\n        delete this._extent._queries;\n      }\n    },\n    _changeOpacity: function (e) {\n      if (e && e.target && e.target.value >= 0 && e.target.value <= 1.0) {\n        this.changeOpacity(e.target.value);\n      }\n    },\n    changeOpacity: function (opacity) {\n      this._container.style.opacity = opacity;\n      if (this.opacityEl) this.opacityEl.value = opacity;\n    },\n    _changeExtentOpacity: function (e) {\n      if (e && e.target && e.target.value >= 0 && e.target.value <= 1.0) {\n        this.templatedLayer.changeOpacity(e.target.value);\n        this._templateVars.opacity = e.target.value;\n      }\n    },\n    _changeExtent: function (e, extentEl) {\n      if (e.target.checked) {\n        extentEl.checked = true;\n        if (this._layerEl.checked) {\n          extentEl.templatedLayer = M.templatedLayer(extentEl._templateVars, {\n            pane: this._container,\n            opacity: extentEl._templateVars.opacity,\n            _leafletLayer: this,\n            crs: extentEl.crs,\n            extentZIndex: extentEl.extentZIndex,\n            extentEl: extentEl._DOMnode || extentEl\n          }).addTo(this._map);\n          extentEl.templatedLayer.setZIndex();\n          this._setLayerElExtent();\n        }\n      } else {\n        L.DomEvent.stopPropagation(e);\n        extentEl.checked = false;\n        if (this._layerEl.checked) this._map.removeLayer(extentEl.templatedLayer);\n        this._setLayerElExtent();\n      }\n    },\n    setName(newName) {\n      // a layer's accessible name is set by the <map-title>, if present\n      // if it's not available the <layer- label=\"accessible-name\"> attribute\n      // can be used\n      if (!this._titleIsReadOnly) {\n        this._title = newName;\n        this._mapmlLayerItem.querySelector('.mapml-layer-item-name').innerHTML =\n          newName;\n      }\n    },\n    getName() {\n      return this._title;\n    },\n\n    onAdd: function (map) {\n      if (this._extent && !this._validProjection(map)) {\n        this.validProjection = false;\n        return;\n      }\n      this._map = map;\n      if (this._content) {\n        if (!this._mapmlvectors) {\n          this._mapmlvectors = M.featureLayer(this._content, {\n            // pass the vector layer a renderer of its own, otherwise leaflet\n            // puts everything into the overlayPane\n            renderer: M.featureRenderer(),\n            // pass the vector layer the container for the parent into which\n            // it will append its own container for rendering into\n            pane: this._container,\n            opacity: this.options.opacity,\n            projection: map.options.projection,\n            // each owned child layer gets a reference to the root layer\n            _leafletLayer: this,\n            static: true,\n            onEachFeature: function (properties, geometry) {\n              // need to parse as HTML to preserve semantics and styles\n              if (properties) {\n                var c = document.createElement('div');\n                c.classList.add('mapml-popup-content');\n                c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n                geometry.bindPopup(c, { autoClose: false, minWidth: 165 });\n              }\n            }\n          });\n        }\n        this._setLayerElExtent();\n        map.addLayer(this._mapmlvectors);\n      } else {\n        this.once(\n          'extentload',\n          function () {\n            if (!this._validProjection(map)) {\n              this.validProjection = false;\n              return;\n            }\n            if (!this._mapmlvectors) {\n              this._mapmlvectors = M.featureLayer(this._content, {\n                // pass the vector layer a renderer of its own, otherwise leaflet\n                // puts everything into the overlayPane\n                renderer: M.featureRenderer(),\n                // pass the vector layer the container for the parent into which\n                // it will append its own container for rendering into\n                pane: this._container,\n                opacity: this.options.opacity,\n                projection: map.options.projection,\n                // each owned child layer gets a reference to the root layer\n                _leafletLayer: this,\n                static: true,\n                onEachFeature: function (properties, geometry) {\n                  // need to parse as HTML to preserve semantics and styles\n                  if (properties) {\n                    var c = document.createElement('div');\n                    c.classList.add('mapml-popup-content');\n                    c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n                    geometry.bindPopup(c, { autoClose: false, minWidth: 165 });\n                  }\n                }\n              }).addTo(map);\n            }\n            this._setLayerElExtent();\n          },\n          this\n        );\n      }\n\n      if (!this._imageLayer) {\n        this._imageLayer = L.layerGroup();\n      }\n      map.addLayer(this._imageLayer);\n      // the layer._imageContainer property contains an element in which\n      // content will be maintained\n\n      //only add the layer if there are tiles to be rendered\n      if (\n        (!this._staticTileLayer || this._staticTileLayer._container === null) &&\n        this._mapmlTileContainer.getElementsByTagName('map-tiles').length > 0\n      ) {\n        this._staticTileLayer = M.staticTileLayer({\n          pane: this._container,\n          _leafletLayer: this,\n          className: 'mapml-static-tile-layer',\n          tileContainer: this._mapmlTileContainer,\n          maxZoomBound: map.options.crs.options.resolutions.length - 1,\n          tileSize: map.options.crs.options.crs.tile.bounds.max.x\n        });\n        map.addLayer(this._staticTileLayer);\n        this._setLayerElExtent();\n      }\n\n      const createAndAdd = createAndAddTemplatedLayers.bind(this);\n      // if the extent has been initialized and received, update the map,\n      if (\n        this._extent &&\n        this._extent._mapExtents &&\n        this._extent._mapExtents[0]._templateVars\n      ) {\n        createAndAdd();\n      } else {\n        // wait for extent to be loaded\n        this.once(\n          'extentload',\n          function () {\n            if (!this._validProjection(map)) {\n              this.validProjection = false;\n              return;\n            }\n            createAndAdd();\n          },\n          this\n        );\n      }\n\n      this.setZIndex(this.options.zIndex);\n      this.getPane().appendChild(this._container);\n      setTimeout(() => {\n        map.fire('checkdisabled');\n      }, 0);\n      map.on('popupopen', this._attachSkipButtons, this);\n\n      function createAndAddTemplatedLayers() {\n        if (this._extent && this._extent._mapExtents) {\n          for (let i = 0; i < this._extent._mapExtents.length; i++) {\n            if (\n              this._extent._mapExtents[i]._templateVars &&\n              this._extent._mapExtents[i].checked\n            ) {\n              if (!this._extent._mapExtents[i].extentZIndex)\n                this._extent._mapExtents[i].extentZIndex = i;\n              this._templatedLayer = M.templatedLayer(\n                this._extent._mapExtents[i]._templateVars,\n                {\n                  pane: this._container,\n                  opacity: this._extent._mapExtents[i]._templateVars.opacity,\n                  _leafletLayer: this,\n                  crs: this._extent.crs,\n                  extentZIndex: this._extent._mapExtents[i].extentZIndex,\n                  // when a <map-extent> migrates from a remote mapml file and attaches to the shadow of <layer- >\n                  // this._extent._mapExtents[i] refers to the <map-extent> in remote mapml\n                  extentEl:\n                    this._extent._mapExtents[i]._DOMnode ||\n                    this._extent._mapExtents[i]\n                }\n              ).addTo(map);\n              this._extent._mapExtents[i].templatedLayer = this._templatedLayer;\n              if (this._templatedLayer._queries) {\n                if (!this._extent._queries) this._extent._queries = [];\n                this._extent._queries = this._extent._queries.concat(\n                  this._templatedLayer._queries\n                );\n              }\n            }\n            if (this._extent._mapExtents[i].hasAttribute('opacity')) {\n              let opacity = this._extent._mapExtents[i].getAttribute('opacity');\n              this._extent._mapExtents[i].templatedLayer.changeOpacity(opacity);\n            }\n          }\n          this._setLayerElExtent();\n        }\n      }\n    },\n\n    _validProjection: function (map) {\n      let noLayer = false;\n      if (this._extent && this._extent._mapExtents) {\n        for (let i = 0; i < this._extent._mapExtents.length; i++) {\n          if (this._extent._mapExtents[i]._templateVars) {\n            for (let template of this._extent._mapExtents[i]._templateVars)\n              if (\n                !template.projectionMatch &&\n                template.projection !== map.options.projection\n              ) {\n                noLayer = true; // if there's a single template where projections don't match, set noLayer to true\n                break;\n              }\n          }\n        }\n      }\n      return !(\n        noLayer || this.getProjection() !== map.options.projection.toUpperCase()\n      );\n    },\n\n    //sets the <layer-> elements .bounds property\n    _setLayerElExtent: function () {\n      let bounds,\n        zoomMax,\n        zoomMin,\n        maxNativeZoom,\n        minNativeZoom,\n        zoomBounds = {\n          minZoom: 0,\n          maxZoom: 0,\n          maxNativeZoom: 0,\n          minNativeZoom: 0\n        };\n      let layerTypes = [\n        '_staticTileLayer',\n        '_imageLayer',\n        '_mapmlvectors',\n        '_templatedLayer'\n      ];\n      layerTypes.forEach((type) => {\n        if (this[type]) {\n          if (type === '_templatedLayer') {\n            for (let i = 0; i < this._extent._mapExtents.length; i++) {\n              for (\n                let j = 0;\n                j < this._extent._mapExtents[i]._templateVars.length;\n                j++\n              ) {\n                let inputData = M._extractInputBounds(\n                  this._extent._mapExtents[i]._templateVars[j]\n                );\n                this._extent._mapExtents[i]._templateVars[j].tempExtentBounds =\n                  inputData.bounds;\n                this._extent._mapExtents[i]._templateVars[j].extentZoomBounds =\n                  inputData.zoomBounds;\n              }\n            }\n            for (let i = 0; i < this._extent._mapExtents.length; i++) {\n              if (this._extent._mapExtents[i].checked) {\n                for (\n                  let j = 0;\n                  j < this._extent._mapExtents[i]._templateVars.length;\n                  j++\n                ) {\n                  if (!bounds) {\n                    bounds =\n                      this._extent._mapExtents[i]._templateVars[j]\n                        .tempExtentBounds;\n                    zoomMax =\n                      this._extent._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.maxZoom;\n                    zoomMin =\n                      this._extent._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.minZoom;\n                    maxNativeZoom =\n                      this._extent._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.maxNativeZoom;\n                    minNativeZoom =\n                      this._extent._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.minNativeZoom;\n                  } else {\n                    bounds.extend(\n                      this._extent._mapExtents[i]._templateVars[j]\n                        .tempExtentBounds.min\n                    );\n                    bounds.extend(\n                      this._extent._mapExtents[i]._templateVars[j]\n                        .tempExtentBounds.max\n                    );\n                    zoomMax = Math.max(\n                      zoomMax,\n                      this._extent._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.maxZoom\n                    );\n                    zoomMin = Math.min(\n                      zoomMin,\n                      this._extent._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.minZoom\n                    );\n                    maxNativeZoom = Math.max(\n                      maxNativeZoom,\n                      this._extent._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.maxNativeZoom\n                    );\n                    minNativeZoom = Math.min(\n                      minNativeZoom,\n                      this._extent._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.minNativeZoom\n                    );\n                  }\n                }\n              }\n            }\n            zoomBounds.minZoom = zoomMin;\n            zoomBounds.maxZoom = zoomMax;\n            zoomBounds.minNativeZoom = minNativeZoom;\n            zoomBounds.maxNativeZoom = maxNativeZoom;\n            this._extent.zoomBounds = zoomBounds;\n            this._extent.layerBounds = bounds;\n            // assign each template the layer and zoom bounds\n            for (let i = 0; i < this._extent._mapExtents.length; i++) {\n              this._extent._mapExtents[i].templatedLayer.layerBounds = bounds;\n              this._extent._mapExtents[i].templatedLayer.zoomBounds = zoomBounds;\n            }\n          } else {\n            if (this[type].layerBounds) {\n              if (!bounds) {\n                bounds = this[type].layerBounds;\n                zoomBounds = this[type].zoomBounds;\n              } else {\n                bounds.extend(this[type].layerBounds.min);\n                bounds.extend(this[type].layerBounds.max);\n              }\n            }\n          }\n        }\n      });\n      if (bounds) {\n        //assigns the formatted extent object to .extent and spreads the zoom ranges to .extent also\n        this._layerEl.extent = Object.assign(\n          M._convertAndFormatPCRS(bounds, this._map),\n          { zoom: zoomBounds }\n        );\n      }\n    },\n\n    addTo: function (map) {\n      map.addLayer(this);\n      return this;\n    },\n    getEvents: function () {\n      return { zoomanim: this._onZoomAnim };\n    },\n    redraw: function () {\n      // for now, only redraw templated layers.\n      if (this._extent._mapExtents) {\n        for (let i = 0; i < this._extent._mapExtents.length; i++) {\n          if (this._extent._mapExtents[i].templatedLayer) {\n            this._extent._mapExtents[i].templatedLayer.redraw();\n          }\n        }\n      }\n    },\n    _onZoomAnim: function (e) {\n      // this callback will be invoked AFTER <layer- > has been removed\n      // but due to the characteristic of JavaScript, the context (this pointer) can still be used\n      // the easiest way to solve this:\n      if (!this._map) {\n        return;\n      }\n      // get the min and max zooms from all extents\n      var toZoom = e.zoom,\n        zoom =\n          this._extent && this._extent._mapExtents\n            ? this._extent._mapExtents[0].querySelector('map-input[type=zoom]')\n            : null,\n        min =\n          zoom && zoom.hasAttribute('min')\n            ? parseInt(zoom.getAttribute('min'))\n            : this._map.getMinZoom(),\n        max =\n          zoom && zoom.hasAttribute('max')\n            ? parseInt(zoom.getAttribute('max'))\n            : this._map.getMaxZoom();\n      if (zoom) {\n        for (let i = 1; i < this._extent._mapExtents.length; i++) {\n          zoom = this._extent._mapExtents[i].querySelector(\n            'map-input[type=zoom]'\n          );\n          if (zoom && zoom.hasAttribute('min')) {\n            min = Math.min(parseInt(zoom.getAttribute('min')), min);\n          }\n          if (zoom && zoom.hasAttribute('max')) {\n            max = Math.max(parseInt(zoom.getAttribute('max')), max);\n          }\n        }\n      }\n      var canZoom =\n        (toZoom < min && this._extent.zoomout) ||\n        (toZoom > max && this._extent.zoomin);\n      if (!(min <= toZoom && toZoom <= max)) {\n        if (this._extent.zoomin && toZoom > max) {\n          // this._href is the 'original' url from which this layer came\n          // since we are following a zoom link we will be getting a new\n          // layer almost, resetting child content as appropriate\n          this._href = this._extent.zoomin;\n          this._layerEl.src = this._extent.zoomin;\n          // this.href is the \"public\" property. When a dynamic layer is\n          // accessed, this value changes with every new extent received\n          this.href = this._extent.zoomin;\n          this._layerEl.src = this._extent.zoomin;\n        } else if (this._extent.zoomout && toZoom < min) {\n          this._href = this._extent.zoomout;\n          this.href = this._extent.zoomout;\n          this._layerEl.src = this._extent.zoomout;\n        }\n      }\n      if (this._templatedLayer && canZoom) ;\n    },\n    onRemove: function (map) {\n      L.DomUtil.remove(this._container);\n      if (this._staticTileLayer) map.removeLayer(this._staticTileLayer);\n      if (this._mapmlvectors) map.removeLayer(this._mapmlvectors);\n      if (this._imageLayer) map.removeLayer(this._imageLayer);\n      if (this._extent && this._extent._mapExtents) this._removeExtents(map);\n\n      map.fire('checkdisabled');\n      map.off('popupopen', this._attachSkipButtons);\n    },\n    getAttribution: function () {\n      return this.options.attribution;\n    },\n\n    getLayerExtentHTML: function (labelName, i) {\n      var extent = L.DomUtil.create('fieldset', 'mapml-layer-extent'),\n        extentProperties = L.DomUtil.create(\n          'div',\n          'mapml-layer-item-properties',\n          extent\n        ),\n        extentSettings = L.DomUtil.create(\n          'div',\n          'mapml-layer-item-settings',\n          extent\n        ),\n        extentLabel = L.DomUtil.create(\n          'label',\n          'mapml-layer-item-toggle',\n          extentProperties\n        ),\n        input = L.DomUtil.create('input'),\n        svgExtentControlIcon = L.SVG.create('svg'),\n        extentControlPath1 = L.SVG.create('path'),\n        extentControlPath2 = L.SVG.create('path'),\n        extentNameIcon = L.DomUtil.create('span'),\n        extentItemControls = L.DomUtil.create(\n          'div',\n          'mapml-layer-item-controls',\n          extentProperties\n        ),\n        opacityControl = L.DomUtil.create(\n          'details',\n          'mapml-layer-item-opacity',\n          extentSettings\n        ),\n        extentOpacitySummary = L.DomUtil.create('summary', '', opacityControl),\n        mapEl = this._layerEl.parentNode,\n        layerEl = this._layerEl,\n        opacity = L.DomUtil.create('input', '', opacityControl);\n      extentSettings.hidden = true;\n      extent.setAttribute('aria-grabbed', 'false');\n      if (!labelName) {\n        // if a label attribute is not present, set it to hidden in layer control\n        extent.setAttribute('hidden', '');\n        this._extent._mapExtents[i].hidden = true;\n      }\n\n      // append the svg paths\n      svgExtentControlIcon.setAttribute('viewBox', '0 0 24 24');\n      svgExtentControlIcon.setAttribute('height', '22');\n      svgExtentControlIcon.setAttribute('width', '22');\n      extentControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n      extentControlPath1.setAttribute('fill', 'none');\n      extentControlPath2.setAttribute(\n        'd',\n        'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z'\n      );\n      svgExtentControlIcon.appendChild(extentControlPath1);\n      svgExtentControlIcon.appendChild(extentControlPath2);\n\n      let removeExtentButton = L.DomUtil.create(\n        'button',\n        'mapml-layer-item-remove-control',\n        extentItemControls\n      );\n      removeExtentButton.type = 'button';\n      removeExtentButton.title = 'Remove Sub Layer';\n      removeExtentButton.innerHTML = \"<span aria-hidden='true'>&#10005;</span>\";\n      removeExtentButton.classList.add('mapml-button');\n      L.DomEvent.on(removeExtentButton, 'click', L.DomEvent.stop);\n      L.DomEvent.on(\n        removeExtentButton,\n        'click',\n        (e) => {\n          let allRemoved = true;\n          e.target.checked = false;\n          this._extent._mapExtents[i].removed = true;\n          this._extent._mapExtents[i].checked = false;\n          if (this._layerEl.checked)\n            this._changeExtent(e, this._extent._mapExtents[i]);\n          this._extent._mapExtents[i].extentAnatomy.parentNode.removeChild(\n            this._extent._mapExtents[i].extentAnatomy\n          );\n          for (let j = 0; j < this._extent._mapExtents.length; j++) {\n            if (!this._extent._mapExtents[j].removed) allRemoved = false;\n          }\n          if (allRemoved)\n            this._layerItemSettingsHTML.removeChild(this._extentGroupAnatomy);\n        },\n        this\n      );\n\n      let extentsettingsButton = L.DomUtil.create(\n        'button',\n        'mapml-layer-item-settings-control',\n        extentItemControls\n      );\n      extentsettingsButton.type = 'button';\n      extentsettingsButton.title = 'Extent Settings';\n      extentsettingsButton.setAttribute('aria-expanded', false);\n      extentsettingsButton.classList.add('mapml-button');\n      L.DomEvent.on(\n        extentsettingsButton,\n        'click',\n        (e) => {\n          if (extentSettings.hidden === true) {\n            extentsettingsButton.setAttribute('aria-expanded', true);\n            extentSettings.hidden = false;\n          } else {\n            extentsettingsButton.setAttribute('aria-expanded', false);\n            extentSettings.hidden = true;\n          }\n        },\n        this\n      );\n\n      extentNameIcon.setAttribute('aria-hidden', true);\n      extentLabel.appendChild(input);\n      extentsettingsButton.appendChild(extentNameIcon);\n      extentNameIcon.appendChild(svgExtentControlIcon);\n      extentOpacitySummary.innerText = 'Opacity';\n      extentOpacitySummary.id =\n        'mapml-layer-item-opacity-' + L.stamp(extentOpacitySummary);\n      opacity.setAttribute('type', 'range');\n      opacity.setAttribute('min', '0');\n      opacity.setAttribute('max', '1.0');\n      opacity.setAttribute('step', '0.1');\n      opacity.setAttribute(\n        'aria-labelledby',\n        'mapml-layer-item-opacity-' + L.stamp(extentOpacitySummary)\n      );\n      let opacityValue = this._extent._mapExtents[i].hasAttribute('opacity')\n        ? this._extent._mapExtents[i].getAttribute('opacity')\n        : '1.0';\n      this._extent._mapExtents[i]._templateVars.opacity = opacityValue;\n      opacity.setAttribute('value', opacityValue);\n      opacity.value = opacityValue;\n      L.DomEvent.on(\n        opacity,\n        'change',\n        this._changeExtentOpacity,\n        this._extent._mapExtents[i]\n      );\n\n      var extentItemNameSpan = L.DomUtil.create(\n        'span',\n        'mapml-layer-item-name',\n        extentLabel\n      );\n      input.defaultChecked = this._extent._mapExtents[i] ? true : false;\n      this._extent._mapExtents[i].checked = input.defaultChecked;\n      input.type = 'checkbox';\n      extentItemNameSpan.innerHTML = labelName;\n      L.DomEvent.on(input, 'change', (e) => {\n        this._changeExtent(e, this._extent._mapExtents[i]);\n      });\n      extentItemNameSpan.id =\n        'mapml-extent-item-name-{' + L.stamp(extentItemNameSpan) + '}';\n      extent.setAttribute('aria-labelledby', extentItemNameSpan.id);\n      extentItemNameSpan.extent = this._extent._mapExtents[i];\n\n      extent.ontouchstart = extent.onmousedown = (downEvent) => {\n        if (\n          (downEvent.target.parentElement.tagName.toLowerCase() === 'label' &&\n            downEvent.target.tagName.toLowerCase() !== 'input') ||\n          downEvent.target.tagName.toLowerCase() === 'label'\n        ) {\n          downEvent.stopPropagation();\n          downEvent =\n            downEvent instanceof TouchEvent ? downEvent.touches[0] : downEvent;\n\n          let control = extent,\n            controls = extent.parentNode,\n            moving = false,\n            yPos = downEvent.clientY;\n\n          document.body.ontouchmove = document.body.onmousemove = (moveEvent) => {\n            moveEvent.preventDefault();\n            moveEvent =\n              moveEvent instanceof TouchEvent ? moveEvent.touches[0] : moveEvent;\n\n            // Fixes flickering by only moving element when there is enough space\n            let offset = moveEvent.clientY - yPos;\n            moving = Math.abs(offset) > 5 || moving;\n            if (\n              (controls && !moving) ||\n              (controls && controls.childElementCount <= 1) ||\n              controls.getBoundingClientRect().top >\n                control.getBoundingClientRect().bottom ||\n              controls.getBoundingClientRect().bottom <\n                control.getBoundingClientRect().top\n            ) {\n              return;\n            }\n\n            controls.classList.add('mapml-draggable');\n            control.style.transform = 'translateY(' + offset + 'px)';\n            control.style.pointerEvents = 'none';\n\n            let x = moveEvent.clientX,\n              y = moveEvent.clientY,\n              root =\n                mapEl.tagName === 'MAPML-VIEWER'\n                  ? mapEl.shadowRoot\n                  : mapEl.querySelector('.mapml-web-map').shadowRoot,\n              elementAt = root.elementFromPoint(x, y),\n              swapControl =\n                !elementAt || !elementAt.closest('fieldset')\n                  ? control\n                  : elementAt.closest('fieldset');\n\n            swapControl =\n              Math.abs(offset) <= swapControl.offsetHeight\n                ? control\n                : swapControl;\n\n            control.setAttribute('aria-grabbed', 'true');\n            control.setAttribute('aria-dropeffect', 'move');\n            if (swapControl && controls === swapControl.parentNode) {\n              swapControl =\n                swapControl !== control.nextSibling\n                  ? swapControl\n                  : swapControl.nextSibling;\n              if (control !== swapControl) {\n                yPos = moveEvent.clientY;\n                control.style.transform = null;\n              }\n              controls.insertBefore(control, swapControl);\n            }\n          };\n\n          document.body.ontouchend = document.body.onmouseup = () => {\n            control.setAttribute('aria-grabbed', 'false');\n            control.removeAttribute('aria-dropeffect');\n            control.style.pointerEvents = null;\n            control.style.transform = null;\n            let controlsElems = controls.children,\n              zIndex = 0;\n            for (let c of controlsElems) {\n              let extentEl = c.querySelector('span').extent;\n\n              extentEl.setAttribute('data-moving', '');\n              layerEl.insertAdjacentElement('beforeend', extentEl);\n              extentEl.removeAttribute('data-moving');\n\n              extentEl.extentZIndex = zIndex;\n              extentEl.templatedLayer.setZIndex(zIndex);\n              zIndex++;\n            }\n            controls.classList.remove('mapml-draggable');\n            document.body.ontouchmove =\n              document.body.onmousemove =\n              document.body.ontouchend =\n              document.body.onmouseup =\n                null;\n          };\n        }\n      };\n      return extent;\n    },\n\n    getLayerUserControlsHTML: function () {\n      var fieldset = L.DomUtil.create('fieldset', 'mapml-layer-item'),\n        input = L.DomUtil.create('input'),\n        layerItemName = L.DomUtil.create('span', 'mapml-layer-item-name'),\n        settingsButtonNameIcon = L.DomUtil.create('span'),\n        layerItemProperty = L.DomUtil.create(\n          'div',\n          'mapml-layer-item-properties',\n          fieldset\n        ),\n        layerItemSettings = L.DomUtil.create(\n          'div',\n          'mapml-layer-item-settings',\n          fieldset\n        ),\n        itemToggleLabel = L.DomUtil.create(\n          'label',\n          'mapml-layer-item-toggle',\n          layerItemProperty\n        ),\n        layerItemControls = L.DomUtil.create(\n          'div',\n          'mapml-layer-item-controls',\n          layerItemProperty\n        ),\n        opacityControl = L.DomUtil.create(\n          'details',\n          'mapml-layer-item-opacity mapml-control-layers',\n          layerItemSettings\n        ),\n        opacity = L.DomUtil.create('input'),\n        opacityControlSummary = L.DomUtil.create('summary'),\n        svgSettingsControlIcon = L.SVG.create('svg'),\n        settingsControlPath1 = L.SVG.create('path'),\n        settingsControlPath2 = L.SVG.create('path'),\n        extentsFieldset = L.DomUtil.create(\n          'fieldset',\n          'mapml-layer-grouped-extents'\n        ),\n        mapEl = this._layerEl.parentNode;\n      this.opacityEl = opacity;\n      this._mapmlLayerItem = fieldset;\n\n      // append the paths in svg for the remove layer and toggle icons\n      svgSettingsControlIcon.setAttribute('viewBox', '0 0 24 24');\n      svgSettingsControlIcon.setAttribute('height', '22');\n      svgSettingsControlIcon.setAttribute('width', '22');\n      svgSettingsControlIcon.setAttribute('fill', 'currentColor');\n      settingsControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n      settingsControlPath1.setAttribute('fill', 'none');\n      settingsControlPath2.setAttribute(\n        'd',\n        'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z'\n      );\n      svgSettingsControlIcon.appendChild(settingsControlPath1);\n      svgSettingsControlIcon.appendChild(settingsControlPath2);\n\n      layerItemSettings.hidden = true;\n      settingsButtonNameIcon.setAttribute('aria-hidden', true);\n\n      let removeControlButton = L.DomUtil.create(\n        'button',\n        'mapml-layer-item-remove-control',\n        layerItemControls\n      );\n      removeControlButton.type = 'button';\n      removeControlButton.title = 'Remove Layer';\n      removeControlButton.innerHTML = \"<span aria-hidden='true'>&#10005;</span>\";\n      removeControlButton.classList.add('mapml-button');\n      //L.DomEvent.disableClickPropagation(removeControlButton);\n      L.DomEvent.on(removeControlButton, 'click', L.DomEvent.stop);\n      L.DomEvent.on(\n        removeControlButton,\n        'click',\n        (e) => {\n          let fieldset = 0,\n            elem,\n            root;\n          root =\n            mapEl.tagName === 'MAPML-VIEWER'\n              ? mapEl.shadowRoot\n              : mapEl.querySelector('.mapml-web-map').shadowRoot;\n          if (\n            e.target.closest('fieldset').nextElementSibling &&\n            !e.target.closest('fieldset').nextElementSibling.disbaled\n          ) {\n            elem = e.target.closest('fieldset').previousElementSibling;\n            while (elem) {\n              fieldset += 2; // find the next layer menu item\n              elem = elem.previousElementSibling;\n            }\n          } else {\n            // focus on the link\n            elem = 'link';\n          }\n          mapEl.removeChild(\n            e.target.closest('fieldset').querySelector('span').layer._layerEl\n          );\n          elem = elem\n            ? root.querySelector('.leaflet-control-attribution').firstElementChild\n            : (elem = root.querySelectorAll('input')[fieldset]);\n          elem.focus();\n        },\n        this\n      );\n\n      let itemSettingControlButton = L.DomUtil.create(\n        'button',\n        'mapml-layer-item-settings-control',\n        layerItemControls\n      );\n      itemSettingControlButton.type = 'button';\n      itemSettingControlButton.title = 'Layer Settings';\n      itemSettingControlButton.setAttribute('aria-expanded', false);\n      itemSettingControlButton.classList.add('mapml-button');\n      L.DomEvent.on(\n        itemSettingControlButton,\n        'click',\n        (e) => {\n          let layerControl = this._layerEl._layerControl._container;\n          if (!layerControl._isExpanded && e.pointerType === 'touch') {\n            layerControl._isExpanded = true;\n            return;\n          }\n          if (layerItemSettings.hidden === true) {\n            itemSettingControlButton.setAttribute('aria-expanded', true);\n            layerItemSettings.hidden = false;\n          } else {\n            itemSettingControlButton.setAttribute('aria-expanded', false);\n            layerItemSettings.hidden = true;\n          }\n        },\n        this\n      );\n\n      input.defaultChecked = this._map ? true : false;\n      input.type = 'checkbox';\n      input.setAttribute('class', 'leaflet-control-layers-selector');\n      layerItemName.layer = this;\n\n      if (this._legendUrl) {\n        var legendLink = document.createElement('a');\n        legendLink.text = ' ' + this._title;\n        legendLink.href = this._legendUrl;\n        legendLink.target = '_blank';\n        legendLink.draggable = false;\n        layerItemName.appendChild(legendLink);\n      } else {\n        layerItemName.innerHTML = this._title;\n      }\n      layerItemName.id = 'mapml-layer-item-name-{' + L.stamp(layerItemName) + '}';\n      opacityControlSummary.innerText = 'Opacity';\n      opacityControlSummary.id =\n        'mapml-layer-item-opacity-' + L.stamp(opacityControlSummary);\n      opacityControl.appendChild(opacityControlSummary);\n      opacityControl.appendChild(opacity);\n      opacity.setAttribute('type', 'range');\n      opacity.setAttribute('min', '0');\n      opacity.setAttribute('max', '1.0');\n      opacity.setAttribute('value', this._container.style.opacity || '1.0');\n      opacity.setAttribute('step', '0.1');\n      opacity.setAttribute('aria-labelledby', opacityControlSummary.id);\n      opacity.value = this._container.style.opacity || '1.0';\n\n      fieldset.setAttribute('aria-grabbed', 'false');\n      fieldset.setAttribute('aria-labelledby', layerItemName.id);\n\n      fieldset.ontouchstart = fieldset.onmousedown = (downEvent) => {\n        if (\n          (downEvent.target.parentElement.tagName.toLowerCase() === 'label' &&\n            downEvent.target.tagName.toLowerCase() !== 'input') ||\n          downEvent.target.tagName.toLowerCase() === 'label'\n        ) {\n          downEvent =\n            downEvent instanceof TouchEvent ? downEvent.touches[0] : downEvent;\n          let control = fieldset,\n            controls = fieldset.parentNode,\n            moving = false,\n            yPos = downEvent.clientY;\n\n          document.body.ontouchmove = document.body.onmousemove = (moveEvent) => {\n            moveEvent.preventDefault();\n            moveEvent =\n              moveEvent instanceof TouchEvent ? moveEvent.touches[0] : moveEvent;\n\n            // Fixes flickering by only moving element when there is enough space\n            let offset = moveEvent.clientY - yPos;\n            moving = Math.abs(offset) > 5 || moving;\n            if (\n              (controls && !moving) ||\n              (controls && controls.childElementCount <= 1) ||\n              controls.getBoundingClientRect().top >\n                control.getBoundingClientRect().bottom ||\n              controls.getBoundingClientRect().bottom <\n                control.getBoundingClientRect().top\n            ) {\n              return;\n            }\n\n            controls.classList.add('mapml-draggable');\n            control.style.transform = 'translateY(' + offset + 'px)';\n            control.style.pointerEvents = 'none';\n\n            let x = moveEvent.clientX,\n              y = moveEvent.clientY,\n              root =\n                mapEl.tagName === 'MAPML-VIEWER'\n                  ? mapEl.shadowRoot\n                  : mapEl.querySelector('.mapml-web-map').shadowRoot,\n              elementAt = root.elementFromPoint(x, y),\n              swapControl =\n                !elementAt || !elementAt.closest('fieldset')\n                  ? control\n                  : elementAt.closest('fieldset');\n\n            swapControl =\n              Math.abs(offset) <= swapControl.offsetHeight\n                ? control\n                : swapControl;\n\n            control.setAttribute('aria-grabbed', 'true');\n            control.setAttribute('aria-dropeffect', 'move');\n            if (swapControl && controls === swapControl.parentNode) {\n              swapControl =\n                swapControl !== control.nextSibling\n                  ? swapControl\n                  : swapControl.nextSibling;\n              if (control !== swapControl) {\n                yPos = moveEvent.clientY;\n                control.style.transform = null;\n              }\n              controls.insertBefore(control, swapControl);\n            }\n          };\n\n          document.body.ontouchend = document.body.onmouseup = () => {\n            control.setAttribute('aria-grabbed', 'false');\n            control.removeAttribute('aria-dropeffect');\n            control.style.pointerEvents = null;\n            control.style.transform = null;\n            let controlsElems = controls.children,\n              zIndex = 1;\n            for (let c of controlsElems) {\n              let layerEl = c.querySelector('span').layer._layerEl;\n\n              layerEl.setAttribute('data-moving', '');\n              mapEl.insertAdjacentElement('beforeend', layerEl);\n              layerEl.removeAttribute('data-moving');\n\n              layerEl._layer.setZIndex(zIndex);\n              zIndex++;\n            }\n            controls.classList.remove('mapml-draggable');\n            document.body.ontouchmove =\n              document.body.onmousemove =\n              document.body.onmouseup =\n                null;\n          };\n        }\n      };\n\n      L.DomEvent.on(opacity, 'change', this._changeOpacity, this);\n\n      itemToggleLabel.appendChild(input);\n      itemToggleLabel.appendChild(layerItemName);\n      itemSettingControlButton.appendChild(settingsButtonNameIcon);\n      settingsButtonNameIcon.appendChild(svgSettingsControlIcon);\n\n      if (this._styles) {\n        layerItemSettings.appendChild(this._styles);\n      }\n\n      if (this._userInputs) {\n        var frag = document.createDocumentFragment();\n        var templates = this._extent._templateVars;\n        if (templates) {\n          for (var i = 0; i < templates.length; i++) {\n            var template = templates[i];\n            for (var j = 0; j < template.values.length; j++) {\n              var mapmlInput = template.values[j],\n                id = '#' + mapmlInput.getAttribute('id');\n              // don't add it again if it is referenced > once\n              if (\n                mapmlInput.tagName.toLowerCase() === 'map-select' &&\n                !frag.querySelector(id)\n              ) {\n                // generate a <details><summary></summary><select...></details>\n                var selectdetails = L.DomUtil.create(\n                    'details',\n                    'mapml-layer-item-time mapml-control-layers',\n                    frag\n                  ),\n                  selectsummary = L.DomUtil.create('summary'),\n                  selectSummaryLabel = L.DomUtil.create('label');\n                selectSummaryLabel.innerText = mapmlInput.getAttribute('name');\n                selectSummaryLabel.setAttribute(\n                  'for',\n                  mapmlInput.getAttribute('id')\n                );\n                selectsummary.appendChild(selectSummaryLabel);\n                selectdetails.appendChild(selectsummary);\n                selectdetails.appendChild(mapmlInput.htmlselect);\n              }\n            }\n          }\n        }\n        layerItemSettings.appendChild(frag);\n      }\n\n      // if there are extents, add them to the layer control\n      if (this._extent && this._extent._mapExtents) {\n        var allHidden = true;\n        this._layerItemSettingsHTML = layerItemSettings;\n        this._extentGroupAnatomy = extentsFieldset;\n        extentsFieldset.setAttribute('aria-label', 'Sublayers');\n        for (let j = 0; j < this._extent._mapExtents.length; j++) {\n          extentsFieldset.appendChild(this._extent._mapExtents[j].extentAnatomy);\n          if (!this._extent._mapExtents[j].hidden) allHidden = false;\n        }\n        if (!allHidden) layerItemSettings.appendChild(extentsFieldset);\n      }\n\n      return this._mapmlLayerItem;\n    },\n    _initialize: function (content) {\n      if (!this._href && !content) {\n        return;\n      }\n      var layer = this;\n      // the this._href (comes from layer@src) should take precedence over\n      // content of the <layer> element, but if no this._href / src is provided\n      // but there *is* child content of the <layer> element (which is copied/\n      // referred to by this._content), we should use that content.\n      if (this._href) {\n        var xhr = new XMLHttpRequest();\n        //            xhr.withCredentials = true;\n        _get(this._href, _processInitialExtent);\n      } else if (content) {\n        // may not set this._extent if it can't be done from the content\n        // (eg a single point) and there's no map to provide a default yet\n        _processInitialExtent.call(this, content);\n      }\n      function _get(url, fCallback) {\n        xhr.onreadystatechange = function () {\n          if (this.readyState === this.DONE) {\n            if (\n              this.status === 400 ||\n              this.status === 404 ||\n              this.status === 500 ||\n              this.status === 406\n            ) {\n              layer.error = true;\n              layer.fire('extentload', layer, true);\n              xhr.abort();\n            }\n          }\n        };\n        xhr.onload = fCallback;\n        xhr.onerror = function () {\n          layer.error = true;\n          layer.fire('extentload', layer, true);\n        };\n        xhr.open('GET', url);\n        xhr.setRequestHeader('Accept', M.mime);\n        xhr.overrideMimeType('text/xml');\n        xhr.send();\n      }\n      function transcribe(element) {\n        var select = document.createElement('select');\n        var elementAttrNames = element.getAttributeNames();\n\n        for (let i = 0; i < elementAttrNames.length; i++) {\n          select.setAttribute(\n            elementAttrNames[i],\n            element.getAttribute(elementAttrNames[i])\n          );\n        }\n\n        var options = element.children;\n\n        for (let i = 0; i < options.length; i++) {\n          var option = document.createElement('option');\n          var optionAttrNames = options[i].getAttributeNames();\n\n          for (let j = 0; j < optionAttrNames.length; j++) {\n            option.setAttribute(\n              optionAttrNames[j],\n              options[i].getAttribute(optionAttrNames[j])\n            );\n          }\n\n          option.innerHTML = options[i].innerHTML;\n          select.appendChild(option);\n        }\n        return select;\n      }\n\n      function _initTemplateVars(\n        serverExtent,\n        metaExtent,\n        projection,\n        mapml,\n        base,\n        projectionMatch\n      ) {\n        var templateVars = [];\n        // set up the URL template and associated inputs (which yield variable values when processed)\n        var tlist = serverExtent.querySelectorAll(\n            'map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]'\n          ),\n          varNamesRe = new RegExp('(?:{)(.*?)(?:})', 'g'),\n          zoomInput = serverExtent.querySelector('map-input[type=\"zoom\" i]'),\n          includesZoom = false,\n          extentFallback = {};\n\n        extentFallback.zoom = 0;\n        if (metaExtent) {\n          let content = M._metaContentToObject(\n              metaExtent.getAttribute('content')\n            ),\n            cs;\n\n          extentFallback.zoom = content.zoom || extentFallback.zoom;\n\n          let metaKeys = Object.keys(content);\n          for (let i = 0; i < metaKeys.length; i++) {\n            if (!metaKeys[i].includes('zoom')) {\n              cs = M.axisToCS(metaKeys[i].split('-')[2]);\n              break;\n            }\n          }\n          let axes = M.csToAxes(cs);\n          extentFallback.bounds = M.boundsToPCRSBounds(\n            L.bounds(\n              L.point(\n                +content[`top-left-${axes[0]}`],\n                +content[`top-left-${axes[1]}`]\n              ),\n              L.point(\n                +content[`bottom-right-${axes[0]}`],\n                +content[`bottom-right-${axes[1]}`]\n              )\n            ),\n            extentFallback.zoom,\n            projection,\n            cs\n          );\n        } else {\n          extentFallback.bounds = M[projection].options.crs.pcrs.bounds;\n        }\n\n        for (var i = 0; i < tlist.length; i++) {\n          var t = tlist[i],\n            template = t.getAttribute('tref');\n          t.zoomInput = zoomInput;\n          if (!template) {\n            template = BLANK_TT_TREF;\n            let blankInputs = mapml.querySelectorAll('map-input');\n            for (let i of blankInputs) {\n              template += `{${i.getAttribute('name')}}`;\n            }\n          }\n\n          var v,\n            title = t.hasAttribute('title')\n              ? t.getAttribute('title')\n              : 'Query this layer',\n            vcount = template.match(varNamesRe),\n            trel =\n              !t.hasAttribute('rel') ||\n              t.getAttribute('rel').toLowerCase() === 'tile'\n                ? 'tile'\n                : t.getAttribute('rel').toLowerCase(),\n            ttype = !t.hasAttribute('type')\n              ? 'image/*'\n              : t.getAttribute('type').toLowerCase(),\n            inputs = [],\n            tms = t && t.hasAttribute('tms');\n          var zoomBounds = mapml.querySelector('map-meta[name=zoom]')\n            ? M._metaContentToObject(\n                mapml.querySelector('map-meta[name=zoom]').getAttribute('content')\n              )\n            : undefined;\n          while ((v = varNamesRe.exec(template)) !== null) {\n            var varName = v[1],\n              inp = serverExtent.querySelector(\n                'map-input[name=' + varName + '],map-select[name=' + varName + ']'\n              );\n            if (inp) {\n              if (\n                inp.hasAttribute('type') &&\n                inp.getAttribute('type') === 'location' &&\n                (!inp.hasAttribute('min') || !inp.hasAttribute('max')) &&\n                inp.hasAttribute('axis') &&\n                !['i', 'j'].includes(inp.getAttribute('axis').toLowerCase())\n              ) {\n                if (\n                  zoomInput &&\n                  template.includes(`{${zoomInput.getAttribute('name')}}`)\n                ) {\n                  zoomInput.setAttribute('value', extentFallback.zoom);\n                }\n                let axis = inp.getAttribute('axis'),\n                  axisBounds = M.convertPCRSBounds(\n                    extentFallback.bounds,\n                    extentFallback.zoom,\n                    projection,\n                    M.axisToCS(axis)\n                  );\n                inp.setAttribute('min', axisBounds.min[M.axisToXY(axis)]);\n                inp.setAttribute('max', axisBounds.max[M.axisToXY(axis)]);\n              }\n\n              inputs.push(inp);\n              includesZoom =\n                includesZoom ||\n                (inp.hasAttribute('type') &&\n                  inp.getAttribute('type').toLowerCase() === 'zoom');\n              if (inp.tagName.toLowerCase() === 'map-select') {\n                // use a throwaway div to parse the input from MapML into HTML\n                var div = document.createElement('div');\n                div.insertAdjacentHTML('afterbegin', inp.outerHTML);\n                // parse\n                inp.htmlselect = div.querySelector('map-select');\n                inp.htmlselect = transcribe(inp.htmlselect);\n\n                // this goes into the layer control, so add a listener\n                L.DomEvent.on(inp.htmlselect, 'change', layer.redraw, layer);\n                if (!layer._userInputs) {\n                  layer._userInputs = [];\n                }\n                layer._userInputs.push(inp.htmlselect);\n              }\n              // TODO: if this is an input@type=location\n              // get the TCRS min,max attribute values at the identified zoom level\n              // save this information as properties of the serverExtent,\n              // perhaps as a bounds object so that it can be easily used\n              // later by the layer control to determine when to enable\n              // disable the layer for drawing.\n            } else {\n              console.log(\n                'input with name=' +\n                  varName +\n                  ' not found for template variable of same name'\n              );\n              // no match found, template won't be used\n              break;\n            }\n          }\n          if (\n            (template && vcount.length === inputs.length) ||\n            template === BLANK_TT_TREF\n          ) {\n            if (trel === 'query') {\n              layer.queryable = true;\n            }\n            if (!includesZoom && zoomInput) {\n              inputs.push(zoomInput);\n            }\n            let step = zoomInput ? zoomInput.getAttribute('step') : 1;\n            if (!step || step === '0' || isNaN(step)) step = 1;\n            // template has a matching input for every variable reference {varref}\n            templateVars.push({\n              template: decodeURI(new URL(template, base)),\n              linkEl: t,\n              title: title,\n              rel: trel,\n              type: ttype,\n              values: inputs,\n              zoomBounds: zoomBounds,\n              extentPCRSFallback: { bounds: extentFallback.bounds },\n              projectionMatch: projectionMatch,\n              projection:\n                serverExtent.getAttribute('units') || FALLBACK_PROJECTION,\n              tms: tms,\n              step: step\n            });\n          }\n        }\n        return templateVars;\n      }\n\n      function _processInitialExtent(content) {\n        //TODO: include inline extents\n        var mapml = this.responseXML || content;\n        if (mapml.querySelector && mapml.querySelector('map-feature'))\n          layer._content = mapml;\n        if (!this.responseXML && this.responseText)\n          mapml = new DOMParser().parseFromString(this.responseText, 'text/xml');\n\n        // if everything is ok, continue with the processing\n        if (\n          this.readyState === this.DONE &&\n          mapml.querySelector &&\n          !mapml.querySelector('parsererror')\n        ) {\n          // Get layer's title/label\n          if (mapml.querySelector('map-title')) {\n            layer._title = mapml.querySelector('map-title').textContent.trim();\n            layer._titleIsReadOnly = true;\n          } else if (mapml instanceof Element && mapml.hasAttribute('label')) {\n            layer._title = mapml.getAttribute('label').trim();\n          }\n\n          var serverExtent = mapml.querySelectorAll('map-extent'),\n            projection,\n            projectionMatch,\n            serverMeta;\n\n          if (!serverExtent.length) {\n            serverMeta = mapml.querySelector('map-meta[name=projection]');\n          }\n\n          // check whether all map-extent elements have the same units\n          if (serverExtent.length >= 1) {\n            for (let i = 0; i < serverExtent.length; i++) {\n              if (\n                serverExtent[i].tagName.toLowerCase() === 'map-extent' &&\n                serverExtent[i].hasAttribute('units')\n              ) {\n                projection = serverExtent[i].getAttribute('units');\n              }\n              projectionMatch =\n                projection && projection === layer.options.mapprojection;\n              if (!projectionMatch) {\n                break;\n              }\n            }\n          } else if (serverMeta) {\n            if (\n              serverMeta.tagName.toLowerCase() === 'map-meta' &&\n              serverMeta.hasAttribute('content')\n            ) {\n              projection = M._metaContentToObject(\n                serverMeta.getAttribute('content')\n              ).content;\n              projectionMatch =\n                projection && projection === layer.options.mapprojection;\n            }\n          } else {\n            // default projection set to parent projection when no map-meta projection element present\n            projection = layer.options.mapprojection;\n            projectionMatch = true;\n            serverMeta = projection;\n            console.log(\n              `A projection was not assigned to the '${layer._title}' Layer. Please specify a projection for that layer using a map-meta element. See more here - https://maps4html.org/web-map-doc/docs/elements/meta/`\n            );\n            // TODO: Add a more obvious warning.\n          }\n\n          var metaExtent = mapml.querySelector('map-meta[name=extent]'),\n            selectedAlternate =\n              !projectionMatch &&\n              mapml.querySelector(\n                'map-head map-link[rel=alternate][projection=' +\n                  layer.options.mapprojection +\n                  ']'\n              ),\n            base = new URL(\n              mapml.querySelector('map-base')\n                ? mapml.querySelector('map-base').getAttribute('href')\n                : mapml.baseURI || this.responseURL,\n              this.responseURL\n            ).href;\n\n          if (\n            !projectionMatch &&\n            selectedAlternate &&\n            selectedAlternate.hasAttribute('href')\n          ) {\n            layer.fire(\n              'changeprojection',\n              {\n                href: new URL(selectedAlternate.getAttribute('href'), base).href\n              },\n              false\n            );\n            return;\n          } else if (\n            !projectionMatch &&\n            layer._map &&\n            layer._map.options.mapEl.querySelectorAll('layer-').length === 1\n          ) {\n            layer._map.options.mapEl.projection = projection;\n            return;\n          } else if (!serverMeta) {\n            layer._extent = {};\n            if (projectionMatch) {\n              layer._extent.crs = M[projection];\n            }\n            layer._extent._mapExtents = []; // stores all the map-extent elements in the layer\n            layer._extent._templateVars = []; // stores all template variables coming from all extents\n            for (let j = 0; j < serverExtent.length; j++) {\n              if (\n                serverExtent[j].querySelector(\n                  'map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]'\n                ) &&\n                serverExtent[j].hasAttribute('units')\n              ) {\n                layer._extent._mapExtents.push(serverExtent[j]);\n                projectionMatch = projectionMatch || selectedAlternate;\n                let templateVars = _initTemplateVars.call(\n                  layer,\n                  serverExtent[j],\n                  metaExtent,\n                  projection,\n                  mapml,\n                  base,\n                  projectionMatch\n                );\n                layer._extent._mapExtents[j]._templateVars = templateVars;\n                layer._extent._templateVars =\n                  layer._extent._templateVars.concat(templateVars);\n              }\n            }\n          } else {\n            if (typeof serverMeta === 'string') {\n              // when map-meta projection not present for layer\n              layer._extent = { serverMeta };\n            } else {\n              // when map-meta projection present for layer\n              layer._extent = serverMeta;\n            }\n          }\n          layer._parseLicenseAndLegend(mapml, layer, projection);\n\n          var zoomin = mapml.querySelector('map-link[rel=zoomin]'),\n            zoomout = mapml.querySelector('map-link[rel=zoomout]');\n          delete layer._extent.zoomin;\n          delete layer._extent.zoomout;\n          if (zoomin) {\n            layer._extent.zoomin = new URL(\n              zoomin.getAttribute('href'),\n              base\n            ).href;\n          }\n          if (zoomout) {\n            layer._extent.zoomout = new URL(\n              zoomout.getAttribute('href'),\n              base\n            ).href;\n          }\n          if (layer._extent._mapExtents) {\n            for (let i = 0; i < layer._extent._mapExtents.length; i++) {\n              if (layer._extent._mapExtents[i].templatedLayer) {\n                layer._extent._mapExtents[i].templatedLayer.reset(\n                  layer._extent._mapExtents[i]._templateVars,\n                  layer._extent._mapExtents[i].extentZIndex\n                );\n              }\n            }\n          }\n          if (mapml.querySelector('map-tile')) {\n            var tiles = document.createElement('map-tiles'),\n              zoom =\n                mapml.querySelector('map-meta[name=zoom][content]') ||\n                mapml.querySelector('map-input[type=zoom][value]');\n            tiles.setAttribute(\n              'zoom',\n              (zoom && zoom.getAttribute('content')) ||\n                (zoom && zoom.getAttribute('value')) ||\n                '0'\n            );\n            var newTiles = mapml.getElementsByTagName('map-tile');\n            for (var nt = 0; nt < newTiles.length; nt++) {\n              tiles.appendChild(document.importNode(newTiles[nt], true));\n            }\n            layer._mapmlTileContainer.appendChild(tiles);\n          }\n          M._parseStylesheetAsHTML(mapml, base, layer._container);\n\n          // add multiple extents\n          if (layer._extent._mapExtents) {\n            for (let j = 0; j < layer._extent._mapExtents.length; j++) {\n              var labelName = layer._extent._mapExtents[j].getAttribute('label');\n              var extentElement = layer.getLayerExtentHTML(labelName, j);\n              layer._extent._mapExtents[j].extentAnatomy = extentElement;\n            }\n          }\n\n          var styleLinks = mapml.querySelectorAll(\n            'map-link[rel=style],map-link[rel=\"self style\"],map-link[rel=\"style self\"]'\n          );\n          if (styleLinks.length > 1) {\n            var stylesControl = document.createElement('details'),\n              stylesControlSummary = document.createElement('summary');\n            stylesControlSummary.innerText = 'Style';\n            stylesControl.appendChild(stylesControlSummary);\n            var changeStyle = function (e) {\n              layer.fire(\n                'changestyle',\n                { src: e.target.getAttribute('data-href') },\n                false\n              );\n            };\n\n            for (var j = 0; j < styleLinks.length; j++) {\n              var styleOption = document.createElement('div'),\n                styleOptionInput = styleOption.appendChild(\n                  document.createElement('input')\n                );\n              styleOptionInput.setAttribute('type', 'radio');\n              styleOptionInput.setAttribute(\n                'id',\n                'rad-' + L.stamp(styleOptionInput)\n              );\n              styleOptionInput.setAttribute('name', 'styles-' + this._title);\n              styleOptionInput.setAttribute(\n                'value',\n                styleLinks[j].getAttribute('title')\n              );\n              styleOptionInput.setAttribute(\n                'data-href',\n                new URL(styleLinks[j].getAttribute('href'), base).href\n              );\n              var styleOptionLabel = styleOption.appendChild(\n                document.createElement('label')\n              );\n              styleOptionLabel.setAttribute(\n                'for',\n                'rad-' + L.stamp(styleOptionInput)\n              );\n              styleOptionLabel.innerText = styleLinks[j].getAttribute('title');\n              if (\n                styleLinks[j].getAttribute('rel') === 'style self' ||\n                styleLinks[j].getAttribute('rel') === 'self style'\n              ) {\n                styleOptionInput.checked = true;\n              }\n              stylesControl.appendChild(styleOption);\n              L.DomUtil.addClass(\n                stylesControl,\n                'mapml-layer-item-style mapml-control-layers'\n              );\n              L.DomEvent.on(styleOptionInput, 'click', changeStyle, layer);\n            }\n            layer._styles = stylesControl;\n          }\n\n          if (layer._map) {\n            layer._validateExtent();\n            // if the layer is checked in the layer control, force the addition\n            // of the attribution just received\n            if (layer._map.hasLayer(layer)) {\n              layer._map.attributionControl.addAttribution(\n                layer.getAttribution()\n              );\n            }\n            //layer._map.fire('moveend', layer);\n          }\n        } else {\n          layer.error = true;\n        }\n        if (this.responseXML) {\n          _attachToLayer.call(layer);\n        }\n        layer.fire('extentload', layer, false);\n        // update controls if needed based on mapml-viewer controls/controlslist attribute\n        if (layer._layerEl.parentElement) {\n          // if layer does not have a parent Element, do not need to set Controls\n          layer._layerEl.parentElement._toggleControls();\n        }\n        layer._layerEl.dispatchEvent(\n          new CustomEvent('extentload', { detail: layer, bubbles: true })\n        );\n      }\n\n      function _attachToLayer() {\n        let mapml = xhr.responseXML,\n          shadowRoot = this._layerEl.shadowRoot;\n        if (mapml) {\n          let elements = mapml.children[0].children[1].children;\n          if (elements) {\n            let baseURL = mapml.children[0].children[0]\n              .querySelector('map-base')\n              ?.getAttribute('href');\n            for (let el of elements) {\n              // if not clone, the elements will be **REMOVED** from mapml file and re-attached to the layer's shadow root\n              // which makes the this._content (mapml file) changed and thus affects the later generation process of this._mapmlvectors\n              let node = el.cloneNode(true);\n              el._DOMnode = node;\n              // resolve relative url\n              if (node.nodeName === 'map-link') {\n                let url = node.getAttribute('href') || node.getAttribute('tref');\n                // if relative\n                if (\n                  url &&\n                  (url.indexOf('http://') === 0 || url.indexOf('https://') === 0)\n                ) {\n                  let resolvedURL = baseURL + url;\n                  if (node.hasAttribute('href')) {\n                    node.setAttribute('href', resolvedURL);\n                  } else {\n                    node.setAttribute('tref', resolvedURL);\n                  }\n                }\n              }\n              shadowRoot.appendChild(node);\n            }\n          }\n        }\n      }\n    },\n    _validateExtent: function () {\n      // TODO: change so that the _extent bounds are set based on inputs\n      if (!this._extent || !this._map) {\n        return;\n      }\n      var serverExtent = this._extent._mapExtents\n          ? this._extent._mapExtents\n          : [this._extent],\n        lp;\n\n      // loop through the map-extent elements and assign each one its crs\n      for (let i = 0; i < serverExtent.length; i++) {\n        if (!serverExtent[i].querySelector) {\n          return;\n        }\n        if (\n          serverExtent[i].querySelector(\n            '[type=zoom][min=\"\"], [type=zoom][max=\"\"]'\n          )\n        ) {\n          var zoom = serverExtent[i].querySelector('[type=zoom]');\n          zoom.setAttribute('min', this._map.getMinZoom());\n          zoom.setAttribute('max', this._map.getMaxZoom());\n        }\n        lp = serverExtent[i].hasAttribute('units')\n          ? serverExtent[i].getAttribute('units')\n          : null;\n        if (lp && M[lp]) {\n          if (this._extent._mapExtents) this._extent._mapExtents[i].crs = M[lp];\n          else this._extent.crs = M[lp];\n        } else {\n          if (this._extent._mapExtents)\n            this._extent._mapExtents[i].crs = M.OSMTILE;\n          else this._extent.crs = M.OSMTILE;\n        }\n      }\n    },\n    // a layer must share a projection with the map so that all the layers can\n    // be overlayed in one coordinate space.  WGS84 is a 'wildcard', sort of.\n    getProjection: function () {\n      if (!this._extent) {\n        return;\n      }\n      let extent = this._extent._mapExtents\n        ? this._extent._mapExtents[0]\n        : this._extent; // the projections for each extent eould be the same (as) validated in _validProjection, so can use mapExtents[0]\n      if (extent.serverMeta) return extent.serverMeta;\n      switch (extent.tagName.toUpperCase()) {\n        case 'MAP-EXTENT':\n          if (extent.hasAttribute('units'))\n            return extent.getAttribute('units').toUpperCase();\n          break;\n        case 'MAP-INPUT':\n          if (extent.hasAttribute('value'))\n            return extent.getAttribute('value').toUpperCase();\n          break;\n        case 'MAP-META':\n          if (extent.hasAttribute('content'))\n            return M._metaContentToObject(\n              extent.getAttribute('content')\n            ).content.toUpperCase();\n          break;\n        default:\n          return FALLBACK_PROJECTION;\n      }\n      return FALLBACK_PROJECTION;\n    },\n    _parseLicenseAndLegend: function (xml, layer) {\n      var licenseLink = xml.querySelector('map-link[rel=license]'),\n        licenseTitle,\n        licenseUrl,\n        attText;\n      if (licenseLink) {\n        licenseTitle = licenseLink.getAttribute('title');\n        licenseUrl = licenseLink.getAttribute('href');\n        attText =\n          '<a href=\"' +\n          licenseUrl +\n          '\" title=\"' +\n          licenseTitle +\n          '\">' +\n          licenseTitle +\n          '</a>';\n      }\n      L.setOptions(layer, { attribution: attText });\n      var legendLink = xml.querySelector('map-link[rel=legend]');\n      if (legendLink) {\n        layer._legendUrl = legendLink.getAttribute('href');\n      }\n    },\n    getQueryTemplates: function (pcrsClick) {\n      if (this._extent && this._extent._queries) {\n        var templates = [];\n        // only return queries that are in bounds\n        if (\n          this._layerEl.checked &&\n          !this._layerEl.hidden &&\n          this._mapmlLayerItem\n        ) {\n          let layerAndExtents = this._mapmlLayerItem.querySelectorAll(\n            '.mapml-layer-item-name'\n          );\n          for (let i = 0; i < layerAndExtents.length; i++) {\n            if (\n              layerAndExtents[i].extent ||\n              this._extent._mapExtents.length === 1\n            ) {\n              // the layer won't have an .extent property, this is kind of a hack\n              let extent =\n                layerAndExtents[i].extent || this._extent._mapExtents[0];\n              for (let j = 0; j < extent._templateVars.length; j++) {\n                if (extent.checked) {\n                  let template = extent._templateVars[j];\n                  // for each template in the extent, see if it corresponds to one in the this._extent._queries array\n                  for (let k = 0; k < this._extent._queries.length; k++) {\n                    let queryTemplate = this._extent._queries[k];\n                    if (\n                      template === queryTemplate &&\n                      queryTemplate.extentBounds.contains(pcrsClick)\n                    ) {\n                      templates.push(queryTemplate);\n                    }\n                  }\n                }\n              }\n            }\n          }\n          return templates;\n        }\n      }\n    },\n    _attachSkipButtons: function (e) {\n      let popup = e.popup,\n        map = e.target,\n        layer,\n        group,\n        content = popup._container.getElementsByClassName(\n          'mapml-popup-content'\n        )[0];\n\n      popup._container.setAttribute('role', 'dialog');\n      content.setAttribute('tabindex', '-1');\n      // https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/467#issuecomment-844307818\n      content.setAttribute('role', 'document');\n      popup._count = 0; // used for feature pagination\n\n      if (popup._source._eventParents) {\n        // check if the popup is for a feature or query\n        layer =\n          popup._source._eventParents[\n            Object.keys(popup._source._eventParents)[0]\n          ]; // get first parent of feature, there should only be one\n        group = popup._source.group;\n        // if the popup is for a static / templated feature, the \"zoom to here\" link can be attached once the popup opens\n        attachZoomLink.call(popup);\n      } else {\n        layer = popup._source._templatedLayer;\n        // if the popup is for a query, the \"zoom to here\" link should be re-attached every time new pagination features are displayed\n        map.on('attachZoomLink', attachZoomLink, popup);\n      }\n\n      if (popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]')) {\n        L.DomUtil.remove(\n          popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]')\n        );\n        L.DomUtil.remove(popup._container.querySelector('hr'));\n      }\n      //add when popopen event happens instead\n      let div = L.DomUtil.create('nav', 'mapml-focus-buttons');\n\n      // creates |< button, focuses map\n      let mapFocusButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      mapFocusButton.type = 'button';\n      mapFocusButton.title = 'Focus Map';\n      mapFocusButton.innerHTML = \"<span aria-hidden='true'>|&#10094;</span>\";\n      L.DomEvent.on(\n        mapFocusButton,\n        'click',\n        (e) => {\n          L.DomEvent.stop(e);\n          map.featureIndex._sortIndex();\n          map.closePopup();\n          map._container.focus();\n        },\n        popup\n      );\n\n      // creates < button, focuses previous feature, if none exists focuses the current feature\n      let previousButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      previousButton.type = 'button';\n      previousButton.title = 'Previous Feature';\n      previousButton.innerHTML = \"<span aria-hidden='true'>&#10094;</span>\";\n      L.DomEvent.on(previousButton, 'click', layer._previousFeature, popup);\n\n      // static feature counter that 1/1\n      let featureCount = L.DomUtil.create('p', 'mapml-feature-count', div),\n        totalFeatures = this._totalFeatureCount ? this._totalFeatureCount : 1;\n      featureCount.innerText = popup._count + 1 + '/' + totalFeatures;\n\n      // creates > button, focuses next feature, if none exists focuses the current feature\n      let nextButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      nextButton.type = 'button';\n      nextButton.title = 'Next Feature';\n      nextButton.innerHTML = \"<span aria-hidden='true'>&#10095;</span>\";\n      L.DomEvent.on(nextButton, 'click', layer._nextFeature, popup);\n\n      // creates >| button, focuses map controls\n      let controlFocusButton = L.DomUtil.create(\n        'button',\n        'mapml-popup-button',\n        div\n      );\n      controlFocusButton.type = 'button';\n      controlFocusButton.title = 'Focus Controls';\n      controlFocusButton.innerHTML = \"<span aria-hidden='true'>&#10095;|</span>\";\n      L.DomEvent.on(\n        controlFocusButton,\n        'click',\n        (e) => {\n          map.featureIndex._sortIndex();\n          map.featureIndex.currentIndex =\n            map.featureIndex.inBoundFeatures.length - 1;\n          map.featureIndex.inBoundFeatures[0].path.setAttribute('tabindex', -1);\n          map.featureIndex.inBoundFeatures[\n            map.featureIndex.currentIndex\n          ].path.setAttribute('tabindex', 0);\n          L.DomEvent.stop(e);\n          map.closePopup();\n          map._controlContainer.querySelector('A:not([hidden])').focus();\n        },\n        popup\n      );\n\n      let divider = L.DomUtil.create('hr', 'mapml-popup-divider');\n\n      popup._navigationBar = div;\n      popup._content.appendChild(divider);\n      popup._content.appendChild(div);\n\n      content.focus();\n\n      if (group && !M.options.featureIndexOverlayOption) {\n        // e.target = this._map\n        // Looks for keydown, more specifically tab and shift tab\n        group.setAttribute('aria-expanded', 'true');\n        map.on('keydown', focusFeature);\n      } else {\n        map.on('keydown', focusMap);\n      }\n      // When popup is open, what gets focused with tab needs to be done using JS as the DOM order is not in an accessibility friendly manner\n      function focusFeature(focusEvent) {\n        let path =\n          focusEvent.originalEvent.path ||\n          focusEvent.originalEvent.composedPath();\n        let isTab = focusEvent.originalEvent.keyCode === 9,\n          shiftPressed = focusEvent.originalEvent.shiftKey;\n        if (\n          (path[0].classList.contains('leaflet-popup-close-button') &&\n            isTab &&\n            !shiftPressed) ||\n          focusEvent.originalEvent.keyCode === 27 ||\n          (path[0].classList.contains('leaflet-popup-close-button') &&\n            focusEvent.originalEvent.keyCode === 13)\n        ) {\n          setTimeout(() => {\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        } else if (\n          path[0].classList.contains('mapml-popup-content') &&\n          isTab &&\n          shiftPressed\n        ) {\n          setTimeout(() => {\n            //timeout needed so focus of the feature is done even after the keypressup event occurs\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        } else if (\n          path[0] === popup._content.querySelector('a') &&\n          isTab &&\n          shiftPressed\n        ) {\n          setTimeout(() => {\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        }\n      }\n\n      function focusMap(focusEvent) {\n        let path =\n          focusEvent.originalEvent.path ||\n          focusEvent.originalEvent.composedPath();\n        let isTab = focusEvent.originalEvent.keyCode === 9,\n          shiftPressed = focusEvent.originalEvent.shiftKey;\n\n        if (\n          (focusEvent.originalEvent.keyCode === 13 &&\n            path[0].classList.contains('leaflet-popup-close-button')) ||\n          focusEvent.originalEvent.keyCode === 27\n        ) {\n          L.DomEvent.stopPropagation(focusEvent);\n          map.closePopup(popup);\n          map._container.focus();\n          if (focusEvent.originalEvent.keyCode !== 27) map._popupClosed = true;\n        } else if (\n          isTab &&\n          path[0].classList.contains('leaflet-popup-close-button')\n        ) {\n          map.closePopup(popup);\n        } else if (\n          path[0].classList.contains('mapml-popup-content') &&\n          isTab &&\n          shiftPressed\n        ) {\n          map.closePopup(popup);\n          setTimeout(() => {\n            //timeout needed so focus of the feature is done even after the keypressup event occurs\n            L.DomEvent.stop(focusEvent);\n            map._container.focus();\n          }, 0);\n        } else if (\n          path[0] === popup._content.querySelector('a') &&\n          isTab &&\n          shiftPressed\n        ) {\n          map.closePopup(popup);\n          setTimeout(() => {\n            L.DomEvent.stop(focusEvent);\n            map._container.focus();\n          }, 0);\n        }\n      }\n\n      function attachZoomLink(e) {\n        // this === popup\n        let content = this._content,\n          featureEl = e ? e.currFeature : this._source._groupLayer._featureEl;\n        if (content.querySelector('a.mapml-zoom-link')) {\n          content.querySelector('a.mapml-zoom-link').remove();\n        }\n        if (!featureEl.querySelector('map-geometry')) return;\n        let tL = featureEl.extent.topLeft.gcrs,\n          bR = featureEl.extent.bottomRight.gcrs,\n          center = L.latLngBounds(\n            L.latLng(tL.horizontal, tL.vertical),\n            L.latLng(bR.horizontal, bR.vertical)\n          ).getCenter(true);\n        let zoomLink = document.createElement('a');\n        zoomLink.href = `#${featureEl.getMaxZoom()},${center.lng},${center.lat}`;\n        zoomLink.innerHTML = `${M.options.locale.popupZoom}`;\n        zoomLink.className = 'mapml-zoom-link';\n        zoomLink.onclick = zoomLink.onkeydown = function (e) {\n          if (!(e instanceof MouseEvent) && e.keyCode !== 13) return;\n          e.preventDefault();\n          featureEl.zoomTo();\n          featureEl._map.closePopup();\n        };\n        content.insertBefore(\n          zoomLink,\n          content.querySelector('hr.mapml-popup-divider')\n        );\n      }\n\n      // if popup closes then the focusFeature handler can be removed\n      map.on('popupclose', removeHandlers);\n      function removeHandlers(removeEvent) {\n        if (removeEvent.popup === popup) {\n          map.off('keydown', focusFeature);\n          map.off('keydown', focusMap);\n          map.off('popupopen', attachZoomLink);\n          map.off('popupclose', removeHandlers);\n          if (group) group.setAttribute('aria-expanded', 'false');\n        }\n      }\n    }\n  });\n  var mapMLLayer = function (url, node, options) {\n    if (!url && !node) return null;\n    return new MapMLLayer(url, node, options);\n  };\n\n  var DebugOverlay = L.Layer.extend({\n    onAdd: function (map) {\n      let mapSize = map.getSize();\n\n      //conditionally show container for debug panel/banner only when the map has enough space for it\n      if (mapSize.x > 400 || mapSize.y > 300) {\n        this._container = L.DomUtil.create(\n          'table',\n          'mapml-debug',\n          map._container\n        );\n\n        this._panel = debugPanel({\n          className: 'mapml-debug-panel',\n          pane: this._container\n        });\n        map.addLayer(this._panel);\n      }\n\n      this._grid = debugGrid({\n        className: 'mapml-debug-grid',\n        pane: map._panes.mapPane,\n        zIndex: 400,\n        tileSize: map.options.crs.options.crs.tile.bounds.max.x\n      });\n      map.addLayer(this._grid);\n\n      this._vectors = debugVectors({\n        className: 'mapml-debug-vectors',\n        pane: map._panes.mapPane,\n        toolPane: this._container\n      });\n      map.addLayer(this._vectors);\n    },\n\n    onRemove: function (map) {\n      map.removeLayer(this._grid);\n      map.removeLayer(this._vectors);\n      if (this._panel) {\n        //conditionally remove the panel, as it's not always added\n        map.removeLayer(this._panel);\n        L.DomUtil.remove(this._container);\n      }\n    }\n  });\n\n  var debugOverlay = function () {\n    return new DebugOverlay();\n  };\n\n  var DebugPanel = L.Layer.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n    },\n\n    onAdd: function (map) {\n      this._title = L.DomUtil.create(\n        'caption',\n        'mapml-debug-banner',\n        this.options.pane\n      );\n      this._title.innerHTML = 'Debug mode';\n\n      map.debug = {};\n      map.debug._infoContainer = this._debugContainer = L.DomUtil.create(\n        'tbody',\n        'mapml-debug-panel',\n        this.options.pane\n      );\n\n      let infoContainer = map.debug._infoContainer;\n\n      map.debug._tileCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._tileMatrixCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._mapCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._tcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._pcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._gcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n\n      this._map.on('mousemove', this._updateCoords);\n    },\n    onRemove: function () {\n      L.DomUtil.remove(this._title);\n      if (this._debugContainer) {\n        L.DomUtil.remove(this._debugContainer);\n        this._map.off('mousemove', this._updateCoords);\n      }\n    },\n    _updateCoords: function (e) {\n      if (this.contextMenu._visible) return;\n      let mapEl = this.options.mapEl,\n        point = mapEl._map.project(e.latlng),\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation.untransform(point, scale),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointI = point.x % tileSize,\n        pointJ = point.y % tileSize;\n\n      if (pointI < 0) pointI += tileSize;\n      if (pointJ < 0) pointJ += tileSize;\n\n      this.debug._tileCoord.innerHTML = `\n      <th scope=\"row\">tile: </th>\n      <td>i: ${Math.trunc(pointI)}, </td>\n      <td>j: ${Math.trunc(pointJ)}</td>\n      `;\n      this.debug._mapCoord.innerHTML = `\n      <th scope=\"row\">map: </th>\n      <td>i: ${Math.trunc(e.containerPoint.x)}, </td>\n      <td>j: ${Math.trunc(e.containerPoint.y)}</td>\n      `;\n      this.debug._gcrsCoord.innerHTML = `\n      <th scope=\"row\">gcrs: </th>\n      <td>lon: ${e.latlng.lng.toFixed(6)}, </td>\n      <td>lat: ${e.latlng.lat.toFixed(6)}</td>\n      `;\n      this.debug._tcrsCoord.innerHTML = `\n      <th scope=\"row\">tcrs: </th>\n      <td>x: ${Math.trunc(point.x)}, </td>\n      <td>y: ${Math.trunc(point.y)}</td>\n      `;\n      this.debug._tileMatrixCoord.innerHTML = `\n      <th scope=\"row\">tilematrix: </th>\n      <td>column: ${Math.trunc(point.x / tileSize)}, </td>\n      <td>row: ${Math.trunc(point.y / tileSize)}</td>\n      `;\n      this.debug._pcrsCoord.innerHTML = `\n      <th scope=\"row\">pcrs: </th>\n      <td>easting: ${pcrs.x.toFixed(2)}, </td>\n      <td>northing: ${pcrs.y.toFixed(2)}</td>\n      `;\n    }\n  });\n\n  var debugPanel = function (options) {\n    return new DebugPanel(options);\n  };\n\n  var DebugGrid = L.GridLayer.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.GridLayer.prototype.initialize.call(this, this._map);\n    },\n\n    createTile: function (coords) {\n      let tile = L.DomUtil.create('div', 'mapml-debug-tile');\n      tile.setAttribute('col', coords.x);\n      tile.setAttribute('row', coords.y);\n      tile.setAttribute('zoom', coords.z);\n      tile.innerHTML = [\n        `col: ${coords.x}`,\n        `row: ${coords.y}`,\n        `zoom: ${coords.z}`\n      ].join(', ');\n\n      tile.style.outline = '1px dashed red';\n      return tile;\n    }\n  });\n\n  var debugGrid = function (options) {\n    return new DebugGrid(options);\n  };\n\n  var DebugVectors = L.LayerGroup.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.LayerGroup.prototype.initialize.call(this, this._map, options);\n    },\n    onAdd: function (map) {\n      map.on('overlayremove', this._mapLayerUpdate, this);\n      map.on('overlayadd', this._mapLayerUpdate, this);\n      let center = map.options.crs.transformation.transform(\n        L.point(0, 0),\n        map.options.crs.scale(0)\n      );\n      this._centerVector = L.circle(map.options.crs.pointToLatLng(center, 0), {\n        radius: 250\n      });\n      this._centerVector.bindTooltip('Projection Center');\n\n      this._addBounds(map);\n    },\n    onRemove: function (map) {\n      this.clearLayers();\n    },\n\n    _addBounds: function (map) {\n      let id = Object.keys(map._layers),\n        layers = map._layers,\n        colors = ['#FF5733', '#8DFF33', '#3397FF', '#E433FF', '#F3FF33'],\n        j = 0;\n\n      this.addLayer(this._centerVector);\n\n      for (let i of id) {\n        if (layers[i].layerBounds || layers[i].extentBounds) {\n          let boundsArray;\n          if (layers[i].layerBounds) {\n            boundsArray = [\n              layers[i].layerBounds.min,\n              L.point(layers[i].layerBounds.max.x, layers[i].layerBounds.min.y),\n              layers[i].layerBounds.max,\n              L.point(layers[i].layerBounds.min.x, layers[i].layerBounds.max.y)\n            ];\n          } else {\n            boundsArray = [\n              layers[i].extentBounds.min,\n              L.point(layers[i].extentBounds.max.x, layers[i].extentBounds.min.y),\n              layers[i].extentBounds.max,\n              L.point(layers[i].extentBounds.min.x, layers[i].extentBounds.max.y)\n            ];\n          }\n          let boundsRect = projectedExtent(boundsArray, {\n            color: colors[j % colors.length],\n            weight: 2,\n            opacity: 1,\n            fillOpacity: 0.01,\n            fill: true\n          });\n          if (layers[i].options._leafletLayer)\n            boundsRect.bindTooltip(layers[i].options._leafletLayer._title, {\n              sticky: true\n            });\n          this.addLayer(boundsRect);\n          j++;\n        }\n      }\n\n      if (map.totalLayerBounds) {\n        let totalBoundsArray = [\n          map.totalLayerBounds.min,\n          L.point(map.totalLayerBounds.max.x, map.totalLayerBounds.min.y),\n          map.totalLayerBounds.max,\n          L.point(map.totalLayerBounds.min.x, map.totalLayerBounds.max.y)\n        ];\n\n        let totalBounds = projectedExtent(totalBoundsArray, {\n          color: '#808080',\n          weight: 5,\n          opacity: 0.5,\n          fill: false\n        });\n        this.addLayer(totalBounds);\n      }\n    },\n\n    _mapLayerUpdate: function (e) {\n      this.clearLayers();\n      this._addBounds(e.target);\n    }\n  });\n\n  var debugVectors = function (options) {\n    return new DebugVectors(options);\n  };\n\n  var ProjectedExtent = L.Path.extend({\n    getCenter: function (round) {\n      let crs = this._map.options.crs;\n      return crs.unproject(L.bounds(this._locations).getCenter());\n    },\n\n    options: {\n      className: 'mapml-debug-extent'\n    },\n    initialize: function (locations, options) {\n      //locations passed in as pcrs coordinates\n      this._locations = locations;\n      L.setOptions(this, options);\n    },\n\n    _project: function () {\n      this._rings = [];\n      let scale = this._map.options.crs.scale(this._map.getZoom()),\n        map = this._map;\n      for (let i = 0; i < this._locations.length; i++) {\n        let point = map.options.crs.transformation.transform(\n          this._locations[i],\n          scale\n        );\n        //substract the pixel origin from the pixel coordinates to get the location relative to map viewport\n        this._rings.push(\n          L.point(point.x, point.y)._subtract(map.getPixelOrigin())\n        );\n      }\n      //leaflet SVG renderer looks for and array of arrays to build polygons,\n      //in this case it only deals with a rectangle so one closed array or points\n      this._parts = [this._rings];\n    },\n\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updatePoly(this, true); //passing true creates a closed path i.e. a rectangle\n    }\n  });\n\n  var projectedExtent = function (locations, options) {\n    return new ProjectedExtent(locations, options);\n  };\n\n  var QueryHandler = L.Handler.extend({\n    addHooks: function () {\n      // get a reference to the actual <map> element, so we can\n      // use its layers property to iterate the layers from top down\n      // evaluating if they are 'on the map' (enabled)\n      L.setOptions(this, { mapEl: this._map.options.mapEl });\n      L.DomEvent.on(this._map, 'click', this._queryTopLayer, this);\n      L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n    },\n    removeHooks: function () {\n      L.DomEvent.off(this._map, 'click', this._queryTopLayer, this);\n      L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n    },\n    _getTopQueryableLayer: function () {\n      var layers = this.options.mapEl.layers;\n      // work backwards in document order (top down)\n      for (var l = layers.length - 1; l >= 0; l--) {\n        var mapmlLayer = layers[l]._layer;\n        if (layers[l].checked && mapmlLayer.queryable) {\n          return mapmlLayer;\n        }\n      }\n    },\n    _queryTopLayerAtMapCenter: function (event) {\n      setTimeout(() => {\n        if (\n          this._map.isFocused &&\n          !this._map._popupClosed &&\n          (event.originalEvent.key === ' ' || +event.originalEvent.keyCode === 13)\n        ) {\n          this._map.fire('click', {\n            latlng: this._map.getCenter(),\n            layerPoint: this._map.latLngToLayerPoint(this._map.getCenter()),\n            containerPoint: this._map.latLngToContainerPoint(\n              this._map.getCenter()\n            )\n          });\n        } else {\n          delete this._map._popupClosed;\n        }\n      }, 0);\n    },\n    _queryTopLayer: function (event) {\n      var layer = this._getTopQueryableLayer();\n      if (layer) {\n        if (layer._mapmlFeatures) delete layer._mapmlFeatures;\n        this._query(event, layer);\n      }\n    },\n    _query(e, layer) {\n      var zoom = e.target.getZoom(),\n        map = this._map,\n        crs = layer._extent.crs, // the crs for each extent would be the same\n        tileSize = map.options.crs.options.crs.tile.bounds.max.x,\n        container = layer._container,\n        popupOptions = {\n          autoClose: false,\n          autoPan: true,\n          maxHeight: map.getSize().y * 0.5 - 50\n        },\n        tcrs2pcrs = function (c) {\n          return crs.transformation.untransform(c, crs.scale(zoom));\n        },\n        tcrs2gcrs = function (c) {\n          return crs.unproject(\n            crs.transformation.untransform(c, crs.scale(zoom)),\n            zoom\n          );\n        };\n      var tcrsClickLoc = crs.latLngToPoint(e.latlng, zoom),\n        tileMatrixClickLoc = tcrsClickLoc.divideBy(tileSize).floor(),\n        tileBounds = new L.Bounds(\n          tcrsClickLoc.divideBy(tileSize).floor().multiplyBy(tileSize),\n          tcrsClickLoc.divideBy(tileSize).ceil().multiplyBy(tileSize)\n        );\n\n      let point = this._map.project(e.latlng),\n        scale = this._map.options.crs.scale(this._map.getZoom()),\n        pcrsClick = this._map.options.crs.transformation.untransform(\n          point,\n          scale\n        );\n      let templates = layer.getQueryTemplates(pcrsClick);\n\n      var fetchFeatures = function (template, obj, lastOne) {\n        const parser = new DOMParser();\n        fetch(L.Util.template(template.template, obj), { redirect: 'follow' })\n          .then((response) => {\n            if (response.status >= 200 && response.status < 300) {\n              return response.text().then((text) => {\n                return {\n                  contenttype: response.headers.get('Content-Type'),\n                  text: text\n                };\n              });\n            } else {\n              throw new Error(response.status);\n            }\n          })\n          .then((response) => {\n            if (!layer._mapmlFeatures) layer._mapmlFeatures = [];\n            if (response.contenttype.startsWith('text/mapml')) {\n              // the mapmldoc could have <map-meta> elements that are important, perhaps\n              // also, the mapmldoc can have many features\n              let mapmldoc = parser.parseFromString(\n                  response.text,\n                  'application/xml'\n                ),\n                features = Array.prototype.slice.call(\n                  mapmldoc.querySelectorAll('map-feature')\n                );\n              // <map-meta> elements\n              layer.metas = Array.prototype.slice.call(\n                mapmldoc.querySelectorAll(\n                  'map-meta[name=cs], map-meta[name=zoom], map-meta[name=projection]'\n                )\n              );\n              if (features.length)\n                layer._mapmlFeatures = layer._mapmlFeatures.concat(features);\n            } else {\n              // synthesize a single feature from text or html content\n              let geom =\n                  \"<map-geometry cs='gcrs'><map-point><map-coordinates>\" +\n                  e.latlng.lng +\n                  ' ' +\n                  e.latlng.lat +\n                  '</map-coordinates></map-point></map-geometry>',\n                feature = parser\n                  .parseFromString(\n                    '<map-feature><map-properties>' +\n                      response.text +\n                      '</map-properties>' +\n                      geom +\n                      '</map-feature>',\n                    'text/html'\n                  )\n                  .querySelector('map-feature');\n              layer._mapmlFeatures.push(feature);\n            }\n            if (lastOne) {\n              // create connection between queried <map-feature> and its parent <map-extent>\n              for (let feature of layer._mapmlFeatures) {\n                feature._extentEl = template._extentEl;\n              }\n              displayFeaturesPopup(layer._mapmlFeatures, e.latlng);\n            }\n          })\n          .catch((err) => {\n            console.log('Looks like there was a problem. Status: ' + err.message);\n          });\n      };\n\n      for (let i = 0; i < templates.length; i++) {\n        var obj = {},\n          template = templates[i];\n\n        // all of the following are locations that might be used in a query, I think.\n        obj[template.query.tilei] =\n          tcrsClickLoc.x.toFixed() - tileMatrixClickLoc.x * tileSize;\n        obj[template.query.tilej] =\n          tcrsClickLoc.y.toFixed() - tileMatrixClickLoc.y * tileSize;\n\n        // this forces the click to the centre of the map extent in the layer crs\n        obj[template.query.mapi] = map.getSize().divideBy(2).x.toFixed();\n        obj[template.query.mapj] = map.getSize().divideBy(2).y.toFixed();\n\n        obj[template.query.pixelleft] = crs.pointToLatLng(tcrsClickLoc, zoom).lng;\n        obj[template.query.pixeltop] = crs.pointToLatLng(tcrsClickLoc, zoom).lat;\n        obj[template.query.pixelright] = crs.pointToLatLng(\n          tcrsClickLoc.add([1, 1]),\n          zoom\n        ).lng;\n        obj[template.query.pixelbottom] = crs.pointToLatLng(\n          tcrsClickLoc.add([1, 1]),\n          zoom\n        ).lat;\n\n        obj[template.query.column] = tileMatrixClickLoc.x;\n        obj[template.query.row] = tileMatrixClickLoc.y;\n        obj[template.query.x] = tcrsClickLoc.x.toFixed();\n        obj[template.query.y] = tcrsClickLoc.y.toFixed();\n\n        // whereas the layerPoint is calculated relative to the origin plus / minus any\n        // pan movements so is equal to containerPoint at first before any pans, but\n        // changes as the map pans.\n        obj[template.query.easting] = tcrs2pcrs(tcrsClickLoc).x;\n        obj[template.query.northing] = tcrs2pcrs(tcrsClickLoc).y;\n        obj[template.query.longitude] = tcrs2gcrs(tcrsClickLoc).lng;\n        obj[template.query.latitude] = tcrs2gcrs(tcrsClickLoc).lat;\n        obj[template.query.zoom] = zoom;\n        obj[template.query.width] = map.getSize().x;\n        obj[template.query.height] = map.getSize().y;\n        // assumes the click is at the centre of the map, per template.query.mapi, mapj above\n        obj[template.query.mapbottom] = tcrs2pcrs(\n          tcrsClickLoc.add(map.getSize().divideBy(2))\n        ).y;\n        obj[template.query.mapleft] = tcrs2pcrs(\n          tcrsClickLoc.subtract(map.getSize().divideBy(2))\n        ).x;\n        obj[template.query.maptop] = tcrs2pcrs(\n          tcrsClickLoc.subtract(map.getSize().divideBy(2))\n        ).y;\n        obj[template.query.mapright] = tcrs2pcrs(\n          tcrsClickLoc.add(map.getSize().divideBy(2))\n        ).x;\n\n        obj[template.query.tilebottom] = tcrs2pcrs(tileBounds.max).y;\n        obj[template.query.tileleft] = tcrs2pcrs(tileBounds.min).x;\n        obj[template.query.tiletop] = tcrs2pcrs(tileBounds.min).y;\n        obj[template.query.tileright] = tcrs2pcrs(tileBounds.max).x;\n        // add hidden or other variables that may be present into the values to\n        // be processed by L.Util.template below.\n        for (var v in template.query) {\n          if (\n            [\n              'mapi',\n              'mapj',\n              'tilei',\n              'tilej',\n              'row',\n              'col',\n              'x',\n              'y',\n              'easting',\n              'northing',\n              'longitude',\n              'latitude',\n              'width',\n              'height',\n              'zoom',\n              'mapleft',\n              'mapright',\n              ',maptop',\n              'mapbottom',\n              'tileleft',\n              'tileright',\n              'tiletop',\n              'tilebottom',\n              'pixeltop',\n              'pixelbottom',\n              'pixelleft',\n              'pixelright'\n            ].indexOf(v) < 0\n          ) {\n            obj[v] = template.query[v];\n          }\n        }\n\n        if (template.extentBounds.contains(pcrsClick)) {\n          let lastOne = i === templates.length - 1 ? true : false;\n          fetchFeatures(template, obj, lastOne);\n        }\n      }\n      function displayFeaturesPopup(features, loc) {\n        if (features.length === 0) return;\n        let f = M.featureLayer(features, {\n          // pass the vector layer a renderer of its own, otherwise leaflet\n          // puts everything into the overlayPane\n          renderer: M.featureRenderer(),\n          // pass the vector layer the container for the parent into which\n          // it will append its own container for rendering into\n          pane: container,\n          //color: 'yellow',\n          // instead of unprojecting and then projecting and scaling,\n          // a much smarter approach would be to scale at the current\n          // zoom\n          projection: map.options.projection,\n          _leafletLayer: layer,\n          query: true,\n          static: true\n        });\n        f.addTo(map);\n\n        let div = L.DomUtil.create('div', 'mapml-popup-content'),\n          c = L.DomUtil.create('iframe');\n        c.style = 'border: none';\n        c.srcdoc = features[0].querySelector(\n          'map-feature map-properties'\n        ).innerHTML;\n        c.setAttribute('sandbox', 'allow-same-origin allow-forms');\n        div.appendChild(c);\n        // passing a latlng to the popup is necessary for when there is no\n        // geometry / null geometry\n        layer._totalFeatureCount = features.length;\n        layer.bindPopup(div, popupOptions).openPopup(loc);\n        layer.on('popupclose', function () {\n          map.removeLayer(f);\n        });\n        f.showPaginationFeature({ i: 0, popup: layer._popup, meta: layer.metas });\n      }\n    }\n  });\n\n  /*\n  MIT License related to portions of M.ContextMenu \n  Copyright (c) 2017 adam.ratcliffe@gmail.com\n  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the Software), \n  to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, \n  and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n  */\n  /* global M, KeyboardEvent */\n\n  var ContextMenu = L.Handler.extend({\n    _touchstart: L.Browser.msPointer\n      ? 'MSPointerDown'\n      : L.Browser.pointer\n      ? 'pointerdown'\n      : 'touchstart',\n\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n      this.activeIndex = 0; //current fous index on menu\n      this.excludedIndices = [4, 7]; //menu indexes that are --------\n      this.isRunned = false; //variable for tracking edge case\n      //setting the items in the context menu and their callback functions\n      this._menuItems = {};\n\n      const CTXBACK = 0,\n        CTXFWD = 1,\n        CTXRELOAD = 2,\n        CTXFULLSCR = 3,\n        CTXSPACER1 = 4,\n        CTXCOPY = 5,\n        CTXPASTE = 6,\n        CTXSPACER2 = 7,\n        CTXCNTRLS = 8,\n        CTXDEBUG = 9,\n        CTXVWSRC = 10;\n      this._menuItems.CTXBACK = CTXBACK;\n      this._menuItems.CTXFWD = CTXFWD;\n      this._menuItems.CTXRELOAD = CTXRELOAD;\n      this._menuItems.CTXFULLSCR = CTXFULLSCR;\n      this._menuItems.CTXSPACER1 = CTXSPACER1;\n      this._menuItems.CTXCOPY = CTXCOPY;\n      this._menuItems.CTXPASTE = CTXPASTE;\n      this._menuItems.CTXSPACER2 = CTXSPACER2;\n      this._menuItems.CTXCNTRLS = CTXCNTRLS;\n      this._menuItems.CTXDEBUG = CTXDEBUG;\n      this._menuItems.CTXVWSRC = CTXVWSRC;\n\n      this._items = [\n        {\n          // 0\n          text: M.options.locale.cmBack + ' (<kbd>Alt+Left Arrow</kbd>)',\n          callback: this._goBack\n        },\n        {\n          // 1\n          text: M.options.locale.cmForward + ' (<kbd>Alt+Right Arrow</kbd>)',\n          callback: this._goForward\n        },\n        {\n          // 2\n          text: M.options.locale.cmReload + ' (<kbd>Ctrl+R</kbd>)',\n          callback: this._reload\n        },\n        {\n          // 3\n          text: M.options.locale.btnFullScreen + ' (<kbd>F</kbd>)',\n          callback: this._toggleFullScreen\n        },\n        {\n          // 4\n          spacer: '-'\n        },\n        {\n          // 5\n          text: M.options.locale.cmCopyCoords + ' (<kbd>C</kbd>)<span></span>',\n          callback: this._copyCoords,\n          hideOnSelect: false,\n          popup: true,\n          submenu: [\n            {\n              // 5.0\n              text: M.options.locale.cmCopyMapML,\n              callback: this._copyMapML\n            },\n            {\n              // 5.1\n              text: M.options.locale.cmCopyExtent,\n              callback: this._copyExtent\n            },\n            {\n              // 5.2\n              text: M.options.locale.cmCopyLocation,\n              callback: this._copyLocation\n            }\n          ]\n        },\n        {\n          // 6\n          text: M.options.locale.cmPasteLayer + ' (<kbd>P</kbd>)',\n          callback: this._paste\n        },\n        {\n          // 7\n          spacer: '-'\n        },\n        {\n          // 8\n          text: M.options.locale.cmToggleControls + ' (<kbd>T</kbd>)',\n          callback: this._toggleControls\n        },\n        {\n          // 9\n          text: M.options.locale.cmToggleDebug + ' (<kbd>D</kbd>)',\n          callback: this._toggleDebug\n        },\n        {\n          // 10\n          text: M.options.locale.cmViewSource + ' (<kbd>V</kbd>)',\n          callback: this._viewSource\n        }\n      ];\n\n      // setting the default cs for copying location and extent\n      // should be public as they are used in tests\n      this.defExtCS = M.options.defaultExtCoor;\n      this.defLocCS = M.options.defaultLocCoor;\n      const LYRZOOMTO = 0,\n        LYRCOPY = 1;\n      this._menuItems.LYRZOOMTO = LYRZOOMTO;\n      this._menuItems.LYRCOPY = LYRCOPY;\n      this._layerItems = [\n        {\n          // 0\n          text: M.options.locale.lmZoomToLayer + ' (<kbd>Z</kbd>)',\n          callback: this._zoomToLayer\n        },\n        {\n          // 1\n          text: M.options.locale.lmCopyLayer + ' (<kbd>L</kbd>)',\n          callback: this._copyLayer\n        }\n      ];\n      this._mapMenuVisible = false;\n      this._keyboardEvent = false;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu',\n        map.getContainer()\n      );\n      this._container.setAttribute('hidden', '');\n\n      this._items[CTXBACK].el = this._createItem(\n        this._container,\n        this._items[CTXBACK]\n      );\n      this._items[CTXFWD].el = this._createItem(\n        this._container,\n        this._items[CTXFWD]\n      );\n      this._items[CTXRELOAD].el = this._createItem(\n        this._container,\n        this._items[CTXRELOAD]\n      );\n      this._items[CTXFULLSCR].el = this._createItem(\n        this._container,\n        this._items[CTXFULLSCR]\n      );\n      this._items[CTXSPACER1].el = this._createItem(\n        this._container,\n        this._items[CTXSPACER1]\n      );\n      this._items[CTXCOPY].el = this._createItem(\n        this._container,\n        this._items[CTXCOPY]\n      );\n\n      this._copySubMenu = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu mapml-submenu',\n        this._container\n      );\n      this._copySubMenu.id = 'mapml-copy-submenu';\n      this._copySubMenu.setAttribute('hidden', '');\n\n      this._clickEvent = null;\n\n      const CPYMENUMAP = 0,\n        CPYMENUEXTENT = 1,\n        CPYMENULOC = 2;\n      this._menuItems.CPYMENUMAP = CPYMENUMAP;\n      this._menuItems.CPYMENUEXTENT = CPYMENUEXTENT;\n      this._menuItems.CPYMENULOC = CPYMENULOC;\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENUMAP],\n        CPYMENUMAP\n      );\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENUEXTENT],\n        CPYMENUEXTENT\n      );\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENULOC],\n        CPYMENULOC\n      );\n\n      this._items[CTXPASTE].el = this._createItem(\n        this._container,\n        this._items[CTXPASTE]\n      );\n      this._items[CTXSPACER2].el = this._createItem(\n        this._container,\n        this._items[CTXSPACER2]\n      );\n      this._items[CTXCNTRLS].el = this._createItem(\n        this._container,\n        this._items[CTXCNTRLS]\n      );\n      this._items[CTXDEBUG].el = this._createItem(\n        this._container,\n        this._items[CTXDEBUG]\n      );\n      this._items[CTXVWSRC].el = this._createItem(\n        this._container,\n        this._items[CTXVWSRC]\n      );\n\n      this._layerMenu = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu mapml-layer-menu',\n        map.getContainer()\n      );\n      this._layerMenu.setAttribute('hidden', '');\n      this._createItem(this._layerMenu, this._layerItems[LYRZOOMTO]);\n      this._createItem(this._layerMenu, this._layerItems[LYRCOPY]);\n\n      L.DomEvent.on(this._container, 'click', L.DomEvent.stop)\n        .on(this._container, 'mousedown', L.DomEvent.stop)\n        .on(this._container, 'dblclick', L.DomEvent.stop)\n        .on(this._container, 'contextmenu', L.DomEvent.stop)\n        .on(this._layerMenu, 'click', L.DomEvent.stop)\n        .on(this._layerMenu, 'mousedown', L.DomEvent.stop)\n        .on(this._layerMenu, 'dblclick', L.DomEvent.stop)\n        .on(this._layerMenu, 'contextmenu', L.DomEvent.stop);\n\n      this.t = document.createElement('template');\n      this.t.innerHTML = `<map-feature zoom=\"\">\n        <map-featurecaption></map-featurecaption>\n        <map-properties>\n            <h2></h2>\n            <div style=\"text-align:center\"></div>\n        </map-properties>\n        <map-geometry cs=\"\">\n          <map-point>\n            <map-coordinates></map-coordinates>\n          </map-point>\n        </map-geometry>\n      </map-feature>`;\n    },\n\n    addHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent.on(container, 'mouseleave', this._hide, this).on(\n        document,\n        'keydown',\n        this._onKeyDown,\n        this\n      );\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.on(\n        {\n          contextmenu: this._show,\n          mousedown: this._hide,\n          zoomstart: this._hide\n        },\n        this\n      );\n    },\n\n    removeHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent.off(container, 'mouseleave', this._hide, this).off(\n        document,\n        'keydown',\n        this._onKeyDown,\n        this\n      );\n\n      if (L.Browser.touch) {\n        L.DomEvent.off(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.off(\n        {\n          contextmenu: this._show,\n          mousedown: this._hide,\n          zoomstart: this._hide\n        },\n        this\n      );\n    },\n\n    _updateCS: function () {\n      if (\n        this.defExtCS !== M.options.defaultExtCoor ||\n        this.defLocCS !== M.options.defaultLocCoor\n      ) {\n        this.defExtCS = M.options.defaultExtCoor;\n        this.defLocCS = M.options.defaultLocCoor;\n      }\n    },\n\n    _copyExtent: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        coord = context.defExtCS ? context.defExtCS.toLowerCase() : 'pcrs',\n        tL =\n          e instanceof KeyboardEvent\n            ? this.extent.topLeft[coord]\n            : this.options.mapEl.extent.topLeft[coord],\n        bR =\n          e instanceof KeyboardEvent\n            ? this.extent.bottomRight[coord]\n            : this.options.mapEl.extent.bottomRight[coord],\n        data = '';\n      switch (coord) {\n        case 'MapML':\n        default:\n          if (coord === 'pcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-easting=${Math.round(\n            tL.horizontal\n          )}, top-left-northing=${Math.round(\n            tL.vertical\n          )}, bottom-right-easting=${Math.round(\n            bR.horizontal\n          )}, bottom-right-northing=${Math.round(bR.vertical)}\"></map-meta>`;\n          } else if (coord === 'gcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-longitude=${tL.horizontal}, top-left-latitude=${tL.vertical}, bottom-right-longitude=${bR.horizontal}, bottom-right-latitude=${bR.vertical}\"></map-meta>`;\n          } else if (coord === 'tcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-x=${\n            tL[0].horizontal\n          }, top-left-y=${tL[0].vertical}, bottom-right-x=${\n            bR[bR.length - 1].horizontal\n          }, bottom-right-y=${bR[bR.length - 1].vertical}\"></map-meta>`;\n          } else if (coord === 'tilematrix') {\n            data = `<map-meta name=\"extent\" content=\"top-left-column=${\n            tL[0].horizontal\n          }, top-left-row=${tL[0].vertical}, bottom-right-column=${\n            bR[bR.length - 1].horizontal\n          }, bottom-right-row=${bR[bR.length - 1].vertical}\"></map-meta>`;\n          } else {\n            console.log('not support');\n          }\n          break;\n      }\n      context._copyData(data);\n    },\n\n    _zoomToLayer: function (e) {\n      let context =\n        e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu;\n      context._layerClicked.layer._layerEl.zoomTo();\n    },\n\n    _copyLayer: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        layerElem = context._layerClicked.layer._layerEl;\n      context._copyData(layerElem.getOuterHTML());\n    },\n\n    _goForward: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.forward();\n    },\n\n    _goBack: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.back();\n    },\n\n    _reload: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.reload();\n    },\n\n    _toggleFullScreen: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl._toggleFullScreen();\n    },\n\n    _toggleControls: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      if (mapEl.controls) {\n        mapEl.controls = false;\n      } else {\n        mapEl.controls = true;\n      }\n    },\n\n    _copyMapML: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl =\n          e instanceof KeyboardEvent\n            ? this._map.options.mapEl\n            : this.options.mapEl;\n      context._copyData(\n        mapEl.outerHTML.replace(\n          /<div class=\"mapml-web-map\">.*?<\\/div>|<style>\\[is=\"web-map\"].*?<\\/style>|<style>mapml-viewer.*?<\\/style>/gm,\n          ''\n        )\n      );\n    },\n\n    // Add support for pasting GeoJSON in the future\n    _paste: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl =\n          e instanceof KeyboardEvent\n            ? this._map.options.mapEl\n            : this.options.mapEl;\n      navigator.clipboard.readText().then((layer) => {\n        M._pasteLayer(mapEl, layer);\n      });\n    },\n\n    _viewSource: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.viewSource();\n    },\n\n    _toggleDebug: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.toggleDebug();\n    },\n\n    _copyCoords: function (e) {\n      let directory = this.contextMenu ? this.contextMenu : this;\n      directory._showCopySubMenu(e);\n    },\n\n    _copyData: function (data) {\n      const el = document.createElement('textarea');\n      el.value = data;\n      document.body.appendChild(el);\n      el.select();\n      document.execCommand('copy');\n      document.body.removeChild(el);\n    },\n\n    _copyLocation: function (e) {\n      const menu = this.contextMenu;\n      switch (menu.defLocCS.toLowerCase()) {\n        case 'tile':\n          menu._copyTile.call(this, e);\n          break;\n        case 'tilematrix':\n          menu._copyTileMatrix.call(this, e);\n          break;\n        case 'map':\n          menu._copyMap.call(this, e);\n          break;\n        case 'tcrs':\n          menu._copyTCRS.call(this, e);\n          break;\n        case 'pcrs':\n          menu._copyPCRS.call(this, e);\n          break;\n        case 'gcrs':\n        default:\n          menu._copyGCRS.call(this, e);\n          break;\n      }\n    },\n\n    _copyGCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} gcrs location`;\n      h2.textContent = `Copied ${projection} gcrs location`;\n      div.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        pt = { x: point.x.toFixed(), y: point.y.toFixed() },\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'tcrs');\n      caption.textContent = `Copied ${projection} tcrs location`;\n      h2.textContent = `Copied ${projection} tcrs location`;\n      div.textContent = `${pt.x} ${pt.y}`;\n      coords.textContent = `${pt.x} ${pt.y}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTileMatrix: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} tilematrix location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} tilematrix location (not implemented yet)`;\n      div.textContent = `${Math.trunc(point.x / tileSize)} ${Math.trunc(\n      point.y / tileSize\n    )}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyPCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation\n          .untransform(point, scale)\n          .round(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'pcrs');\n      caption.textContent = `Copied ${projection} pcrs location`;\n      h2.textContent = `Copied ${projection} pcrs location`;\n      div.textContent = `${pcrs.x} ${pcrs.y}`;\n      coords.textContent = `${pcrs.x} ${pcrs.y}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTile: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        // the _map.project method returns pixels, while the _map.crs.project\n        // method returns meters, confusingly:\n        // https://leafletjs.com/reference.html#map-project\n        // https://leafletjs.com/reference.html#crs-project\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointX = point.x % tileSize,\n        pointY = point.y % tileSize,\n        pt = L.point(pointX, pointY).trunc(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      if (pt.x < 0) pt.x += tileSize;\n      if (pt.y < 0) pt.y += tileSize;\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} tile location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} tile location (not implemented yet)`;\n      div.textContent = `${pt.x} ${pt.y}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyMap: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        mapPt = click.containerPoint.trunc(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} map location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} map location (not implemented yet)`;\n      div.textContent = `${mapPt.x} ${mapPt.y}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyAllCoords: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointX = point.x % tileSize,\n        pointY = point.y % tileSize,\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation.untransform(point, scale);\n      let allData = `z:${mapEl.zoom}\\n`;\n      allData += `tile: i:${Math.trunc(pointX)}, j:${Math.trunc(pointY)}\\n`;\n      allData += `tilematrix: column:${Math.trunc(\n      point.x / tileSize\n    )}, row:${Math.trunc(point.y / tileSize)}\\n`;\n      allData += `map: i:${Math.trunc(click.containerPoint.x)}, j:${Math.trunc(\n      click.containerPoint.y\n    )}\\n`;\n      allData += `tcrs: x:${Math.trunc(point.x)}, y:${Math.trunc(point.y)}\\n`;\n      allData += `pcrs: easting:${pcrs.x.toFixed(2)}, northing:${pcrs.y.toFixed(\n      2\n    )}\\n`;\n      allData += `gcrs: lon :${click.latlng.lng.toFixed(\n      6\n    )}, lat:${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(allData);\n    },\n\n    _createItem: function (container, options, index) {\n      if (options.spacer) {\n        return this._createSeparator(container, index);\n      }\n\n      var itemCls = 'mapml-contextmenu-item',\n        el = this._insertElementAt('button', itemCls, container, index),\n        callback = this._createEventHandler(\n          el,\n          options.callback,\n          options.context,\n          options.hideOnSelect\n        ),\n        html = '';\n\n      el.innerHTML = html + options.text;\n      el.setAttribute('type', 'button');\n      el.classList.add('mapml-button');\n      if (options.popup) {\n        el.setAttribute('aria-haspopup', 'true');\n        el.setAttribute('aria-expanded', 'false');\n        el.setAttribute('aria-controls', 'mapml-copy-submenu');\n      }\n\n      L.DomEvent.on(el, 'mouseover', this._onItemMouseOver, this)\n        .on(el, 'mouseout', this._onItemMouseOut, this)\n        .on(el, 'mousedown', L.DomEvent.stopPropagation)\n        .on(el, 'click', callback);\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(el, this._touchstart, L.DomEvent.stopPropagation);\n      }\n\n      // Devices without a mouse fire \"mouseover\" on tap, but never mouseout\"\n      if (!L.Browser.pointer) {\n        L.DomEvent.on(el, 'click', this._onItemMouseOut, this);\n      }\n\n      return {\n        id: L.Util.stamp(el),\n        el: el,\n        callback: callback\n      };\n    },\n\n    _createSeparator: function (container, index) {\n      let el = this._insertElementAt(\n        'div',\n        'mapml-contextmenu-separator',\n        container,\n        index\n      );\n\n      return {\n        id: L.Util.stamp(el),\n        el: el\n      };\n    },\n\n    _createEventHandler: function (el, func, context, hideOnSelect) {\n      let parent = this;\n\n      hideOnSelect = hideOnSelect !== undefined ? hideOnSelect : true;\n\n      return function (e) {\n        let map = parent._map,\n          containerPoint = parent._showLocation.containerPoint,\n          layerPoint = map.containerPointToLayerPoint(containerPoint),\n          latlng = map.layerPointToLatLng(layerPoint),\n          relatedTarget = parent._showLocation.relatedTarget,\n          data = {\n            containerPoint: containerPoint,\n            layerPoint: layerPoint,\n            latlng: latlng,\n            relatedTarget: relatedTarget\n          };\n\n        if (hideOnSelect) {\n          parent._hide();\n        }\n\n        if (func) {\n          func.call(context || map, data);\n        }\n\n        parent._map.fire('contextmenu.select', {\n          contextmenu: parent,\n          el: el\n        });\n      };\n    },\n\n    _insertElementAt: function (tagName, className, container, index) {\n      let refEl,\n        el = document.createElement(tagName);\n\n      el.className = className;\n\n      if (index !== undefined) {\n        refEl = container.children[index];\n      }\n\n      if (refEl) {\n        container.insertBefore(el, refEl);\n      } else {\n        container.appendChild(el);\n      }\n\n      return el;\n    },\n\n    _show: function (e) {\n      // don't show a context menu for features\n      if (e.originalEvent.target.closest('.mapml-vector-container')) return;\n      if (this._mapMenuVisible) this._hide();\n      this._clickEvent = e;\n      let elem = e.originalEvent.target;\n      if (elem.closest('fieldset')) {\n        elem = elem.closest('fieldset');\n        elem =\n          elem.className === 'mapml-layer-extent'\n            ? elem\n                .closest('fieldset')\n                .parentNode.parentNode.parentNode.querySelector('span')\n            : elem.querySelector('span');\n        if (!elem.layer.validProjection) return;\n        this._layerClicked = elem;\n        this._layerMenu.removeAttribute('hidden');\n        this._showAtPoint(e.containerPoint, e, this._layerMenu);\n      } else if (\n        elem.classList.contains('leaflet-container') ||\n        elem.classList.contains('mapml-debug-extent') ||\n        elem.tagName === 'path'\n      ) {\n        let layerList = this._map.options.mapEl.layers;\n        this._layerClicked = Array.from(layerList).find((el) => el.checked);\n        // the 'hidden' attribute must be removed before any attempt to get the size of container\n        let pt = e.containerPoint;\n        // this is for firefox, which reports the e.containerPoint as x=0 when you\n        // use a keyboard Shift+F10 to display the context menu; this appears\n        // to be because blink returns a PointerEvent of type==='contextmenu',\n        // while gecko returns an object (for e.originalEvent).\n        if (L.Browser.gecko) {\n          const getCenter = function (el) {\n            let w = el.getBoundingClientRect().width;\n            let h = el.getBoundingClientRect().height;\n            return { x: Number.parseInt(w / 2), y: Number.parseInt(h / 2) };\n          };\n          pt = getCenter(this._map.getContainer());\n        }\n        this._container.removeAttribute('hidden');\n        this._showAtPoint(pt, e, this._container);\n        this._updateCS();\n      }\n      if (e.originalEvent.button === 0 || e.originalEvent.button === -1) {\n        this._keyboardEvent = true;\n        if (this._layerClicked.className.includes('mapml-layer-item')) {\n          let activeEl = document.activeElement;\n          this._elementInFocus = activeEl.shadowRoot.activeElement;\n          this._layerMenuTabs = 1;\n          this._layerMenu.firstChild.focus();\n        } else {\n          this._container.querySelectorAll('button:not([disabled])')[0].focus();\n        }\n      }\n    },\n\n    _showAtPoint: function (pt, data, container) {\n      if (this._items.length) {\n        let event = L.extend(data || {}, { contextmenu: this });\n\n        this._showLocation = {\n          containerPoint: pt\n        };\n\n        if (data && data.relatedTarget) {\n          this._showLocation.relatedTarget = data.relatedTarget;\n        }\n\n        this._setPosition(pt, container);\n\n        if (!this._mapMenuVisible) {\n          container.removeAttribute('hidden');\n          this._mapMenuVisible = true;\n        }\n\n        this._map.fire('contextmenu.show', event);\n      }\n    },\n\n    _hide: function () {\n      if (this._mapMenuVisible) {\n        this._mapMenuVisible = false;\n        this._container.setAttribute('hidden', '');\n        this._copySubMenu.setAttribute('hidden', '');\n        this._layerMenu.setAttribute('hidden', '');\n        this._map.fire('contextmenu.hide', { contextmenu: this });\n        setTimeout(() => this._map._container.focus(), 0);\n        this.activeIndex = 0;\n        this.isRunned = false;\n      }\n    },\n\n    _setPosition: function (pt, container) {\n      let mapSize = this._map.getSize(),\n        containerSize = this._getElementSize(container),\n        anchor;\n\n      if (this._map.options.contextmenuAnchor) {\n        anchor = L.point(this._map.options.contextmenuAnchor);\n        pt = pt.add(anchor);\n      }\n\n      container._leaflet_pos = pt;\n\n      if (pt.x + containerSize.x > mapSize.x) {\n        container.style.left = 'auto';\n        container.style.right =\n          Math.min(\n            Math.max(mapSize.x - pt.x, 0),\n            mapSize.x - containerSize.x - 1\n          ) + 'px';\n      } else {\n        container.style.left = Math.max(pt.x, 0) + 'px';\n        container.style.right = 'auto';\n      }\n\n      if (pt.y + containerSize.y > mapSize.y) {\n        container.style.top = 'auto';\n        container.style.bottom =\n          Math.min(\n            Math.max(mapSize.y - pt.y, 0),\n            mapSize.y - containerSize.y - 1\n          ) + 'px';\n      } else {\n        container.style.top = Math.max(pt.y, 0) + 'px';\n        container.style.bottom = 'auto';\n      }\n    },\n\n    _getElementSize: function (el) {\n      let size = this._size;\n\n      if (!size || this._sizeChanged) {\n        size = {};\n\n        el.style.left = '-999999px';\n        el.style.right = 'auto';\n\n        size.x = el.offsetWidth;\n        size.y = el.offsetHeight;\n\n        el.style.left = 'auto';\n\n        this._sizeChanged = false;\n      }\n\n      return size;\n    },\n\n    // once tab is clicked on the layer menu, change the focus back to the layer control\n    _focusOnLayerControl: function () {\n      this._mapMenuVisible = false;\n      delete this._layerMenuTabs;\n      this._layerMenu.setAttribute('hidden', '');\n      if (this._elementInFocus) {\n        this._elementInFocus.focus();\n      } else {\n        this._layerClicked.parentElement.firstChild.focus();\n      }\n      delete this._elementInFocus;\n    },\n\n    _setActiveItem: function (index) {\n      if (\n        document.activeElement.shadowRoot === null &&\n        this.noActiveEl === true\n      ) {\n        //bug fix when theres no active element\n        this.noActiveEl = false;\n        //setting this._items[9] is just for preventing some diabled index, it will be override by later code.\n        this._items[9].el.el.focus();\n      }\n      if (\n        document.activeElement.shadowRoot.activeElement.innerHTML ===\n        this._items[index].el.el.innerHTML\n      ) {\n        //edge case where pressing shift f10 focuses the first element on contextmenu (if already focused, have to press arrow twice to go down)\n        let next = index + 1;\n        while (this._items[next].el.el.disabled) {\n          next++;\n          if (next >= this._items.length) {\n            next = 0;\n          }\n        }\n        this._setActiveItem(next);\n      } else {\n        if (this.excludedIndices.includes(index)) {\n          // find the next or previous non-excluded item\n          let nextIndex = index + 1;\n          let prevIndex = index - 1;\n          while (\n            this.excludedIndices.includes(nextIndex) ||\n            this._items[nextIndex].el.el.disabled\n          ) {\n            nextIndex++;\n            if (nextIndex >= this._items.length) {\n              nextIndex = 0;\n            }\n          }\n          while (\n            this.excludedIndices.includes(prevIndex) ||\n            this._items[prevIndex].el.el.disabled\n          ) {\n            prevIndex--;\n            if (prevIndex < 0) {\n              prevIndex = this._items.length - 1;\n            }\n          }\n          // set the active item to the next or previous non-excluded item\n          if (this.activeIndex < index) {\n            this._setActiveItem(nextIndex);\n          } else {\n            this._setActiveItem(prevIndex);\n          }\n        } else {\n          // set the focus item\n          this._items[index].el.el.focus();\n          this.activeIndex = index;\n        }\n      }\n    },\n\n    _onKeyDown: function (e) {\n      if (!this._mapMenuVisible || e.key === 'Shift') return;\n\n      if (e.code === 'Enter' || e.code === 'Tab' || e.code.startsWith('Arrow'))\n        e.preventDefault();\n\n      if (e.code === 'ArrowUp' || (e.shiftKey && e.code === 'Tab')) {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          (document.activeElement.shadowRoot === null || //null happens when the focus is on submenu and when mouse hovers on main menu, submenu disappears\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML)\n        ) {\n          //\"map\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML\n        ) {\n          //\"extent\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n        ) {\n          //\"Location\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();\n        } else if (\n          !this._layerMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML\n        ) {\n          //\"zoom to layer\" on layermenu\n          this._layerMenu.children[this._menuItems.LYRCOPY].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden')) {\n          this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();\n        } else {\n          if (this.activeIndex > 0) {\n            let prevIndex = this.activeIndex - 1;\n            while (this._items[prevIndex].el.el.disabled) {\n              prevIndex--;\n              if (prevIndex < 0) {\n                prevIndex = this._items.length - 1;\n              }\n            }\n            this._setActiveItem(prevIndex);\n          } else {\n            this._setActiveItem(this._items.length - 1);\n          }\n        }\n      } else if (e.code === 'ArrowDown' || e.code === 'Tab') {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          (document.activeElement.shadowRoot === null ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML)\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();\n        } else if (\n          !this._layerMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML\n        ) {\n          this._layerMenu.children[this._menuItems.LYRCOPY].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden')) {\n          this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();\n        } else {\n          if (this.activeIndex < this._items.length - 1) {\n            //edge case at index 0\n            if (\n              !this.isRunned &&\n              this.activeIndex === 0 &&\n              !this._items[this.activeIndex].el.el.disabled\n            ) {\n              this._setActiveItem(0);\n              this.isRunned = true;\n            } else {\n              //edge case over\n              let nextIndex = this.activeIndex + 1;\n              while (this._items[nextIndex].el.el.disabled) {\n                nextIndex++;\n                if (nextIndex >= this._items.length) {\n                  nextIndex = 0;\n                }\n              }\n              this._setActiveItem(nextIndex);\n            }\n          } else {\n            let nextIndex = 0;\n            while (this._items[nextIndex].el.el.disabled) {\n              nextIndex++;\n              if (nextIndex >= this._items.length) {\n                nextIndex = 0;\n              }\n            }\n            this._setActiveItem(nextIndex);\n          }\n        }\n      } else if (e.code === 'ArrowRight') {\n        if (\n          document.activeElement.shadowRoot !== null &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML && //'copy'\n          this._copySubMenu.hasAttribute('hidden')\n        ) {\n          this._showCopySubMenu();\n          this._copySubMenu.children[0].focus();\n        } else if (\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML &&\n          !this._copySubMenu.hasAttribute('hidden')\n        ) {\n          this._copySubMenu.children[0].focus();\n        }\n      } else if (e.code === 'ArrowLeft') {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot !== null\n        ) {\n          if (\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUEXTENT]\n                .innerHTML ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n          ) {\n            this._copySubMenu.setAttribute('hidden', '');\n            this._setActiveItem(this._menuItems.CTXCOPY);\n          }\n        }\n      } else if (e.code === 'Escape') {\n        if (this._layerMenuTabs) {\n          L.DomEvent.stop(e);\n          this._focusOnLayerControl();\n          return;\n        }\n        if (document.activeElement.shadowRoot === null) {\n          this._hide();\n        } else {\n          if (!this._copySubMenu.hasAttribute('hidden')) {\n            if (\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENUMAP]\n                  .innerHTML ||\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENUEXTENT]\n                  .innerHTML ||\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n            ) {\n              this._copySubMenu.setAttribute('hidden', '');\n              this._setActiveItem(this._menuItems.CTXCOPY);\n            }\n          } else {\n            this._hide();\n          }\n        }\n      } else if (\n        e.code !== 'KeyC' &&\n        document.activeElement.shadowRoot.activeElement.innerHTML !==\n          this._items[this._menuItems.CTXCOPY].el.el.innerHTML\n      ) {\n        this._hide();\n      }\n      // using KeyboardEvent.code for its mnemonics and case-independence\n      switch (e.code) {\n        case 'Enter':\n          if (\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML\n          ) {\n            this._copyCoords({\n              latlng: this._map.getCenter()\n            });\n            this._copySubMenu.firstChild.focus();\n          } else {\n            if (\n              this._map._container.parentNode.activeElement.parentNode.classList.contains(\n                'mapml-contextmenu'\n              )\n            )\n              this._map._container.parentNode.activeElement.click();\n          }\n          break;\n        case 'Space':\n          if (\n            this._map._container.parentNode.activeElement.parentNode.classList.contains(\n              'mapml-contextmenu'\n            )\n          )\n            this._map._container.parentNode.activeElement.click();\n          break;\n        case 'KeyC':\n          this._copyCoords({\n            latlng: this._map.getCenter()\n          });\n          this._copySubMenu.firstChild.focus();\n          break;\n        case 'KeyD':\n          this._toggleDebug(e);\n          break;\n        case 'KeyM':\n          this._copyMapML(e);\n          break;\n        case 'KeyL':\n          if (this._layerClicked.className.includes('mapml-layer-item'))\n            this._copyLayer(e);\n          break;\n        case 'KeyF':\n          this._toggleFullScreen(e);\n          break;\n        case 'KeyP':\n          this._paste(e);\n          break;\n        case 'KeyT':\n          this._toggleControls(e);\n          break;\n        case 'KeyV':\n          this._viewSource(e);\n          break;\n        case 'KeyZ':\n          if (this._layerClicked.className.includes('mapml-layer-item')) {\n            this._zoomToLayer(e);\n          }\n          break;\n      }\n    },\n\n    _showCopySubMenu: function (e) {\n      let mapSize = this._map.getSize(),\n        click = this._clickEvent,\n        menu = this._copySubMenu,\n        copyEl = this._items[5].el.el;\n\n      copyEl.setAttribute('aria-expanded', 'true');\n      menu.removeAttribute('hidden');\n\n      const menuWidth = this._container.offsetWidth,\n        menuHeight = this._container.offsetHeight,\n        submenuWidth = menu.offsetWidth;\n      if (click.containerPoint.x + menuWidth + submenuWidth > mapSize.x) {\n        menu.style.left = 'auto';\n        menu.style.right = menuWidth + 'px';\n      } else {\n        menu.style.left = menuWidth + 'px';\n        menu.style.right = 'auto';\n      }\n\n      menu.style.top = 100 - 22 + 'px';\n      menu.style.bottom = 'auto';\n    },\n\n    _hideCopySubMenu: function (e) {\n      if (\n        !e.relatedTarget ||\n        !e.relatedTarget.parentElement ||\n        e.relatedTarget.parentElement.classList.contains('mapml-submenu') ||\n        e.relatedTarget.classList.contains('mapml-submenu')\n      )\n        return;\n      let menu = this._copySubMenu,\n        copyEl = this._items[4].el.el;\n      copyEl.setAttribute('aria-expanded', 'false');\n      menu.setAttribute('hidden', '');\n      this.noActiveEl = true; //variable to keep track of no focus element on contextmenu, bug fix for arrow key navigation\n    },\n\n    _onItemMouseOver: function (e) {\n      L.DomUtil.addClass(e.target || e.srcElement, 'over');\n      if (e.srcElement.innerText === M.options.locale.cmCopyCoords + ' (C)')\n        this._showCopySubMenu(e);\n    },\n\n    _onItemMouseOut: function (e) {\n      L.DomUtil.removeClass(e.target || e.srcElement, 'over');\n      this._hideCopySubMenu(e);\n    },\n\n    toggleContextMenuItem: function (options, state) {\n      options = options.toUpperCase();\n      if (state === 'disabled') {\n        if (options === 'CONTROLS') {\n          this._items[8].el.el.disabled = true;\n        } else if (options === 'BACK') {\n          this._items[0].el.el.disabled = true;\n        } else if (options === 'FORWARD') {\n          this._items[1].el.el.disabled = true;\n        } else if (options === 'RELOAD') {\n          this._items[2].el.el.disabled = true;\n        }\n      } else if (state === 'enabled') {\n        if (options === 'CONTROLS') {\n          this._items[8].el.el.disabled = false;\n        } else if (options === 'BACK') {\n          this._items[0].el.el.disabled = false;\n        } else if (options === 'FORWARD') {\n          this._items[1].el.el.disabled = false;\n        } else if (options === 'RELOAD') {\n          this._items[2].el.el.disabled = false;\n        }\n      }\n    },\n\n    setViewFullScreenInnerHTML: function (options) {\n      if (options === 'view') {\n        this._map.contextMenu._items[3].el.el.innerHTML =\n          M.options.locale.btnFullScreen + ' (<kbd>F</kbd>)';\n      } else if (options === 'exit') {\n        this._map.contextMenu._items[3].el.el.innerHTML =\n          M.options.locale.btnExitFullScreen + ' (<kbd>F</kbd>)';\n      }\n    }\n  });\n\n  var Util = {\n    // _convertAndFormatPCRS returns the converted CRS and formatted pcrsBounds in gcrs, pcrs, tcrs, and tilematrix. Used for setting extent for the map and layer (map.extent, layer.extent).\n    // _convertAndFormatPCRS: L.Bounds, _map -> {...}\n    _convertAndFormatPCRS: function (pcrsBounds, map) {\n      if (!pcrsBounds || !map) return {};\n\n      let tcrsTopLeft = [],\n        tcrsBottomRight = [],\n        tileMatrixTopLeft = [],\n        tileMatrixBottomRight = [],\n        tileSize = map.options.crs.options.crs.tile.bounds.max.y;\n\n      for (let i = 0; i < map.options.crs.options.resolutions.length; i++) {\n        let scale = map.options.crs.scale(i),\n          minConverted = map.options.crs.transformation.transform(\n            pcrsBounds.min,\n            scale\n          ),\n          maxConverted = map.options.crs.transformation.transform(\n            pcrsBounds.max,\n            scale\n          );\n\n        tcrsTopLeft.push({\n          horizontal: minConverted.x,\n          vertical: maxConverted.y\n        });\n        tcrsBottomRight.push({\n          horizontal: maxConverted.x,\n          vertical: minConverted.y\n        });\n\n        //converts the tcrs values from earlier to tilematrix\n        tileMatrixTopLeft.push({\n          horizontal: tcrsTopLeft[i].horizontal / tileSize,\n          vertical: tcrsTopLeft[i].vertical / tileSize\n        });\n        tileMatrixBottomRight.push({\n          horizontal: tcrsBottomRight[i].horizontal / tileSize,\n          vertical: tcrsBottomRight[i].vertical / tileSize\n        });\n      }\n\n      //converts the gcrs, I believe it can take any number values from -inf to +inf\n      let unprojectedMin = map.options.crs.unproject(pcrsBounds.min),\n        unprojectedMax = map.options.crs.unproject(pcrsBounds.max);\n\n      let gcrs = {\n        topLeft: {\n          horizontal: unprojectedMin.lng,\n          vertical: unprojectedMax.lat\n        },\n        bottomRight: {\n          horizontal: unprojectedMax.lng,\n          vertical: unprojectedMin.lat\n        }\n      };\n\n      //formats known pcrs bounds to correct format\n      let pcrs = {\n        topLeft: {\n          horizontal: pcrsBounds.min.x,\n          vertical: pcrsBounds.max.y\n        },\n        bottomRight: {\n          horizontal: pcrsBounds.max.x,\n          vertical: pcrsBounds.min.y\n        }\n      };\n\n      //formats all extent data\n      return {\n        topLeft: {\n          tcrs: tcrsTopLeft,\n          tilematrix: tileMatrixTopLeft,\n          gcrs: gcrs.topLeft,\n          pcrs: pcrs.topLeft\n        },\n        bottomRight: {\n          tcrs: tcrsBottomRight,\n          tilematrix: tileMatrixBottomRight,\n          gcrs: gcrs.bottomRight,\n          pcrs: pcrs.bottomRight\n        },\n        projection: map.options.projection\n      };\n    },\n\n    // _extractInputBounds extracts and returns Input Bounds from the provided template\n    // _extractInputBounds: Object -> {zoomBounds: ..., bounds: ...}\n    _extractInputBounds: function (template) {\n      if (!template) return undefined;\n\n      //sets variables with their respective fallback values incase content is missing from the template\n      let inputs = template.values,\n        projection = template.projection || FALLBACK_PROJECTION,\n        value = 0,\n        boundsUnit = FALLBACK_CS;\n      let bounds = this[projection].options.crs.tilematrix.bounds(0),\n        defaultMinZoom = 0,\n        defaultMaxZoom = this[projection].options.resolutions.length - 1,\n        nativeMinZoom = defaultMinZoom,\n        nativeMaxZoom = defaultMaxZoom;\n      let locInputs = false,\n        numberOfAxes = 0;\n      for (let i = 0; i < inputs.length; i++) {\n        switch (inputs[i].getAttribute('type')) {\n          case 'zoom':\n            nativeMinZoom = +(inputs[i].hasAttribute('min') &&\n            !isNaN(+inputs[i].getAttribute('min'))\n              ? inputs[i].getAttribute('min')\n              : defaultMinZoom);\n            nativeMaxZoom = +(inputs[i].hasAttribute('max') &&\n            !isNaN(+inputs[i].getAttribute('max'))\n              ? inputs[i].getAttribute('max')\n              : defaultMaxZoom);\n            value = +inputs[i].getAttribute('value');\n            break;\n          case 'location':\n            if (!inputs[i].getAttribute('max') || !inputs[i].getAttribute('min'))\n              continue;\n            let max = +inputs[i].getAttribute('max'),\n              min = +inputs[i].getAttribute('min');\n            switch (inputs[i].getAttribute('axis').toLowerCase()) {\n              case 'x':\n              case 'longitude':\n              case 'column':\n              case 'easting':\n                boundsUnit = M.axisToCS(\n                  inputs[i].getAttribute('axis').toLowerCase()\n                );\n                bounds.min.x = min;\n                bounds.max.x = max;\n                numberOfAxes++;\n                break;\n              case 'y':\n              case 'latitude':\n              case 'row':\n              case 'northing':\n                boundsUnit = M.axisToCS(\n                  inputs[i].getAttribute('axis').toLowerCase()\n                );\n                bounds.min.y = min;\n                bounds.max.y = max;\n                numberOfAxes++;\n                break;\n            }\n            break;\n        }\n      }\n      if (numberOfAxes >= 2) {\n        locInputs = true;\n      }\n      // min/maxZoom are copied from <meta name=zoom content=\"min=n,max=m>, are *display* range for content\n      // min/maxNativeZoom are received from <input type=zoom min=... max=...>, describe *server* content availability\n      let zoomBounds = {\n        minZoom:\n          template.zoomBounds?.min && !isNaN(+template.zoomBounds.min)\n            ? +template.zoomBounds.min\n            : defaultMinZoom,\n        maxZoom:\n          template.zoomBounds?.max && !isNaN(+template.zoomBounds.max)\n            ? +template.zoomBounds.max\n            : defaultMaxZoom,\n        minNativeZoom: nativeMinZoom,\n        maxNativeZoom: nativeMaxZoom\n      };\n      if (\n        !locInputs &&\n        template.extentPCRSFallback &&\n        template.extentPCRSFallback.bounds\n      ) {\n        bounds = template.extentPCRSFallback.bounds;\n      } else if (locInputs) {\n        bounds = this.boundsToPCRSBounds(bounds, value, projection, boundsUnit);\n      } else {\n        bounds = this[projection].options.crs.pcrs.bounds;\n      }\n      return {\n        zoomBounds: zoomBounds,\n        bounds: bounds\n      };\n    },\n\n    // axisToCS returns the CRS when given the axis:\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // axisToCS: (Axis String) -> (CRS String)\n    axisToCS: function (axis) {\n      try {\n        switch (axis.toLowerCase()) {\n          case 'row':\n          case 'column':\n            return 'TILEMATRIX';\n          case 'i':\n          case 'j':\n            return ['MAP', 'TILE'];\n          case 'x':\n          case 'y':\n            return 'TCRS';\n          case 'latitude':\n          case 'longitude':\n            return 'GCRS';\n          case 'northing':\n          case 'easting':\n            return 'PCRS';\n          default:\n            return FALLBACK_CS;\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // csToAxes takes a given cs and retuns the axes, first horizontal then vertical\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // csToAxes: (CRS String) -> [(horizontal axis String), (Vertical axis String)]\n    csToAxes: function (cs) {\n      try {\n        switch (cs.toLowerCase()) {\n          case 'tilematrix':\n            return ['column', 'row'];\n          case 'map':\n          case 'tile':\n            return ['i', 'j'];\n          case 'tcrs':\n            return ['x', 'y'];\n          case 'gcrs':\n            return ['longitude', 'latitude'];\n          case 'pcrs':\n            return ['easting', 'northing'];\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // axisToXY takes horizontal axis and returns 'x', or takes vertical axis and returns 'y'\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // axisToXY: (Axis String) -> 'x' or 'y'\n    axisToXY: function (axis) {\n      try {\n        switch (axis.toLowerCase()) {\n          case 'i':\n          case 'column':\n          case 'longitude':\n          case 'x':\n          case 'easting':\n            return 'x';\n          case 'row':\n          case 'j':\n          case 'latitude':\n          case 'y':\n          case 'northing':\n            return 'y';\n\n          default:\n            return undefined;\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // convertPCRSBounds converts pcrsBounds to the given cs Bounds.\n    // convertPCRSBounds: L.Bounds, Int, L.CRS, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.Bounds\n    convertPCRSBounds: function (pcrsBounds, zoom, projection, cs) {\n      if (\n        !pcrsBounds ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection ||\n        !cs\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      switch (cs.toUpperCase()) {\n        case 'PCRS':\n          return pcrsBounds;\n        case 'TCRS':\n        case 'TILEMATRIX':\n          let minPixel = projection.transformation.transform(\n              pcrsBounds.min,\n              projection.scale(+zoom)\n            ),\n            maxPixel = projection.transformation.transform(\n              pcrsBounds.max,\n              projection.scale(+zoom)\n            );\n          if (cs.toUpperCase() === 'TCRS') return L.bounds(minPixel, maxPixel);\n          let tileSize = projection.options.crs.tile.bounds.max.x;\n          return L.bounds(\n            L.point(minPixel.x / tileSize, minPixel.y / tileSize),\n            L.point(maxPixel.x / tileSize, maxPixel.y / tileSize)\n          );\n        case 'GCRS':\n          let minGCRS = projection.unproject(pcrsBounds.min),\n            maxGCRS = projection.unproject(pcrsBounds.max);\n          return L.bounds(\n            L.point(minGCRS.lng, minGCRS.lat),\n            L.point(maxGCRS.lng, maxGCRS.lat)\n          );\n        default:\n          return undefined;\n      }\n    },\n\n    // pointToPCRSPoint takes a point, with a projection and cs and converts it to a pcrs L.point/L.latLng\n    //pointToPCRSPoint: L.Point, Int, L.CRS, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.point|L.latLng\n    pointToPCRSPoint: function (point, zoom, projection, cs) {\n      if (\n        !point ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !cs ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      let tileSize = projection.options.crs.tile.bounds.max.x;\n      switch (cs.toUpperCase()) {\n        case 'TILEMATRIX':\n          return M.pixelToPCRSPoint(\n            L.point(point.x * tileSize, point.y * tileSize),\n            zoom,\n            projection\n          );\n        case 'PCRS':\n          return point;\n        case 'TCRS' :\n          return M.pixelToPCRSPoint(point, zoom, projection);\n        case 'GCRS':\n          return projection.project(L.latLng(point.y, point.x));\n        default:\n          return undefined;\n      }\n    },\n\n    // pixelToPCRSPoint takes a pixel L.point, the zoom and projection and returns a L.point in pcrs\n    // pixelToPCRSPoint: L.Point, Int, L.CRS|Str -> L.point\n    pixelToPCRSPoint: function (point, zoom, projection) {\n      if (\n        !point ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return projection.transformation.untransform(point, projection.scale(zoom));\n    },\n\n    // boundsToPCRSBounds converts bounds with projection and cs to PCRS bounds\n    // boundsToPCRSBounds: L.bounds, Int, L.CRS|Str, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.bounds\n    boundsToPCRSBounds: function (bounds, zoom, projection, cs) {\n      if (\n        !bounds ||\n        !bounds.max ||\n        !bounds.min ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection ||\n        !cs\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return L.bounds(\n        M.pointToPCRSPoint(bounds.min, zoom, projection, cs),\n        M.pointToPCRSPoint(bounds.max, zoom, projection, cs)\n      );\n    },\n\n    //L.bounds have fixed point positions, where min is always topleft, max is always bottom right, and the values are always sorted by leaflet\n    //important to consider when working with pcrs where the origin is not topleft but rather bottomleft, could lead to confusion\n    pixelToPCRSBounds: function (bounds, zoom, projection) {\n      if (\n        !bounds ||\n        !bounds.max ||\n        !bounds.min ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return L.bounds(\n        M.pixelToPCRSPoint(bounds.min, zoom, projection),\n        M.pixelToPCRSPoint(bounds.max, zoom, projection)\n      );\n    },\n\n    //meta content is the content attribute of meta\n    // input \"max=5,min=4\" => [[max,5][min,5]]\n    _metaContentToObject: function (input) {\n      if (!input || input instanceof Object) return {};\n      let content = input.split(/\\s+/).join('');\n      let contentArray = {};\n      let stringSplit = content.split(',');\n\n      for (let i = 0; i < stringSplit.length; i++) {\n        let prop = stringSplit[i].split('=');\n        if (prop.length === 2) contentArray[prop[0]] = prop[1];\n      }\n      if (contentArray !== '' && stringSplit[0].split('=').length === 1)\n        contentArray.content = stringSplit[0];\n      return contentArray;\n    },\n\n    // _coordsToArray returns an array of arrays of coordinate pairs\n    // _coordsToArray: (\"1,2,3,4\") -> [[1,2],[3,4]]\n    _coordsToArray: function (containerPoints) {\n      for (\n        var i = 1, pairs = [], coords = containerPoints.split(',');\n        i < coords.length;\n        i += 2\n      ) {\n        pairs.push([parseInt(coords[i - 1]), parseInt(coords[i])]);\n      }\n      return pairs;\n    },\n\n    // _parseStylesheetAsHTML parses map-link and map-style from mapml and inserts them to the container as HTML\n    _parseStylesheetAsHTML: function (mapml, base, container) {\n      if (\n        !(container instanceof Element) ||\n        !mapml ||\n        !mapml.querySelector('map-link[rel=stylesheet],map-style')\n      )\n        return;\n\n      if (base instanceof Element) {\n        base = base.getAttribute('href')\n          ? base.getAttribute('href')\n          : document.URL;\n      } else if (!base || base === '' || base instanceof Object) {\n        return;\n      }\n\n      var ss = [];\n      var stylesheets = mapml.querySelectorAll(\n        'map-link[rel=stylesheet],map-style'\n      );\n      for (var i = 0; i < stylesheets.length; i++) {\n        if (stylesheets[i].nodeName.toUpperCase() === 'MAP-LINK') {\n          var href = stylesheets[i].hasAttribute('href')\n            ? new URL(stylesheets[i].getAttribute('href'), base).href\n            : null;\n          if (href) {\n            if (!container.querySelector(\"link[href='\" + href + \"']\")) {\n              var linkElm = document.createElement('link');\n              linkElm.setAttribute('href', href);\n              linkElm.setAttribute('rel', 'stylesheet');\n              ss.push(linkElm);\n            }\n          }\n        } else {\n          // <map-style>\n          var styleElm = document.createElement('style');\n          styleElm.textContent = stylesheets[i].textContent;\n          ss.push(styleElm);\n        }\n      }\n      // insert <link> or <style> elements after the begining  of the container\n      // element, in document order as copied from original mapml document\n      // note the code below assumes hrefs have been resolved and elements\n      // re-parsed from xml and serialized as html elements ready for insertion\n      for (var s = ss.length - 1; s >= 0; s--) {\n        container.insertAdjacentElement('afterbegin', ss[s]);\n      }\n    },\n\n    // _splitCoordinate splits string coordinates to an array as floating point numbers\n    _splitCoordinate: function (element, index, array) {\n      var a = [];\n      element.split(/\\s+/gim).forEach(M._parseNumber, a);\n      this.push(a);\n    },\n\n    // _parseNumber parses a string as a floating point number, helper function for _splitCoordinate\n    _parseNumber: function (element, index, array) {\n      this.push(parseFloat(element));\n    },\n\n    // _handleLink handles map-a links, when clicked on a map-a link\n    _handleLink: function (link, leafletLayer) {\n      let zoomTo,\n        justPan = false,\n        layer,\n        map = leafletLayer._map,\n        opacity;\n      if (link.type === 'text/html' && link.target !== '_blank') {\n        // all other target values other than blank behave as _top\n        link.target = '_top';\n      } else if (link.type !== 'text/html' && link.url.includes('#')) {\n        let hash = link.url.split('#'),\n          loc = hash[1].split(',');\n        zoomTo = { z: loc[0] || 0, lng: loc[1] || 0, lat: loc[2] || 0 };\n        justPan = !hash[0]; // if the first half of the array is an empty string then the link is just for panning\n        if (['/', '.', '#'].includes(link.url[0])) link.target = '_self';\n      }\n      if (!justPan) {\n        let newLayer = false;\n        layer = document.createElement('layer-');\n        layer.setAttribute('src', link.url);\n        layer.setAttribute('checked', '');\n        switch (link.target) {\n          case '_blank':\n            if (link.type === 'text/html') {\n              window.open(link.url);\n            } else {\n              map.options.mapEl.appendChild(layer);\n              newLayer = true;\n            }\n            break;\n          case '_parent':\n            for (let l of map.options.mapEl.querySelectorAll('layer-'))\n              if (l._layer !== leafletLayer) map.options.mapEl.removeChild(l);\n            map.options.mapEl.appendChild(layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n            newLayer = true;\n            break;\n          case '_top':\n            window.location.href = link.url;\n            break;\n          default:\n            opacity = leafletLayer._layerEl.opacity;\n            leafletLayer._layerEl.insertAdjacentElement('beforebegin', layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n            newLayer = true;\n        }\n        if (!link.inPlace && newLayer)\n          L.DomEvent.on(layer, 'extentload', function focusOnLoad(e) {\n            if (\n              newLayer &&\n              ['_parent', '_self'].includes(link.target) &&\n              layer.parentElement.querySelectorAll('layer-').length === 1\n            )\n              layer.parentElement.projection = layer._layer.getProjection();\n            if (layer.extent) {\n              if (zoomTo)\n                layer.parentElement.zoomTo(+zoomTo.lat, +zoomTo.lng, +zoomTo.z);\n              else layer.zoomTo();\n              L.DomEvent.off(layer, 'extentload', focusOnLoad);\n            }\n\n            if (opacity) layer.opacity = opacity;\n            map.getContainer().focus();\n          });\n      } else if (zoomTo && !link.inPlace && justPan) {\n        leafletLayer._map.options.mapEl.zoomTo(\n          +zoomTo.lat,\n          +zoomTo.lng,\n          +zoomTo.z\n        );\n        if (opacity) layer.opacity = opacity;\n      }\n    },\n\n    // _gcrsToTileMatrix returns the [column, row] of the tiles at map center. Used for Announce movement for screen readers\n    // _gcrsToTileMatrix: map/mapml-viewer -> [column, row]\n    _gcrsToTileMatrix: function (mapEl) {\n      let point = mapEl._map.project(mapEl._map.getCenter());\n      let tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.y;\n      let column = Math.trunc(point.x / tileSize);\n      let row = Math.trunc(point.y / tileSize);\n      return [column, row];\n    },\n\n    // Pastes text to a mapml-viewer/map element(mapEl), text can be a mapml link, geojson, or a layer-\n    //    used for pasting layers through ctrl+v, drag/drop, and pasting through the contextmenu\n    // _pasteLayer: HTMLElement Str -> None\n    // Effects: append a layer- element to mapEl, if it is valid\n    _pasteLayer: function (mapEl, text) {\n      try {\n        new URL(text);\n        // create a new <layer-> child of the <mapml-viewer> element\n        let l =\n          '<layer- src=\"' +\n          text +\n          '\" label=\"' +\n          M.options.locale.dfLayer +\n          '\" checked=\"\"></layer->';\n        mapEl.insertAdjacentHTML('beforeend', l);\n        mapEl.lastChild.addEventListener('error', function () {\n          if (mapEl) {\n            // should invoke lifecyle callbacks automatically by removing it from DOM\n            mapEl.removeChild(mapEl.lastChild);\n          }\n          // garbage collect it\n          l = null;\n        });\n      } catch (err) {\n        text = text\n          .replace(/(<!--.*?-->)|(<!--[\\S\\s]+?-->)|(<!--[\\S\\s]*?$)/g, '')\n          .trim();\n        if (text.slice(0, 7) === '<layer-' && text.slice(-9) === '</layer->') {\n          mapEl.insertAdjacentHTML('beforeend', text);\n        } else if (\n          text.slice(0, 12) === '<map-feature' &&\n          text.slice(-14) === '</map-feature>'\n        ) {\n          let layer =\n            `<layer- label=\"${M.options.locale.dfPastedLayer}\" checked>\n                       <map-meta name='projection' content='${mapEl.projection}'></map-meta>` +\n            text +\n            '</layer->';\n          mapEl.insertAdjacentHTML('beforeend', layer);\n        } else {\n          try {\n            mapEl.geojson2mapml(JSON.parse(text));\n          } catch {\n            console.log('Invalid Input!');\n          }\n        }\n      }\n    },\n\n    // Takes GeoJSON Properties to return an HTML table, helper function\n    //    for geojson2mapml\n    // _properties2Table: geojsonPropertiesOBJ -> HTML Table\n    _properties2Table: function (json) {\n      let table = document.createElement('table');\n\n      // Creating a Table Header\n      let thead = table.createTHead();\n      let row = thead.insertRow();\n      let th1 = document.createElement('th');\n      let th2 = document.createElement('th');\n      th1.appendChild(document.createTextNode('Property name'));\n      th2.appendChild(document.createTextNode('Property value'));\n      th1.setAttribute('role', 'columnheader');\n      th2.setAttribute('role', 'columnheader');\n      th1.setAttribute('scope', 'col');\n      th2.setAttribute('scope', 'col');\n      row.appendChild(th1);\n      row.appendChild(th2);\n\n      // Creating table body and populating it from the JSON\n      let tbody = table.createTBody();\n      for (let key in json) {\n        if (json.hasOwnProperty(key)) {\n          let row = tbody.insertRow();\n          let th = document.createElement('th');\n          let td = document.createElement('td');\n          th.appendChild(document.createTextNode(key));\n          td.appendChild(document.createTextNode(json[key]));\n          th.setAttribute('scope', 'row');\n          td.setAttribute('itemprop', key);\n          row.appendChild(th);\n          row.appendChild(td);\n        }\n      }\n      return table;\n    },\n\n    // Takes bbox array and a x,y coordinate to possibly update the extent, returns extent\n    //    for geojson2mapml\n    // _updateExtent: [min x, min y, max x, max y], x, y -> [min x, min y, max x, max y]\n    _updateExtent: function (bboxExtent, x, y) {\n      if (bboxExtent === {}) {\n        return bboxExtent;\n      }\n      bboxExtent[0] = Math.min(x, bboxExtent[0]);\n      bboxExtent[1] = Math.min(y, bboxExtent[1]);\n      bboxExtent[2] = Math.max(x, bboxExtent[2]);\n      bboxExtent[3] = Math.max(y, bboxExtent[3]);\n      return bboxExtent;\n    },\n\n    // Takes a GeoJSON geojson and an options Object which returns a <layer-> Element\n    // The options object can contain the following:\n    //      label            - String, contains the layer name, if included overrides the default label mapping\n    //      projection       - String, contains the projection of the layer (OSMTILE, WGS84, CBMTILE, APSTILE), defaults to   OSMTILE\n    //      caption          - Function | String, function accepts one argument being the feature object which produces the   featurecaption string OR a string that is the name of the property that will be mapped to featurecaption\n    //      properties       - Function | String | HTMLElement, a function which maps the geojson feature to an HTMLElement   or a string that will be parsed as an HTMLElement or an HTMLElement\n    //      geometryFunction - Function, A function you supply that can add classes, hyperlinks and spans to the created  <map-geometry> element, default would be the plain map-geometry element\n    // geojson2mapml: geojson Object <layer-> [min x, min y, max x, max y] -> <layer->\n    geojson2mapml: function (json, options = {}, layer = null, bboxExtent = {}) {\n      let defaults = {\n        label: null,\n        projection: 'OSMTILE',\n        caption: null,\n        properties: null,\n        geometryFunction: null\n      };\n      // assign default values for undefined options\n      options = Object.assign({}, defaults, options);\n\n      // If string json is received\n      if (typeof json === 'string') {\n        json = JSON.parse(json);\n      }\n      let geometryType = [\n        'POINT',\n        'LINESTRING',\n        'POLYGON',\n        'MULTIPOINT',\n        'MULTILINESTRING',\n        'MULTIPOLYGON',\n        'GEOMETRYCOLLECTION'\n      ];\n      let jsonType = json.type.toUpperCase();\n      let out = '';\n      let setExtent = false;\n\n      // HTML parser\n      let parser = new DOMParser();\n\n      // initializing layer\n      if (layer === null) {\n        if (!json.bbox) {\n          setExtent = true;\n        }\n        // creating an empty mapml layer\n        let xmlStringLayer =\n          \"<layer- label='' checked><map-meta name='projection' content='\" +\n          options.projection +\n          \"'></map-meta><map-meta name='cs' content='gcrs'></map-meta></layer->\";\n        layer = parser.parseFromString(xmlStringLayer, 'text/html');\n        //console.log(layer)\n        if (options.label !== null) {\n          layer.querySelector('layer-').setAttribute('label', options.label);\n        } else if (json.name) {\n          layer.querySelector('layer-').setAttribute('label', json.name);\n        } else if (json.title) {\n          layer.querySelector('layer-').setAttribute('label', json.title);\n        } else {\n          layer\n            .querySelector('layer-')\n            .setAttribute('label', M.options.locale.dfLayer);\n        }\n      }\n      let point = '<map-point></map-point>';\n      point = parser.parseFromString(point, 'text/html');\n\n      let multiPoint =\n        '<map-multipoint><map-coordinates></map-coordinates></map-multipoint>';\n      multiPoint = parser.parseFromString(multiPoint, 'text/html');\n\n      let linestring =\n        '<map-linestring><map-coordinates></map-coordinates></map-linestring>';\n      linestring = parser.parseFromString(linestring, 'text/html');\n\n      let multilinestring = '<map-multilinestring></map-multilinestring>';\n      multilinestring = parser.parseFromString(multilinestring, 'text/html');\n\n      let polygon = '<map-polygon></map-polygon>';\n      polygon = parser.parseFromString(polygon, 'text/html');\n\n      let multiPolygon = '<map-multipolygon></map-multipolygon>';\n      multiPolygon = parser.parseFromString(multiPolygon, 'text/html');\n\n      let geometrycollection =\n        '<map-geometrycollection></map-geometrycollection>';\n      geometrycollection = parser.parseFromString(\n        geometrycollection,\n        'text/html'\n      );\n\n      let feature =\n        '<map-feature><map-featurecaption></map-featurecaption><map-geometry></map-geometry><map-properties></map-properties></map-feature>';\n      feature = parser.parseFromString(feature, 'text/html');\n\n      // Template to add coordinates to Geometries\n      let coords = '<map-coordinates></map-coordinates>';\n      coords = parser.parseFromString(coords, 'text/html');\n\n      //console.log(layer);\n      if (jsonType === 'FEATURECOLLECTION') {\n        // Setting bbox if it exists\n        if (json.bbox) {\n          layer\n            .querySelector('layer-')\n            .insertAdjacentHTML(\n              'afterbegin',\n              \"<map-meta name='extent' content='top-left-longitude=\" +\n                json.bbox[0] +\n                ', top-left-latitude=' +\n                json.bbox[1] +\n                ', bottom-right-longitude=' +\n                json.bbox[2] +\n                ',bottom-right-latitude=' +\n                json.bbox[3] +\n                \"'></map-meta>\"\n            );\n        } else {\n          bboxExtent = [\n            Infinity,\n            Infinity,\n            Number.NEGATIVE_INFINITY,\n            Number.NEGATIVE_INFINITY\n          ];\n        }\n\n        let features = json.features;\n        //console.log(\"Features length - \" + features.length);\n        for (let l = 0; l < features.length; l++) {\n          M.geojson2mapml(features[l], options, layer, bboxExtent);\n        }\n      } else if (jsonType === 'FEATURE') {\n        let clone_feature = feature.cloneNode(true);\n        let curr_feature = clone_feature.querySelector('map-feature');\n\n        // Setting bbox if it exists\n        if (json.bbox) {\n          layer\n            .querySelector('layer-')\n            .insertAdjacentHTML(\n              'afterbegin',\n              \"<map-meta name='extent' content='top-left-longitude=\" +\n                json.bbox[0] +\n                ', top-left-latitude=' +\n                json.bbox[1] +\n                ', bottom-right-longitude=' +\n                json.bbox[2] +\n                ',bottom-right-latitude=' +\n                json.bbox[3] +\n                \"'></map-meta>\"\n            );\n        } else if (\n          typeof bboxExtent === 'object' &&\n          bboxExtent.length === undefined\n        ) {\n          bboxExtent = [\n            Infinity,\n            Infinity,\n            Number.NEGATIVE_INFINITY,\n            Number.NEGATIVE_INFINITY\n          ];\n        }\n\n        // Setting featurecaption\n        let featureCaption = layer.querySelector('layer-').getAttribute('label');\n        if (typeof options.caption === 'function') {\n          featureCaption = options.caption(json);\n        } else if (typeof options.caption === 'string') {\n          featureCaption = json.properties[options.caption];\n          // if property does not exist\n          if (featureCaption === undefined) {\n            featureCaption = options.caption;\n          }\n        } else if (json.id) {\n          // when no caption option available try setting id as featurecaption\n          featureCaption = json.id;\n        }\n        curr_feature.querySelector('map-featurecaption').innerHTML =\n          featureCaption;\n\n        // Setting Properties\n        let p;\n        // if properties function is passed\n        if (typeof options.properties === 'function') {\n          p = options.properties(json);\n          // if function output is not an element, ignore the properties.\n          if (!(p instanceof Element)) {\n            p = false;\n            console.error(\n              'options.properties function returns a string instead of an HTMLElement.'\n            );\n          }\n        } else if (typeof options.properties === 'string') {\n          // if properties string is passed\n          curr_feature\n            .querySelector('map-properties')\n            .insertAdjacentHTML('beforeend', options.properties);\n          p = false;\n        } else if (options.properties instanceof HTMLElement) {\n          // if an HTMLElement is passed - NOT TESTED\n          p = options.properties;\n        } else {\n          // If no properties function, string or HTMLElement is passed\n          p = M._properties2Table(json.properties);\n        }\n\n        if (p) {\n          curr_feature.querySelector('map-properties').appendChild(p);\n        }\n\n        // Setting map-geometry\n        let g = M.geojson2mapml(json.geometry, options, layer, bboxExtent);\n        if (typeof options.geometryFunction === 'function') {\n          curr_feature\n            .querySelector('map-geometry')\n            .appendChild(options.geometryFunction(g, json));\n        } else {\n          curr_feature.querySelector('map-geometry').appendChild(g);\n        }\n\n        // Appending feature to layer\n        layer.querySelector('layer-').appendChild(curr_feature);\n      } else if (geometryType.includes(jsonType)) {\n        //console.log(\"Geometry Type - \" + jsonType);\n        switch (jsonType) {\n          case 'POINT':\n            bboxExtent = M._updateExtent(\n              bboxExtent,\n              json.coordinates[0],\n              json.coordinates[1]\n            );\n            out = json.coordinates[0] + ' ' + json.coordinates[1];\n\n            // Create Point element\n            let clone_point = point.cloneNode(true);\n            clone_point = clone_point.querySelector('map-point');\n\n            // Create map-coords to add to the polygon\n            let clone_coords = coords.cloneNode(true);\n            clone_coords = clone_coords.querySelector('map-coordinates');\n\n            clone_coords.innerHTML = out;\n\n            clone_point.appendChild(clone_coords);\n            //console.log(clone_point);\n            return clone_point;\n\n          case 'LINESTRING':\n            let clone_linestring = linestring.cloneNode(true);\n            let linestring_coordindates =\n              clone_linestring.querySelector('map-coordinates');\n\n            out = '';\n\n            for (let x = 0; x < json.coordinates.length; x++) {\n              bboxExtent = M._updateExtent(\n                bboxExtent,\n                json.coordinates[x][0],\n                json.coordinates[x][1]\n              );\n              out =\n                out + json.coordinates[x][0] + ' ' + json.coordinates[x][1] + ' ';\n            }\n\n            linestring_coordindates.innerHTML = out;\n            //console.log(clone_linestring.querySelector('map-linestring'));\n            return clone_linestring.querySelector('map-linestring');\n\n          case 'POLYGON':\n            let clone_polygon = polygon.cloneNode(true);\n            clone_polygon = clone_polygon.querySelector('map-polygon');\n\n            // Going over each coordinates\n            for (let y = 0; y < json.coordinates.length; y++) {\n              let out = '';\n              let clone_coords = coords.cloneNode(true);\n              clone_coords = clone_coords.querySelector('map-coordinates');\n\n              // Going over coordinates for the polygon\n              for (let x = 0; x < json.coordinates[y].length; x++) {\n                bboxExtent = M._updateExtent(\n                  bboxExtent,\n                  json.coordinates[y][x][0],\n                  json.coordinates[y][x][1]\n                );\n                out =\n                  out +\n                  json.coordinates[y][x][0] +\n                  ' ' +\n                  json.coordinates[y][x][1] +\n                  ' ';\n              }\n\n              // Create map-coordinates element and append it to clone_polygon\n              clone_coords.innerHTML = out;\n\n              clone_polygon.appendChild(clone_coords);\n            }\n            //console.log(clone_polygon);\n            return clone_polygon;\n\n          case 'MULTIPOINT':\n            out = '';\n            // Create multipoint element\n            let clone_multipoint = multiPoint.cloneNode(true);\n            clone_multipoint = clone_multipoint.querySelector('map-multipoint');\n\n            for (let i = 0; i < json.coordinates.length; i++) {\n              bboxExtent = M._updateExtent(\n                bboxExtent,\n                json.coordinates[i][0],\n                json.coordinates[i][1]\n              );\n              out =\n                out + json.coordinates[i][0] + ' ' + json.coordinates[i][1] + ' ';\n            }\n            clone_multipoint.querySelector('map-coordinates').innerHTML = out;\n            return clone_multipoint;\n\n          case 'MULTILINESTRING':\n            let clone_multilinestring = multilinestring.cloneNode(true);\n            clone_multilinestring = clone_multilinestring.querySelector(\n              'map-multilinestring'\n            );\n\n            for (let i = 0; i < json.coordinates.length; i++) {\n              let out = '';\n              let clone_coords = coords.cloneNode(true);\n              clone_coords = clone_coords.querySelector('map-coordinates');\n              for (let y = 0; y < json.coordinates[i].length; y++) {\n                bboxExtent = M._updateExtent(\n                  bboxExtent,\n                  json.coordinates[i][y][0],\n                  json.coordinates[i][y][1]\n                );\n                out =\n                  out +\n                  json.coordinates[i][y][0] +\n                  ' ' +\n                  json.coordinates[i][y][1] +\n                  ' ';\n              }\n              clone_coords.innerHTML = out;\n              clone_multilinestring.appendChild(clone_coords);\n            }\n            return clone_multilinestring;\n\n          case 'MULTIPOLYGON':\n            let m = multiPolygon.cloneNode(true);\n            m = m.querySelector('map-multiPolygon');\n\n            // Going over each Polygon\n            for (let i = 0; i < json.coordinates.length; i++) {\n              let clone_polygon = polygon.cloneNode(true);\n              clone_polygon = clone_polygon.querySelector('map-polygon');\n\n              // Going over each coordinates\n              for (let y = 0; y < json.coordinates[i].length; y++) {\n                let out = '';\n                let clone_coords = coords.cloneNode(true);\n                clone_coords = clone_coords.querySelector('map-coordinates');\n\n                // Going over coordinates for the polygon\n                for (let x = 0; x < json.coordinates[i][y].length; x++) {\n                  bboxExtent = M._updateExtent(\n                    bboxExtent,\n                    json.coordinates[i][y][x][0],\n                    json.coordinates[i][y][x][1]\n                  );\n                  out =\n                    out +\n                    json.coordinates[i][y][x][0] +\n                    ' ' +\n                    json.coordinates[i][y][x][1] +\n                    ' ';\n                }\n\n                // Create map-coordinates element and append it to clone_polygon\n                clone_coords.innerHTML = out;\n\n                clone_polygon.appendChild(clone_coords);\n              }\n              m.appendChild(clone_polygon);\n            }\n            return m;\n          case 'GEOMETRYCOLLECTION': // ---------------------------------------------------------------------------\n            let g = geometrycollection.cloneNode(true);\n            g = g.querySelector('map-geometrycollection');\n            //console.log(json.geometries);\n            for (let i = 0; i < json.geometries.length; i++) {\n              let fg = M.geojson2mapml(\n                json.geometries[i],\n                options,\n                layer,\n                bboxExtent\n              );\n              g.appendChild(fg);\n            }\n            return g;\n        }\n      }\n      //Add default bbox\n      if (setExtent) {\n        layer\n          .querySelector('layer-')\n          .insertAdjacentHTML(\n            'afterbegin',\n            \"<map-meta name='extent' content='top-left-longitude=\" +\n              bboxExtent[0] +\n              ', top-left-latitude=' +\n              bboxExtent[1] +\n              ', bottom-right-longitude=' +\n              bboxExtent[2] +\n              ',bottom-right-latitude=' +\n              bboxExtent[3] +\n              \"'></map-meta>\"\n          );\n      }\n      return layer.querySelector('layer-');\n    },\n\n    // Takes an array of length n to return an array of arrays with length 2, helper function\n    //    for mapml2geojson\n    // _breakArray: arr(float) -> arr(arr(float, float))\n    _breakArray: function (arr) {\n      let size = 2;\n      let arrayOfArrays = [];\n      // removing anything other than numbers, ., - (used to remove <map-span> tags)\n      arr = arr.filter((x) => !/[^\\d.-]/g.test(x)).filter((x) => x);\n      for (let i = 0; i < arr.length; i += size) {\n        arrayOfArrays.push(arr.slice(i, i + size).map(Number));\n      }\n      return arrayOfArrays;\n    },\n\n    // Takes an HTML Table to return geojson properties, helper function\n    //    for mapml2geojson\n    // _table2properties: HTML Table -> geojson\n    _table2properties: function (table) {\n      // removing thead, if it exists\n      let head = table.querySelector('thead');\n      if (head !== null) {\n        table.querySelector('thead').remove();\n      }\n      let json = {};\n      table.querySelectorAll('tr').forEach((tr) => {\n        let tableData = tr.querySelectorAll('th, td');\n        json[tableData[0].innerHTML] = tableData[1].innerHTML;\n      });\n      return json;\n    },\n\n    // Converts a geometry element (el) to geojson, helper function\n    //    for mapml2geojson, NOTE - el can not be a map-geometrycollection\n    // _geometry2geojson: (child of <map-geometry>), Proj4, Proj4, Bool -> geojson\n    _geometry2geojson: function (el, source, dest, transform) {\n      // remove map-a, map-span elements if the geometry is wrapped in them\n      while (\n        el.nodeName.toUpperCase() === 'MAP-SPAN' ||\n        el.nodeName.toUpperCase() === 'MAP-A'\n      ) {\n        el = el.firstElementChild;\n      }\n      let elem = el.nodeName;\n      let j = {};\n      let coord;\n\n      switch (elem.toUpperCase()) {\n        case 'MAP-POINT':\n          j.type = 'Point';\n          if (transform) {\n            let pointConv = proj4.transform(\n              source,\n              dest,\n              el\n                .querySelector('map-coordinates')\n                .innerHTML.split(/[<>\\ ]/g)\n                .map(Number)\n            );\n            j.coordinates = [pointConv.x, pointConv.y];\n          } else {\n            j.coordinates = el\n              .querySelector('map-coordinates')\n              .innerHTML.split(/[<>\\ ]/g)\n              .map(Number);\n          }\n          break;\n        case 'MAP-LINESTRING':\n          j.type = 'LineString';\n          coord = el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g);\n          coord = M._breakArray(coord);\n          if (transform) {\n            coord = M._pcrsToGcrs(coord, source, dest);\n          }\n          j.coordinates = coord;\n          break;\n        case 'MAP-POLYGON':\n          j.type = 'Polygon';\n          j.coordinates = [];\n          let x = 0;\n          el.querySelectorAll('map-coordinates').forEach((coord) => {\n            coord = coord.innerHTML.split(/[<>\\ ]/g);\n            coord = M._breakArray(coord);\n            if (transform) {\n              coord = M._pcrsToGcrs(coord, source, dest);\n            }\n            j.coordinates[x] = coord;\n            x++;\n          });\n          break;\n        case 'MAP-MULTIPOINT':\n          j.type = 'MultiPoint';\n          coord = M._breakArray(\n            el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g)\n          );\n          if (transform) {\n            coord = M._pcrsToGcrs(coord, source, dest);\n          }\n          j.coordinates = coord;\n          break;\n        case 'MAP-MULTILINESTRING':\n          j.type = 'MultiLineString';\n          j.coordinates = [];\n          let i = 0;\n          el.querySelectorAll('map-coordinates').forEach((coord) => {\n            coord = coord.innerHTML.split(/[<>\\ ]/g);\n            coord = M._breakArray(coord);\n            if (transform) {\n              coord = M._pcrsToGcrs(coord, source, dest);\n            }\n            j.coordinates[i] = coord;\n            i++;\n          });\n          break;\n        case 'MAP-MULTIPOLYGON':\n          j.type = 'MultiPolygon';\n          j.coordinates = [];\n          let p = 0;\n          el.querySelectorAll('map-polygon').forEach((poly) => {\n            let y = 0;\n            j.coordinates.push([]);\n            poly.querySelectorAll('map-coordinates').forEach((coord) => {\n              coord = coord.innerHTML.split(/[<>\\ ]/g);\n              coord = M._breakArray(coord);\n              if (transform) {\n                coord = M._pcrsToGcrs(coord, source, dest);\n              }\n              j.coordinates[p].push([]);\n              j.coordinates[p][y] = coord;\n              y++;\n            });\n            p++;\n          });\n          break;\n      }\n      return j;\n    },\n\n    // _pcrsToGcrs: arrof([x,y]) Proj4, Proj4 -> arrof[x,y]\n    _pcrsToGcrs: function (arr, source, dest) {\n      let newArr = [];\n      for (let i = 0; i < arr.length; i++) {\n        let conv = proj4.transform(source, dest, arr[i]);\n        conv = [conv.x, conv.y];\n        newArr.push(conv);\n      }\n      return newArr;\n    },\n\n    // Takes an <layer-> element and returns a geojson feature collection object\n    // The options object can contain the following:\n    //      propertyFunction   - function(<map-properties>), A function that maps the features' <map-properties> element to   a GeoJSON \"properties\" member.\n    //      transform          - Bool, Transform coordinates to gcrs values, defaults to True\n    // mapml2geojson: <layer-> Object -> GeoJSON\n    mapml2geojson: function (element, options = {}) {\n      let defaults = {\n        propertyFunction: null,\n        transform: true\n      };\n      // assign default values for undefined options\n      options = Object.assign({}, defaults, options);\n\n      let json = {};\n      json.type = 'FeatureCollection';\n      json.title = element.getAttribute('label');\n      json.features = [];\n\n      // Transforming Coordinates to gcrs if transformation = true and coordinate is not (EPSG:3857 or EPSG:4326)\n      let source = null;\n      let dest = null;\n      if (options.transform) {\n        source = new proj4.Proj(element.parentElement._map.options.crs.code);\n        dest = new proj4.Proj('EPSG:4326');\n        if (\n          element.parentElement._map.options.crs.code === 'EPSG:3857' ||\n          element.parentElement._map.options.crs.code === 'EPSG:4326'\n        ) {\n          options.transform = false;\n        }\n      }\n\n      // Setting all meta settings, if any\n      let metas = element.querySelectorAll('map-meta');\n      metas.forEach((meta) => {\n        let name = meta.getAttribute('name');\n        if (name === 'extent') {\n          let content = meta.getAttribute('content');\n          let arr = content.split(',');\n          let ex = {};\n          for (let i = 0; i < arr.length; i++) {\n            let s = arr[i].split('=');\n            s[0] = s[0].trim(); // removing whitespace\n            s[1] = parseFloat(s[1]);\n            ex[s[0]] = s[1];\n          }\n          json.bbox = [\n            ex['top-left-longitude'],\n            ex['top-left-latitude'],\n            ex['bottom-right-longitude'],\n            ex['bottom-right-latitude']\n          ];\n        }\n      });\n\n      // Iterating over each feature\n      let features = element.querySelectorAll('map-feature');\n      let num = 0;\n\n      // Going over each feature in the layer\n      features.forEach((feature) => {\n        //console.log(feature);\n\n        json.features[num] = { type: 'Feature' };\n        json.features[num].geometry = {};\n        json.features[num].properties = {};\n\n        // setting properties when function presented\n        if (!feature.querySelector('map-properties')) {\n          json.features[num].properties = null;\n        } else if (typeof options.propertyFunction === 'function') {\n          let properties = options.propertyFunction(\n            feature.querySelector('map-properties')\n          );\n          json.features[num].properties = properties;\n        } else if (\n          feature.querySelector('map-properties').querySelector('table') !== null\n        ) {\n          // setting properties when table presented\n          let table = feature\n              .querySelector('map-properties')\n              .querySelector('table')\n              .cloneNode(true),\n            properties = M._table2properties(table);\n          json.features[num].properties = properties;\n        } else {\n          // when no table present, strip any possible html tags to only get text\n          json.features[num].properties = {\n            prop0: feature\n              .querySelector('map-properties')\n              .innerHTML.replace(/(<([^>]+)>)/gi, '')\n          };\n        }\n\n        let geom = feature.querySelector('map-geometry').firstElementChild;\n\n        // remove map-a, map-span elements if the geometry is wrapped in them\n        while (\n          geom.nodeName.toUpperCase() === 'MAP-SPAN' ||\n          geom.nodeName.toUpperCase() === 'MAP-A'\n        ) {\n          geom = geom.firstElementChild;\n        }\n\n        // Adding Geometry\n        if (geom.nodeName.toUpperCase() !== 'MAP-GEOMETRYCOLLECTION') {\n          json.features[num].geometry = M._geometry2geojson(\n            geom,\n            source,\n            dest,\n            options.transform\n          );\n        } else {\n          json.features[num].geometry.type = 'GeometryCollection';\n          json.features[num].geometry.geometries = [];\n\n          let geoms = geom.children;\n          Array.from(geoms).forEach((g) => {\n            // omit all map-span, map-a that may be present in geometry-collection\n            let n = g.nodeName.toUpperCase();\n            if (n === 'MAP-SPAN' || n === 'MAP-A') {\n              g = g.cloneNode(true);\n              [...g.querySelectorAll('map-a, map-span')].forEach((e) =>\n                e.replaceWith(...e.children)\n              );\n              Array.from(g.children).forEach((i) => {\n                i = M._geometry2geojson(i, source, dest, options.transform);\n                json.features[num].geometry.geometries.push(i);\n              });\n            } else {\n              g = M._geometry2geojson(g, source, dest, options.transform);\n              json.features[num].geometry.geometries.push(g);\n            }\n          });\n        }\n        //going to next feature\n        num++;\n      });\n\n      return json;\n    },\n\n    // Takes leaflet bound, leaflet map and min and max zoom limit,\n    // return the maximum zoom level that can show the bound completely\n    // getMaxZoom: L.Bound, L.Map, Number, Number -> Number\n    getMaxZoom: function (bound, map, minZoom, maxZoom) {\n      if (!bound) return;\n\n      let newZoom = map.getZoom(),\n        scale = map.options.crs.scale(newZoom),\n        mapCenterTCRS = map.options.crs.transformation.transform(\n          bound.getCenter(true),\n          scale\n        );\n\n      let mapHalf = map.getSize().divideBy(2),\n        mapTlNew = mapCenterTCRS.subtract(mapHalf).round(),\n        mapBrNew = mapCenterTCRS.add(mapHalf).round();\n\n      let mapTlPCRSNew = M.pixelToPCRSPoint(\n          mapTlNew,\n          newZoom,\n          map.options.projection\n        ),\n        mapBrPCRSNew = M.pixelToPCRSPoint(\n          mapBrNew,\n          newZoom,\n          map.options.projection\n        );\n\n      let mapPCRS = L.bounds(mapTlPCRSNew, mapBrPCRSNew),\n        zOffset = mapPCRS.contains(bound) ? 1 : -1;\n\n      while (\n        (zOffset === -1 && !mapPCRS.contains(bound) && newZoom - 1 >= minZoom) ||\n        (zOffset === 1 && mapPCRS.contains(bound) && newZoom + 1 <= maxZoom)\n      ) {\n        newZoom += zOffset;\n        scale = map.options.crs.scale(newZoom);\n        mapCenterTCRS = map.options.crs.transformation.transform(\n          bound.getCenter(true),\n          scale\n        );\n\n        mapTlNew = mapCenterTCRS.subtract(mapHalf).round();\n        mapBrNew = mapCenterTCRS.add(mapHalf).round();\n        mapTlPCRSNew = M.pixelToPCRSPoint(\n          mapTlNew,\n          newZoom,\n          map.options.projection\n        );\n        mapBrPCRSNew = M.pixelToPCRSPoint(\n          mapBrNew,\n          newZoom,\n          map.options.projection\n        );\n\n        mapPCRS = L.bounds(mapTlPCRSNew, mapBrPCRSNew);\n      }\n\n      if (\n        zOffset === 1 &&\n        newZoom - 1 >= 0 &&\n        !(newZoom === maxZoom && mapPCRS.contains(bound))\n      )\n        newZoom--;\n      return newZoom;\n    }\n  };\n\n  var AttributionButton = L.Control.Attribution.extend({\n    options: {\n      prefix:\n        '<img src=\"https://www.w3.org/community/src/templates/wordpress/StoryTeller/favicon.ico\" style=\"position: relative; top: 5px\" alt=\"W3C Community and Business Groups logo\"> <a href=\"https://www.w3.org/community/maps4html/\">Maps for HTML Community Group</a> | <img src=\"data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTIiIGhlaWdodD0iOCI+PHBhdGggZmlsbD0iIzRDN0JFMSIgZD0iTTAgMGgxMnY0SDB6Ii8+PHBhdGggZmlsbD0iI0ZGRDUwMCIgZD0iTTAgNGgxMnYzSDB6Ii8+PHBhdGggZmlsbD0iI0UwQkMwMCIgZD0iTTAgN2gxMnYxSDB6Ii8+PC9zdmc+\" style=\"padding-right: 0.3em;\" alt=\"Slava Ukraini\"> <a href=\"https://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a> '\n    },\n\n    onAdd: function (map) {\n      map.attributionControl = this;\n      this._container = L.DomUtil.create(\n        'details',\n        'leaflet-control-attribution'\n      );\n      L.DomEvent.disableClickPropagation(this._container);\n\n      for (var i in map._layers) {\n        if (map._layers[i].getAttribution) {\n          this.addAttribution(map._layers[i].getAttribution());\n        }\n      }\n\n      this._update();\n\n      map.on('layeradd', this._addAttribution, this);\n\n      let dialog = document.createElement('dialog');\n      dialog.setAttribute('class', 'shortcuts-dialog');\n      dialog.setAttribute('autofocus', '');\n      dialog.onclick = function (e) {\n        e.stopPropagation();\n      };\n      dialog.innerHTML =\n        `<b>${M.options.locale.kbdShortcuts} </b><button aria-label=\"Close\" onclick='this.parentElement.close()'>X</button>` +\n        `<ul><b>${M.options.locale.kbdMovement}</b><li><kbd>&#8593</kbd> ${M.options.locale.kbdPanUp}</li><li><kbd>&#8595</kbd> ${M.options.locale.kbdPanDown}</li><li><kbd>&#8592</kbd> ${M.options.locale.kbdPanLeft}</li><li><kbd>&#8594</kbd> ${M.options.locale.kbdPanRight}</li><li><kbd>+</kbd> ${M.options.locale.btnZoomIn}</li><li><kbd>-</kbd> ${M.options.locale.btnZoomOut}</li><li><kbd>shift</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 3x ${M.options.locale.kbdPanIncrement}</li><li><kbd>ctrl</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 0.2x ${M.options.locale.kbdPanIncrement}</li><li><kbd>shift</kbd> + <kbd>+/-</kbd> ${M.options.locale.kbdZoom}</li></ul>` +\n        `<ul><b>${M.options.locale.kbdFeature}</b><li><kbd>&#8592/&#8593</kbd> ${M.options.locale.kbdPrevFeature}</li><li><kbd>&#8594/&#8595</kbd> ${M.options.locale.kbdNextFeature}</li></ul>`;\n      map._container.appendChild(dialog);\n\n      return this._container;\n    },\n\n    _update: function () {\n      if (!this._map) {\n        return;\n      }\n\n      var attribs = [];\n\n      for (var i in this._attributions) {\n        if (this._attributions[i]) {\n          attribs.push(i);\n        }\n      }\n\n      var prefixAndAttribs = [];\n\n      if (this.options.prefix) {\n        prefixAndAttribs.push(this.options.prefix);\n      }\n      if (attribs.length) {\n        prefixAndAttribs.push(attribs.join(', '));\n      }\n      this._container.innerHTML =\n        `<summary><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" height=\"30px\" viewBox=\"0 0 24 24\" width=\"30px\" fill=\"currentColor\"><path d=\"M0 0h24v24H0V0z\" fill=\"none\"></path><path d=\"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z\"></path></svg></summary>` +\n        '<div class=\"mapml-attribution-container\">' +\n        `<button onclick=\"this.closest(\\'.leaflet-container\\').querySelector(\\'.shortcuts-dialog\\').showModal()\" class=\"shortcuts-button mapml-button\">${M.options.locale.kbdShortcuts}</button> | ` +\n        prefixAndAttribs.join(' <span aria-hidden=\"true\">|</span> ') +\n        '</div>';\n      this._container.setAttribute('role', 'group');\n      this._container.setAttribute(\n        'aria-label',\n        `${M.options.locale.btnAttribution}`\n      );\n    }\n  });\n\n  L.Map.mergeOptions({\n    attributionControl: false,\n    toggleableAttributionControl: true\n  });\n\n  L.Map.addInitHook(function () {\n    if (this.options.toggleableAttributionControl) {\n      new AttributionButton().addTo(this);\n    }\n  });\n\n  var attributionButton = function (options) {\n    return new AttributionButton(options);\n  };\n\n  var ReloadButton = L.Control.extend({\n    options: {\n      position: 'topleft'\n    },\n\n    onAdd: function (map) {\n      let container = L.DomUtil.create('div', 'mapml-reload-button leaflet-bar');\n\n      let link = L.DomUtil.create('button', 'mapml-reload-button', container);\n      link.innerHTML = \"<span aria-hidden='true'>&#x021BA</span>\";\n      link.title = M.options.locale.cmReload;\n      link.setAttribute('type', 'button');\n      link.classList.add('mapml-button');\n      link.setAttribute('aria-label', 'Reload');\n\n      L.DomEvent.disableClickPropagation(link);\n      L.DomEvent.on(link, 'click', L.DomEvent.stop);\n      L.DomEvent.on(link, 'click', this._goReload, this);\n\n      this._reloadButton = link;\n\n      this._updateDisabled();\n      map.on('moveend', this._updateDisabled, this);\n\n      return container;\n    },\n\n    onRemove: function (map) {\n      map.off('moveend', this._updateDisabled, this);\n    },\n\n    disable: function () {\n      this._disabled = true;\n      this._updateDisabled();\n      return this;\n    },\n\n    enable: function () {\n      this._disabled = false;\n      this._updateDisabled();\n      return this;\n    },\n\n    _goReload: function (e) {\n      if (!this._disabled && this._map.options.mapEl._history.length > 1) {\n        this._map.options.mapEl.reload();\n      }\n    },\n\n    _updateDisabled: function () {\n      setTimeout(() => {\n        L.DomUtil.removeClass(this._reloadButton, 'leaflet-disabled');\n        this._reloadButton.setAttribute('aria-disabled', 'false');\n\n        if (\n          this._map &&\n          (this._disabled || this._map.options.mapEl._history.length <= 1)\n        ) {\n          L.DomUtil.addClass(this._reloadButton, 'leaflet-disabled');\n          this._reloadButton.setAttribute('aria-disabled', 'true');\n        }\n      }, 0);\n    }\n  });\n\n  var reloadButton = function (options) {\n    return new ReloadButton(options);\n  };\n\n  var ScaleBar = L.Control.Scale.extend({\n    options: {\n      maxWidth: 100,\n      updateWhenIdle: true,\n      position: 'bottomleft'\n    },\n\n    onAdd: function (map) {\n      // create output tag for screenreader to read from\n      let outputScale =\n        \"<output role='status' aria-live='polite' aria-atomic='true' class='mapml-screen-reader-output-scale'></output>\";\n      map._container.insertAdjacentHTML('beforeend', outputScale);\n\n      // initialize _container\n      this._container = L.DomUtil.create('div', 'mapml-control-scale');\n      let scaleControl = L.Control.Scale.prototype.onAdd.call(this, map);\n      this._container.appendChild(scaleControl);\n      this._container.setAttribute('tabindex', 0);\n      this._scaleControl = this;\n\n      // run on load\n      setTimeout(() => {\n        this._updateOutput();\n        this._focusOutput();\n      }, 0);\n\n      // update whenever map is zoomed or dragged\n      map.on('zoomend moveend', this._updateOutput, this);\n\n      // have screenreader read out everytime the map is focused\n      this._map._container.addEventListener('focus', () => this._focusOutput());\n\n      return this._container;\n    },\n\n    onRemove: function (map) {\n      map.off('zoomend moveend', this._updateOutput, this);\n    },\n\n    getContainer: function () {\n      return this._container;\n    },\n\n    _pixelsToDistance: function (px, units) {\n      let dpi = window.devicePixelRatio * 96; // default dpi\n      if (units === 'metric') {\n        return (px / dpi) * 2.54; // inches to cm\n      }\n      return px / dpi;\n    },\n\n    _scaleLength: function (scale) {\n      let scaleLength = scale.getAttribute('style');\n      let finalLength = parseInt(scaleLength.match(/width:\\s*(\\d+)px/)[1]);\n\n      return finalLength;\n    },\n\n    _focusOutput: function () {\n      setTimeout(() => {\n        let outputFocus = this._map._container.querySelector(\n          '.mapml-screen-reader-output-scale'\n        );\n        outputFocus.textContent = '';\n        setTimeout(() => {\n          outputFocus.textContent = this._container.getAttribute('aria-label');\n        }, 100);\n      }, 0);\n    },\n\n    _updateOutput: function () {\n      let output = '';\n      let scaleLine = this._scaleControl\n        .getContainer()\n        .getElementsByClassName('leaflet-control-scale-line')[0];\n\n      if (this.options.metric) {\n        let distance = parseFloat(\n          this._pixelsToDistance(this._scaleLength(scaleLine), 'metric').toFixed(\n            1\n          )\n        );\n        output = `${distance} centimeters to ${scaleLine.textContent.trim()}`;\n        output = output.replace(/(\\d+)\\s*m\\b/g, '$1 meters');\n        output = output.replace(/ km/g, ' kilometers');\n      } else {\n        let distance = parseFloat(\n          this._pixelsToDistance(\n            this._scaleLength(scaleLine),\n            'imperial'\n          ).toFixed(1)\n        );\n        output = `${distance} inches to ${scaleLine.textContent.trim()}`;\n        output = output.replace(/ft/g, 'feet');\n        output = output.replace(/mi/g, 'miles');\n      }\n\n      this._container.setAttribute('aria-label', output);\n      this._map._container.querySelector(\n        '.mapml-screen-reader-output-scale'\n      ).textContent = output;\n    }\n  });\n  var scaleBar = function (options) {\n    return new ScaleBar(options);\n  };\n\n  var FullscreenButton = L.Control.extend({\n    options: {\n      position: 'topleft',\n      title: {\n        false: 'View Fullscreen',\n        true: 'Exit Fullscreen'\n      }\n    },\n\n    onAdd: function (map) {\n      var container = L.DomUtil.create(\n        'div',\n        'leaflet-control-fullscreen leaflet-bar leaflet-control'\n      );\n\n      this.link = L.DomUtil.create(\n        'a',\n        'leaflet-control-fullscreen-button leaflet-bar-part',\n        container\n      );\n      this.link.href = '#';\n      this.link.setAttribute('role', 'button');\n\n      this._map = map;\n      this._map.on('fullscreenchange', this._toggleTitle, this);\n      this._toggleTitle();\n\n      L.DomEvent.on(this.link, 'click', this._click, this);\n\n      return container;\n    },\n\n    onRemove: function (map) {\n      map.off('fullscreenchange', this._toggleTitle, this);\n    },\n\n    _click: function (e) {\n      L.DomEvent.stopPropagation(e);\n      L.DomEvent.preventDefault(e);\n      this._map.toggleFullscreen(this.options);\n    },\n\n    _toggleTitle: function () {\n      this.link.title = this.options.title[this._map.isFullscreen()];\n    }\n  });\n\n  L.Map.include({\n    isFullscreen: function () {\n      return this._isFullscreen || false;\n    },\n\n    toggleFullscreen: function (options) {\n      // the <map> element can't contain a shadow root, so we used a child <div>\n      // <mapml-viewer> can contain a shadow root, so return it directly\n      var mapEl = this.getContainer().getRootNode().host,\n        container = mapEl.nodeName === 'DIV' ? mapEl.parentElement : mapEl;\n      if (this.isFullscreen()) {\n        if (options && options.pseudoFullscreen) {\n          this._disablePseudoFullscreen(container);\n        } else if (document.exitFullscreen) {\n          document.exitFullscreen();\n        } else if (document.mozCancelFullScreen) {\n          document.mozCancelFullScreen();\n        } else if (document.webkitCancelFullScreen) {\n          document.webkitCancelFullScreen();\n        } else if (document.msExitFullscreen) {\n          document.msExitFullscreen();\n        } else {\n          this._disablePseudoFullscreen(container);\n        }\n      } else {\n        if (options && options.pseudoFullscreen) {\n          this._enablePseudoFullscreen(container);\n        } else if (container.requestFullscreen) {\n          container.requestFullscreen();\n        } else if (container.mozRequestFullScreen) {\n          container.mozRequestFullScreen();\n        } else if (container.webkitRequestFullscreen) {\n          container.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n        } else if (container.msRequestFullscreen) {\n          container.msRequestFullscreen();\n        } else {\n          this._enablePseudoFullscreen(container);\n        }\n      }\n    },\n\n    _enablePseudoFullscreen: function (container) {\n      L.DomUtil.addClass(container, 'leaflet-pseudo-fullscreen');\n      this._setFullscreen(true);\n      this.fire('fullscreenchange');\n    },\n\n    _disablePseudoFullscreen: function (container) {\n      L.DomUtil.removeClass(container, 'leaflet-pseudo-fullscreen');\n      this._setFullscreen(false);\n      this.fire('fullscreenchange');\n    },\n\n    _setFullscreen: function (fullscreen) {\n      this._isFullscreen = fullscreen;\n      var container = this.getContainer().getRootNode().host;\n      if (fullscreen) {\n        L.DomUtil.addClass(container, 'mapml-fullscreen-on');\n      } else {\n        L.DomUtil.removeClass(container, 'mapml-fullscreen-on');\n      }\n      this.invalidateSize();\n    },\n\n    _onFullscreenChange: function (e) {\n      var fullscreenElement =\n          document.fullscreenElement ||\n          document.mozFullScreenElement ||\n          document.webkitFullscreenElement ||\n          document.msFullscreenElement,\n        mapEl = this.getContainer().getRootNode().host,\n        container = mapEl.nodeName === 'DIV' ? mapEl.parentElement : mapEl;\n\n      if (fullscreenElement === container && !this._isFullscreen) {\n        this._setFullscreen(true);\n        this.fire('fullscreenchange');\n      } else if (fullscreenElement !== container && this._isFullscreen) {\n        this._setFullscreen(false);\n        this.fire('fullscreenchange');\n      }\n    }\n  });\n\n  L.Map.mergeOptions({\n    fullscreenControl: false\n  });\n\n  L.Map.addInitHook(function () {\n    if (this.options.fullscreenControl) {\n      this.fullscreenControl = new FullscreenButton(\n        this.options.fullscreenControl\n      );\n      this.addControl(this.fullscreenControl);\n    }\n\n    var fullscreenchange;\n\n    if ('onfullscreenchange' in document) {\n      fullscreenchange = 'fullscreenchange';\n    } else if ('onmozfullscreenchange' in document) {\n      fullscreenchange = 'mozfullscreenchange';\n    } else if ('onwebkitfullscreenchange' in document) {\n      fullscreenchange = 'webkitfullscreenchange';\n    } else if ('onmsfullscreenchange' in document) {\n      fullscreenchange = 'MSFullscreenChange';\n    }\n\n    if (fullscreenchange) {\n      var onFullscreenChange = L.bind(this._onFullscreenChange, this);\n\n      this.whenReady(function () {\n        L.DomEvent.on(document, fullscreenchange, onFullscreenChange);\n      });\n\n      this.on('unload', function () {\n        L.DomEvent.off(document, fullscreenchange, onFullscreenChange);\n      });\n    }\n  });\n\n  var fullscreenButton = function (options) {\n    return new FullscreenButton(options);\n  };\n\n  var GeolocationButton = L.Control.extend({\n    options: {\n      position: 'bottomright'\n    },\n\n    onAdd: function (map) {\n      this.locateControl = L.control\n        .locate({\n          showPopup: false,\n          strings: {\n            title: M.options.locale.btnLocTrackOff\n          },\n          position: this.options.position,\n          locateOptions: {\n            maxZoom: 16\n          }\n        })\n        .addTo(map);\n\n      var container = this.locateControl._container;\n      var button = this.locateControl;\n      var observer = new MutationObserver(function (mutations) {\n        if (\n          container.classList.contains('active') &&\n          container.classList.contains('following')\n        ) {\n          container.firstChild.title = M.options.locale.btnLocTrackOn;\n          button._marker.bindTooltip(M.options.locale.btnMyLocTrackOn, {\n            permanent: true\n          });\n        } else if (container.classList.contains('active')) {\n          container.firstChild.title = M.options.locale.btnLocTrackLastKnown;\n          button._marker.bindTooltip(M.options.locale.btnMyLastKnownLocTrackOn);\n        } else {\n          container.firstChild.title = M.options.locale.btnLocTrackOff;\n        }\n      });\n      var observerConfig = { attributes: true, attributeFilter: ['class'] };\n      observer.observe(container, observerConfig);\n\n      return container;\n    },\n\n    stop: function () {\n      return this.locateControl.stop();\n    }\n  });\n\n  var geolocationButton = function (options) {\n    return new GeolocationButton(options);\n  };\n\n  var Crosshair = L.Layer.extend({\n    onAdd: function (map) {\n      // SVG crosshair design from https://github.com/xguaita/Leaflet.MapCenterCoord/blob/master/src/icons/MapCenterCoordIcon1.svg?short_path=81a5c76\n      // Optimized with SVGOMG: https://jakearchibald.github.io/svgomg/\n      let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><g stroke=\"#fff\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"50.028\" cy=\"50.219\" r=\"3.923\" stroke-width=\"2\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M4.973 54.424h31.768a4.204 4.204 0 1 0 0-8.409H4.973A4.203 4.203 0 0 0 .77 50.22a4.203 4.203 0 0 0 4.204 4.205z\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M54.232 5.165a4.204 4.204 0 1 0-8.408 0v31.767a4.204 4.204 0 1 0 8.408 0V5.165z\"/><path stroke-width=\"3\" d=\"M99.288 50.22a4.204 4.204 0 0 0-4.204-4.205H63.317a4.204 4.204 0 1 0 0 8.409h31.767a4.205 4.205 0 0 0 4.204-4.205zM45.823 95.274a4.204 4.204 0 1 0 8.409 0V63.506a4.204 4.204 0 1 0-8.409 0v31.768z\" color=\"currentColor\" overflow=\"visible\"/></g></svg>`;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-crosshair',\n        map._container\n      );\n      this._container.innerHTML = svgInnerHTML;\n      map.isFocused = false;\n      this._isQueryable = false;\n\n      map.on(\n        'layerchange layeradd layerremove overlayremove',\n        this._toggleEvents,\n        this\n      );\n      map.on('popupopen', this._isMapFocused, this);\n      L.DomEvent.on(\n        map._container,\n        'keydown keyup mousedown',\n        this._isMapFocused,\n        this\n      );\n\n      this._addOrRemoveCrosshair();\n    },\n\n    onRemove: function (map) {\n      map.off(\n        'layerchange layeradd layerremove overlayremove',\n        this._toggleEvents\n      );\n      map.off('popupopen', this._isMapFocused);\n      L.DomEvent.off(\n        map._container,\n        'keydown keyup mousedown',\n        this._isMapFocused\n      );\n    },\n\n    _toggleEvents: function () {\n      if (this._hasQueryableLayer()) {\n        this._map.on('viewreset move moveend', this._addOrRemoveCrosshair, this);\n      } else {\n        this._map.off('viewreset move moveend', this._addOrRemoveCrosshair, this);\n      }\n      this._addOrRemoveCrosshair();\n    },\n\n    _addOrRemoveCrosshair: function (e) {\n      if (this._hasQueryableLayer()) {\n        this._container.removeAttribute('hidden');\n      } else {\n        this._container.setAttribute('hidden', '');\n      }\n    },\n\n    _addOrRemoveMapOutline: function (e) {\n      let mapContainer = this._map._container;\n      if (this._map.isFocused && !this._outline) {\n        this._outline = L.DomUtil.create('div', 'mapml-outline', mapContainer);\n      } else if (!this._map.isFocused && this._outline) {\n        L.DomUtil.remove(this._outline);\n        delete this._outline;\n      }\n    },\n\n    _hasQueryableLayer: function () {\n      let layers = this._map.options.mapEl.layers;\n      if (this._map.isFocused) {\n        for (let layer of layers) {\n          if (layer.checked && layer._layer.queryable) {\n            return true;\n          }\n        }\n      }\n      return false;\n    },\n\n    // TODO: should be merged with the 'mapfocused' event emitted by mapml-viewer and map, not trivial\n    _isMapFocused: function (e) {\n      //set this._map.isFocused = true if arrow buttons are used\n      if (!this._map._container.parentNode.activeElement) {\n        this._map.isFocused = false;\n        return;\n      }\n      let isLeafletContainer =\n        this._map._container.parentNode.activeElement.classList.contains(\n          'leaflet-container'\n        );\n      if (\n        isLeafletContainer &&\n        ['keydown'].includes(e.type) &&\n        e.shiftKey &&\n        e.keyCode === 9\n      ) {\n        this._map.isFocused = false;\n      } else\n        this._map.isFocused =\n          isLeafletContainer && ['keyup', 'keydown'].includes(e.type);\n\n      if (this._map.isFocused) this._map.fire('mapkeyboardfocused');\n      this._addOrRemoveMapOutline();\n      this._addOrRemoveCrosshair();\n    }\n  });\n\n  var crosshair = function (options) {\n    return new Crosshair(options);\n  };\n\n  /**\n   * M.Feature is a extension of L.Path that understands mapml feature markup\n   * It converts the markup to the following structure (abstract enough to encompass all feature types) for example:\n   *  this._outlinePath = HTMLElement;\n   *  this._parts = [\n   *    {\n   *      path: HTMLElement,\n   *      rings:[\n   *        {points:[{x:1,y:1}, ...]},\n   *        ...\n   *      ],\n   *      subrings:[\n   *        {points:[{x:2, y:2}, ...], cls:\"Span Class Name\", path: HTMLElement,},\n   *        ...\n   *      ],\n   *      cls:\"className\",\n   *    },\n   *    ...\n   *  ];\n   */\n  var Feature = L.Path.extend({\n    /**\n     * Initializes the M.Feature\n     * @param {HTMLElement} markup - The markup representation of the feature\n     * @param {Object} options - The options of the feature\n     */\n    initialize: function (markup, options) {\n      this.type = markup.tagName.toUpperCase();\n\n      if (this.type === 'MAP-POINT' || this.type === 'MAP-MULTIPOINT')\n        options.fillOpacity = 1;\n\n      if (options.wrappers.length > 0)\n        options = Object.assign(this._convertWrappers(options.wrappers), options);\n      L.setOptions(this, options);\n\n      this.group = this.options.group;\n      this.options.interactive =\n        this.options.link ||\n        (this.options.properties && this.options.onEachFeature);\n\n      this._parts = [];\n      this._markup = markup;\n      this.options.zoom = markup.getAttribute('zoom') || this.options.nativeZoom;\n\n      this._convertMarkup();\n\n      if (markup.querySelector('map-span') || markup.querySelector('map-a')) {\n        this._generateOutlinePoints();\n      }\n\n      this.isClosed = this._isClosed();\n    },\n\n    /**\n     * Attaches link handler to the sub parts' paths\n     * @param {SVGElement} elem - The element to add listeners to, either path or g elements\n     * @param {Object} link - The link object that contains the url, type and target data\n     * @param leafletLayer\n     */\n    attachLinkHandler: function (elem, link, leafletLayer) {\n      let dragStart,\n        container = document.createElement('div'),\n        p = document.createElement('p'),\n        hovered = false;\n      container.classList.add('mapml-link-preview');\n      container.appendChild(p);\n      elem.classList.add('map-a');\n      if (link.visited) elem.classList.add('map-a-visited');\n      elem.mousedown = (e) => (dragStart = { x: e.clientX, y: e.clientY });\n      L.DomEvent.on(elem, 'mousedown', elem.mousedown, this);\n      elem.mouseup = (e) => {\n        if (e.button !== 0) return; // don't trigger when button isn't left click\n        let onTop = true,\n          nextLayer = this.options._leafletLayer._layerEl.nextElementSibling;\n        while (nextLayer && onTop) {\n          if (nextLayer.tagName && nextLayer.tagName.toUpperCase() === 'LAYER-')\n            onTop = !(nextLayer.checked && nextLayer._layer.queryable);\n          nextLayer = nextLayer.nextElementSibling;\n        }\n        if (onTop && dragStart) {\n          //M._handleLink gets called twice, once in the target phase on the path element, then in the bubble phase on the g element\n          //Using stopPropagation leaves the mouse in the mousedown state\n          if (e.eventPhase === Event.BUBBLING_PHASE) return;\n          let dist = Math.sqrt(\n            Math.pow(dragStart.x - e.clientX, 2) +\n              Math.pow(dragStart.y - e.clientY, 2)\n          );\n          if (dist <= 5) {\n            link.visited = true;\n            elem.setAttribute('stroke', '#6c00a2');\n            elem.classList.add('map-a-visited');\n            M._handleLink(link, leafletLayer);\n          }\n        }\n      };\n      L.DomEvent.on(elem, 'mouseup', elem.mouseup, this);\n      L.DomEvent.on(\n        elem,\n        'keypress',\n        (e) => {\n          L.DomEvent.stop(e);\n          if (e.keyCode === 13 || e.keyCode === 32) {\n            link.visited = true;\n            elem.setAttribute('stroke', '#6c00a2');\n            elem.classList.add('map-a-visited');\n            M._handleLink(link, leafletLayer);\n          }\n        },\n        this\n      );\n      L.DomEvent.on(\n        elem,\n        'mouseenter keyup',\n        (e) => {\n          if (e.target !== e.currentTarget) return;\n          hovered = true;\n          let resolver = document.createElement('a'),\n            mapWidth = this._map.getContainer().clientWidth;\n          resolver.href = link.url;\n          p.innerHTML = resolver.href;\n\n          this._map.getContainer().appendChild(container);\n\n          while (p.clientWidth > mapWidth / 2) {\n            p.innerHTML =\n              p.innerHTML.substring(0, p.innerHTML.length - 5) + '...';\n          }\n          setTimeout(() => {\n            if (hovered) p.innerHTML = resolver.href;\n          }, 1000);\n        },\n        this\n      );\n      L.DomEvent.on(\n        elem,\n        'mouseout keydown mousedown',\n        (e) => {\n          if (e.target !== e.currentTarget || !container.parentElement) return;\n          hovered = false;\n          this._map.getContainer().removeChild(container);\n        },\n        this\n      );\n      L.DomEvent.on(\n        leafletLayer._map.getContainer(),\n        'mouseout mouseenter click',\n        (e) => {\n          //adds a lot of event handlers\n          if (!container.parentElement) return;\n          hovered = false;\n          this._map.getContainer().removeChild(container);\n        },\n        this\n      );\n    },\n\n    /**\n     * Updates internal structure of the feature to the new map state, the structure can be found in this._parts\n     * @param {L.Map} addedMap - The map that the feature is part of, can be left blank in the case of static features\n     * @param {L.Point} tileOrigin - The tile origin for the feature, if blank then it takes the maps pixel origin in the function\n     * @param {int} zoomingTo - The zoom the map is animating to, if left blank then it takes the map zoom, its provided because in templated tiles zoom is delayed\n     * @private\n     */\n    _project: function (addedMap, tileOrigin = undefined, zoomingTo = undefined) {\n      let map = addedMap || this._map,\n        origin = tileOrigin || map.getPixelOrigin(),\n        zoom = zoomingTo === undefined ? map.getZoom() : zoomingTo;\n      for (let p of this._parts) {\n        p.pixelRings = this._convertRing(p.rings, map, origin, zoom);\n        for (let subP of p.subrings) {\n          subP.pixelSubrings = this._convertRing([subP], map, origin, zoom);\n        }\n      }\n      if (!this._outline) return;\n      this.pixelOutline = [];\n      for (let o of this._outline) {\n        this.pixelOutline = this.pixelOutline.concat(\n          this._convertRing(o, map, origin, zoom)\n        );\n      }\n    },\n\n    /**\n     * Converts the PCRS points to pixel points that can be used to create the SVG\n     * @param {L.Point[][]} r - Is the rings of a feature, either the mainParts, subParts or outline\n     * @param {L.Map} map - The map that the feature is part of\n     * @param {L.Point} origin - The origin used to calculate the pixel points\n     * @param {int} zoom - The current zoom level of the map\n     * @returns {L.Point[][]}\n     * @private\n     */\n    _convertRing: function (r, map, origin, zoom) {\n      // TODO: Implement Ramer-Douglas-Peucer Algo for simplifying points\n      let scale = map.options.crs.scale(zoom),\n        parts = [];\n      for (let sub of r) {\n        let interm = [];\n        for (let p of sub.points) {\n          let conv = map.options.crs.transformation.transform(p, scale);\n          interm.push(L.point(conv.x, conv.y)._subtract(origin).round());\n        }\n        parts.push(interm);\n      }\n      return parts;\n    },\n\n    /**\n     * Updates the features\n     * @private\n     */\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updateFeature(this);\n    },\n\n    /**\n     * Converts the map-spans, a and divs around a geometry subtype into options for the feature\n     * @param {HTMLElement[]} elems - The current zoom level of the map\n     * @private\n     */\n    _convertWrappers: function (elems) {\n      if (!elems || elems.length === 0) return;\n      let classList = '',\n        output = {};\n      for (let elem of elems) {\n        if (elem.tagName.toUpperCase() !== 'MAP-A' && elem.className) {\n          classList += `${elem.className} `;\n        } else if (!output.link && elem.getAttribute('href')) {\n          let link = {};\n          link.url = elem.getAttribute('href');\n          if (elem.hasAttribute('target'))\n            link.target = elem.getAttribute('target');\n          if (elem.hasAttribute('type')) link.type = elem.getAttribute('type');\n          if (elem.hasAttribute('inplace')) link.inPlace = true;\n          output.link = link;\n        }\n      }\n      output.className = `${classList} ${this.options.className}`.trim();\n      return output;\n    },\n\n    /**\n     * Converts this._markup to the internal structure of features\n     * @private\n     */\n    _convertMarkup: function () {\n      if (!this._markup) return;\n\n      let attr = this._markup.attributes;\n      this.featureAttributes = {};\n      if (\n        this.options.link &&\n        this._markup.parentElement.tagName.toUpperCase() === 'MAP-A' &&\n        this._markup.parentElement.parentElement.tagName.toUpperCase() !==\n          'MAP-GEOMETRY'\n      )\n        this.featureAttributes.tabindex = '0';\n      for (let i = 0; i < attr.length; i++) {\n        this.featureAttributes[attr[i].name] = attr[i].value;\n      }\n\n      let first = true;\n      for (let c of this._markup.querySelectorAll('map-coordinates')) {\n        //loops through the coordinates of the child\n        let ring = [],\n          subRings = [];\n        this._coordinateToArrays(c, ring, subRings, this.options.className); //creates an array of pcrs points for the main ring and the subparts\n        if (!first && this.type === 'MAP-POLYGON') {\n          this._parts[0].rings.push(ring[0]);\n          if (subRings.length > 0)\n            this._parts[0].subrings = this._parts[0].subrings.concat(subRings);\n        } else if (this.type === 'MAP-MULTIPOINT') {\n          for (let point of ring[0].points.concat(subRings)) {\n            this._parts.push({\n              rings: [{ points: [point] }],\n              subrings: [],\n              cls: `${point.cls || ''} ${this.options.className || ''}`.trim()\n            });\n          }\n        } else {\n          this._parts.push({\n            rings: ring,\n            subrings: subRings,\n            cls: `${this.featureAttributes.class || ''} ${\n            this.options.className || ''\n          }`.trim()\n          });\n        }\n        first = false;\n      }\n    },\n\n    /**\n     * Generates the feature outline, subtracting the map-spans to generate those separately\n     * @private\n     */\n    _generateOutlinePoints: function () {\n      if (\n        this.type === 'MAP-MULTIPOINT' ||\n        this.type === 'MAP-POINT' ||\n        this.type === 'MAP-LINESTRING' ||\n        this.type === 'MAP-MULTILINESTRING'\n      )\n        return;\n\n      this._outline = [];\n      for (let coords of this._markup.querySelectorAll('map-coordinates')) {\n        let nodes = coords.childNodes,\n          cur = 0,\n          tempDiv = document.createElement('div'),\n          nodeLength = nodes.length;\n        for (let i = 0; i < nodes.length; i++) {\n          if (nodes[i].textContent.trim().length === 0) {\n            nodes[i].remove();\n          }\n        }\n        for (let n of nodes) {\n          let line = [];\n          if (!n.tagName) {\n            //no tagName means it's text content\n            let c = '',\n              ind = (((cur - 1) % nodes.length) + nodes.length) % nodes.length; // this equation turns Javascript's % to how it behaves in C for example\n            if (nodes[ind].tagName) {\n              let prev = nodes[ind].textContent.trim().split(/\\s+/);\n              c += `${prev[prev.length - 2]} ${prev[prev.length - 1]} `;\n            }\n            c += n.textContent;\n            ind = (((cur + 1) % nodes.length) + nodes.length) % nodes.length; // this is equivalent to C/C++'s (cur + 1) % nodes.length\n            if (nodes[ind].tagName) {\n              let next = nodes[ind].textContent.trim().split(/\\s+/);\n              c += `${next[0]} ${next[1]} `;\n            }\n            tempDiv.innerHTML = c;\n            this._coordinateToArrays(\n              tempDiv,\n              line,\n              [],\n              true,\n              this.featureAttributes.class || this.options.className\n            );\n            this._outline.push(line);\n          }\n          cur++;\n        }\n      }\n    },\n\n    /**\n     * Converts map-coordinates element to an object representing the parts and subParts\n     * @param {HTMLElement} coords - A single map-coordinates element\n     * @param {Object[]} main - An empty array representing the main parts\n     * @param {Object[]} subParts - An empty array representing the sub parts\n     * @param {boolean} isFirst - A true | false representing if the current HTML element is the parent map-coordinates element or not\n     * @param {string} cls - The class of the coordinate/span\n     * @param parents\n     * @private\n     */\n    _coordinateToArrays: function (\n      coords,\n      main,\n      subParts,\n      isFirst = true,\n      cls = undefined,\n      parents = []\n    ) {\n      for (let span of coords.children) {\n        this._coordinateToArrays(\n          span,\n          main,\n          subParts,\n          false,\n          span.getAttribute('class'),\n          parents.concat([span])\n        );\n      }\n      let noSpan = coords.textContent.replace(/(<([^>]+)>)/gi, ''),\n        pairs = noSpan.match(/(\\S+\\s+\\S+)/gim),\n        local = [],\n        bounds;\n      for (let p of pairs) {\n        let numPair = [];\n        p.split(/\\s+/gim).forEach(M._parseNumber, numPair);\n        let point = M.pointToPCRSPoint(\n          L.point(numPair),\n          this.options.zoom,\n          this.options.projection,\n          this.options.nativeCS\n        );\n        local.push(point);\n        bounds = bounds ? bounds.extend(point) : L.bounds(point, point);\n      }\n      if (this._bounds) {\n        this._bounds.extend(bounds.min);\n        this._bounds.extend(bounds.max);\n      } else {\n        this._bounds = bounds;\n      }\n      if (isFirst) {\n        main.push({ points: local });\n      } else {\n        let attrMap = {},\n          attr = coords.attributes,\n          wrapperAttr = this._convertWrappers(parents);\n        if (wrapperAttr.link) attrMap.tabindex = '0';\n        for (let i = 0; i < attr.length; i++) {\n          if (attr[i].name === 'class') continue;\n          attrMap[attr[i].name] = attr[i].value;\n        }\n        subParts.unshift({\n          points: local,\n          center: bounds.getCenter(),\n          cls: `${cls || ''} ${wrapperAttr.className || ''}`.trim(),\n          attr: attrMap,\n          link: wrapperAttr.link,\n          linkTarget: wrapperAttr.linkTarget,\n          linkType: wrapperAttr.linkType\n        });\n      }\n    },\n\n    /**\n     * Returns if the feature is closed or open, useful when styling\n     * @returns {boolean}\n     * @private\n     */\n    _isClosed: function () {\n      switch (this.type) {\n        case 'MAP-POLYGON':\n        case 'MAP-MULTIPOLYGON':\n        case 'MAP-POINT':\n        case 'MAP-MULTIPOINT':\n          return true;\n        case 'MAP-LINESTRING':\n        case 'MAP-MULTILINESTRING':\n          return false;\n        default:\n          return false;\n      }\n    },\n\n    /**\n     * Returns the center of the entire feature\n     * @returns {L.Point}\n     */\n    getCenter: function () {\n      if (!this._bounds) return null;\n      return this._map.options.crs.unproject(this._bounds.getCenter());\n    },\n\n    getPCRSCenter: function () {\n      return this._bounds.getCenter();\n    }\n  });\n\n  /**\n   *\n   * @param {HTMLElement} markup - The markup of the feature\n   * @param {Object} options - Options of the feature\n   * @returns {M.Feature}\n   */\n  var feature = function (markup, options) {\n    return new Feature(markup, options);\n  };\n\n  /**\n   * Returns a new Feature Renderer\n   * @param {Object} options - Options for the renderer\n   * @returns {*}\n   */\n  var FeatureRenderer = L.SVG.extend({\n    /**\n     * Override method of same name from L.SVG, use the this._container property\n     * to set up the role=\"none presentation\" on featureGroupu container,\n     * per this recommendation:\n     * https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/471#issuecomment-845192246\n     * @private overrides ancestor method so that we have a _container to work with\n     */\n    _initContainer: function () {\n      // call the method we're overriding, per https://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n      // note you have to pass 'this' as the first arg\n      L.SVG.prototype._initContainer.call(this);\n      // knowing that the previous method call creates the this._container, we\n      // access it and set the role=\"none presetation\" which suppresses the\n      // announcement of \"Graphic\" on each feature focus.\n      this._container.setAttribute('role', 'none presentation');\n    },\n\n    /**\n     * Creates all the appropriate path elements for a M.Feature\n     * @param {M.Feature} layer - The M.Feature that needs paths generated\n     * @param {boolean} stampLayer - Whether or not a layer should be stamped and stored in the renderer layers\n     * @private\n     */\n    _initPath: function (layer, stampLayer = true) {\n      if (layer._outline) {\n        let outlinePath = L.SVG.create('path');\n        if (layer.options.className)\n          L.DomUtil.addClass(\n            outlinePath,\n            layer.featureAttributes.class || layer.options.className\n          );\n        L.DomUtil.addClass(outlinePath, 'mapml-feature-outline');\n        outlinePath.style.fill = 'none';\n        layer.outlinePath = outlinePath;\n      }\n\n      //creates the main parts and sub parts paths\n      for (let p of layer._parts) {\n        if (p.rings) {\n          this._createPath(\n            p,\n            layer.options.className,\n            layer.featureAttributes['aria-label'],\n            layer.options.interactive,\n            layer.featureAttributes\n          );\n          if (layer.outlinePath) p.path.style.stroke = 'none';\n        }\n        if (p.subrings) {\n          for (let r of p.subrings) {\n            this._createPath(\n              r,\n              layer.options.className,\n              r.attr['aria-label'],\n              r.link !== undefined,\n              r.attr\n            );\n          }\n        }\n        this._updateStyle(layer);\n      }\n      if (stampLayer) {\n        let stamp = L.stamp(layer);\n        this._layers[stamp] = layer;\n      }\n    },\n\n    /**\n     * Creates paths for either mainParts, subParts or outline of a feature\n     * @param {Object} ring - The ring the current path is being generated for\n     * @param {string} title - The accessible aria-label of a path\n     * @param {string} cls - The class of the path\n     * @param {boolean} interactive - The boolean representing whether a feature is interactive or not\n     * @param {Object} attr - Attributes map\n     * @private\n     */\n    _createPath: function (\n      ring,\n      cls,\n      title,\n      interactive = false,\n      attr = undefined\n    ) {\n      let p = L.SVG.create('path');\n      ring.path = p;\n      if (!attr) {\n        if (title) p.setAttribute('aria-label', title);\n      } else {\n        for (let [name, value] of Object.entries(attr)) {\n          if (name === 'id' || name === 'tabindex') continue;\n          p.setAttribute(name, value);\n        }\n      }\n      if (ring.cls || cls) {\n        L.DomUtil.addClass(p, ring.cls || cls);\n      }\n      if (interactive) {\n        L.DomUtil.addClass(p, 'leaflet-interactive');\n      }\n    },\n\n    /**\n     * Adds all the paths needed for a feature\n     * @param {M.Feature} layer - The feature that needs it's paths added\n     * @param {HTMLElement} container - The location the paths need to be added to\n     * @param {boolean} interactive - Whether a feature is interactive or not\n     * @private\n     */\n    _addPath: function (layer, container = undefined, interactive = true) {\n      if (!this._rootGroup && !container) {\n        this._initContainer();\n      }\n      let c = container || this._rootGroup,\n        outlineAdded = false;\n      if (interactive) {\n        layer.addInteractiveTarget(layer.group);\n      }\n      for (let p of layer._parts) {\n        if (p.path) layer.group.appendChild(p.path);\n        if (interactive) {\n          if (layer.options.link)\n            layer.attachLinkHandler(\n              p.path,\n              layer.options.link,\n              layer.options._leafletLayer\n            );\n          layer.addInteractiveTarget(p.path);\n        }\n\n        if (!outlineAdded && layer.pixelOutline) {\n          layer.group.appendChild(layer.outlinePath);\n          outlineAdded = true;\n        }\n\n        for (let subP of p.subrings) {\n          if (subP.path) {\n            if (subP.link) {\n              layer.attachLinkHandler(\n                subP.path,\n                subP.link,\n                layer.options._leafletLayer\n              );\n              layer.addInteractiveTarget(subP.path);\n            }\n            layer.group.appendChild(subP.path);\n          }\n        }\n      }\n      c.appendChild(layer.group);\n    },\n\n    /**\n     * Removes all the paths related to a feature\n     * @param {M.Feature} layer - The feature who's paths need to be removed\n     * @private\n     */\n    _removePath: function (layer) {\n      for (let p of layer._parts) {\n        if (p.path) {\n          layer.removeInteractiveTarget(p.path);\n          L.DomUtil.remove(p.path);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path) L.DomUtil.remove(subP.path);\n        }\n      }\n      if (layer.outlinePath) L.DomUtil.remove(layer.outlinePath);\n      layer.removeInteractiveTarget(layer.group);\n      L.DomUtil.remove(layer.group);\n      delete this._layers[L.stamp(layer)];\n    },\n\n    /**\n     * Updates the d attribute of all paths of a feature\n     * @param {M.Feature} layer - The Feature that needs updating\n     * @private\n     */\n    _updateFeature: function (layer) {\n      if (layer.pixelOutline)\n        this._setPath(\n          layer.outlinePath,\n          this.geometryToPath(layer.pixelOutline, false)\n        );\n      for (let p of layer._parts) {\n        this._setPath(p.path, this.geometryToPath(p.pixelRings, layer.isClosed));\n        for (let subP of p.subrings) {\n          this._setPath(\n            subP.path,\n            this.geometryToPath(subP.pixelSubrings, false)\n          );\n        }\n      }\n    },\n\n    /**\n     * Generates the marker d attribute for a given point\n     * @param {L.Point} p - The point of the marker\n     * @returns {string}\n     * @private\n     */\n    _pointToMarker: function (p) {\n      return `M${p.x} ${p.y} L${p.x - 12.5} ${p.y - 30} C${p.x - 12.5} ${\n      p.y - 50\n    }, ${p.x + 12.5} ${p.y - 50}, ${p.x + 12.5} ${p.y - 30} L${p.x} ${p.y}z`;\n    },\n\n    /**\n     * Updates the styles of all paths of a feature\n     * @param {M.Feature} layer - The feature that needs styles updated\n     * @private\n     */\n    _updateStyle: function (layer) {\n      this._updatePathStyle(layer.outlinePath, layer, false, true);\n      for (let p of layer._parts) {\n        if (p.path) {\n          this._updatePathStyle(p.path, layer, true);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path) this._updatePathStyle(subP.path, layer);\n        }\n      }\n    },\n\n    /**\n     * Updates the style of a single path\n     * @param {HTMLElement} path - The path that needs updating\n     * @param {M.Feature} layer - The feature layer\n     * @param {boolean} isMain - Whether it's the main parts or not\n     * @param {boolean} isOutline - Whether a path is an outline or not\n     * @private\n     */\n    _updatePathStyle: function (path, layer, isMain = false, isOutline = false) {\n      if (!path || !layer) {\n        return;\n      }\n      let options = layer.options,\n        isClosed = layer.isClosed;\n      if (\n        (options.stroke && (!isClosed || isOutline)) ||\n        (isMain && !layer.outlinePath)\n      ) {\n        path.setAttribute('stroke', options.color);\n        path.setAttribute('stroke-opacity', options.opacity);\n        path.setAttribute('stroke-width', options.weight);\n        path.setAttribute('stroke-linecap', options.lineCap);\n        path.setAttribute('stroke-linejoin', options.lineJoin);\n\n        if (options.dashArray) {\n          path.setAttribute('stroke-dasharray', options.dashArray);\n        } else {\n          path.removeAttribute('stroke-dasharray');\n        }\n\n        if (options.dashOffset) {\n          path.setAttribute('stroke-dashoffset', options.dashOffset);\n        } else {\n          path.removeAttribute('stroke-dashoffset');\n        }\n\n        if (options.link) {\n          path.setAttribute(\n            'stroke',\n            options.link.visited ? '#6c00a2' : '#0000EE'\n          );\n          path.setAttribute('stroke-opacity', '1');\n          path.setAttribute('stroke-width', '1px');\n          path.setAttribute('stroke-dasharray', 'none');\n        }\n      } else {\n        path.setAttribute('stroke', 'none');\n      }\n\n      if (isClosed && !isOutline) {\n        if (!options.fill) {\n          path.setAttribute('fill', options.fillColor || options.color);\n          path.setAttribute('fill-opacity', options.fillOpacity);\n          path.setAttribute('fill-rule', options.fillRule || 'evenodd');\n        } else {\n          path.setAttribute('fill', options.color);\n        }\n      } else {\n        path.setAttribute('fill', 'none');\n      }\n    },\n\n    /**\n     * Sets the d attribute of a path\n     * @param {HTMLElement} path - The path that is being updated\n     * @param {string} def - The new d attribute of the path\n     * @private\n     */\n    _setPath: function (path, def) {\n      path.setAttribute('d', def);\n    },\n\n    /**\n     * Generates the d string of a feature part\n     * @param {L.Point[]} rings - The points making up a given part of a feature\n     * @param {boolean} closed - Whether a feature is closed or not\n     * @returns {string}\n     */\n    geometryToPath: function (rings, closed) {\n      let str = '',\n        i,\n        j,\n        len,\n        len2,\n        points,\n        p;\n\n      for (i = 0, len = rings.length; i < len; i++) {\n        points = rings[i];\n        if (points.length === 1) {\n          return this._pointToMarker(points[0]);\n        }\n        for (j = 0, len2 = points.length; j < len2; j++) {\n          p = points[j];\n          str += (j ? 'L' : 'M') + p.x + ' ' + p.y;\n        }\n        str += closed ? 'z' : '';\n      }\n      return str || 'M0 0';\n    }\n  });\n\n  /**\n   * Returns new M.FeatureRenderer\n   * @param {Object} options - Options for the renderer\n   * @returns {M.FeatureRenderer}\n   */\n  var featureRenderer = function (options) {\n    return new FeatureRenderer(options);\n  };\n\n  var FeatureGroup = L.FeatureGroup.extend({\n    /**\n     * Initialize the feature group\n     * @param {M.Feature[]} layers\n     * @param {Object} options\n     */\n    initialize: function (layers, options) {\n      if (options.wrappers && options.wrappers.length > 0)\n        options = Object.assign(\n          M.Feature.prototype._convertWrappers(options.wrappers),\n          options\n        );\n\n      L.LayerGroup.prototype.initialize.call(this, layers, options);\n      this._featureEl = this.options.mapmlFeature;\n\n      if (\n        (this.options.onEachFeature && this.options.properties) ||\n        this.options.link\n      ) {\n        L.DomUtil.addClass(this.options.group, 'leaflet-interactive');\n        let firstLayer = layers[Object.keys(layers)[0]];\n        if (layers.length === 1 && firstLayer.options.link)\n          this.options.link = firstLayer.options.link;\n        if (this.options.link) {\n          M.Feature.prototype.attachLinkHandler.call(\n            this,\n            this.options.group,\n            this.options.link,\n            this.options._leafletLayer\n          );\n          this.options.group.setAttribute('role', 'link');\n        } else {\n          this.options.group.setAttribute('aria-expanded', 'false');\n          this.options.group.setAttribute('role', 'button');\n          this.options.onEachFeature(this.options.properties, this);\n          this.off('click', this._openPopup);\n        }\n      }\n\n      L.DomEvent.on(this.options.group, 'keyup keydown', this._handleFocus, this);\n      this.options.group.setAttribute('aria-label', this.options.accessibleTitle);\n      if (this.options.featureID)\n        this.options.group.setAttribute('data-fid', this.options.featureID);\n      for (let feature of layers) {\n        feature._groupLayer = this;\n      }\n    },\n\n    onAdd: function (map) {\n      L.LayerGroup.prototype.onAdd.call(this, map);\n      this.updateInteraction();\n    },\n\n    updateInteraction: function () {\n      let map = this._map || this.options._leafletLayer._map;\n      if (this.options.onEachFeature || this.options.link)\n        map.featureIndex.addToIndex(\n          this,\n          this.getPCRSCenter(),\n          this.options.group\n        );\n\n      for (let layerID in this._layers) {\n        let layer = this._layers[layerID];\n        for (let part of layer._parts) {\n          if (layer.featureAttributes && layer.featureAttributes.tabindex)\n            map.featureIndex.addToIndex(layer, layer.getPCRSCenter(), part.path);\n          for (let subPart of part.subrings) {\n            if (subPart.attr && subPart.attr.tabindex)\n              map.featureIndex.addToIndex(layer, subPart.center, subPart.path);\n          }\n        }\n      }\n    },\n\n    /**\n     * Check whether the feature group should be rendered at current map zoom level\n     * @param {Number} zoom - current map zoom\n     * @param {Object} vectorMinZoom - the minimum zoom bound of vector layer\n     * @param {Object} vectorMinZoom - the maximum zoom bound of vector layer\n     * @returns {Boolean}\n     * @private\n     */\n    _checkRender: function (zoom, vectorMinZoom, vectorMaxZoom) {\n      let minZoom = this._featureEl.getAttribute('min'),\n        maxZoom = this._featureEl.getAttribute('max');\n      // if the current map zoom falls below/above the zoom bounds of the vector layer\n      if (zoom > vectorMaxZoom || zoom < vectorMinZoom) return false;\n      // if no min and max attribute present\n      if (minZoom === null && maxZoom === null) return true;\n      // if the current map zoom falls below/above the [min, max] range\n      if (\n        (minZoom !== null && zoom < +minZoom) ||\n        (maxZoom !== null && zoom > +maxZoom)\n      ) {\n        return false;\n      }\n      return true;\n    },\n\n    /**\n     * Handler for focus events\n     * @param {L.DOMEvent} e - Event that occurred\n     * @private\n     */\n    _handleFocus: function (e) {\n      // tab, shift, cr, esc, up, left, down, right,\n      if (\n        [9, 16, 27, 37, 38, 39, 40].includes(e.keyCode) &&\n        e.type === 'keydown'\n      ) {\n        let index = this._map.featureIndex.currentIndex;\n        // Down/right arrow keys replicate tabbing through the feature index\n        // Up/left arrow keys replicate shift-tabbing through the feature index\n        if (e.keyCode === 37 || e.keyCode === 38) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\n            'tabindex',\n            -1\n          );\n          if (index === 0) {\n            this._map.featureIndex.inBoundFeatures[\n              this._map.featureIndex.inBoundFeatures.length - 1\n            ].path.focus();\n            this._map.featureIndex.currentIndex =\n              this._map.featureIndex.inBoundFeatures.length - 1;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index - 1].path.focus();\n            this._map.featureIndex.currentIndex--;\n          }\n        } else if (e.keyCode === 39 || e.keyCode === 40) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\n            'tabindex',\n            -1\n          );\n          if (index === this._map.featureIndex.inBoundFeatures.length - 1) {\n            this._map.featureIndex.inBoundFeatures[0].path.focus();\n            this._map.featureIndex.currentIndex = 0;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index + 1].path.focus();\n            this._map.featureIndex.currentIndex++;\n          }\n        } else if (e.keyCode === 27) {\n          let shadowRoot = this._map.options.mapEl.shadowRoot\n            ? this._map.options.mapEl.shadowRoot\n            : this._map.options.mapEl.querySelector('.mapml-web-map').shadowRoot;\n          if (shadowRoot.activeElement.nodeName !== 'g') return;\n          this._map._container.focus();\n        } else if (e.keyCode === 9) {\n          let obj = this;\n          setTimeout(function () {\n            obj._map.featureIndex.inBoundFeatures[0].path.setAttribute(\n              'tabindex',\n              0\n            );\n          }, 0);\n        }\n        // tab, shift, cr, esc, right, left, up, down,\n        // 1, 2, 3, 4, 5, 6, 7 (featureIndexOverlay available index items\n        // [8, 9] being allocated to next, previous menu items).\n      } else if (\n        ![9, 16, 13, 27, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55].includes(\n          e.keyCode\n        )\n      ) {\n        this._map.featureIndex.currentIndex = 0;\n        this._map.featureIndex.inBoundFeatures[0].path.focus();\n      }\n\n      // 27 added so that the tooltip opens when dismissing popup with 'esc' key\n      if (e.target.tagName.toUpperCase() !== 'G') return;\n      if (\n        [9, 13, 16, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55, 27].includes(\n          e.keyCode\n        ) &&\n        e.type === 'keyup'\n      ) {\n        this.openTooltip();\n      } else if (e.keyCode === 13 || e.keyCode === 32) {\n        this.closeTooltip();\n        if (!this.options.link && this.options.onEachFeature) {\n          L.DomEvent.stop(e);\n          this.openPopup();\n        }\n      } else {\n        this.closeTooltip();\n      }\n    },\n\n    /**\n     * Add a M.Feature to the M.FeatureGroup\n     * @param layer\n     */\n    addLayer: function (layer) {\n      if (!layer.options.link && layer.options.interactive) {\n        this.options.onEachFeature(this.options.properties, layer);\n      }\n      L.FeatureGroup.prototype.addLayer.call(this, layer);\n    },\n\n    /**\n     * Focuses the previous function in the sequence on previous button press\n     * @param e\n     * @private\n     */\n    _previousFeature: function (e) {\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.max(\n        this._map.featureIndex.currentIndex - 1,\n        0\n      );\n      let prevFocus =\n        this._map.featureIndex.inBoundFeatures[\n          this._map.featureIndex.currentIndex\n        ];\n      prevFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    /**\n     * Focuses next feature in sequence\n     * @param e\n     * @private\n     */\n    _nextFeature: function (e) {\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.min(\n        this._map.featureIndex.currentIndex + 1,\n        this._map.featureIndex.inBoundFeatures.length - 1\n      );\n      let nextFocus =\n        this._map.featureIndex.inBoundFeatures[\n          this._map.featureIndex.currentIndex\n        ];\n      nextFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    getPCRSCenter: function () {\n      let bounds;\n      for (let l in this._layers) {\n        let layer = this._layers[l];\n        if (!bounds) {\n          bounds = L.bounds(layer.getPCRSCenter(), layer.getPCRSCenter());\n        } else {\n          bounds.extend(layer.getPCRSCenter());\n        }\n      }\n      return bounds.getCenter();\n    }\n  });\n\n  /**\n   * Returns new M.FeatureGroup\n   * @param {M.Feature[]} layers - Layers belonging to feature group\n   * @param {Object} options - Options for the feature group\n   * @returns {M.FeatureGroup}\n   */\n  var featureGroup = function (layers, options) {\n    return new FeatureGroup(layers, options);\n  };\n\n  var AnnounceMovement = L.Handler.extend({\n    addHooks: function () {\n      this._map.on({\n        layeradd: this.totalBounds,\n        layerremove: this.totalBounds\n      });\n\n      this._map.options.mapEl.addEventListener('moveend', this.announceBounds);\n      this._map.dragging._draggable.addEventListener('dragstart', this.dragged);\n      this._map.options.mapEl.addEventListener(\n        'mapfocused',\n        this.focusAnnouncement\n      );\n    },\n    removeHooks: function () {\n      this._map.off({\n        layeradd: this.totalBounds,\n        layerremove: this.totalBounds\n      });\n\n      this._map.options.mapEl.removeEventListener('moveend', this.announceBounds);\n      this._map.dragging._draggable.removeEventListener(\n        'dragstart',\n        this.dragged\n      );\n      this._map.options.mapEl.removeEventListener(\n        'mapfocused',\n        this.focusAnnouncement\n      );\n    },\n\n    focusAnnouncement: function () {\n      let mapEl = this;\n      setTimeout(function () {\n        let el = mapEl.querySelector('.mapml-web-map')\n          ? mapEl\n              .querySelector('.mapml-web-map')\n              .shadowRoot.querySelector('.leaflet-container')\n          : mapEl.shadowRoot.querySelector('.leaflet-container');\n\n        let mapZoom = mapEl._map.getZoom();\n        let location = M._gcrsToTileMatrix(mapEl);\n        let standard = M.options.locale.amZoom + ' ' + mapZoom;\n\n        if (mapZoom === mapEl._map._layersMaxZoom) {\n          standard = M.options.locale.amMaxZoom + ' ' + standard;\n        } else if (mapZoom === mapEl._map._layersMinZoom) {\n          standard = M.options.locale.amMinZoom + ' ' + standard;\n        }\n\n        el.setAttribute('aria-roledescription', 'region ' + standard);\n        setTimeout(function () {\n          el.removeAttribute('aria-roledescription');\n        }, 2000);\n      }, 0);\n    },\n\n    announceBounds: function () {\n      if (this._traversalCall > 0) {\n        return;\n      }\n      let mapZoom = this._map.getZoom();\n      let mapBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        mapZoom,\n        this._map.options.projection\n      );\n\n      let visible = true;\n      if (this._map.totalLayerBounds) {\n        visible =\n          mapZoom <= this._map._layersMaxZoom &&\n          mapZoom >= this._map._layersMinZoom &&\n          this._map.totalLayerBounds.overlaps(mapBounds);\n      }\n\n      let output = this.querySelector('.mapml-web-map')\n        ? this.querySelector('.mapml-web-map').shadowRoot.querySelector(\n            '.mapml-screen-reader-output'\n          )\n        : this.shadowRoot.querySelector('.mapml-screen-reader-output');\n\n      //GCRS to TileMatrix\n      let location = M._gcrsToTileMatrix(this);\n      let standard = M.options.locale.amZoom + ' ' + mapZoom;\n\n      if (!visible) {\n        let outOfBoundsPos = this._history[this._historyIndex];\n        let inBoundsPos = this._history[this._historyIndex - 1];\n        this.back();\n        this._history.pop();\n\n        if (outOfBoundsPos.zoom !== inBoundsPos.zoom) {\n          output.innerText = M.options.locale.amZoomedOut;\n        } else if (this._map.dragging._draggable.wasDragged) {\n          output.innerText = M.options.locale.amDraggedOut;\n        } else if (outOfBoundsPos.x > inBoundsPos.x) {\n          output.innerText = M.options.locale.amEastBound;\n        } else if (outOfBoundsPos.x < inBoundsPos.x) {\n          output.innerText = M.options.locale.amWestBound;\n        } else if (outOfBoundsPos.y < inBoundsPos.y) {\n          output.innerText = M.options.locale.amNorthBound;\n        } else if (outOfBoundsPos.y > inBoundsPos.y) {\n          output.innerText = M.options.locale.amSouthBound;\n        }\n      } else {\n        let prevZoom = this._history[this._historyIndex - 1]\n          ? this._history[this._historyIndex - 1].zoom\n          : this._history[this._historyIndex].zoom;\n        if (mapZoom === this._map._layersMaxZoom && mapZoom !== prevZoom) {\n          output.innerText = M.options.locale.amMaxZoom + ' ' + standard;\n        } else if (mapZoom === this._map._layersMinZoom && mapZoom !== prevZoom) {\n          output.innerText = M.options.locale.amMinZoom + ' ' + standard;\n        } else {\n          output.innerText = standard;\n        }\n      }\n      this._map.dragging._draggable.wasDragged = false;\n    },\n\n    totalBounds: function () {\n      let layers = Object.keys(this._layers);\n      let bounds = L.bounds();\n\n      layers.forEach((i) => {\n        if (this._layers[i].layerBounds) {\n          if (!bounds) {\n            let point = this._layers[i].layerBounds.getCenter();\n            bounds = L.bounds(point, point);\n          }\n          bounds.extend(this._layers[i].layerBounds.min);\n          bounds.extend(this._layers[i].layerBounds.max);\n        }\n      });\n\n      this.totalLayerBounds = bounds;\n    },\n\n    dragged: function () {\n      this.wasDragged = true;\n    }\n  });\n\n  var FeatureIndex = L.Handler.extend({\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n      this.inBoundFeatures = [];\n      this.outBoundFeatures = [];\n      this.currentIndex = 0;\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        map.getZoom(),\n        map.options.projection\n      );\n    },\n\n    addHooks: function () {\n      this._map.on('mapkeyboardfocused', this._updateMapBounds, this);\n      this._map.on('mapkeyboardfocused', this._sortIndex, this);\n    },\n\n    removeHooks: function () {\n      this._map.off('mapkeyboardfocused', this._updateMapBounds);\n      this._map.off('mapkeyboardfocused', this._sortIndex);\n    },\n\n    /**\n     * Adds a svg element to the index of tabbable features, it also keeps track of the layer it's associated + center\n     * @param layer - the layer object the feature is associated with\n     * @param lc - the layer center\n     * @param path - the svg element that needs to be focused, can be a path or g\n     */\n    addToIndex: function (layer, lc, path) {\n      let mc = this._mapPCRSBounds.getCenter();\n      let dist = Math.sqrt(Math.pow(lc.x - mc.x, 2) + Math.pow(lc.y - mc.y, 2));\n      let index = this._mapPCRSBounds.contains(lc)\n        ? this.inBoundFeatures\n        : this.outBoundFeatures;\n\n      let elem = { path: path, layer: layer, center: lc, dist: dist };\n      path.setAttribute('tabindex', -1);\n\n      index.push(elem);\n\n      // TODO: this insertion loop has potential to be improved slightly\n      for (\n        let i = index.length - 1;\n        i > 0 && index[i].dist < index[i - 1].dist;\n        i--\n      ) {\n        let tmp = index[i];\n        index[i] = index[i - 1];\n        index[i - 1] = tmp;\n      }\n\n      if (this._mapPCRSBounds.contains(lc)) this.inBoundFeatures = index;\n      else this.outBoundFeatures = index;\n    },\n\n    /**\n     * Removes features that are no longer on the map, also moves features to the respective array depending\n     * on whether the feature is in the maps viewport or not\n     */\n    cleanIndex: function () {\n      this.currentIndex = 0;\n      this.inBoundFeatures = this.inBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute('tabindex', -1);\n        if (elem.layer._map && !inbound) {\n          this.outBoundFeatures.push(elem);\n        }\n        return elem.layer._map && inbound;\n      });\n      this.outBoundFeatures = this.outBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute('tabindex', -1);\n        if (elem.layer._map && inbound) {\n          this.inBoundFeatures.push(elem);\n        }\n        return elem.layer._map && !inbound;\n      });\n    },\n\n    /**\n     * Sorts the index of features in the map's viewport based on distance from center\n     * @private\n     */\n    _sortIndex: function () {\n      this.cleanIndex();\n      if (this.inBoundFeatures.length === 0) return;\n\n      let mc = this._mapPCRSBounds.getCenter();\n\n      this.inBoundFeatures.sort(function (a, b) {\n        let ac = a.center;\n        let bc = b.center;\n        a.dist = Math.sqrt(Math.pow(ac.x - mc.x, 2) + Math.pow(ac.y - mc.y, 2));\n        b.dist = Math.sqrt(Math.pow(bc.x - mc.x, 2) + Math.pow(bc.y - mc.y, 2));\n        return a.dist - b.dist;\n      });\n      this.inBoundFeatures[0].path.setAttribute('tabindex', 0);\n    },\n\n    /**\n     * Event handler for 'mapfocused' event to update the map's bounds in terms of PCRS\n     * @param e - the event object\n     * @private\n     */\n    _updateMapBounds: function (e) {\n      // TODO: map's PCRS bounds is used in other parts of the viewer, can be moved out to the map object directly\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        this._map.getZoom(),\n        this._map.options.projection\n      );\n    }\n  });\n\n  var Options = {\n    featureIndexOverlayOption: false,\n    announceMovement: false,\n    announceScale: { metric: true, imperial: false },\n    defaultExtCoor: 'pcrs',\n    defaultLocCoor: 'gcrs',\n    locale: {\n      cmBack: 'Back',\n      cmForward: 'Forward',\n      cmReload: 'Reload',\n      cmToggleControls: 'Toggle Controls',\n      cmCopyCoords: 'Copy',\n      cmCopyMapML: 'Map',\n      cmCopyExtent: 'Extent',\n      cmCopyLocation: 'Location',\n      cmToggleDebug: 'Toggle Debug Mode',\n      cmPasteLayer: 'Paste',\n      cmViewSource: 'View Map Source',\n      lmZoomToLayer: 'Zoom To Layer',\n      lmCopyLayer: 'Copy Layer',\n      lcOpacity: 'Opacity',\n      btnAttribution: 'Map data attribution',\n      btnZoomIn: 'Zoom in',\n      btnZoomOut: 'Zoom out',\n      btnFullScreen: 'View Fullscreen',\n      btnExitFullScreen: 'Exit Fullscreen',\n      btnLocTrackOn: 'Show my location - location tracking on',\n      btnMyLocTrackOn: 'My current location, shown on map',\n      btnLocTrackOff: 'Show my location - location tracking off',\n      btnLocTrackLastKnown: 'Show my location - last known location shown',\n      btnMyLastKnownLocTrackOn: 'My last known location, shown on map',\n      amZoom: 'zoom level',\n      amColumn: 'column',\n      amRow: 'row',\n      amMaxZoom: 'At maximum zoom level, zoom in disabled',\n      amMinZoom: 'At minimum zoom level, zoom out disabled',\n      amZoomedOut: 'Zoomed out of bounds, returning to',\n      amDraggedOut: 'Dragged out of bounds, returning to',\n      amEastBound: 'Reached east bound, panning east disabled',\n      amWestBound: 'Reached west bound, panning west disabled',\n      amNorthBound: 'Reached north bound, panning north disabled',\n      amSouthBound: 'Reached south bound, panning south disabled',\n      kbdShortcuts: 'Keyboard shortcuts',\n      kbdMovement: 'Movement keys',\n      kbdFeature: 'Feature navigation keys',\n      kbdPanUp: 'Pan up',\n      kbdPanDown: 'Pan down',\n      kbdPanLeft: 'Pan left',\n      kbdPanRight: 'Pan right',\n      kbdPanIncrement: 'pan increment',\n      kbdZoom: 'Zoom in/out 3 levels',\n      kbdPrevFeature: 'Previous feature',\n      kbdNextFeature: 'Next feature',\n      dfLayer: 'Layer',\n      popupZoom: 'Zoom to here',\n      dfPastedLayer: 'Pasted layer'\n    }\n  };\n\n  L.Map.Keyboard.include({\n    _onKeyDown: function (e) {\n      if (e.altKey || e.metaKey) {\n        return;\n      }\n\n      let zoomIn = {\n        187: 187,\n        107: 107,\n        61: 61,\n        171: 171\n      };\n\n      let zoomOut = {\n        189: 189,\n        109: 109,\n        54: 54,\n        173: 173\n      };\n\n      var key = e.keyCode,\n        map = this._map,\n        offset;\n\n      if (key in this._panKeys) {\n        if (!map._panAnim || !map._panAnim._inProgress) {\n          offset = this._panKeys[key];\n          if (e.shiftKey) {\n            offset = L.point(offset).multiplyBy(3);\n          }\n          if (e.ctrlKey) {\n            offset = L.point(offset).divideBy(5);\n          }\n\n          map.panBy(offset);\n\n          if (map.options.maxBounds) {\n            map.panInsideBounds(map.options.maxBounds);\n          }\n        }\n      } else if (key in this._zoomKeys) {\n        if (\n          (key in zoomIn && map._layersMaxZoom !== map.getZoom()) ||\n          (key in zoomOut && map._layersMinZoom !== map.getZoom())\n        )\n          map.setZoom(map.getZoom() + (e.shiftKey ? 3 : 1) * this._zoomKeys[key]);\n      } else if (\n        key === 27 &&\n        map._popup &&\n        map._popup.options.closeOnEscapeKey\n      ) {\n        map.closePopup();\n      } else {\n        return;\n      }\n\n      L.DomEvent.stop(e);\n    }\n  });\n\n  var FeatureIndexOverlay = L.Layer.extend({\n    onAdd: function (map) {\n      let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><path fill=\"none\" stroke=\"#000\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"3\" d=\"M0 0h100v100H0z\" color=\"#000\" overflow=\"visible\"/></svg>`;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-feature-index-box',\n        map._container\n      );\n      this._container.innerHTML = svgInnerHTML;\n\n      this._output = L.DomUtil.create(\n        'output',\n        'mapml-feature-index',\n        map._container\n      );\n      this._output.setAttribute('role', 'status');\n      this._output.setAttribute('aria-live', 'polite');\n      this._output.setAttribute('aria-atomic', 'true');\n      this._body = L.DomUtil.create(\n        'span',\n        'mapml-feature-index-content',\n        this._output\n      );\n      this._body.index = 0;\n      this._output.initialFocus = false;\n      map.on(\n        'layerchange layeradd layerremove overlayremove',\n        this._toggleEvents,\n        this\n      );\n      map.on('moveend focus templatedfeatureslayeradd', this._checkOverlap, this);\n      map.on('keydown', this._onKeyDown, this);\n      this._addOrRemoveFeatureIndex();\n    },\n\n    _calculateReticleBounds: function () {\n      let bounds = this._map.getPixelBounds();\n      let center = bounds.getCenter();\n      let wRatio =\n        Math.abs(bounds.min.x - bounds.max.x) / this._map.options.mapEl.width;\n      let hRatio =\n        Math.abs(bounds.min.y - bounds.max.y) / this._map.options.mapEl.height;\n\n      let reticleDimension = getComputedStyle(this._container).width.replace(\n        /[^\\d.]/g,\n        ''\n      );\n      if (getComputedStyle(this._container).width.slice(-1) === '%') {\n        reticleDimension =\n          (reticleDimension * this._map.options.mapEl.width) / 100;\n      }\n      let w = (wRatio * reticleDimension) / 2;\n      let h = (hRatio * reticleDimension) / 2;\n      let minPoint = L.point(center.x - w, center.y + h);\n      let maxPoint = L.point(center.x + w, center.y - h);\n      let b = L.bounds(minPoint, maxPoint);\n      return M.pixelToPCRSBounds(\n        b,\n        this._map.getZoom(),\n        this._map.options.projection\n      );\n    },\n\n    _checkOverlap: function (e) {\n      if (e.type === 'focus') this._output.initialFocus = true;\n      if (!this._output.initialFocus) return;\n      if (this._output.popupClosed) {\n        this._output.popupClosed = false;\n        return;\n      }\n\n      this._map.fire('mapkeyboardfocused');\n\n      let featureIndexBounds = this._calculateReticleBounds();\n      let features = this._map.featureIndex.inBoundFeatures;\n      let index = 1;\n      let keys = Object.keys(features);\n      let body = this._body;\n\n      body.innerHTML = '';\n      body.index = 0;\n\n      body.allFeatures = [];\n      keys.forEach((i) => {\n        let layer = features[i].layer;\n        let layers = features[i].layer._layers;\n        let bounds = L.bounds();\n\n        if (layers) {\n          let keys = Object.keys(layers);\n          keys.forEach((j) => {\n            if (!bounds)\n              bounds = L.bounds(\n                layer._layers[j]._bounds.min,\n                layer._layers[j]._bounds.max\n              );\n            bounds.extend(layer._layers[j]._bounds.min);\n            bounds.extend(layer._layers[j]._bounds.max);\n          });\n        } else if (layer._bounds) {\n          bounds = L.bounds(layer._bounds.min, layer._bounds.max);\n        }\n\n        if (featureIndexBounds.overlaps(bounds)) {\n          let label = features[i].path.getAttribute('aria-label');\n\n          if (index < 8) {\n            body.appendChild(this._updateOutput(label, index, index));\n          }\n          if (index % 7 === 0 || index === 1) {\n            body.allFeatures.push([]);\n          }\n          body.allFeatures[Math.floor((index - 1) / 7)].push({\n            label,\n            index,\n            layer\n          });\n          if (body.allFeatures[1] && body.allFeatures[1].length === 1) {\n            body.appendChild(this._updateOutput('More results', 0, 9));\n          }\n          index += 1;\n        }\n      });\n      this._addToggleKeys();\n    },\n\n    _updateOutput: function (label, index, key) {\n      let span = document.createElement('span');\n      span.setAttribute('data-index', index);\n      //\", \" adds a brief auditory pause when a screen reader is reading through the feature index\n      //also prevents names with numbers + key from being combined when read\n      span.innerHTML = `<kbd>${key}</kbd>` + ' ' + label + '<span>, </span>';\n      return span;\n    },\n\n    _addToggleKeys: function () {\n      let allFeatures = this._body.allFeatures;\n      for (let i = 0; i < allFeatures.length; i++) {\n        if (allFeatures[i].length === 0) return;\n        if (allFeatures[i - 1]) {\n          let label = 'Previous results';\n          allFeatures[i].push({ label });\n        }\n\n        if (allFeatures[i + 1] && allFeatures[i + 1].length > 0) {\n          let label = 'More results';\n          allFeatures[i].push({ label });\n        }\n      }\n    },\n\n    _onKeyDown: function (e) {\n      let body = this._body;\n      let key = e.originalEvent.keyCode;\n      if (key >= 49 && key <= 55) {\n        if (!body.allFeatures[body.index]) return;\n        let feature = body.allFeatures[body.index][key - 49];\n        if (!feature) return;\n        let layer = feature.layer;\n        if (layer) {\n          this._map.featureIndex.currentIndex = feature.index - 1;\n          if (layer._popup) {\n            this._map.closePopup();\n            layer.openPopup();\n          } else layer.options.group.focus();\n        }\n      } else if (key === 56) {\n        this._newContent(body, -1);\n      } else if (key === 57) {\n        this._newContent(body, 1);\n      }\n    },\n\n    _newContent: function (body, direction) {\n      let index = body.firstChild.getAttribute('data-index');\n      let newContent = body.allFeatures[Math.floor((index - 1) / 7 + direction)];\n      if (newContent && newContent.length > 0) {\n        body.innerHTML = '';\n        body.index += direction;\n        for (let i = 0; i < newContent.length; i++) {\n          let feature = newContent[i];\n          let index = feature.index ? feature.index : 0;\n          let key = i + 1;\n          if (feature.label === 'More results') key = 9;\n          if (feature.label === 'Previous results') key = 8;\n          body.appendChild(this._updateOutput(feature.label, index, key));\n        }\n      }\n    },\n\n    _toggleEvents: function () {\n      this._map.on(\n        'viewreset move moveend focus blur popupclose',\n        this._addOrRemoveFeatureIndex,\n        this\n      );\n    },\n\n    _addOrRemoveFeatureIndex: function (e) {\n      let features = this._body.allFeatures ? this._body.allFeatures.length : 0;\n      //Toggle aria-hidden attribute so screen reader rereads the feature index on focus\n      if (!this._output.initialFocus) {\n        this._output.setAttribute('aria-hidden', 'true');\n      } else if (this._output.hasAttribute('aria-hidden')) {\n        let obj = this;\n        setTimeout(function () {\n          obj._output.removeAttribute('aria-hidden');\n        }, 100);\n      }\n\n      if (e && e.type === 'popupclose') {\n        this._output.setAttribute('aria-hidden', 'true');\n        this._output.popupClosed = true;\n      } else if (e && e.type === 'focus') {\n        this._container.removeAttribute('hidden');\n        if (features !== 0)\n          this._output.classList.remove('mapml-screen-reader-output');\n      } else if (e && e.originalEvent && e.originalEvent.type === 'pointermove') {\n        this._container.setAttribute('hidden', '');\n        this._output.classList.add('mapml-screen-reader-output');\n      } else if (e && e.target._popup) {\n        this._container.setAttribute('hidden', '');\n      } else if (e && e.type === 'blur') {\n        this._container.setAttribute('hidden', '');\n        this._output.classList.add('mapml-screen-reader-output');\n        this._output.initialFocus = false;\n        this._addOrRemoveFeatureIndex();\n      } else if (this._map.isFocused && e) {\n        this._container.removeAttribute('hidden');\n        if (features !== 0) {\n          this._output.classList.remove('mapml-screen-reader-output');\n        } else {\n          this._output.classList.add('mapml-screen-reader-output');\n        }\n      } else {\n        this._container.setAttribute('hidden', '');\n        this._output.classList.add('mapml-screen-reader-output');\n      }\n    }\n  });\n\n  var featureIndexOverlay = function (options) {\n    return new FeatureIndexOverlay(options);\n  };\n\n  /*\n   * Copyright 2015-2016 Canada Centre for Mapping and Earth Observation,\n   * Earth Sciences Sector, Natural Resources Canada.\n   *\n   * License\n   *\n   * By obtaining and/or copying this work, you (the licensee) agree that you have\n   * read, understood, and will comply with the following terms and conditions.\n   *\n   * Permission to copy, modify, and distribute this work, with or without\n   * modification, for any purpose and without fee or royalty is hereby granted,\n   * provided that you include the following on ALL copies of the work or portions\n   * thereof, including modifications:\n   *\n   * The full text of this NOTICE in a location viewable to users of the\n   * redistributed or derivative work.\n   *\n   * Any pre-existing intellectual property disclaimers, notices, or terms and\n   * conditions. If none exist, the W3C Software and Document Short Notice should\n   * be included.\n   *\n   * Notice of any changes or modifications, through a copyright statement on the\n   * new code or document such as \"This software or document includes material\n   * copied from or derived from [title and URI of the W3C document].\n   * Copyright  [YEAR] W3C (MIT, ERCIM, Keio, Beihang).\"\n   *\n   * Disclaimers\n   *\n   * THIS WORK IS PROVIDED \"AS IS,\" AND COPYRIGHT HOLDERS MAKE NO REPRESENTATIONS\n   * OR WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO, WARRANTIES OF\n   * MERCHANTABILITY OR FITNESS FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF THE\n   * SOFTWARE OR DOCUMENT WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS,\n   * TRADEMARKS OR OTHER RIGHTS.\n   * COPYRIGHT HOLDERS WILL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL OR\n   * CONSEQUENTIAL DAMAGES ARISING OUT OF ANY USE OF THE SOFTWARE OR DOCUMENT.\n   *\n   * The name and trademarks of copyright holders may NOT be used in advertising or\n   * publicity pertaining to the work without specific, written prior permission.\n   * Title to copyright in this work will at all times remain with copyright holders.\n   */\n\n  /* global L, Node */\n  (function (window, document, undefined$1) {\n    var M = {};\n    window.M = M;\n\n    (function () {\n      M.detectImagePath = function (container) {\n        // this relies on the CSS style leaflet-default-icon-path containing a\n        // relative url() that leads to a valid icon file.  Since that depends on\n        // how all of this stuff is deployed (i.e. custom element or as leaflet-plugin)\n        // also, because we're using 'shady DOM' api, the container must be\n        // a shady dom container, because the custom element tags it with added\n        // style-scope ... and related classes.\n        var el = L.DomUtil.create('div', 'leaflet-default-icon-path', container);\n        var path =\n          L.DomUtil.getStyle(el, 'background-image') ||\n          L.DomUtil.getStyle(el, 'backgroundImage'); // IE8\n\n        container.removeChild(el);\n\n        if (path === null || path.indexOf('url') !== 0) {\n          path = '';\n        } else {\n          path = path\n            .replace(/^url\\([\"']?/, '')\n            .replace(/marker-icon\\.png[\"']?\\)$/, '');\n        }\n\n        return path;\n      };\n      M.mime = 'text/mapml';\n\n      let mapOptions = window.document.head.querySelector('map-options');\n      M.options = Options;\n      if (mapOptions)\n        M.options = Object.assign(M.options, JSON.parse(mapOptions.innerHTML));\n\n      // see https://leafletjs.com/reference-1.5.0.html#crs-l-crs-base\n      // \"new classes can't inherit from (L.CRS), and methods can't be added\n      // to (L.CRS.anything) with the include function\n      // so we'll use the options property as a way to integrate needed\n      // properties and methods...\n      M.WGS84 = new L.Proj.CRS(\n        'EPSG:4326',\n        '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ',\n        {\n          origin: [-180, +90],\n          bounds: L.bounds([\n            [-180, -90],\n            [180, 90]\n          ]),\n          resolutions: [\n            0.703125, 0.3515625, 0.17578125, 0.087890625, 0.0439453125,\n            0.02197265625, 0.010986328125, 0.0054931640625, 0.00274658203125,\n            0.001373291015625, 0.0006866455078125, 0.0003433227539062,\n            0.0001716613769531, 0.0000858306884766, 0.0000429153442383,\n            0.0000214576721191, 0.0000107288360596, 0.0000053644180298,\n            0.0000026822090149, 0.0000013411045074, 0.0000006705522537,\n            0.0000003352761269\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.bounds.getSize().x /\n                      M.WGS84.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.bounds.getSize().y /\n                      M.WGS84.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.WGS84.options.crs.tcrs.horizontal.min,\n                    M.WGS84.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tcrs.horizontal.max(zoom),\n                    M.WGS84.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'longitude',\n                get min() {\n                  return M.WGS84.options.crs.gcrs.horizontal.min;\n                },\n                get max() {\n                  return M.WGS84.options.crs.gcrs.horizontal.max;\n                }\n              },\n              vertical: {\n                name: 'latitude',\n                get min() {\n                  return M.WGS84.options.crs.gcrs.vertical.min;\n                },\n                get max() {\n                  return M.WGS84.options.crs.gcrs.vertical.max;\n                }\n              },\n              get bounds() {\n                return M.WGS84.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -180.0,\n                max: 180.0\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -90.0,\n                max: 90.0\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.WGS84.options.crs.gcrs.vertical.min,\n                    M.WGS84.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.WGS84.options.crs.gcrs.vertical.max,\n                    M.WGS84.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.WGS84.options.crs.tile.horizontal.min,\n                    M.WGS84.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tile.horizontal.max,\n                    M.WGS84.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.crs.tcrs.horizontal.max(zoom) /\n                      M.WGS84.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.crs.tcrs.vertical.max(zoom) /\n                      M.WGS84.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.WGS84.options.crs.tilematrix.horizontal.min,\n                    M.WGS84.options.crs.tilematrix.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tilematrix.horizontal.max(zoom),\n                    M.WGS84.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.CBMTILE = new L.Proj.CRS(\n        'EPSG:3978',\n        '+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\n        {\n          origin: [-34655800, 39310000],\n          bounds: L.bounds([\n            [-34655800, -39000000],\n            [10000000, 39310000]\n          ]),\n          resolutions: [\n            38364.660062653464, 22489.62831258996, 13229.193125052918,\n            7937.5158750317505, 4630.2175937685215, 2645.8386250105837,\n            1587.5031750063501, 926.0435187537042, 529.1677250021168,\n            317.50063500127004, 185.20870375074085, 111.12522225044451,\n            66.1459656252646, 38.36466006265346, 22.48962831258996,\n            13.229193125052918, 7.9375158750317505, 4.6302175937685215,\n            2.6458386250105836, 1.5875031750063502, 0.92604351875370428,\n            0.52916772500211673, 0.31750063500127002, 0.18520870375074083,\n            0.11112522225044451, 0.066145965625264591\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.bounds.getSize().x /\n                      M.CBMTILE.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.bounds.getSize().y /\n                      M.CBMTILE.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.CBMTILE.options.crs.tcrs.horizontal.min,\n                    M.CBMTILE.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.tcrs.horizontal.max(zoom),\n                    M.CBMTILE.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'easting',\n                get min() {\n                  return M.CBMTILE.options.bounds.min.x;\n                },\n                get max() {\n                  return M.CBMTILE.options.bounds.max.x;\n                }\n              },\n              vertical: {\n                name: 'northing',\n                get min() {\n                  return M.CBMTILE.options.bounds.min.y;\n                },\n                get max() {\n                  return M.CBMTILE.options.bounds.max.y;\n                }\n              },\n              get bounds() {\n                return M.CBMTILE.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -141.01,\n                max: -47.74\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: 40.04,\n                max: 86.46\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.CBMTILE.options.crs.gcrs.vertical.min,\n                    M.CBMTILE.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.gcrs.vertical.max,\n                    M.CBMTILE.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.CBMTILE.options.crs.tile.horizontal.min,\n                    M.CBMTILE.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.tile.horizontal.max,\n                    M.CBMTILE.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.crs.tcrs.horizontal.max(zoom) /\n                      M.CBMTILE.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.crs.tcrs.vertical.max(zoom) /\n                      M.CBMTILE.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [0, 0],\n                  [\n                    M.CBMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.CBMTILE.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.APSTILE = new L.Proj.CRS(\n        'EPSG:5936',\n        '+proj=stere +lat_0=90 +lat_ts=50 +lon_0=-150 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m +no_defs',\n        {\n          origin: [-2.8567784109255e7, 3.2567784109255e7],\n          bounds: L.bounds([\n            [-28567784.109254867, -28567784.109254755],\n            [32567784.109255023, 32567784.10925506]\n          ]),\n          resolutions: [\n            238810.813354, 119405.406677, 59702.7033384999, 29851.3516692501,\n            14925.675834625, 7462.83791731252, 3731.41895865639, 1865.70947932806,\n            932.854739664032, 466.427369832148, 233.213684916074,\n            116.606842458037, 58.3034212288862, 29.1517106145754,\n            14.5758553072877, 7.28792765351156, 3.64396382688807,\n            1.82198191331174, 0.910990956788164, 0.45549547826179\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.bounds.getSize().x /\n                      M.APSTILE.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.bounds.getSize().y /\n                      M.APSTILE.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.APSTILE.options.crs.tcrs.horizontal.min,\n                    M.APSTILE.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.tcrs.horizontal.max(zoom),\n                    M.APSTILE.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'easting',\n                get min() {\n                  return M.APSTILE.options.bounds.min.x;\n                },\n                get max() {\n                  return M.APSTILE.options.bounds.max.x;\n                }\n              },\n              vertical: {\n                name: 'northing',\n                get min() {\n                  return M.APSTILE.options.bounds.min.y;\n                },\n                get max() {\n                  return M.APSTILE.options.bounds.max.y;\n                }\n              },\n              get bounds() {\n                return M.APSTILE.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -180.0,\n                max: 180.0\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: 60.0,\n                max: 90.0\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.APSTILE.options.crs.gcrs.vertical.min,\n                    M.APSTILE.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.gcrs.vertical.max,\n                    M.APSTILE.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.APSTILE.options.crs.tile.horizontal.min,\n                    M.APSTILE.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.tile.horizontal.max,\n                    M.APSTILE.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.crs.tcrs.horizontal.max(zoom) /\n                      M.APSTILE.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.crs.tcrs.vertical.max(zoom) /\n                      M.APSTILE.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [0, 0],\n                  [\n                    M.APSTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.APSTILE.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.OSMTILE = L.CRS.EPSG3857;\n      L.setOptions(M.OSMTILE, {\n        origin: [-20037508.342787, 20037508.342787],\n        bounds: L.bounds([\n          [-20037508.342787, -20037508.342787],\n          [20037508.342787, 20037508.342787]\n        ]),\n        resolutions: [\n          156543.0339, 78271.51695, 39135.758475, 19567.8792375, 9783.93961875,\n          4891.969809375, 2445.9849046875, 1222.9924523438, 611.49622617188,\n          305.74811308594, 152.87405654297, 76.437028271484, 38.218514135742,\n          19.109257067871, 9.5546285339355, 4.7773142669678, 2.3886571334839,\n          1.1943285667419, 0.59716428337097, 0.29858214168549, 0.14929107084274,\n          0.074645535421371, 0.03732276771068573, 0.018661383855342865,\n          0.009330691927671432495\n        ],\n        crs: {\n          tcrs: {\n            horizontal: {\n              name: 'x',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.bounds.getSize().x /\n                    M.OSMTILE.options.resolutions[zoom]\n                )\n            },\n            vertical: {\n              name: 'y',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.bounds.getSize().y /\n                    M.OSMTILE.options.resolutions[zoom]\n                )\n            },\n            bounds: (zoom) =>\n              L.bounds(\n                [\n                  M.OSMTILE.options.crs.tcrs.horizontal.min,\n                  M.OSMTILE.options.crs.tcrs.vertical.min\n                ],\n                [\n                  M.OSMTILE.options.crs.tcrs.horizontal.max(zoom),\n                  M.OSMTILE.options.crs.tcrs.vertical.max(zoom)\n                ]\n              )\n          },\n          pcrs: {\n            horizontal: {\n              name: 'easting',\n              get min() {\n                return M.OSMTILE.options.bounds.min.x;\n              },\n              get max() {\n                return M.OSMTILE.options.bounds.max.x;\n              }\n            },\n            vertical: {\n              name: 'northing',\n              get min() {\n                return M.OSMTILE.options.bounds.min.y;\n              },\n              get max() {\n                return M.OSMTILE.options.bounds.max.y;\n              }\n            },\n            get bounds() {\n              return M.OSMTILE.options.bounds;\n            }\n          },\n          gcrs: {\n            horizontal: {\n              name: 'longitude',\n              get min() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lng;\n              },\n              get max() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lng;\n              }\n            },\n            vertical: {\n              name: 'latitude',\n              get min() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lat;\n              },\n              get max() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lat;\n              }\n            },\n            get bounds() {\n              return L.latLngBounds(\n                [\n                  M.OSMTILE.options.crs.gcrs.vertical.min,\n                  M.OSMTILE.options.crs.gcrs.horizontal.min\n                ],\n                [\n                  M.OSMTILE.options.crs.gcrs.vertical.max,\n                  M.OSMTILE.options.crs.gcrs.horizontal.max\n                ]\n              );\n            }\n          },\n          map: {\n            horizontal: {\n              name: 'i',\n              min: 0,\n              max: (map) => map.getSize().x\n            },\n            vertical: {\n              name: 'j',\n              min: 0,\n              max: (map) => map.getSize().y\n            },\n            bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n          },\n          tile: {\n            horizontal: {\n              name: 'i',\n              min: 0,\n              max: 256\n            },\n            vertical: {\n              name: 'j',\n              min: 0,\n              max: 256\n            },\n            get bounds() {\n              return L.bounds(\n                [\n                  M.OSMTILE.options.crs.tile.horizontal.min,\n                  M.OSMTILE.options.crs.tile.vertical.min\n                ],\n                [\n                  M.OSMTILE.options.crs.tile.horizontal.max,\n                  M.OSMTILE.options.crs.tile.vertical.max\n                ]\n              );\n            }\n          },\n          tilematrix: {\n            horizontal: {\n              name: 'column',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.crs.tcrs.horizontal.max(zoom) /\n                    M.OSMTILE.options.crs.tile.bounds.getSize().x\n                )\n            },\n            vertical: {\n              name: 'row',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.crs.tcrs.vertical.max(zoom) /\n                    M.OSMTILE.options.crs.tile.bounds.getSize().y\n                )\n            },\n            bounds: (zoom) =>\n              L.bounds(\n                [0, 0],\n                [\n                  M.OSMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                  M.OSMTILE.options.crs.tilematrix.vertical.max(zoom)\n                ]\n              )\n          }\n        }\n      });\n    })();\n\n    M._handleLink = Util._handleLink;\n    M.convertPCRSBounds = Util.convertPCRSBounds;\n    M.axisToXY = Util.axisToXY;\n    M.csToAxes = Util.csToAxes;\n    M._convertAndFormatPCRS = Util._convertAndFormatPCRS;\n    M.axisToCS = Util.axisToCS;\n    M._parseNumber = Util._parseNumber;\n    M._extractInputBounds = Util._extractInputBounds;\n    M._splitCoordinate = Util._splitCoordinate;\n    M.boundsToPCRSBounds = Util.boundsToPCRSBounds;\n    M.pixelToPCRSBounds = Util.pixelToPCRSBounds;\n    M._metaContentToObject = Util._metaContentToObject;\n    M._coordsToArray = Util._coordsToArray;\n    M._parseStylesheetAsHTML = Util._parseStylesheetAsHTML;\n    M.pointToPCRSPoint = Util.pointToPCRSPoint;\n    M.pixelToPCRSPoint = Util.pixelToPCRSPoint;\n    M._gcrsToTileMatrix = Util._gcrsToTileMatrix;\n    M._pasteLayer = Util._pasteLayer;\n    M._properties2Table = Util._properties2Table;\n    M._updateExtent = Util._updateExtent;\n    M.geojson2mapml = Util.geojson2mapml;\n    M._breakArray = Util._breakArray;\n    M._table2properties = Util._table2properties;\n    M._geometry2geojson = Util._geometry2geojson;\n    M._pcrsToGcrs = Util._pcrsToGcrs;\n    M.mapml2geojson = Util.mapml2geojson;\n    M.getMaxZoom = Util.getMaxZoom;\n\n    M.QueryHandler = QueryHandler;\n    M.ContextMenu = ContextMenu;\n    M.AnnounceMovement = AnnounceMovement;\n    M.FeatureIndex = FeatureIndex;\n\n    // see https://leafletjs.com/examples/extending/extending-3-controls.html#handlers\n    L.Map.addInitHook('addHandler', 'query', M.QueryHandler);\n    L.Map.addInitHook('addHandler', 'contextMenu', M.ContextMenu);\n    L.Map.addInitHook('addHandler', 'announceMovement', M.AnnounceMovement);\n    L.Map.addInitHook('addHandler', 'featureIndex', M.FeatureIndex);\n\n    M.MapMLLayer = MapMLLayer;\n    M.mapMLLayer = mapMLLayer;\n\n    M.ImageLayer = ImageLayer;\n    M.imageLayer = imageLayer;\n\n    M.TemplatedImageLayer = TemplatedImageLayer;\n    M.templatedImageLayer = templatedImageLayer;\n\n    M.TemplatedFeaturesLayer = TemplatedFeaturesLayer;\n    M.templatedFeaturesLayer = templatedFeaturesLayer;\n\n    M.TemplatedLayer = TemplatedLayer;\n    M.templatedLayer = templatedLayer;\n\n    M.TemplatedTileLayer = TemplatedTileLayer;\n    M.templatedTileLayer = templatedTileLayer;\n\n    M.FeatureLayer = FeatureLayer;\n    M.featureLayer = featureLayer;\n\n    M.LayerControl = LayerControl;\n    M.layerControl = layerControl;\n\n    M.AttributionButton = AttributionButton;\n    M.attributionButton = attributionButton;\n\n    M.ReloadButton = ReloadButton;\n    M.reloadButton = reloadButton;\n\n    M.ScaleBar = ScaleBar;\n    M.scaleBar = scaleBar;\n\n    M.FullscreenButton = FullscreenButton;\n    M.fullscreenButton = fullscreenButton;\n\n    M.geolocationButton = geolocationButton;\n\n    M.StaticTileLayer = StaticTileLayer;\n    M.staticTileLayer = staticTileLayer;\n\n    M.DebugOverlay = DebugOverlay;\n    M.debugOverlay = debugOverlay;\n\n    M.Crosshair = Crosshair;\n    M.crosshair = crosshair;\n\n    M.FeatureIndexOverlay = FeatureIndexOverlay;\n    M.featureIndexOverlay = featureIndexOverlay;\n\n    M.Feature = Feature;\n    M.feature = feature;\n\n    M.FeatureRenderer = FeatureRenderer;\n    M.featureRenderer = featureRenderer;\n\n    M.FeatureGroup = FeatureGroup;\n    M.featureGroup = featureGroup;\n  })(window);\n\n}());\n"],"names":["staticTileLayer","options","StaticTileLayer","layerControl","layers","LayerControl","L","GridLayer","extend","initialize","this","zoomBounds","_getZoomBounds","tileContainer","maxZoomBound","setOptions","_groups","_groupTiles","getElementsByTagName","onAdd","_bounds","_getLayerBounds","_map","projection","layerBounds","Object","keys","let","key","min","max","prototype","call","_handleMoveEnd","getEvents","events","_parentOnMoveEnd","moveend","move","e","mapZoom","getZoom","zoomLevel","maxNativeZoom","minNativeZoom","isVisible","maxZoom","minZoom","overlaps","M","pixelToPCRSBounds","getPixelBounds","_isValidTile","coords","_tileCoordsToKey","createTile","tileGroup","tileElem","document","createElement","tileSize","getTileSize","setAttribute","x","y","z","i","length","tile","width","height","alt","src","appendChild","tileGroups","crs","bounds","sCoords","split","pixelCoords","point","pixelBounds","zoom","container","meta","_metaContentToObject","getAttribute","tiles","nativeZoom","value","lZoom","Math","tileMap","row","col","tileCode","push","Control","Layers","autoZIndex","sortLayers","sortFunction","layerA","layerB","zIndex","overlays","_layerControlInputs","_layers","_lastZIndex","_handlingClick","_addLayer","_initLayout","on","_validateInput","DomEvent","mapEl","_container","_focusFirstLayer","_preventDefaultContextMenu","_update","_showControls","onRemove","map","off","layer","_onLayerChange","addOrUpdateOverlay","name","alreadyThere","addOverlay","removeAttribute","removeLayer","input","labels","label","checked","_layerEl","disabled","closest","style","fontStyle","_extent","_mapExtents","j","extentAnatomy","getElementsByClassName","elem","className","children","setTimeout","focus","_withinZoomBounds","range","_addItem","obj","layercontrols","getLayerUserControlsHTML","querySelector","layerId","stamp","_onInputClick","_overlaysList","collapse","target","tagName","relatedTarget","parentElement","contextMenu","_layerMenu","display","DomUtil","removeClass","originalEvent","pointerType","_isExpanded","latlng","mouseEventToLatLng","containerPoint","mouseEventToContainerPoint","preventDefault","fire","FALLBACK_PROJECTION","FALLBACK_CS","BLANK_TT_TREF","featureLayer","mapml","FeatureLayer","templatedTileLayer","template","TemplatedTileLayer","templatedLayer","templates","TemplatedLayer","templatedFeaturesLayer","TemplatedFeaturesLayer","templatedImageLayer","TemplatedImageLayer","imageLayer","url","location","size","angle","ImageLayer","mapMLLayer","node","MapMLLayer","debugOverlay","DebugOverlay","FeatureGroup","native","static","create","pane","addClass","renderer","query","_mapmlFeatures","features","_getNativeVariables","nativeCS","cs","_features","_staticFeature","addData","_resetFeatures","_leafletLayer","_addZoomLimit","showPaginationFeature","remove","featureIndex","cleanIndex","zoomend","_handleZoomEnd","feature","type","_extentEl","shadowRoot","replaceChildren","clearLayers","_featureGroup","popup","_navigationBar","innerText","_totalFeatureCount","_content","srcdoc","innerHTML","currFeature","once","mapmlEl","content","withinZoom","_removeCSS","toUpperCase","metaKeys","includes","axisToCS","axes","csToAxes","boundsToPCRSBounds","error","tilematrix","k","checkRender","_checkRender","addLayer","_setZoomTransform","center","clampZoom","scale","getZoomScale","translate","multiplyBy","subtract","_getNewPixelOrigin","round","any3d","setTransform","setPosition","nMin","nMax","querySelectorAll","resolutions","len","nodeType","Node","DOCUMENT_NODE","nodeName","base","hasAttribute","URL","href","_parseStylesheetAsHTML","_DOMnode","cloneNode","filter","classList","title","properties","add","insertAdjacentHTML","geometryToLayer","color","defaultOptions","resetStyle","onEachFeature","bindTooltip","interactive","sticky","featureZoom","_groupEl","group","Util","_setLayerStyle","setStyle","eachLayer","toDelete","removeChild","vectorOptions","geometry","svgGroup","SVG","copyOptions","assign","geo","featureID","id","wrappers","_getGeometryParents","groupOptions","mapmlFeature","accessibleTitle","collections","featureGroup","subType","elems","concat","TileLayer","inputData","_extractInputBounds","extentBounds","tms","opacity","_setUpTileTemplateVars","_template","_initContainer","_updateZIndex","mapBounds","linkEl","dispatchEvent","CustomEvent","detail","appendTile","startsWith","_url","_fetchTile","_mapmlTileReady","getPane","fetch","getTileUrl","redirect","then","response","status","Promise","resolve","console","log","reject","text","DOMParser","parseFromString","_createFeatures","catch","markup","svg","g","xOffset","yOffset","groupID","tileFeatures","FeatureRenderer","_initPath","_project","_addPath","_updateFeature","toString","contains","v","zoomInput","_getZoomForUrl","pcrs","easting","left","_tileMatrixToPCRSPosition","right","northing","top","bottom","indexOf","infinite","invertedY","_globalTileRange","r","detectRetina","Browser","retina","pos","nwPoint","scaleBy","sePoint","centrePoint","floor","nw","transformation","untransform","se","cen","result","Point","east","north","inputs","values","units","axis","position","select","toLowerCase","horizontal","isNaN","Number","parseFloat","vertical","match","parseInt","parsedselect","htmlselect","pcrs2tilematrix","c","transform","divideBy","bind","pcrsBounds","zmin","zmax","_clampZoom","clamp","step","Layer","_templates","rel","setZIndex","extentZIndex","errorTileUrl","hasSetBoundsHandler","_queries","extentEl","_setupQueryVars","zoomstart","_onZoomStart","redraw","closePopup","queryVarNames","pixelleft","tileleft","mapleft","pixelright","tileright","mapright","pixeltop","tiletop","maptop","pixelbottom","tilebottom","mapbottom","tilei","mapi","tilej","mapj","reset","addToMap","hasLayer","old_templates","undefined","_previousFeature","_count","_nextFeature","_source","changeOpacity","_setUpFeaturesTemplateVars","_onMoveEnd","featureRenderer","bindPopup","autoClose","minWidth","parent","parentNode","history","_history","current","previous","steppedZoom","headers","parser","context","_pullFeatureFeed","scaleBounds","getCenter","_getfeaturesUrl","Headers","Accept","limit","el","_nativeZoom","_nativeCS","append","_updateTabIndex","layerNum","_path","childElementCount","getSize","_TCRSToPCRS","featuresVarNames","hidden","_setUpExtentTemplateVars","_clearLayer","_onAdd","containerImages","_addImage","loc","overlayToRemove","_imageOverlay","getImageUrl","_step","addTo","_overlayToRemove","_scaleImage","_image","_pixelOrigins","getPixelOrigin","pixelOrigin","_removeZoomLimit","extent","extentVarNames","ImageOverlay","_location","_size","_angle","viewreset","_reset","_zoomAnimated","zoomanim","_animateZoom","load","_onImageLoad","_initImage","addInteractiveTarget","removeInteractiveTarget","loaded","Date","_updateOpacity","image","nextFrame","fade","now","setOpacity","cancelAnimFrame","_fadeFrame","requestAnimFrame","maxNext","_href","_imageContainer","_mapmlTileContainer","_title","_initialize","_validateExtent","validProjection","_mapmlLayerItem","getHref","_removeExtents","_changeOpacity","opacityEl","_changeExtentOpacity","_templateVars","_changeExtent","_setLayerElExtent","stopPropagation","setName","newName","_titleIsReadOnly","getName","_validProjection","_mapmlvectors","_imageLayer","layerGroup","_staticTileLayer","createAndAdd","_templatedLayer","_attachSkipButtons","noLayer","projectionMatch","getProjection","zoomMax","zoomMin","forEach","tempExtentBounds","extentZoomBounds","_convertAndFormatPCRS","_onZoomAnim","toZoom","getMinZoom","getMaxZoom","zoomout","zoomin","getAttribution","attribution","getLayerExtentHTML","labelName","extentProperties","extentSettings","extentLabel","svgExtentControlIcon","extentControlPath1","extentControlPath2","extentNameIcon","extentItemControls","opacityControl","extentOpacitySummary","layerEl","removeExtentButton","stop","allRemoved","removed","_layerItemSettingsHTML","_extentGroupAnatomy","extentsettingsButton","opacityValue","extentItemNameSpan","defaultChecked","ontouchstart","onmousedown","downEvent","TouchEvent","touches","control","controls","moving","yPos","clientY","body","ontouchmove","onmousemove","moveEvent","offset","abs","getBoundingClientRect","pointerEvents","clientX","root","elementAt","elementFromPoint","swapControl","offsetHeight","nextSibling","insertBefore","ontouchend","onmouseup","controlsElems","insertAdjacentElement","fieldset","layerItemName","settingsButtonNameIcon","layerItemProperty","layerItemSettings","itemToggleLabel","layerItemControls","opacityControlSummary","svgSettingsControlIcon","settingsControlPath1","settingsControlPath2","extentsFieldset","removeControlButton","nextElementSibling","disbaled","previousElementSibling","firstElementChild","itemSettingControlButton","_layerControl","_legendUrl","legendLink","draggable","_layer","_styles","_userInputs","frag","createDocumentFragment","selectdetails","selectsummary","mapmlInput","selectSummaryLabel","allHidden","xhr","fCallback","_initTemplateVars","serverExtent","metaExtent","templateVars","tlist","varNamesRe","RegExp","includesZoom","extentFallback","t","vcount","trel","ttype","exec","div","varName","inp","axisBounds","convertPCRSBounds","axisToXY","outerHTML","element","elementAttrNames","getAttributeNames","option","optionAttrNames","transcribe","queryable","decodeURI","extentPCRSFallback","_processInitialExtent","responseXML","responseText","readyState","DONE","textContent","trim","Element","serverMeta","mapprojection","selectedAlternate","baseURI","responseURL","_parseLicenseAndLegend","newTiles","nt","importNode","extentElement","styleLinks","stylesControl","stylesControlSummary","changeStyle","styleOption","styleOptionInput","styleOptionLabel","attributionControl","addAttribution","elements","resolvedURL","baseURL","_toggleControls","bubbles","XMLHttpRequest","onreadystatechange","abort","onload","onerror","open","setRequestHeader","mime","overrideMimeType","send","lp","OSMTILE","xml","attText","licenseLink","licenseTitle","getQueryTemplates","pcrsClick","layerAndExtents","queryTemplate","_eventParents","attachZoomLink","mapFocusButton","_sortIndex","previousButton","featureCount","totalFeatures","nextButton","controlFocusButton","currentIndex","inBoundFeatures","path","_controlContainer","divider","focusFeature","focusEvent","composedPath","isTab","keyCode","shiftPressed","shiftKey","focusMap","_popupClosed","featureEl","_groupLayer","_featureEl","tL","topLeft","gcrs","bR","bottomRight","latLngBounds","latLng","zoomLink","lng","lat","locale","popupZoom","onclick","onkeydown","MouseEvent","zoomTo","featureIndexOverlayOption","removeHandlers","removeEvent","mapSize","_panel","debugPanel","_grid","debugGrid","_panes","mapPane","_vectors","debugVectors","toolPane","DebugPanel","debug","_infoContainer","_debugContainer","infoContainer","_tileCoord","_tileMatrixCoord","_mapCoord","_tcrsCoord","_pcrsCoord","_gcrsCoord","_updateCoords","_visible","project","pointI","pointJ","trunc","toFixed","DebugGrid","join","outline","DebugVectors","LayerGroup","_mapLayerUpdate","_centerVector","circle","pointToLatLng","radius","_addBounds","colors","boundsArray","boundsRect","projectedExtent","weight","fillOpacity","fill","totalLayerBounds","totalBoundsArray","totalBounds","ProjectedExtent","Path","unproject","_locations","locations","_rings","_subtract","_parts","_renderer","_updatePoly","QueryHandler","Handler","addHooks","_queryTopLayer","_queryTopLayerAtMapCenter","removeHooks","_getTopQueryableLayer","l","mapmlLayer","event","isFocused","layerPoint","latLngToLayerPoint","latLngToContainerPoint","_query","tcrs2pcrs","tcrs2gcrs","fetchFeatures","lastOne","contenttype","get","Error","mapmldoc","Array","slice","metas","geom","f","popupOptions","openPopup","_popup","displayFeaturesPopup","err","message","autoPan","maxHeight","tcrsClickLoc","latLngToPoint","tileMatrixClickLoc","tileBounds","Bounds","ceil","column","longitude","latitude","ContextMenu","_touchstart","msPointer","pointer","activeIndex","excludedIndices","isRunned","_menuItems","CTXBACK","CTXFWD","CTXRELOAD","CTXFULLSCR","CTXSPACER1","CTXCOPY","CTXPASTE","CTXSPACER2","CTXCNTRLS","CTXDEBUG","CTXVWSRC","_items","cmBack","callback","_goBack","cmForward","_goForward","cmReload","_reload","btnFullScreen","_toggleFullScreen","spacer","cmCopyCoords","_copyCoords","hideOnSelect","submenu","cmCopyMapML","_copyMapML","cmCopyExtent","_copyExtent","cmCopyLocation","_copyLocation","cmPasteLayer","_paste","cmToggleControls","cmToggleDebug","_toggleDebug","cmViewSource","_viewSource","defExtCS","defaultExtCoor","defLocCS","defaultLocCoor","LYRZOOMTO","LYRCOPY","_layerItems","lmZoomToLayer","_zoomToLayer","lmCopyLayer","_copyLayer","_mapMenuVisible","_keyboardEvent","getContainer","_createItem","_copySubMenu","_clickEvent","CPYMENUMAP","CPYMENUEXTENT","CPYMENULOC","_hide","_onKeyDown","touch","contextmenu","_show","mousedown","_updateCS","KeyboardEvent","coord","data","_copyData","_layerClicked","layerElem","getOuterHTML","forward","back","reload","replace","navigator","clipboard","readText","_pasteLayer","viewSource","toggleDebug","directory","_showCopySubMenu","execCommand","menu","_copyTile","_copyTileMatrix","_copyMap","_copyTCRS","_copyPCRS","_copyGCRS","click","caption","h2","pt","pointX","pointY","mapPt","_copyAllCoords","allData","index","_createSeparator","_insertElementAt","_createEventHandler","_onItemMouseOver","_onItemMouseOut","func","_showLocation","containerPointToLayerPoint","layerPointToLatLng","refEl","_showAtPoint","layerList","from","find","gecko","w","h","button","activeEl","activeElement","_elementInFocus","_layerMenuTabs","firstChild","_setPosition","anchor","containerSize","_getElementSize","contextmenuAnchor","_leaflet_pos","_sizeChanged","offsetWidth","_focusOnLayerControl","_setActiveItem","noActiveEl","next","nextIndex","prevIndex","code","copyEl","menuWidth","submenuWidth","_hideCopySubMenu","srcElement","toggleContextMenuItem","state","setViewFullScreenInnerHTML","btnExitFullScreen","tcrsTopLeft","tcrsBottomRight","tileMatrixTopLeft","tileMatrixBottomRight","minConverted","maxConverted","unprojectedMin","unprojectedMax","tcrs","boundsUnit","defaultMaxZoom","nativeMinZoom","nativeMaxZoom","locInputs","numberOfAxes","isFinite","minPixel","maxPixel","minGCRS","maxGCRS","pixelToPCRSPoint","pointToPCRSPoint","contentArray","stringSplit","prop","containerPoints","pairs","styleElm","ss","stylesheets","linkElm","s","array","a","_parseNumber","link","leafletLayer","justPan","hash","inPlace","newLayer","window","focusOnLoad","dfLayer","lastChild","addEventListener","dfPastedLayer","geojson2mapml","JSON","parse","json","table","thead","createTHead","insertRow","th1","th2","createTextNode","tbody","createTBody","hasOwnProperty","th","td","bboxExtent","geometryFunction","jsonType","out","setExtent","bbox","xmlStringLayer","multiPoint","linestring","multilinestring","polygon","multiPolygon","geometrycollection","Infinity","NEGATIVE_INFINITY","clone_feature","curr_feature","featureCaption","p","HTMLElement","_properties2Table","_updateExtent","coordinates","clone_point","clone_coords","clone_linestring","linestring_coordindates","clone_polygon","clone_multipoint","clone_multilinestring","m","geometries","fg","arr","arrayOfArrays","test","tableData","tr","source","dest","pointConv","proj4","_breakArray","_pcrsToGcrs","poly","newArr","conv","propertyFunction","Proj","ex","num","_table2properties","prop0","_geometry2geojson","geoms","n","replaceWith","bound","newZoom","mapCenterTCRS","mapHalf","mapTlNew","mapBrNew","mapTlPCRSNew","mapBrPCRSNew","mapPCRS","zOffset","AttributionButton","Attribution","prefix","disableClickPropagation","_addAttribution","dialog","kbdShortcuts","kbdMovement","kbdPanUp","kbdPanDown","kbdPanLeft","kbdPanRight","btnZoomIn","btnZoomOut","kbdPanIncrement","kbdZoom","kbdFeature","kbdPrevFeature","kbdNextFeature","attribs","_attributions","prefixAndAttribs","btnAttribution","Map","mergeOptions","toggleableAttributionControl","addInitHook","attributionButton","reloadButton","ReloadButton","scaleBar","ScaleBar","_goReload","_reloadButton","_updateDisabled","disable","_disabled","enable","Scale","maxWidth","updateWhenIdle","scaleControl","_scaleControl","_updateOutput","_focusOutput","_pixelsToDistance","px","dpi","devicePixelRatio","_scaleLength","scaleLength","outputFocus","output","scaleLine","distance","metric","FullscreenButton","false","true","_toggleTitle","_click","toggleFullscreen","isFullscreen","include","_isFullscreen","getRootNode","host","pseudoFullscreen","_disablePseudoFullscreen","exitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","_enablePseudoFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","ALLOW_KEYBOARD_INPUT","msRequestFullscreen","_setFullscreen","fullscreen","invalidateSize","_onFullscreenChange","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","fullscreenControl","fullscreenchange","onFullscreenChange","addControl","whenReady","fullscreenButton","geolocationButton","GeolocationButton","crosshair","Crosshair","Feature","locateControl","locate","showPopup","strings","btnLocTrackOff","locateOptions","MutationObserver","mutations","btnLocTrackOn","_marker","btnMyLocTrackOn","permanent","btnLocTrackLastKnown","btnMyLastKnownLocTrackOn","observe","attributes","attributeFilter","_isQueryable","_toggleEvents","_isMapFocused","_addOrRemoveCrosshair","_hasQueryableLayer","_addOrRemoveMapOutline","mapContainer","_outline","isLeafletContainer","_convertWrappers","_markup","_convertMarkup","_generateOutlinePoints","isClosed","_isClosed","attachLinkHandler","dragStart","hovered","visited","mouseup","onTop","nextLayer","eventPhase","Event","BUBBLING_PHASE","sqrt","pow","_handleLink","currentTarget","resolver","mapWidth","clientWidth","substring","addedMap","tileOrigin","zoomingTo","origin","pixelRings","_convertRing","rings","subP","subrings","pixelSubrings","pixelOutline","o","parts","sub","interm","points","attr","featureAttributes","tabindex","first","ring","subRings","_coordinateToArrays","cls","class","nodes","childNodes","cur","tempDiv","prev","line","ind","main","subParts","isFirst","parents","span","noSpan","local","numPair","attrMap","wrapperAttr","unshift","linkTarget","linkType","getPCRSCenter","stampLayer","outlinePath","_createPath","stroke","_updateStyle","entries","_rootGroup","outlineAdded","_removePath","_setPath","geometryToPath","_pointToMarker","_updatePathStyle","isMain","isOutline","lineCap","lineJoin","dashArray","dashOffset","fillColor","fillRule","def","closed","str","len2","firstLayer","_openPopup","_handleFocus","updateInteraction","layerID","addToIndex","part","subPart","vectorMinZoom","vectorMaxZoom","openTooltip","closeTooltip","prevFocus","nextFocus","AnnounceMovement","layeradd","layerremove","announceBounds","dragging","_draggable","dragged","focusAnnouncement","removeEventListener","_gcrsToTileMatrix","standard","amZoom","_layersMaxZoom","amMaxZoom","_layersMinZoom","amMinZoom","_traversalCall","visible","outOfBoundsPos","prevZoom","_historyIndex","inBoundsPos","pop","amZoomedOut","wasDragged","amDraggedOut","amEastBound","amWestBound","amNorthBound","amSouthBound","FeatureIndex","outBoundFeatures","_mapPCRSBounds","_updateMapBounds","lc","mc","dist","tmp","inbound","sort","b","ac","bc","Options","announceMovement","announceScale","imperial","lcOpacity","amColumn","amRow","Keyboard","altKey","metaKey","_panKeys","_panAnim","_inProgress","ctrlKey","panBy","maxBounds","panInsideBounds","_zoomKeys","187","107","61","171","189","109","54","173","setZoom","closeOnEscapeKey","featureIndexOverlay","FeatureIndexOverlay","_output","_body","initialFocus","_checkOverlap","_addOrRemoveFeatureIndex","_calculateReticleBounds","wRatio","hRatio","reticleDimension","getComputedStyle","minPoint","maxPoint","popupClosed","featureIndexBounds","allFeatures","_addToggleKeys","_newContent","direction","newContent","detectImagePath","getStyle","mapOptions","head","WGS84","CRS","CBMTILE","APSTILE","EPSG3857","_splitCoordinate","_coordsToArray","mapml2geojson"],"mappings":"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"}