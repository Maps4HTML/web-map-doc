{"version":3,"file":"web-map.js","sources":["../src/web-map.js"],"sourcesContent":["import './leaflet.js';  // a lightly modified version of Leaflet for use as browser module\nimport './mapml.js';       // refactored URI usage, replaced with URL standard\nimport { MapLayer } from './layer.js';\nimport { MapArea } from './map-area.js';\nimport { MapCaption } from './map-caption.js';\n\nexport class WebMap extends HTMLMapElement {\n  static get observedAttributes() {\n    return ['lat', 'lon', 'zoom', 'projection', 'width', 'height', 'controls', 'static'];\n  }\n  // see comments below regarding attributeChangedCallback vs. getter/setter\n  // usage.  Effectively, the user of the element must use the property, not\n  // the getAttribute/setAttribute/removeAttribute DOM API, because the latter\n  // calls don't result in the getter/setter being called (so you have to use\n  // the getter/setter directly)\n  get controls() {\n    return this.hasAttribute('controls');\n  }\n  set controls(value) {\n    const hasControls = Boolean(value);\n    if (hasControls)\n      this.setAttribute('controls', '');\n    else\n      this.removeAttribute('controls');\n    this._toggleControls(hasControls);\n  }\n  get controlslist() {\n    return this.hasAttribute('controlslist') ? this.getAttribute(\"controlslist\") : \"\";\n  }\n  set controlslist(val) {\n    let options = [\"nofullscreen\", \"nozoom\", \"nolayer\", \"noreload\"],\n        lowerVal = val.toLowerCase();\n    if (this.controlslist.includes(lowerVal) || !options.includes(lowerVal))return;\n    this.setAttribute(\"controlslist\", this.controlslist+` ${lowerVal}`);\n  }\n  get width() {\n    return (window.getComputedStyle(this).width).replace('px','');\n  }\n  set width(val) {\n    //img.height or img.width setters change or add the corresponding attributes\n    this.setAttribute(\"width\", val);\n  }\n  get height() {\n    return (window.getComputedStyle(this).height).replace('px','');\n  }\n  set height(val) {\n    //img.height or img.width setters change or add the corresponding attributes\n    this.setAttribute(\"height\", val);\n  }\n  get lat() {\n    return this.hasAttribute(\"lat\") ? this.getAttribute(\"lat\") : \"0\";\n  }\n  set lat(val) {\n    if (val) {\n      this.setAttribute(\"lat\", val);\n    }\n  }\n  get lon() {\n    return this.hasAttribute(\"lon\") ? this.getAttribute(\"lon\") : \"0\";\n  }\n  set lon(val) {\n    if (val) {\n      this.setAttribute(\"lon\", val);\n    }\n  }\n  get projection() {\n    return this.hasAttribute(\"projection\") ? this.getAttribute(\"projection\") : \"OSMTILE\";\n  }\n  set projection(val) {\n    if(val && M[val]){\n      this.setAttribute('projection', val);\n      if (this._map && this._map.options.projection !== val){\n        this._map.options.crs = M[val];\n        this._map.options.projection = val;\n        for(let layer of this.querySelectorAll(\"layer-\")){\n          layer.removeAttribute(\"disabled\");\n          let reAttach = this.removeChild(layer);\n          this.appendChild(reAttach);\n        }\n        if(this._debug) for(let i = 0; i<2;i++) this.toggleDebug();\n      } else this.dispatchEvent(new CustomEvent('createmap'));\n    } else throw new Error(\"Undefined Projection\");\n  }\n  get zoom() {\n    return this.hasAttribute(\"zoom\") ? this.getAttribute(\"zoom\") : 0;\n  }\n  set zoom(val) {\n    var parsedVal = parseInt(val,10);\n    if (!isNaN(parsedVal) && (parsedVal >= 0 && parsedVal <= 25)) {\n      this.setAttribute('zoom', parsedVal);\n    }\n  }\n  get layers() {\n    return this.getElementsByTagName('layer-');\n  }\n  get areas() {\n    return this.getElementsByTagName('area');\n  }\n\n  get extent(){\n    let map = this._map,\n      pcrsBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        map.getZoom(),\n        map.options.projection);\n    let formattedExtent = M._convertAndFormatPCRS(pcrsBounds, map);\n    if(map.getMaxZoom() !== Infinity){\n      formattedExtent.zoom = {\n        minZoom:map.getMinZoom(),\n        maxZoom:map.getMaxZoom()\n      };\n    }\n    return (formattedExtent);\n  }\n  get static() {\n    return this.hasAttribute('static');\n  }\n  set static(value) {\n    const isStatic = Boolean(value);\n    if (isStatic)\n      this.setAttribute('static', '');\n    else\n      this.removeAttribute('static');\n  }\n\n  constructor() {\n    // Always call super first in constructor\n    super();\n\n    this._source = this.outerHTML;\n    let tmpl = document.createElement('template');\n    tmpl.innerHTML = `<link rel=\"stylesheet\" href=\"${new URL(\"mapml.css\", import.meta.url).href}\">`; // jshint ignore:line\n\n    const rootDiv = document.createElement('div');\n    rootDiv.classList.add('mapml-web-map');\n\n    let shadowRoot = rootDiv.attachShadow({mode: 'open'});\n    this._container = document.createElement('div');\n\n    let output = \"<output role='status' aria-live='polite' aria-atomic='true' class='mapml-screen-reader-output'></output>\";\n    this._container.insertAdjacentHTML(\"beforeend\", output);\n\n    // Set default styles for the map element.\n    let mapDefaultCSS = document.createElement('style');\n    mapDefaultCSS.innerHTML =\n    `[is=\"web-map\"] {` +\n    `all: initial;` + // Reset properties inheritable from html/body, as some inherited styles may cause unexpected issues with the map element's components (https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/140).\n    `contain: layout size;` + // Contain layout and size calculations within the map element.\n    `display: inline-block;` + // This together with dimension properties is required so that Leaflet isn't working with a height=0 box by default.\n    `height: 150px;` + // Provide a \"default object size\" (https://github.com/Maps4HTML/HTML-Map-Element/issues/31).\n    `width: 300px;` +\n    `border-width: 2px;` + // Set a default border for contrast, similar to UA default for iframes.\n    `border-style: inset;` +\n    `box-sizing: inherit;` + // https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/350#issuecomment-888361985\n    `}` +\n    `[is=\"web-map\"][frameborder=\"0\"] {` +\n  \t`border-width: 0;` +\n  \t`}` +\n    `[is=\"web-map\"][hidden] {` +\n    `display: none!important;` +\n    `}` +\n    `[is=\"web-map\"] .mapml-web-map {` +\n    `display: contents;` + // This div doesn't have to participate in layout by generating its own box.\n    `}`;\n    \n    let shadowRootCSS = document.createElement('style');\n    shadowRootCSS.innerHTML =\n    `:host .leaflet-control-container {` +\n    `visibility: hidden!important;` + // Visibility hack to improve percieved performance (mitigate FOUC) â€“ visibility is unset in mapml.css! (https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/154).\n    `}`;\n    \n    // Hide all (light DOM) children of the map element except for the\n    // `<area>` and `<div class=\"mapml-web-map\">` (shadow root host) elements.\n    let hideElementsCSS = document.createElement('style');\n    hideElementsCSS.innerHTML =\n    `[is=\"web-map\"] > :not(area):not(.mapml-web-map) {` +\n    `display: none!important;` +\n    `}`;\n    \n    shadowRoot.appendChild(shadowRootCSS);\n    shadowRoot.appendChild(tmpl.content.cloneNode(true));\n    shadowRoot.appendChild(this._container);\n    this.appendChild(rootDiv);\n    this.appendChild(hideElementsCSS);\n    document.head.insertAdjacentElement('afterbegin', mapDefaultCSS);\n    this._toggleState = false;\n    this.controlsListObserver = new MutationObserver((m) => {\n      m.forEach((change)=>{\n        if(change.type===\"attributes\" && change.attributeName === \"controlslist\")\n          this.setControls(false,false,false);\n      });\n    });\n    this.controlsListObserver.observe(this, {attributes:true});\n  }\n\n  connectedCallback() {\n    if (this.isConnected) {\n\n      // the dimension attributes win, if they're there. A map does not\n      // have an intrinsic size, unlike an image or video, and so must\n      // have a defined width and height.\n      var s = window.getComputedStyle(this),\n        wpx = s.width, hpx=s.height,\n        w = this.hasAttribute(\"width\") ? this.getAttribute(\"width\") : parseInt(wpx.replace('px','')),\n        h = this.hasAttribute(\"height\") ? this.getAttribute(\"height\") : parseInt(hpx.replace('px',''));\n      this._changeWidth(w);\n      this._changeHeight(h);\n\n\n      // create an array to track the history of the map and the current index\n      if(!this._history){\n        this._history = [];\n        this._historyIndex = -1;\n        this._traversalCall = false;\n      }\n\n      this.addEventListener('createmap', ()=>{\n        if (!this._map) {\n          this._map = L.map(this._container, {\n            center: new L.LatLng(this.lat, this.lon),\n            projection: this.projection,\n            query: true,\n            contextMenu: true,\n            announceMovement: M.options.announceMovement,\n            featureIndex: true,\n            mapEl: this,\n            crs: M[this.projection],\n            zoom: this.zoom,\n            zoomControl: false,\n            // because the M.MapMLLayer invokes _tileLayer._onMoveEnd when\n            // the mapml response is received the screen tends to flash.  I'm sure\n            // there is a better configuration than that, but at this moment\n            // I'm not sure how to approach that issue.\n            // See https://github.com/Maps4HTML/MapML-Leaflet-Client/issues/24\n            fadeAnimation: true\n          });\n          this._addToHistory();\n          // the attribution control is not optional\n          M.attributionControl(this);\n\n          this.setControls(false,false,true);\n          this._crosshair = M.crosshair().addTo(this._map);\n          if(M.options.featureIndexOverlayOption) this._featureIndexOverlay = M.featureIndexOverlay().addTo(this._map);\n\n          if (this.hasAttribute('name')) {\n            var name = this.getAttribute('name');\n            if (name) {\n              this.poster = document.querySelector('img[usemap='+'\"#'+name+'\"]');\n              // firefox has an issue where the attribution control's use of\n              // _container.innerHTML does not work properly if the engine is throwing\n              // exceptions because there are no area element children of the image map\n              // for firefox only, a workaround is to actually remove the image...\n              if (this.poster) {\n                if (L.Browser.gecko) {\n                    this.poster.removeAttribute('usemap');\n                }\n                //this.appendChild(this.poster);\n              }\n            }\n          }\n\n          // undisplay the img in the image map, because it's not needed now.\n          // gives a slight FOUC, unless:\n          // 1) the img is pre-styled (https://github.com/Maps4HTML/Web-Map-Custom-Element/blob/80a4a4e372d2ef61bb7cad6a111e17e396b8e908/index-map-area.html#L35)\n          // 2) placed after the map element\n          if (this.poster) {\n            this.poster.setAttribute('hidden', '');\n          }\n          \n          // https://github.com/Maps4HTML/Web-Map-Custom-Element/issues/274\n          this.setAttribute('role', 'application');\n          // Make the Leaflet container element programmatically identifiable\n          // (https://github.com/Leaflet/Leaflet/issues/7193).\n          this._container.setAttribute('role', 'region');\n          this._container.setAttribute('aria-label', 'Interactive map');\n          \n          this._setUpEvents();\n          // this.fire('load', {target: this});\n        }\n      }, {once:true});\n\n      let custom = !([\"CBMTILE\",\"APSTILE\",\"OSMTILE\",\"WGS84\"].includes(this.projection));\n      // if the page doesn't use nav.js or isn't custom then dispatch createmap event\t\n      if(!custom){\t\n        this.dispatchEvent(new CustomEvent('createmap'));\n      }\n      \n      if (this._map && this.hasAttribute('static')) {\n        this._toggleStatic();\n      }\n\n      /*\n        1. only deletes aria-label when the last (only remaining) map caption is removed\n        2. only deletes aria-label if the aria-label was defined by the map caption element itself\n      */\n      \n      let mapcaption = this.querySelector('map-caption');\n      \n      if (mapcaption !== null) {\n        setTimeout(() => {\n          let ariaupdate = this.getAttribute('aria-label');\n        \n          if (ariaupdate === mapcaption.innerHTML) {\n            this.mapCaptionObserver = new MutationObserver((m) => {\n              let mapcaptionupdate = this.querySelector('map-caption');\n              if (mapcaptionupdate !== mapcaption) {\n                this.removeAttribute('aria-label');\n              }     \n            });\n            this.mapCaptionObserver.observe(this, {\n              childList: true\n            });\n          }\n        }, 0);\n      }\n    }\n  }\n  disconnectedCallback() {\n    //this._removeEvents();\n    delete this._map;\n  }\n  adoptedCallback() {\n//    console.log('Custom map element moved to new page.');\n  }\n\n  setControls(isToggle, toggleShow, setup){\n    if (this.controls && this._map) {\n      let controls = [\"_zoomControl\", \"_reloadButton\", \"_fullScreenControl\", \"_layerControl\"],\n          options = [\"nozoom\", \"noreload\", \"nofullscreen\", 'nolayer'],\n          mapSize = this._map.getSize().y,\n          totalSize = 0;\n\n      //removes the left hand controls, if not done they will be re-added in the incorrect order\n      //better to just reset them\n      for(let i = 0 ; i<3;i++){\n        if(this[controls[i]]){\n          this._map.removeControl(this[controls[i]]);\n          delete this[controls[i]];\n        }\n      }\n\n      if (!this.controlslist.toLowerCase().includes(\"nolayer\") && !this._layerControl && this.layers.length > 0){\n        this._layerControl = M.layerControl(null,{\"collapsed\": true, mapEl: this}).addTo(this._map);\n        //if this is the initial setup the layers dont need to be readded, causes issues if they are\n        if(!setup){\n          for (var i=0;i<this.layers.length;i++) {\n            if (!this.layers[i].hidden) {\n              this._layerControl.addOverlay(this.layers[i]._layer, this.layers[i].label);\n              this._map.on('moveend', this.layers[i]._validateDisabled,  this.layers[i]);\n              this.layers[i]._layerControl = this._layerControl;\n            }\n          }\n          this._map.fire(\"validate\");\n        }\n      }\n      if (!this.controlslist.toLowerCase().includes(\"nozoom\") && !this._zoomControl && (totalSize + 93) <= mapSize){\n        totalSize += 93;\n        this._zoomControl = L.control.zoom().addTo(this._map);\n      }\n      if (!this.controlslist.toLowerCase().includes(\"noreload\") && !this._reloadButton && (totalSize + 49) <= mapSize){\n        totalSize += 49;\n        this._reloadButton = M.reloadButton().addTo(this._map);\n      }\n      if (!this.controlslist.toLowerCase().includes(\"nofullscreen\") && !this._fullScreenControl && (totalSize + 49) <= mapSize){\n        totalSize += 49;\n        this._fullScreenControl = M.fullscreenButton().addTo(this._map);\n      }\n      //removes any control layers that are not needed, either by the toggling or by the controlslist attribute\n      for(let i in options){\n        if(this[controls[i]] && (this.controlslist.toLowerCase().includes(options[i]) || (isToggle && !toggleShow ))){\n          this._map.removeControl(this[controls[i]]);\n          delete this[controls[i]];\n        }\n      }\n    }else if (!this.controls && this._map) {\n      this._map.contextMenu._items[4].el.el.setAttribute(\"disabled\", \"\");\n    }\n  }\n  attributeChangedCallback(name, oldValue, newValue) {\n//    console.log('Attribute: ' + name + ' changed from: '+ oldValue + ' to: '+newValue);\n    // \"Best practice\": handle side-effects in this callback\n    // https://developers.google.com/web/fundamentals/web-components/best-practices\n    // https://developers.google.com/web/fundamentals/web-components/best-practices#avoid-reentrancy\n    // note that the example is misleading, since the user can't use\n    // setAttribute or removeAttribute to set the property, they need to use\n    // the property directly in their API usage, which kinda sucks\n    /*\n  const hasValue = newValue !== null;\n  switch (name) {\n    case 'checked':\n      // Note the attributeChangedCallback is only handling the *side effects*\n      // of setting the attribute.\n      this.setAttribute('aria-checked', hasValue);\n      break;\n    ...\n  }     */\n    switch(name) {\n      case 'height': \n        if (oldValue !== newValue) {\n          this._changeHeight(newValue);\n        }\n      break;  \n      case 'width': \n        if (oldValue !== newValue) {\n          this._changeWidth(newValue);\n        }\n      break;  \n      case 'static':\n        this._toggleStatic();\n      break;  \n    }\n  }\n  _toggleStatic(){\n    const isStatic = this.hasAttribute('static');\n    if (this._map) {\n      if (isStatic) {\n        this._map.dragging.disable();\n        this._map.touchZoom.disable();\n        this._map.doubleClickZoom.disable();\n        this._map.scrollWheelZoom.disable();\n        this._map.boxZoom.disable();\n        this._map.keyboard.disable();\n        this._zoomControl.disable();\n      } else {\n        this._map.dragging.enable();\n        this._map.touchZoom.enable();\n        this._map.doubleClickZoom.enable();\n        this._map.scrollWheelZoom.enable();\n        this._map.boxZoom.enable();\n        this._map.keyboard.enable();\n        this._zoomControl.enable();\n      }\n    }\n  }\n  _dropHandler(event) {\n    event.preventDefault();\n    let text = event.dataTransfer.getData(\"text\");\n    M._pasteLayer(this, text);\n  }\n  _dragoverHandler(event) {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = \"copy\";\n  }\n  _removeEvents() {\n    if (this._map) {\n      this._map.off();\n      this.removeEventListener(\"drop\", this._dropHandler, false);\n      this.removeEventListener(\"dragover\", this._dragoverHandler, false);\n    }\n  }\n  _setUpEvents() {\n    this.addEventListener(\"drop\", this._dropHandler, false);\n    this.addEventListener(\"dragover\", this._dragoverHandler, false);\n    this.addEventListener(\"change\",\n    function(e) {\n      if(e.target.tagName === \"LAYER-\"){\n        this.dispatchEvent(new CustomEvent(\"layerchange\", {details:{target: this, originalEvent: e}}));\n      }\n    }, false);\n\n    this.parentElement.addEventListener('keyup', function (e) {\n      if(e.keyCode === 9 && document.activeElement.nodeName === \"MAPML-VIEWER\"){\n        document.activeElement.dispatchEvent(new CustomEvent('mapfocused', {detail:\n              {target: this}}));\n      }\n    });\n    // pasting layer-, links and geojson using Ctrl+V \n    this.addEventListener('keydown', function (e) {\n      if(e.keyCode === 86 && e.ctrlKey){\n        navigator.clipboard\n          .readText()\n          .then(\n            (layer) => {\n              M._pasteLayer(this, layer);\n            });\n      } else if (e.keyCode === 32) {\n        e.preventDefault();\n        this._map.fire('keypress', {originalEvent: e});\n      }\n    });\n    this.parentElement.addEventListener('mousedown', function (e) {\n      if(document.activeElement.nodeName === \"MAPML-VIEWER\"){\n        document.activeElement.dispatchEvent(new CustomEvent('mapfocused', {detail:\n              {target: this}}));\n      }\n    });\n    this._map.on('load',\n      function () {\n        this.dispatchEvent(new CustomEvent('load', {detail: {target: this}}));\n      }, this);\n    this._map.on('preclick',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('preclick', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('click',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('click', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('dblclick',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('dblclick', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('mousemove',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('mousemove', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('mouseover',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('mouseover', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('mouseout',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('mouseout', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('mousedown',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('mousedown', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      },this);\n    this._map.on('mouseup',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('mouseup', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('contextmenu',\n      function (e) {\n        this.dispatchEvent(new CustomEvent('contextmenu', {detail:\n          {lat: e.latlng.lat,     lon: e.latlng.lng,\n             x: e.containerPoint.x, y: e.containerPoint.y}\n         }));\n      }, this);\n    this._map.on('movestart',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(new CustomEvent('movestart', {detail:\n          {target: this}}));\n      }, this);\n    this._map.on('move',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(new CustomEvent('move', {detail:\n          {target: this}}));\n      }, this);\n    this._map.on('moveend',\n      function () {\n        this._updateMapCenter();\n        this._addToHistory();\n        this.dispatchEvent(new CustomEvent('moveend', {detail:\n          {target: this}}));\n      }, this);\n    this._map.on('zoomstart',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(new CustomEvent('zoomstart', {detail:\n          {target: this}}));\n      }, this);\n    this._map.on('zoom',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(new CustomEvent('zoom', {detail:\n          {target: this}}));\n      }, this);\n    this._map.on('zoomend',\n      function () {\n        this._updateMapCenter();\n        this.dispatchEvent(new CustomEvent('zoomend', {detail:\n          {target: this}}));\n      }, this);\n  }\n  _toggleControls() {\n    if (this._map) {\n        this.setControls(true, this._toggleState, false);\n        this._toggleState = !this._toggleState;\n    }\n  }\n\n  toggleDebug(){\n    if(this._debug){\n      this._debug.remove();\n      this._debug = undefined;\n    } else {\n      this._debug = M.debugOverlay().addTo(this._map);\n    }\n  }\n  \n  _changeWidth(width) {\n    this._container.style.width = width+\"px\";\n    document.querySelector('[is=\"web-map\"]').style.width = width+\"px\";\n    if (this._map) {\n        this._map.invalidateSize(false);\n    }\n  }\n  _changeHeight(height) {\n    this._container.style.height = height+\"px\";\n    document.querySelector('[is=\"web-map\"]').style.height = height+\"px\";\n    if (this._map) {\n        this._map.invalidateSize(false);\n    }\n  }\n  zoomTo(lat, lon, zoom) {\n    zoom = Number.isInteger(+zoom) ? +zoom : this.zoom;\n    let location = new L.LatLng(+lat, +lon);\n    this._map.setView(location, zoom);\n    this.zoom = zoom;\n    this.lat = location.lat;\n    this.lon = location.lng;\n  }\n  _updateMapCenter() {\n    // remember to tell Leaflet event handler that 'this' in here refers to\n    //  something other than the map in this case the custom polymer element\n    this.lat = this._map.getCenter().lat;\n    this.lon = this._map.getCenter().lng;\n    this.zoom = this._map.getZoom();\n  }\n\n  /**\n   * Adds to the maps history on moveends\n   * @private\n   */\n  _addToHistory(){\n    if(this._traversalCall > 0) { // this._traversalCall tracks how many consecutive moveends to ignore from history\n      this._traversalCall--;      // this is useful for ignoring moveends corresponding to back, forward and reload\n      return;\n    }\n\n    let mapLocation = this._map.getPixelBounds().getCenter();\n    let location = {\n      zoom: this._map.getZoom(),\n      x:mapLocation.x,\n      y:mapLocation.y,\n    };\n    this._historyIndex++;\n    this._history.splice(this._historyIndex, 0, location);\n    // Remove future history and overwrite it when map pan/zoom while inside history\n    if (this._historyIndex + 1 !== this._history.length) {\n      this._history.length = this._historyIndex + 1;\n    }\n    if (this._historyIndex === 0) {\n      // when at initial state of map, disable back, forward, and reload items\n      this._map.contextMenu._items[0].el.el.disabled = true; // back contextmenu item\n      this._map.contextMenu._items[1].el.el.disabled = true; // forward contextmenu item\n      this._map.contextMenu._items[2].el.el.disabled = true; // reload contextmenu item\n    } else {\n      this._map.contextMenu._items[0].el.el.disabled = false; // back contextmenu item\n      this._map.contextMenu._items[1].el.el.disabled = true; // forward contextmenu item\n      this._map.contextMenu._items[2].el.el.disabled = false; // reload contextmenu item\n    }\n  }\n\n  /**\n   * Allow user to move back in history\n   */\n  back(){\n    let history = this._history;\n    let curr = history[this._historyIndex];\n\n    if(this._historyIndex > 0){\n      this._map.contextMenu._items[1].el.el.disabled = false; // forward contextmenu item\n      this._historyIndex--;\n      let prev = history[this._historyIndex];\n      // Disable back, reload contextmenu item when at the end of history\n      if (this._historyIndex === 0) {\n        this._map.contextMenu._items[0].el.el.disabled = true; // back contextmenu item\n        this._map.contextMenu._items[2].el.el.disabled = true; // reload contextmenu item\n      }\n\n      if(prev.zoom !== curr.zoom){\n        this._traversalCall = 2;  // allows the next 2 moveends to be ignored from history\n\n        let currScale = this._map.options.crs.scale(curr.zoom); // gets the scale of the current zoom level\n        let prevScale = this._map.options.crs.scale(prev.zoom); // gets the scale of the previous zoom level\n\n        let scale = currScale / prevScale; // used to convert the previous pixel location to be in terms of the current zoom level\n\n        this._map.panBy([((prev.x * scale) - curr.x), ((prev.y * scale) - curr.y)], {animate: false});\n        this._map.setZoom(prev.zoom);\n      } else {\n        this._traversalCall = 1;\n        this._map.panBy([(prev.x - curr.x), (prev.y - curr.y)]);\n      }\n    }\n  }\n\n  /**\n   * Allows user to move forward in history\n   */\n  forward(){\n    let history = this._history;\n    let curr = history[this._historyIndex];\n    if(this._historyIndex < history.length - 1){\n      this._map.contextMenu._items[0].el.el.disabled = false; // back contextmenu item\n      this._map.contextMenu._items[2].el.el.disabled = false; // reload contextmenu item\n      this._historyIndex++;\n      let next = history[this._historyIndex];\n      // disable forward contextmenu item, when at the end of forward history\n      if (this._historyIndex + 1 === this._history.length) {\n        this._map.contextMenu._items[1].el.el.disabled = true; // forward contextmenu item\n      }\n\n      if(next.zoom !== curr.zoom){\n        this._traversalCall = 2; // allows the next 2 moveends to be ignored from history\n\n        let currScale = this._map.options.crs.scale(curr.zoom); // gets the scale of the current zoom level\n        let nextScale = this._map.options.crs.scale(next.zoom); // gets the scale of the next zoom level\n\n        let scale = currScale / nextScale; // used to convert the next pixel location to be in terms of the current zoom level\n\n        this._map.panBy([((next.x * scale) - curr.x), ((next.y * scale) - curr.y)], {animate: false});\n        this._map.setZoom(next.zoom);\n      } else {\n        this._traversalCall = 1;\n        this._map.panBy([(next.x - curr.x), (next.y - curr.y)]);\n      }\n    }\n  }\n\n  /**\n   * Allows the user to reload/reset the map's location to it's initial location\n   */\n  reload(){\n    let initialLocation = this._history.shift();\n    let mapLocation = this._map.getPixelBounds().getCenter();\n    let curr = {\n      zoom: this._map.getZoom(),\n      x:mapLocation.x,\n      y:mapLocation.y,\n    };\n\n    this._map.contextMenu._items[0].el.el.disabled = true; // back contextmenu item\n    this._map.contextMenu._items[1].el.el.disabled = true; // forward contextmenu item\n    this._map.contextMenu._items[2].el.el.disabled = true; // reload contextmenu item\n\n    this._history = [initialLocation];\n    this._historyIndex = 0;\n\n    if(initialLocation.zoom !== curr.zoom) {\n      this._traversalCall = 2; // ignores the next 2 moveend events\n\n      let currScale = this._map.options.crs.scale(curr.zoom); // gets the scale of the current zoom level\n      let initScale = this._map.options.crs.scale(initialLocation.zoom); // gets the scale of the initial location's zoom\n\n      let scale = currScale / initScale;\n\n      this._map.panBy([((initialLocation.x * scale) - curr.x), ((initialLocation.y * scale) - curr.y)], {animate: false});\n      this._map.setZoom(initialLocation.zoom);\n    } else { // if it's on the same zoom level as the initial location, no need to calculate scales\n      this._traversalCall = 1;\n      this._map.panBy([(initialLocation.x- curr.x), (initialLocation.y - curr.y)]);\n    }\n  }\n\n  viewSource(){\n    let blob = new Blob([this._source],{type:\"text/plain\"}),\n        url = URL.createObjectURL(blob);\n    window.open(url);\n    URL.revokeObjectURL(url);\n  }\n\n  defineCustomProjection(jsonTemplate) {\n    let t = JSON.parse(jsonTemplate);\n    if (t === undefined || !t.proj4string || !t.projection || !t.resolutions || !t.origin || !t.bounds) throw new Error('Incomplete TCRS Definition');\n    if (t.projection.indexOf(\":\") >= 0) throw new Error('\":\" is not permitted in projection name');\n    if (M[t.projection.toUpperCase()]) return t.projection.toUpperCase();\n    let tileSize = [256, 512, 1024, 2048, 4096].includes(t.tilesize)?t.tilesize:256;\n\n    M[t.projection] = new L.Proj.CRS(t.projection, t.proj4string, {\n      origin: t.origin,\n      resolutions: t.resolutions,\n      bounds: L.bounds(t.bounds),\n      crs: {\n        tcrs: {\n          horizontal: {\n            name: \"x\",\n            min: 0, \n            max: zoom => (Math.round(M[t.projection].options.bounds.getSize().x / M[t.projection].options.resolutions[zoom]))\n          },\n          vertical: {\n            name: \"y\",\n            min:0, \n            max: zoom => (Math.round(M[t.projection].options.bounds.getSize().y / M[t.projection].options.resolutions[zoom]))\n          },\n          bounds: zoom => L.bounds([M[t.projection].options.crs.tcrs.horizontal.min,\n            M[t.projection].options.crs.tcrs.vertical.min],\n            [M[t.projection].options.crs.tcrs.horizontal.max(zoom),\n            M[t.projection].options.crs.tcrs.vertical.max(zoom)])\n        },\n        pcrs: {\n          horizontal: {\n            name: \"easting\",\n            get min() {return M[t.projection].options.bounds.min.x;},\n            get max() {return M[t.projection].options.bounds.max.x;}\n          }, \n          vertical: {\n            name: \"northing\", \n            get min() {return M[t.projection].options.bounds.min.y;},\n            get max() {return M[t.projection].options.bounds.max.y;}\n          },\n          get bounds() {return M[t.projection].options.bounds;}\n        }, \n        gcrs: {\n          horizontal: {\n            name: \"longitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            get min() {return M[t.projection].unproject(M.OSMTILE.options.bounds.min).lng;},\n            get max() {return M[t.projection].unproject(M.OSMTILE.options.bounds.max).lng;}\n          }, \n          vertical: {\n            name: \"latitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            get min() {return M[t.projection].unproject(M.OSMTILE.options.bounds.min).lat;},\n            get max() {return M[t.projection].unproject(M.OSMTILE.options.bounds.max).lat;}\n          },\n          get bounds() {return L.latLngBounds(\n                [M[t.projection].options.crs.gcrs.vertical.min,M[t.projection].options.crs.gcrs.horizontal.min],\n                [M[t.projection].options.crs.gcrs.vertical.max,M[t.projection].options.crs.gcrs.horizontal.max]);}\n        },\n        map: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: map => map.getSize().x\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: map => map.getSize().y\n          },\n          bounds: map => L.bounds(L.point([0,0]),map.getSize())\n        },\n        tile: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: tileSize,\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: tileSize,\n          },\n          get bounds() {return L.bounds(\n                    [M[t.projection].options.crs.tile.horizontal.min,M[t.projection].options.crs.tile.vertical.min],\n                    [M[t.projection].options.crs.tile.horizontal.max,M[t.projection].options.crs.tile.vertical.max]);}\n        },\n        tilematrix: {\n          horizontal: {\n            name: \"column\",\n            min: 0,\n            max: zoom => (Math.round(M[t.projection].options.crs.tcrs.horizontal.max(zoom) / M[t.projection].options.crs.tile.bounds.getSize().x))\n          },\n          vertical: {\n            name: \"row\",\n            min: 0,\n            max: zoom => (Math.round(M[t.projection].options.crs.tcrs.vertical.max(zoom) / M[t.projection].options.crs.tile.bounds.getSize().y))\n          },\n          bounds: zoom => L.bounds(\n                   [M[t.projection].options.crs.tilematrix.horizontal.min,\n                   M[t.projection].options.crs.tilematrix.vertical.min],\n                   [M[t.projection].options.crs.tilematrix.horizontal.max(zoom),\n                   M[t.projection].options.crs.tilematrix.vertical.max(zoom)])\n        }\n      },\n    });      //creates crs using L.Proj\n    M[t.projection.toUpperCase()] = M[t.projection]; //adds the projection uppercase to global M\n    return t.projection;\n  }\n\n  geojson2mapml(json, options = {}){\n    if (options.projection === undefined) {\n      options.projection = this.projection;\n    }\n    let geojsonLayer = M.geojson2mapml(json, options);\n    this.appendChild(geojsonLayer);\n    return geojsonLayer;\n  }\n\n  _ready() {\n    if (this.hasAttribute('name')) {\n      var name = this.getAttribute('name');\n      if (name) {\n        this.poster = document.querySelector('img[usemap='+'\"#'+name+'\"]');\n        // firefox has an issue where the attribution control's use of\n        // _container.innerHTML does not work properly if the engine is throwing\n        // exceptions because there are no area element children of the image map\n        // for firefox only, a workaround is to actually remove the image...\n        if (this.poster) {\n          if (L.Browser.gecko) {\n            this.poster.removeAttribute('usemap');\n          }\n          this._container.appendChild(this.poster);\n        }\n      }\n    }\n  }\n}\n// need to provide options { extends: ... }  for custom built-in elements\nwindow.customElements.define('web-map', WebMap,  { extends: 'map' });\nwindow.customElements.define('layer-', MapLayer);\nwindow.customElements.define('map-area', MapArea, {extends: 'area'});\nwindow.customElements.define('map-caption',MapCaption);\n"],"names":["MapLayer","MapArea","MapCaption","WebMap","HTMLMapElement","observedAttributes","controls","this","hasAttribute","value","hasControls","Boolean","setAttribute","removeAttribute","_toggleControls","controlslist","getAttribute","val","lowerVal","toLowerCase","includes","width","window","getComputedStyle","replace","height","lat","lon","projection","M","Error","_map","options","crs","let","layer","querySelectorAll","reAttach","removeChild","appendChild","_debug","i","toggleDebug","dispatchEvent","CustomEvent","zoom","parsedVal","parseInt","isNaN","layers","getElementsByTagName","areas","extent","map","pcrsBounds","pixelToPCRSBounds","getPixelBounds","getZoom","formattedExtent","_convertAndFormatPCRS","getMaxZoom","Infinity","minZoom","getMinZoom","maxZoom","static","constructor","super","_source","outerHTML","tmpl","document","createElement","innerHTML","URL","import","meta","url","href","rootDiv","classList","add","shadowRoot","attachShadow","mode","_container","insertAdjacentHTML","mapDefaultCSS","shadowRootCSS","hideElementsCSS","content","cloneNode","head","insertAdjacentElement","_toggleState","controlsListObserver","MutationObserver","m","forEach","change","type","attributeName","setControls","observe","attributes","connectedCallback","isConnected","s","wpx","hpx","w","h","_changeWidth","_changeHeight","_history","_historyIndex","_traversalCall","addEventListener","name","L","center","LatLng","query","contextMenu","announceMovement","featureIndex","mapEl","zoomControl","fadeAnimation","_addToHistory","attributionControl","_crosshair","crosshair","addTo","featureIndexOverlayOption","_featureIndexOverlay","featureIndexOverlay","poster","querySelector","Browser","gecko","_setUpEvents","once","_toggleStatic","mapcaption","setTimeout","mapCaptionObserver","childList","disconnectedCallback","adoptedCallback","isToggle","toggleShow","setup","mapSize","getSize","y","totalSize","removeControl","_layerControl","length","layerControl","collapsed","hidden","addOverlay","_layer","label","on","_validateDisabled","fire","_zoomControl","control","_reloadButton","reloadButton","_fullScreenControl","fullscreenButton","_items","el","attributeChangedCallback","oldValue","newValue","isStatic","dragging","disable","touchZoom","doubleClickZoom","scrollWheelZoom","boxZoom","keyboard","enable","_dropHandler","event","preventDefault","text","dataTransfer","getData","_pasteLayer","_dragoverHandler","dropEffect","_removeEvents","off","removeEventListener","e","target","tagName","details","originalEvent","parentElement","keyCode","activeElement","nodeName","detail","ctrlKey","navigator","clipboard","readText","then","latlng","lng","x","containerPoint","_updateMapCenter","remove","undefined","debugOverlay","style","invalidateSize","zoomTo","Number","isInteger","location","setView","getCenter","mapLocation","splice","disabled","back","prev","history","curr","scale","panBy","animate","setZoom","forward","next","reload","initialLocation","shift","viewSource","blob","Blob","createObjectURL","open","revokeObjectURL","defineCustomProjection","jsonTemplate","t","JSON","parse","proj4string","resolutions","origin","bounds","indexOf","toUpperCase","tileSize","tilesize","Proj","CRS","tcrs","horizontal","min","max","Math","round","vertical","pcrs","gcrs","unproject","OSMTILE","latLngBounds","point","tile","tilematrix","geojson2mapml","json","geojsonLayer","_ready","customElements","define","extends"],"mappings":"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"}